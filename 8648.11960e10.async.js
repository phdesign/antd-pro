(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8648],{64335:function(pr,O,x){"use strict";var J=x(67294),E=(0,J.createContext)({});O.Z=E},21349:function(pr,O,x){"use strict";var J=x(84305),E=x(69224),p=x(17781),w=x.n(p),z=x(67294),q=x(94184),Y=x.n(q),ce=x(64335),ne=function(we){var Me=(0,z.useContext)(ce.Z),Kt=we.children,Zt=we.contentWidth,Xt=we.className,zt=we.style,Lt=(0,z.useContext)(E.ZP.ConfigContext),yt=Lt.getPrefixCls,pt=we.prefixCls||yt("pro"),Pr=Zt||Me.contentWidth,Ht="".concat(pt,"-grid-content");return z.createElement("div",{className:Y()(Ht,Xt,{wide:Pr==="Fixed"}),style:zt},z.createElement("div",{className:"".concat(pt,"-grid-content-children")},Kt))};O.Z=ne},46343:function(pr,O,x){"use strict";x.d(O,{zj:function(){return dt},oI:function(){return ln},ni:function(){return ae},gg:function(){return zr}});var J=x(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function E(tr,oe,ge,Re){function qe(Ct){return Ct instanceof ge?Ct:new ge(function(kt){kt(Ct)})}return new(ge||(ge=Promise))(function(Ct,kt){function S(Be){try{he(Re.next(Be))}catch($e){kt($e)}}function F(Be){try{he(Re.throw(Be))}catch($e){kt($e)}}function he(Be){Be.done?Ct(Be.value):qe(Be.value).then(S,F)}he((Re=Re.apply(tr,oe||[])).next())})}function p(tr,oe){var ge={label:0,sent:function(){if(Ct[0]&1)throw Ct[1];return Ct[1]},trys:[],ops:[]},Re,qe,Ct,kt;return kt={next:S(0),throw:S(1),return:S(2)},typeof Symbol=="function"&&(kt[Symbol.iterator]=function(){return this}),kt;function S(he){return function(Be){return F([he,Be])}}function F(he){if(Re)throw new TypeError("Generator is already executing.");for(;ge;)try{if(Re=1,qe&&(Ct=he[0]&2?qe.return:he[0]?qe.throw||((Ct=qe.return)&&Ct.call(qe),0):qe.next)&&!(Ct=Ct.call(qe,he[1])).done)return Ct;switch(qe=0,Ct&&(he=[he[0]&2,Ct.value]),he[0]){case 0:case 1:Ct=he;break;case 4:return ge.label++,{value:he[1],done:!1};case 5:ge.label++,qe=he[1],he=[0];continue;case 7:he=ge.ops.pop(),ge.trys.pop();continue;default:if(Ct=ge.trys,!(Ct=Ct.length>0&&Ct[Ct.length-1])&&(he[0]===6||he[0]===2)){ge=0;continue}if(he[0]===3&&(!Ct||he[1]>Ct[0]&&he[1]<Ct[3])){ge.label=he[1];break}if(he[0]===6&&ge.label<Ct[1]){ge.label=Ct[1],Ct=he;break}if(Ct&&ge.label<Ct[2]){ge.label=Ct[2],ge.ops.push(he);break}Ct[2]&&ge.ops.pop(),ge.trys.pop();continue}he=oe.call(tr,ge)}catch(Be){he=[6,Be],qe=0}finally{Re=Ct=0}if(he[0]&5)throw he[1];return{value:he[0]?he[1]:void 0,done:!0}}}function w(tr,oe){var ge=typeof Symbol=="function"&&tr[Symbol.iterator];if(!ge)return tr;var Re=ge.call(tr),qe,Ct=[],kt;try{for(;(oe===void 0||oe-- >0)&&!(qe=Re.next()).done;)Ct.push(qe.value)}catch(S){kt={error:S}}finally{try{qe&&!qe.done&&(ge=Re.return)&&ge.call(Re)}finally{if(kt)throw kt.error}}return Ct}function z(){for(var tr=[],oe=0;oe<arguments.length;oe++)tr=tr.concat(w(arguments[oe]));return tr}function q(tr){return tr&&tr.__esModule&&Object.prototype.hasOwnProperty.call(tr,"default")?tr.default:tr}function Y(tr,oe){return oe={exports:{}},tr(oe,oe.exports),oe.exports}var ce=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=ge;function ge(Re){return Re&&typeof Re.length=="number"&&Re.length>=0&&Re.length%1==0}tr.exports=oe.default});q(ce);var ne=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=function(ge){return function(){for(var Re=[],qe=arguments.length;qe--;)Re[qe]=arguments[qe];var Ct=Re.pop();return ge.call(this,Re,Ct)}},tr.exports=oe.default});q(ne);var be=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.fallback=qe,oe.wrap=Ct;var ge=oe.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Re=oe.hasNextTick=typeof J=="object"&&typeof J.nextTick=="function";function qe(S){setTimeout(S,0)}function Ct(S){return function(F){for(var he=[],Be=arguments.length-1;Be-- >0;)he[Be]=arguments[Be+1];return S(function(){return F.apply(void 0,he)})}}var kt;ge?kt=setImmediate:Re?kt=J.nextTick:kt=qe,oe.default=Ct(kt)});q(be);var we=be.fallback,Me=be.wrap,Kt=be.hasSetImmediate,Zt=be.hasNextTick,Xt=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=Ct;var ge=qe(ne),Re=qe(be);function qe(F){return F&&F.__esModule?F:{default:F}}function Ct(F){return(0,zt.isAsync)(F)?function(){for(var he=[],Be=arguments.length;Be--;)he[Be]=arguments[Be];var $e=he.pop(),vt=F.apply(this,he);return kt(vt,$e)}:(0,ge.default)(function(he,Be){var $e;try{$e=F.apply(this,he)}catch(vt){return Be(vt)}if($e&&typeof $e.then=="function")return kt($e,Be);Be(null,$e)})}function kt(F,he){return F.then(function(Be){S(he,null,Be)},function(Be){S(he,Be&&Be.message?Be:new Error(Be))})}function S(F,he,Be){try{F(he,Be)}catch($e){(0,Re.default)(function(vt){throw vt},$e)}}tr.exports=oe.default});q(Xt);var zt=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.isAsyncIterable=oe.isAsyncGenerator=oe.isAsync=void 0;var ge=Re(Xt);function Re(F){return F&&F.__esModule?F:{default:F}}function qe(F){return F[Symbol.toStringTag]==="AsyncFunction"}function Ct(F){return F[Symbol.toStringTag]==="AsyncGenerator"}function kt(F){return typeof F[Symbol.asyncIterator]=="function"}function S(F){if(typeof F!="function")throw new Error("expected a function");return qe(F)?(0,ge.default)(F):F}oe.default=S,oe.isAsync=qe,oe.isAsyncGenerator=Ct,oe.isAsyncIterable=kt});q(zt);var Lt=zt.isAsyncIterable,yt=zt.isAsyncGenerator,pt=zt.isAsync,Pr=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=ge;function ge(Re,qe){if(qe===void 0&&(qe=Re.length),!qe)throw new Error("arity is undefined");function Ct(){for(var kt=this,S=[],F=arguments.length;F--;)S[F]=arguments[F];return typeof S[qe-1]=="function"?Re.apply(this,S):new Promise(function(he,Be){S[qe-1]=function($e){for(var vt=[],wt=arguments.length-1;wt-- >0;)vt[wt]=arguments[wt+1];if($e)return Be($e);he(vt.length>1?vt:vt[0])},Re.apply(kt,S)})}return Object.defineProperty(Ct,"name",{configurable:!0,value:"awaitable("+Re.name+")"}),Ct}tr.exports=oe.default});q(Pr);var Ht=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge=Ct(ce),Re=Ct(zt),qe=Ct(Pr);function Ct(kt){return kt&&kt.__esModule?kt:{default:kt}}oe.default=(0,qe.default)(function(kt,S,F){var he=(0,ge.default)(S)?[]:{};kt(S,function(Be,$e,vt){(0,Re.default)(Be)(function(wt){for(var H,Wt=[],Vt=arguments.length-1;Vt-- >0;)Wt[Vt]=arguments[Vt+1];Wt.length<2&&(H=Wt,Wt=H[0]),he[$e]=Wt,vt(wt)})},function(Be){return F(Be,he)})},3),tr.exports=oe.default});q(Ht);var ar=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=ge;function ge(Re){function qe(){for(var Ct=[],kt=arguments.length;kt--;)Ct[kt]=arguments[kt];if(Re!==null){var S=Re;Re=null,S.apply(this,Ct)}}return Object.assign(qe,Re),qe}tr.exports=oe.default});q(ar);var mt=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=function(ge){return ge[Symbol.iterator]&&ge[Symbol.iterator]()},tr.exports=oe.default});q(mt);var Ye=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=F;var ge=qe(ce),Re=qe(mt);function qe(he){return he&&he.__esModule?he:{default:he}}function Ct(he){var Be=-1,$e=he.length;return function(){return++Be<$e?{value:he[Be],key:Be}:null}}function kt(he){var Be=-1;return function(){var vt=he.next();return vt.done?null:(Be++,{value:vt.value,key:Be})}}function S(he){var Be=he?Object.keys(he):[],$e=-1,vt=Be.length;return function(){var H=Be[++$e];return $e<vt?{value:he[H],key:H}:null}}function F(he){if((0,ge.default)(he))return Ct(he);var Be=(0,Re.default)(he);return Be?kt(Be):S(he)}tr.exports=oe.default});q(Ye);var bt=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=ge;function ge(Re){return function(){for(var qe=[],Ct=arguments.length;Ct--;)qe[Ct]=arguments[Ct];if(Re===null)throw new Error("Callback was already called.");var kt=Re;Re=null,kt.apply(this,qe)}}tr.exports=oe.default});q(bt);var Fe=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge={};oe.default=ge,tr.exports=oe.default});q(Fe);var Ae=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=qe;var ge=Re(Fe);function Re(Ct){return Ct&&Ct.__esModule?Ct:{default:Ct}}function qe(Ct,kt,S,F){var he=!1,Be=!1,$e=!1,vt=0,wt=0;function H(){vt>=kt||$e||he||($e=!0,Ct.next().then(function(yr){var Er=yr.value,Ar=yr.done;if(!(Be||he)){if($e=!1,Ar){he=!0,vt<=0&&F(null);return}vt++,S(Er,wt,Wt),wt++,H()}}).catch(Vt))}function Wt(yr,Er){if(vt-=1,!Be){if(yr)return Vt(yr);if(yr===!1){he=!0,Be=!0;return}if(Er===ge.default||he&&vt<=0)return he=!0,F(null);H()}}function Vt(yr){Be||($e=!1,he=!0,F(yr))}H()}tr.exports=oe.default});q(Ae);var Ne=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge=S(ar),Re=S(Ye),qe=S(bt),Ct=S(Ae),kt=S(Fe);function S(F){return F&&F.__esModule?F:{default:F}}oe.default=function(F){return function(he,Be,$e){if($e=(0,ge.default)($e),F<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!he)return $e(null);if((0,zt.isAsyncGenerator)(he))return(0,Ct.default)(he,F,Be,$e);if((0,zt.isAsyncIterable)(he))return(0,Ct.default)(he[Symbol.asyncIterator](),F,Be,$e);var vt=(0,Re.default)(he),wt=!1,H=!1,Wt=0,Vt=!1;function yr(Ar,Mr){if(!H)if(Wt-=1,Ar)wt=!0,$e(Ar);else if(Ar===!1)wt=!0,H=!0;else{if(Mr===kt.default||wt&&Wt<=0)return wt=!0,$e(null);Vt||Er()}}function Er(){for(Vt=!0;Wt<F&&!wt;){var Ar=vt();if(Ar===null){wt=!0,Wt<=0&&$e(null);return}Wt+=1,Be(Ar.value,Ar.key,(0,qe.default)(yr))}Vt=!1}Er()}},tr.exports=oe.default});q(Ne);var xt=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge=Ct(Ne),Re=Ct(zt),qe=Ct(Pr);function Ct(S){return S&&S.__esModule?S:{default:S}}function kt(S,F,he,Be){return(0,ge.default)(F)(S,(0,Re.default)(he),Be)}oe.default=(0,qe.default)(kt,4),tr.exports=oe.default});q(xt);var nr=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge=qe(xt),Re=qe(Pr);function qe(kt){return kt&&kt.__esModule?kt:{default:kt}}function Ct(kt,S,F){return(0,ge.default)(kt,1,S,F)}oe.default=(0,Re.default)(Ct,3),tr.exports=oe.default});q(nr);var re=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=Ct;var ge=qe(Ht),Re=qe(nr);function qe(kt){return kt&&kt.__esModule?kt:{default:kt}}function Ct(kt,S){return(0,ge.default)(Re.default,kt,S)}tr.exports=oe.default}),Ee=q(re),ae=function(){function tr(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];this.args=[],this.tasks=[]}return tr.prototype.call=function(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];return this.args=ge,Ee(this.tasks)},tr.prototype.tap=function(oe,ge){var Re=this;this.tasks.push(function(qe){ge.apply(void 0,z(Re.args)),qe(null,oe)})},tr}(),me=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge=he(ce),Re=he(Fe),qe=he(xt),Ct=he(ar),kt=he(bt),S=he(zt),F=he(Pr);function he(wt){return wt&&wt.__esModule?wt:{default:wt}}function Be(wt,H,Wt){Wt=(0,Ct.default)(Wt);var Vt=0,yr=0,Er=wt.length,Ar=!1;Er===0&&Wt(null);function Mr(Ke,gt){Ke===!1&&(Ar=!0),Ar!==!0&&(Ke?Wt(Ke):(++yr===Er||gt===Re.default)&&Wt(null))}for(;Vt<Er;Vt++)H(wt[Vt],Vt,(0,kt.default)(Mr))}function $e(wt,H,Wt){return(0,qe.default)(wt,Infinity,H,Wt)}function vt(wt,H,Wt){var Vt=(0,ge.default)(wt)?Be:$e;return Vt(wt,(0,S.default)(H),Wt)}oe.default=(0,F.default)(vt,3),tr.exports=oe.default});q(me);var Te=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0}),oe.default=Ct;var ge=qe(me),Re=qe(Ht);function qe(kt){return kt&&kt.__esModule?kt:{default:kt}}function Ct(kt,S){return(0,Re.default)(ge.default,kt,S)}tr.exports=oe.default}),Je=q(Te),dt=function(){function tr(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];this.tasks=[]}return tr.prototype.promise=function(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];return Je(this.tasks)},tr.prototype.tapPromise=function(oe,ge){var Re=this;this.tasks.push(function(qe){return E(Re,void 0,void 0,function(){return p(this,function(Ct){switch(Ct.label){case 0:return[4,ge()];case 1:return Ct.sent(),qe(null,oe),[2]}})})})},tr}(),$t=Y(function(tr,oe){Object.defineProperty(oe,"__esModule",{value:!0});var ge=kt(ar),Re=kt(bt),qe=kt(zt),Ct=kt(Pr);function kt(F){return F&&F.__esModule?F:{default:F}}function S(F,he){if(he=(0,ge.default)(he),!Array.isArray(F))return he(new Error("First argument to waterfall must be an array of functions"));if(!F.length)return he();var Be=0;function $e(wt){var H=(0,qe.default)(F[Be++]);H.apply(void 0,wt.concat([(0,Re.default)(vt)]))}function vt(wt){for(var H=[],Wt=arguments.length-1;Wt-- >0;)H[Wt]=arguments[Wt+1];if(wt!==!1){if(wt||Be===F.length)return he.apply(void 0,[wt].concat(H));$e(H)}}$e([])}oe.default=(0,Ct.default)(S),tr.exports=oe.default}),Fr=q($t),zr=function(){function tr(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];this.tasks=[]}return tr.prototype.call=function(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];return Fr(this.tasks)},tr.prototype.tap=function(oe,ge){this.tasks.length===0?this.tasks.push(function(Re){var qe=ge();Re(qe?null:!1,qe)}):this.tasks.push(function(Re,qe){var Ct=ge();qe(Ct?null:!1,oe)})},tr}(),ln=function(){function tr(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];this.tasks=[]}return tr.prototype.call=function(){for(var oe=arguments,ge=[],Re=0;Re<arguments.length;Re++)ge[Re]=oe[Re];return Ee(this.tasks)},tr.prototype.tap=function(oe,ge){this.tasks.push(function(Re){var qe=ge();Re(qe,oe)})},tr}()},58881:function(pr,O,x){"use strict";x.d(O,{nC:function(){return J.ZP},Hp:function(){return J.Hp},e7:function(){return J.e7},yT:function(){return J.yT},vK:function(){return p.v},BlendType:function(){return z.h},AttributeType:function(){return q.GC},ScaleTypes:function(){return q.vY},StyleScaleType:function(){return q.ee},MapServiceEvent:function(){return ne.I},CoordinateSystem:function(){return be.l},CoordinateUniform:function(){return be.k},CameraUniform:function(){return Kt.l},SceneEventList:function(){return zt.P},PositionType:function(){return mt.d},gl:function(){return F.gl}});var J=x(85951),E=x(69530),p=x(72302),w=x(76915),z=x(77252),q=x(31251),Y=x(8628),ce=x.n(Y);x.o(Y,"CameraUniform")&&x.d(O,{CameraUniform:function(){return Y.CameraUniform}}),x.o(Y,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Y.CityBuildingLayer}}),x.o(Y,"CoordinateSystem")&&x.d(O,{CoordinateSystem:function(){return Y.CoordinateSystem}}),x.o(Y,"CoordinateUniform")&&x.d(O,{CoordinateUniform:function(){return Y.CoordinateUniform}}),x.o(Y,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Y.HeatmapLayer}}),x.o(Y,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Y.ImageLayer}}),x.o(Y,"LineLayer")&&x.d(O,{LineLayer:function(){return Y.LineLayer}}),x.o(Y,"MapServiceEvent")&&x.d(O,{MapServiceEvent:function(){return Y.MapServiceEvent}}),x.o(Y,"Marker")&&x.d(O,{Marker:function(){return Y.Marker}}),x.o(Y,"PointLayer")&&x.d(O,{PointLayer:function(){return Y.PointLayer}}),x.o(Y,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Y.PolygonLayer}}),x.o(Y,"Popup")&&x.d(O,{Popup:function(){return Y.Popup}}),x.o(Y,"PositionType")&&x.d(O,{PositionType:function(){return Y.PositionType}}),x.o(Y,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Y.RasterLayer}}),x.o(Y,"Scene")&&x.d(O,{Scene:function(){return Y.Scene}}),x.o(Y,"SceneEventList")&&x.d(O,{SceneEventList:function(){return Y.SceneEventList}}),x.o(Y,"gl")&&x.d(O,{gl:function(){return Y.gl}});var ne=x(16606),be=x(47282),we=x(41906),Me=x.n(we);x.o(we,"CameraUniform")&&x.d(O,{CameraUniform:function(){return we.CameraUniform}}),x.o(we,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return we.CityBuildingLayer}}),x.o(we,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return we.HeatmapLayer}}),x.o(we,"ImageLayer")&&x.d(O,{ImageLayer:function(){return we.ImageLayer}}),x.o(we,"LineLayer")&&x.d(O,{LineLayer:function(){return we.LineLayer}}),x.o(we,"Marker")&&x.d(O,{Marker:function(){return we.Marker}}),x.o(we,"PointLayer")&&x.d(O,{PointLayer:function(){return we.PointLayer}}),x.o(we,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return we.PolygonLayer}}),x.o(we,"Popup")&&x.d(O,{Popup:function(){return we.Popup}}),x.o(we,"PositionType")&&x.d(O,{PositionType:function(){return we.PositionType}}),x.o(we,"RasterLayer")&&x.d(O,{RasterLayer:function(){return we.RasterLayer}}),x.o(we,"Scene")&&x.d(O,{Scene:function(){return we.Scene}}),x.o(we,"SceneEventList")&&x.d(O,{SceneEventList:function(){return we.SceneEventList}}),x.o(we,"gl")&&x.d(O,{gl:function(){return we.gl}});var Kt=x(4594),Zt=x(1910),Xt=x.n(Zt);x.o(Zt,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Zt.CityBuildingLayer}}),x.o(Zt,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Zt.HeatmapLayer}}),x.o(Zt,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Zt.ImageLayer}}),x.o(Zt,"LineLayer")&&x.d(O,{LineLayer:function(){return Zt.LineLayer}}),x.o(Zt,"Marker")&&x.d(O,{Marker:function(){return Zt.Marker}}),x.o(Zt,"PointLayer")&&x.d(O,{PointLayer:function(){return Zt.PointLayer}}),x.o(Zt,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Zt.PolygonLayer}}),x.o(Zt,"Popup")&&x.d(O,{Popup:function(){return Zt.Popup}}),x.o(Zt,"PositionType")&&x.d(O,{PositionType:function(){return Zt.PositionType}}),x.o(Zt,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Zt.RasterLayer}}),x.o(Zt,"Scene")&&x.d(O,{Scene:function(){return Zt.Scene}}),x.o(Zt,"SceneEventList")&&x.d(O,{SceneEventList:function(){return Zt.SceneEventList}}),x.o(Zt,"gl")&&x.d(O,{gl:function(){return Zt.gl}});var zt=x(19793),Lt=x(93102),yt=x.n(Lt);x.o(Lt,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Lt.CityBuildingLayer}}),x.o(Lt,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Lt.HeatmapLayer}}),x.o(Lt,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Lt.ImageLayer}}),x.o(Lt,"LineLayer")&&x.d(O,{LineLayer:function(){return Lt.LineLayer}}),x.o(Lt,"Marker")&&x.d(O,{Marker:function(){return Lt.Marker}}),x.o(Lt,"PointLayer")&&x.d(O,{PointLayer:function(){return Lt.PointLayer}}),x.o(Lt,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Lt.PolygonLayer}}),x.o(Lt,"Popup")&&x.d(O,{Popup:function(){return Lt.Popup}}),x.o(Lt,"PositionType")&&x.d(O,{PositionType:function(){return Lt.PositionType}}),x.o(Lt,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Lt.RasterLayer}}),x.o(Lt,"Scene")&&x.d(O,{Scene:function(){return Lt.Scene}}),x.o(Lt,"gl")&&x.d(O,{gl:function(){return Lt.gl}});var pt=x(64532),Pr=x.n(pt);x.o(pt,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return pt.CityBuildingLayer}}),x.o(pt,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return pt.HeatmapLayer}}),x.o(pt,"ImageLayer")&&x.d(O,{ImageLayer:function(){return pt.ImageLayer}}),x.o(pt,"LineLayer")&&x.d(O,{LineLayer:function(){return pt.LineLayer}}),x.o(pt,"Marker")&&x.d(O,{Marker:function(){return pt.Marker}}),x.o(pt,"PointLayer")&&x.d(O,{PointLayer:function(){return pt.PointLayer}}),x.o(pt,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return pt.PolygonLayer}}),x.o(pt,"Popup")&&x.d(O,{Popup:function(){return pt.Popup}}),x.o(pt,"PositionType")&&x.d(O,{PositionType:function(){return pt.PositionType}}),x.o(pt,"RasterLayer")&&x.d(O,{RasterLayer:function(){return pt.RasterLayer}}),x.o(pt,"Scene")&&x.d(O,{Scene:function(){return pt.Scene}}),x.o(pt,"gl")&&x.d(O,{gl:function(){return pt.gl}});var Ht=x(2811),ar=x.n(Ht);x.o(Ht,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Ht.CityBuildingLayer}}),x.o(Ht,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Ht.HeatmapLayer}}),x.o(Ht,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Ht.ImageLayer}}),x.o(Ht,"LineLayer")&&x.d(O,{LineLayer:function(){return Ht.LineLayer}}),x.o(Ht,"Marker")&&x.d(O,{Marker:function(){return Ht.Marker}}),x.o(Ht,"PointLayer")&&x.d(O,{PointLayer:function(){return Ht.PointLayer}}),x.o(Ht,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Ht.PolygonLayer}}),x.o(Ht,"Popup")&&x.d(O,{Popup:function(){return Ht.Popup}}),x.o(Ht,"PositionType")&&x.d(O,{PositionType:function(){return Ht.PositionType}}),x.o(Ht,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Ht.RasterLayer}}),x.o(Ht,"Scene")&&x.d(O,{Scene:function(){return Ht.Scene}}),x.o(Ht,"gl")&&x.d(O,{gl:function(){return Ht.gl}});var mt=x(66690),Ye=x(81732),bt=x.n(Ye);x.o(Ye,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Ye.CityBuildingLayer}}),x.o(Ye,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Ye.HeatmapLayer}}),x.o(Ye,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Ye.ImageLayer}}),x.o(Ye,"LineLayer")&&x.d(O,{LineLayer:function(){return Ye.LineLayer}}),x.o(Ye,"Marker")&&x.d(O,{Marker:function(){return Ye.Marker}}),x.o(Ye,"PointLayer")&&x.d(O,{PointLayer:function(){return Ye.PointLayer}}),x.o(Ye,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Ye.PolygonLayer}}),x.o(Ye,"Popup")&&x.d(O,{Popup:function(){return Ye.Popup}}),x.o(Ye,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Ye.RasterLayer}}),x.o(Ye,"Scene")&&x.d(O,{Scene:function(){return Ye.Scene}}),x.o(Ye,"gl")&&x.d(O,{gl:function(){return Ye.gl}});var Fe=x(84007),Ae=x.n(Fe);x.o(Fe,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Fe.CityBuildingLayer}}),x.o(Fe,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Fe.HeatmapLayer}}),x.o(Fe,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Fe.ImageLayer}}),x.o(Fe,"LineLayer")&&x.d(O,{LineLayer:function(){return Fe.LineLayer}}),x.o(Fe,"Marker")&&x.d(O,{Marker:function(){return Fe.Marker}}),x.o(Fe,"PointLayer")&&x.d(O,{PointLayer:function(){return Fe.PointLayer}}),x.o(Fe,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Fe.PolygonLayer}}),x.o(Fe,"Popup")&&x.d(O,{Popup:function(){return Fe.Popup}}),x.o(Fe,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Fe.RasterLayer}}),x.o(Fe,"Scene")&&x.d(O,{Scene:function(){return Fe.Scene}}),x.o(Fe,"gl")&&x.d(O,{gl:function(){return Fe.gl}});var Ne=x(79042),xt=x.n(Ne);x.o(Ne,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Ne.CityBuildingLayer}}),x.o(Ne,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Ne.HeatmapLayer}}),x.o(Ne,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Ne.ImageLayer}}),x.o(Ne,"LineLayer")&&x.d(O,{LineLayer:function(){return Ne.LineLayer}}),x.o(Ne,"Marker")&&x.d(O,{Marker:function(){return Ne.Marker}}),x.o(Ne,"PointLayer")&&x.d(O,{PointLayer:function(){return Ne.PointLayer}}),x.o(Ne,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Ne.PolygonLayer}}),x.o(Ne,"Popup")&&x.d(O,{Popup:function(){return Ne.Popup}}),x.o(Ne,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Ne.RasterLayer}}),x.o(Ne,"Scene")&&x.d(O,{Scene:function(){return Ne.Scene}}),x.o(Ne,"gl")&&x.d(O,{gl:function(){return Ne.gl}});var nr=x(89648),re=x(90919),Ee=x.n(re);x.o(re,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return re.CityBuildingLayer}}),x.o(re,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return re.HeatmapLayer}}),x.o(re,"ImageLayer")&&x.d(O,{ImageLayer:function(){return re.ImageLayer}}),x.o(re,"LineLayer")&&x.d(O,{LineLayer:function(){return re.LineLayer}}),x.o(re,"Marker")&&x.d(O,{Marker:function(){return re.Marker}}),x.o(re,"PointLayer")&&x.d(O,{PointLayer:function(){return re.PointLayer}}),x.o(re,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return re.PolygonLayer}}),x.o(re,"Popup")&&x.d(O,{Popup:function(){return re.Popup}}),x.o(re,"RasterLayer")&&x.d(O,{RasterLayer:function(){return re.RasterLayer}}),x.o(re,"Scene")&&x.d(O,{Scene:function(){return re.Scene}}),x.o(re,"gl")&&x.d(O,{gl:function(){return re.gl}});var ae=x(75925),me=x.n(ae);x.o(ae,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),x.o(ae,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return ae.HeatmapLayer}}),x.o(ae,"ImageLayer")&&x.d(O,{ImageLayer:function(){return ae.ImageLayer}}),x.o(ae,"LineLayer")&&x.d(O,{LineLayer:function(){return ae.LineLayer}}),x.o(ae,"Marker")&&x.d(O,{Marker:function(){return ae.Marker}}),x.o(ae,"PointLayer")&&x.d(O,{PointLayer:function(){return ae.PointLayer}}),x.o(ae,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return ae.PolygonLayer}}),x.o(ae,"Popup")&&x.d(O,{Popup:function(){return ae.Popup}}),x.o(ae,"RasterLayer")&&x.d(O,{RasterLayer:function(){return ae.RasterLayer}}),x.o(ae,"Scene")&&x.d(O,{Scene:function(){return ae.Scene}}),x.o(ae,"gl")&&x.d(O,{gl:function(){return ae.gl}});var Te=x(85040),Je=x.n(Te);x.o(Te,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Te.CityBuildingLayer}}),x.o(Te,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Te.HeatmapLayer}}),x.o(Te,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Te.ImageLayer}}),x.o(Te,"LineLayer")&&x.d(O,{LineLayer:function(){return Te.LineLayer}}),x.o(Te,"Marker")&&x.d(O,{Marker:function(){return Te.Marker}}),x.o(Te,"PointLayer")&&x.d(O,{PointLayer:function(){return Te.PointLayer}}),x.o(Te,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Te.PolygonLayer}}),x.o(Te,"Popup")&&x.d(O,{Popup:function(){return Te.Popup}}),x.o(Te,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Te.RasterLayer}}),x.o(Te,"Scene")&&x.d(O,{Scene:function(){return Te.Scene}}),x.o(Te,"gl")&&x.d(O,{gl:function(){return Te.gl}});var dt=x(8594),$t=x.n(dt);x.o(dt,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return dt.CityBuildingLayer}}),x.o(dt,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return dt.HeatmapLayer}}),x.o(dt,"ImageLayer")&&x.d(O,{ImageLayer:function(){return dt.ImageLayer}}),x.o(dt,"LineLayer")&&x.d(O,{LineLayer:function(){return dt.LineLayer}}),x.o(dt,"Marker")&&x.d(O,{Marker:function(){return dt.Marker}}),x.o(dt,"PointLayer")&&x.d(O,{PointLayer:function(){return dt.PointLayer}}),x.o(dt,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return dt.PolygonLayer}}),x.o(dt,"Popup")&&x.d(O,{Popup:function(){return dt.Popup}}),x.o(dt,"RasterLayer")&&x.d(O,{RasterLayer:function(){return dt.RasterLayer}}),x.o(dt,"Scene")&&x.d(O,{Scene:function(){return dt.Scene}}),x.o(dt,"gl")&&x.d(O,{gl:function(){return dt.gl}});var Fr=x(67571),zr=x.n(Fr);x.o(Fr,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return Fr.CityBuildingLayer}}),x.o(Fr,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return Fr.HeatmapLayer}}),x.o(Fr,"ImageLayer")&&x.d(O,{ImageLayer:function(){return Fr.ImageLayer}}),x.o(Fr,"LineLayer")&&x.d(O,{LineLayer:function(){return Fr.LineLayer}}),x.o(Fr,"Marker")&&x.d(O,{Marker:function(){return Fr.Marker}}),x.o(Fr,"PointLayer")&&x.d(O,{PointLayer:function(){return Fr.PointLayer}}),x.o(Fr,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return Fr.PolygonLayer}}),x.o(Fr,"Popup")&&x.d(O,{Popup:function(){return Fr.Popup}}),x.o(Fr,"RasterLayer")&&x.d(O,{RasterLayer:function(){return Fr.RasterLayer}}),x.o(Fr,"Scene")&&x.d(O,{Scene:function(){return Fr.Scene}}),x.o(Fr,"gl")&&x.d(O,{gl:function(){return Fr.gl}});var ln=x(66718),tr=x.n(ln);x.o(ln,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return ln.CityBuildingLayer}}),x.o(ln,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return ln.HeatmapLayer}}),x.o(ln,"ImageLayer")&&x.d(O,{ImageLayer:function(){return ln.ImageLayer}}),x.o(ln,"LineLayer")&&x.d(O,{LineLayer:function(){return ln.LineLayer}}),x.o(ln,"Marker")&&x.d(O,{Marker:function(){return ln.Marker}}),x.o(ln,"PointLayer")&&x.d(O,{PointLayer:function(){return ln.PointLayer}}),x.o(ln,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return ln.PolygonLayer}}),x.o(ln,"Popup")&&x.d(O,{Popup:function(){return ln.Popup}}),x.o(ln,"RasterLayer")&&x.d(O,{RasterLayer:function(){return ln.RasterLayer}}),x.o(ln,"Scene")&&x.d(O,{Scene:function(){return ln.Scene}}),x.o(ln,"gl")&&x.d(O,{gl:function(){return ln.gl}});var oe=x(92364),ge=x(78010),Re=x.n(ge);x.o(ge,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return ge.CityBuildingLayer}}),x.o(ge,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return ge.HeatmapLayer}}),x.o(ge,"ImageLayer")&&x.d(O,{ImageLayer:function(){return ge.ImageLayer}}),x.o(ge,"LineLayer")&&x.d(O,{LineLayer:function(){return ge.LineLayer}}),x.o(ge,"Marker")&&x.d(O,{Marker:function(){return ge.Marker}}),x.o(ge,"PointLayer")&&x.d(O,{PointLayer:function(){return ge.PointLayer}}),x.o(ge,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return ge.PolygonLayer}}),x.o(ge,"Popup")&&x.d(O,{Popup:function(){return ge.Popup}}),x.o(ge,"RasterLayer")&&x.d(O,{RasterLayer:function(){return ge.RasterLayer}}),x.o(ge,"Scene")&&x.d(O,{Scene:function(){return ge.Scene}}),x.o(ge,"gl")&&x.d(O,{gl:function(){return ge.gl}});var qe=x(68116),Ct=x.n(qe);x.o(qe,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return qe.CityBuildingLayer}}),x.o(qe,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return qe.HeatmapLayer}}),x.o(qe,"ImageLayer")&&x.d(O,{ImageLayer:function(){return qe.ImageLayer}}),x.o(qe,"LineLayer")&&x.d(O,{LineLayer:function(){return qe.LineLayer}}),x.o(qe,"Marker")&&x.d(O,{Marker:function(){return qe.Marker}}),x.o(qe,"PointLayer")&&x.d(O,{PointLayer:function(){return qe.PointLayer}}),x.o(qe,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return qe.PolygonLayer}}),x.o(qe,"Popup")&&x.d(O,{Popup:function(){return qe.Popup}}),x.o(qe,"RasterLayer")&&x.d(O,{RasterLayer:function(){return qe.RasterLayer}}),x.o(qe,"Scene")&&x.d(O,{Scene:function(){return qe.Scene}}),x.o(qe,"gl")&&x.d(O,{gl:function(){return qe.gl}});var kt=x(23067),S=x.n(kt);x.o(kt,"CityBuildingLayer")&&x.d(O,{CityBuildingLayer:function(){return kt.CityBuildingLayer}}),x.o(kt,"HeatmapLayer")&&x.d(O,{HeatmapLayer:function(){return kt.HeatmapLayer}}),x.o(kt,"ImageLayer")&&x.d(O,{ImageLayer:function(){return kt.ImageLayer}}),x.o(kt,"LineLayer")&&x.d(O,{LineLayer:function(){return kt.LineLayer}}),x.o(kt,"Marker")&&x.d(O,{Marker:function(){return kt.Marker}}),x.o(kt,"PointLayer")&&x.d(O,{PointLayer:function(){return kt.PointLayer}}),x.o(kt,"PolygonLayer")&&x.d(O,{PolygonLayer:function(){return kt.PolygonLayer}}),x.o(kt,"Popup")&&x.d(O,{Popup:function(){return kt.Popup}}),x.o(kt,"RasterLayer")&&x.d(O,{RasterLayer:function(){return kt.RasterLayer}}),x.o(kt,"Scene")&&x.d(O,{Scene:function(){return kt.Scene}}),x.o(kt,"gl")&&x.d(O,{gl:function(){return kt.gl}});var F=x(7648)},85951:function(pr,O,x){"use strict";x.d(O,{e7:function(){return Hc},Hp:function(){return bo},ZP:function(){return Sc},yT:function(){return kf}});var J=x(28660),E=x(26729),p=x.n(E),w=x(86700),z=x(84879),q=x(72302),Y=x(96156),ce=x(6610),ne=x(5991),be=x(6901),we=x(49296),Me=x.n(we);function Kt(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function Zt(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?Kt(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):Kt(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function Xt(Z,N){var M;if(typeof Symbol=="undefined"||Z[Symbol.iterator]==null){if(Array.isArray(Z)||(M=zt(Z))||N&&Z&&typeof Z.length=="number"){M&&(Z=M);var R=0,te=function(){};return{s:te,n:function(){return R>=Z.length?{done:!0}:{done:!1,value:Z[R++]}},e:function(Sr){throw Sr},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,ut=!1,Nt;return{s:function(){M=Z[Symbol.iterator]()},n:function(){var Sr=M.next();return ve=Sr.done,Sr},e:function(Sr){ut=!0,Nt=Sr},f:function(){try{!ve&&M.return!=null&&M.return()}finally{if(ut)throw Nt}}}}function zt(Z,N){if(!!Z){if(typeof Z=="string")return Lt(Z,N);var M=Object.prototype.toString.call(Z).slice(8,-1);if(M==="Object"&&Z.constructor&&(M=Z.constructor.name),M==="Map"||M==="Set")return Array.from(Z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Lt(Z,N)}}function Lt(Z,N){(N==null||N>Z.length)&&(N=Z.length);for(var M=0,R=new Array(N);M<N;M++)R[M]=Z[M];return R}var yt=30;function pt(Z){var N=Z.characterSet,M=Z.getFontWidth,R=Z.fontHeight,te=Z.buffer,ve=Z.maxCanvasWidth,ut=Z.mapping,Nt=ut===void 0?{}:ut,Pt=Z.xOffset,Sr=Pt===void 0?0:Pt,Ur=Z.yOffset,Fn=Ur===void 0?0:Ur,Gn=0,vi=Sr;Array.from(N).forEach(function(ci,ji){if(!Nt[ci]){var Gi=M(ci,ji);vi+yt>ve&&(vi=0,Gn++),Nt[ci]={x:vi,y:Fn+Gn*yt,width:yt,height:yt,advance:Gi},vi+=yt}});var mi=R+te*2;return{mapping:Nt,xOffset:vi,yOffset:Fn+Gn*mi,canvasHeight:ar(Fn+(Gn+1)*mi)}}function Pr(Z,N,M){var R=0,te=0,ve=0,ut=[],Nt={},Pt=Xt(Z),Sr;try{for(Pt.s();!(Sr=Pt.n()).done;){var Ur=Sr.value;if(!Nt[Ur.id]){var Fn=Ur.size;R+Fn+N>M&&(Ht(Nt,ut,te),R=0,te=ve+te+N,ve=0,ut=[]),ut.push({icon:Ur,xOffset:R}),R=R+Fn+N,ve=Math.max(ve,Fn)}}}catch(vi){Pt.e(vi)}finally{Pt.f()}ut.length>0&&Ht(Nt,ut,te);var Gn=ar(ve+te+N);return{mapping:Nt,canvasHeight:Gn}}function Ht(Z,N,M){var R=Xt(N),te;try{for(R.s();!(te=R.n()).done;){var ve=te.value,ut=ve.icon,Nt=ve.xOffset;Z[ut.id]=Zt(Zt({},ut),{},{x:Nt,y:M,image:ut.image,width:ut.width,height:ut.height})}}catch(Pt){R.e(Pt)}finally{R.f()}}function ar(Z){return Math.pow(2,Math.ceil(Math.log2(Z)))}var mt,Ye,bt;function Fe(Z,N){var M;if(typeof Symbol=="undefined"||Z[Symbol.iterator]==null){if(Array.isArray(Z)||(M=Ae(Z))||N&&Z&&typeof Z.length=="number"){M&&(Z=M);var R=0,te=function(){};return{s:te,n:function(){return R>=Z.length?{done:!0}:{done:!1,value:Z[R++]}},e:function(Sr){throw Sr},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,ut=!1,Nt;return{s:function(){M=Z[Symbol.iterator]()},n:function(){var Sr=M.next();return ve=Sr.done,Sr},e:function(Sr){ut=!0,Nt=Sr},f:function(){try{!ve&&M.return!=null&&M.return()}finally{if(ut)throw Nt}}}}function Ae(Z,N){if(!!Z){if(typeof Z=="string")return Ne(Z,N);var M=Object.prototype.toString.call(Z).slice(8,-1);if(M==="Object"&&Z.constructor&&(M=Z.constructor.name),M==="Map"||M==="Set")return Array.from(Z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Ne(Z,N)}}function Ne(Z,N){(N==null||N>Z.length)&&(N=Z.length);for(var M=0,R=new Array(N);M<N;M++)R[M]=Z[M];return R}function xt(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function nr(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?xt(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):xt(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}var re=oe(),Ee="sans-serif",ae="normal",me=24,Te=3,Je=.25,dt=8,$t=1024,Fr=1,zr=1,ln=3,tr=null;function oe(){for(var Z=[],N=32;N<128;N++)Z.push(String.fromCharCode(N));return Z}function ge(Z,N,M,R){Z.font="".concat(R," ").concat(M,"px ").concat(N),Z.fillStyle="black",Z.textBaseline="middle"}function Re(Z,N){for(var M=0;M<Z.length;M++)N.data[4*M+3]=Z[M]}var qe=(mt=(0,w.b2)(),mt(Ye=(bt=function(){function Z(){(0,ce.Z)(this,Z),this.fontAtlas=void 0,this.iconFontMap=void 0,this.iconFontGlyphs={},this.fontOptions=void 0,this.key=void 0,this.cache=new be.z6(ln)}return(0,ne.Z)(Z,[{key:"scale",get:function(){return zr}},{key:"canvas",get:function(){var M=this.cache.get(this.key);return M&&M.data}},{key:"mapping",get:function(){var M=this.cache.get(this.key);return M&&M.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ee,fontWeight:ae,characterSet:re,fontSize:me,buffer:Te,sdf:!0,cutoff:Je,radius:dt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(M){var R=this;M.forEach(function(te){R.iconFontGlyphs[te.name]=te.unicode})}},{key:"addIconFont",value:function(M,R){this.iconFontMap.set(M,R)}},{key:"getIconFontKey",value:function(M){return this.iconFontMap.get(M)||M}},{key:"getGlyph",value:function(M){return this.iconFontGlyphs[M]?String.fromCharCode(parseInt(this.iconFontGlyphs[M],16)):""}},{key:"setFontOptions",value:function(M){this.fontOptions=nr(nr({},this.fontOptions),M),this.key=this.getKey();var R=this.getNewChars(this.key,this.fontOptions.characterSet),te=this.cache.get(this.key);if(!(te&&R.length===0)){var ve=this.generateFontAtlas(this.key,R,te);this.fontAtlas=ve,this.cache.set(this.key,ve)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(M,R,te){var ve=this.fontOptions,ut=ve.fontFamily,Nt=ve.fontWeight,Pt=ve.fontSize,Sr=ve.buffer,Ur=ve.sdf,Fn=ve.radius,Gn=ve.cutoff,vi=ve.iconfont,mi=te&&te.data;mi||(mi=document.createElement("canvas"),mi.width=$t);var ci=mi.getContext("2d");ge(ci,ut,Pt,Nt);var ji=pt(nr({getFontWidth:function(Ys){return ci.measureText(Ys).width},fontHeight:Pt*zr,buffer:Sr,characterSet:R,maxCanvasWidth:$t},te&&{mapping:te.mapping,xOffset:te.xOffset,yOffset:te.yOffset})),Gi=ji.mapping,Ao=ji.canvasHeight,No=ji.xOffset,Ko=ji.yOffset,$a=ci.getImageData(0,0,mi.width,mi.height);if(mi.height=Ao,ci.putImageData($a,0,0),ge(ci,ut,Pt,Nt),Ur){var Da=new(Me())(Pt,Sr,Fn,Gn,ut,Nt),ma=ci.getImageData(0,0,Da.size,Da.size),ao=Fe(R),ms;try{for(ao.s();!(ms=ao.n()).done;){var Bo=ms.value;if(vi){var $o=String.fromCharCode(parseInt(Bo.replace("&#x","").replace(";",""),16)),vo=Da.draw($o);Re(vo,ma)}else Re(Da.draw(Bo),ma);ci.putImageData(ma,Gi[Bo].x,Gi[Bo].y)}}catch(_l){ao.e(_l)}finally{ao.f()}}else{var Xs=Fe(R),yl;try{for(Xs.s();!(yl=Xs.n()).done;){var Ds=yl.value;ci.fillText(Ds,Gi[Ds].x,Gi[Ds].y+Pt*Fr)}}catch(_l){Xs.e(_l)}finally{Xs.f()}}return{xOffset:No,yOffset:Ko,mapping:Gi,data:mi,width:mi.width,height:mi.height}}},{key:"getKey",value:function(){return"key";var M,R,te,ve,ut,Nt,Pt,Sr}},{key:"getNewChars",value:function(M,R){var te=this.cache.get(M);if(!te)return R;var ve=[],ut=te.mapping,Nt=new Set(Object.keys(ut)),Pt=new Set(R);return Pt.forEach(function(Sr){Nt.has(Sr)||ve.push(Sr)}),ve}}]),Z}(),bt))||Ye),Ct=x(10379),kt=x(46070),S=x(77608),F,he,Be;function $e(Z){var N=vt();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function vt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var wt=3,H=1024,Wt=64,Vt=(F=(0,w.b2)(),F(he=(Be=function(Z){(0,Ct.Z)(M,Z);var N=$e(M);function M(){var R;(0,ce.Z)(this,M);for(var te=arguments.length,ve=new Array(te),ut=0;ut<te;ut++)ve[ut]=arguments[ut];return R=N.call.apply(N,[this].concat(ve)),R.canvasHeight=128,R.texture=void 0,R.canvas=void 0,R.iconData=void 0,R.iconMap=void 0,R.ctx=void 0,R.loadingImageCount=0,R}return(0,ne.Z)(M,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(te,ve){var ut=this,Nt=new Image;if(this.loadingImageCount++,this.hasImage(te))throw new Error("Image Id already exists");this.iconData.push({id:te,size:Wt}),this.updateIconMap(),this.loadImage(ve).then(function(Pt){Nt=Pt;var Sr=ut.iconData.find(function(Ur){return Ur.id===te});Sr&&(Sr.image=Nt,Sr.width=Nt.width,Sr.height=Nt.height),ut.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(te){return this.iconMap.hasOwnProperty(te)}},{key:"removeImage",value:function(te){this.hasImage(te)&&(this.iconData=this.iconData.filter(function(ve){return ve.id!==te}),delete this.iconMap[te],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var te=this;this.canvas.width=H,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(ve){var ut=te.iconMap[ve],Nt=ut.x,Pt=ut.y,Sr=ut.image,Ur=ut.width,Fn=Ur===void 0?64:Ur,Gn=ut.height,vi=Gn===void 0?64:Gn,mi=Math.max(Fn,vi),ci=mi/Wt,ji=vi/ci,Gi=Fn/ci;Sr&&te.ctx.drawImage(Sr,Nt+(Wt-Gi)/2,Pt+(Wt-ji)/2,Gi,ji)})}},{key:"updateIconMap",value:function(){var te=Pr(this.iconData,wt,H),ve=te.mapping,ut=te.canvasHeight;this.iconMap=ve,this.canvasHeight=ut}},{key:"loadImage",value:function(te){return new Promise(function(ve,ut){if(te instanceof HTMLImageElement){ve(te);return}var Nt=new Image;Nt.crossOrigin="anonymous",Nt.onload=function(){ve(Nt)},Nt.onerror=function(){ut(new Error("Could not load image at "+te))},Nt.src=te instanceof File?URL.createObjectURL(te):te})}}]),M}(E.EventEmitter),Be))||he),yr=x(28481),Er=x(85975),Ar,Mr,Ke,gt=(Ar=(0,w.b2)(),Ar(Mr=(Ke=function(){function Z(){(0,ce.Z)(this,Z),this.viewport=void 0,this.overridedViewProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0,this.jitteredProjectionMatrix=void 0,this.viewMatrixInverse=void 0,this.cameraPosition=void 0}return(0,ne.Z)(Z,[{key:"init",value:function(){}},{key:"update",value:function(M){this.viewport=M,this.viewMatrixInverse=Er.create(),Er.invert(this.viewMatrixInverse,M.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var M=this.viewport.getCenter(),R=(0,yr.Z)(M,2),te=R[0],ve=R[1];return[te,ve]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(M,R){return this.viewport.projectFlat(M,R)}},{key:"setViewProjectionMatrix",value:function(M){this.overridedViewProjectionMatrix=M}},{key:"jitterProjectionMatrix",value:function(M,R){var te=Er.fromTranslation(Er.create(),[M,R,0]);this.jitteredProjectionMatrix=Er.multiply(Er.create(),te,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Er.multiply(Er.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),Z}(),Ke))||Mr),ct,sr,Qr;function st(Z,N){var M;if(typeof Symbol=="undefined"||Z[Symbol.iterator]==null){if(Array.isArray(Z)||(M=Mt(Z))||N&&Z&&typeof Z.length=="number"){M&&(Z=M);var R=0,te=function(){};return{s:te,n:function(){return R>=Z.length?{done:!0}:{done:!1,value:Z[R++]}},e:function(Sr){throw Sr},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,ut=!1,Nt;return{s:function(){M=Z[Symbol.iterator]()},n:function(){var Sr=M.next();return ve=Sr.done,Sr},e:function(Sr){ut=!0,Nt=Sr},f:function(){try{!ve&&M.return!=null&&M.return()}finally{if(ut)throw Nt}}}}function Mt(Z,N){if(!!Z){if(typeof Z=="string")return Jt(Z,N);var M=Object.prototype.toString.call(Z).slice(8,-1);if(M==="Object"&&Z.constructor&&(M=Z.constructor.name),M==="Map"||M==="Set")return Array.from(Z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Jt(Z,N)}}function Jt(Z,N){(N==null||N>Z.length)&&(N=Z.length);for(var M=0,R=new Array(N);M<N;M++)R[M]=Z[M];return R}var mr=(ct=(0,w.b2)(),ct(sr=(Qr=function(){function Z(){(0,ce.Z)(this,Z),this.container=void 0,this.controlCorners=void 0,this.controlContainer=void 0,this.scene=void 0,this.mapsService=void 0,this.controls=[],this.unAddControls=[]}return(0,ne.Z)(Z,[{key:"init",value:function(M,R){this.container=M.container,this.scene=R,this.mapsService=R.get(q.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(M,R){var te=R.get(q.v.IMapService);te.map?(M.addTo(this.scene),this.controls.push(M)):this.unAddControls.push(M)}},{key:"getControlByName",value:function(M){return this.controls.find(function(R){return R.controlOption.name===M})}},{key:"removeControl",value:function(M){var R=this.controls.indexOf(M);return R>-1&&this.controls.splice(R,1),M.remove(),this}},{key:"addControls",value:function(){var M=this;this.unAddControls.forEach(function(R){R.addTo(M.scene),M.controls.push(R)}),this.unAddControls=[]}},{key:"destroy",value:function(){var M=st(this.controls),R;try{for(M.s();!(R=M.n()).done;){var te=R.value;te.remove()}}catch(ve){M.e(ve)}finally{M.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var M=this.controlCorners={},R="l7-",te=this.controlContainer=be.SO.create("div",R+"control-container",this.container);function ve(ut,Nt){var Pt=R+ut+" "+R+Nt;M[ut+Nt]=be.SO.create("div",Pt,te)}ve("top","left"),ve("top","right"),ve("bottom","left"),ve("bottom","right")}},{key:"clearControlPos",value:function(){for(var M in this.controlCorners)this.controlCorners[M]&&be.SO.remove(this.controlCorners[M]);this.controlContainer&&be.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),Z}(),Qr))||sr),gn,Cn,yi,Ei=(gn=(0,w.b2)(),gn(Cn=(yi=function(){function Z(){(0,ce.Z)(this,Z),this.container=void 0,this.scene=void 0,this.mapsService=void 0,this.markers=[],this.markerLayers=[],this.unAddMarkers=[],this.unAddMarkerLayers=[]}return(0,ne.Z)(Z,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var R=this.markerLayers.indexOf(M);R>-1&&this.markerLayers.splice(R,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(R){R.addTo(M.scene),M.markers.push(R)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(R){M.markerLayers.push(R),R.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var R=this.markers.indexOf(M);R>-1&&this.markers.splice(R,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(q.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),Z}(),yi))||Cn),Ii,Ji,li,G=(Ii=(0,w.b2)(),Ii(Ji=(li=function(){function Z(){(0,ce.Z)(this,Z),this.scene=void 0,this.popup=void 0,this.mapsService=void 0,this.unAddPopup=void 0}return(0,ne.Z)(Z,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(q.v.IMapService)}}]),Z}(),li))||Ji),I=x(82492),j=x.n(I),K={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ie=K,Oe,He,ue;function De(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function St(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?De(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):De(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}var Ir={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Br={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},jt=(Oe=(0,w.b2)(),Oe(He=(ue=function(){function Z(){(0,ce.Z)(this,Z),this.sceneConfigCache={},this.layerConfigCache={}}return(0,ne.Z)(Z,[{key:"getSceneConfig",value:function(M){return this.sceneConfigCache[M]}},{key:"getSceneWarninfo",value:function(M){return ie[M]}},{key:"setSceneConfig",value:function(M,R){this.sceneConfigCache[M]=St(St({},Ir),R)}},{key:"getLayerConfig",value:function(M){return this.layerConfigCache[M]}},{key:"setLayerConfig",value:function(M,R,te){this.layerConfigCache[R]=St({},j()({},this.sceneConfigCache[M],Br,te))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),Z}(),ue))||He),dr=x(55770),Wr=x(3473),yn=x(98333),vr=Math.PI/180,vn=512,$r=4003e4;function cn(Z){var N=Z.latitude,M=N===void 0?0:N,R=Z.zoom,te=R===void 0?0:R,ve=Z.scale,ut=Z.highPrecision,Nt=ut===void 0?!1:ut,Pt=Z.flipY,Sr=Pt===void 0?!1:Pt;ve=ve!==void 0?ve:Math.pow(2,te);var Ur={},Fn=vn*ve,Gn=Math.cos(M*vr),vi=Fn/360,mi=vi/Gn,ci=Fn/$r/Gn;if(Ur.pixelsPerMeter=[ci,-ci,ci],Ur.metersPerPixel=[1/ci,-1/ci,1/ci],Ur.pixelsPerDegree=[vi,-mi,ci],Ur.degreesPerPixel=[1/vi,-1/mi,1/ci],Nt){var ji=vr*Math.tan(M*vr)/Gn,Gi=vi*ji/2,Ao=Fn/$r*ji,No=Ao/mi*ci;Ur.pixelsPerDegree2=[0,-Gi,Ao],Ur.pixelsPerMeter2=[No,0,No],Sr&&(Ur.pixelsPerDegree2[1]=-Ur.pixelsPerDegree2[1],Ur.pixelsPerMeter2[1]=-Ur.pixelsPerMeter2[1])}return Sr&&(Ur.pixelsPerMeter[1]=-Ur.pixelsPerMeter[1],Ur.metersPerPixel[1]=-Ur.metersPerPixel[1],Ur.pixelsPerDegree[1]=-Ur.pixelsPerDegree[1],Ur.degreesPerPixel[1]=-Ur.degreesPerPixel[1]),Ur}var di=x(47282),hn,bi,Qi,_i,Oi,Ci,yo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Zi=(hn=(0,w.b2)(),bi=(0,w.f3)(q.v.ICameraService),hn(Qi=(_i=(Ci=function(){function Z(){(0,ce.Z)(this,Z),this.needRefresh=!0,(0,dr.Z)(this,"cameraService",Oi,this),this.coordinateSystem=void 0,this.viewportCenter=void 0,this.viewportCenterProjection=void 0,this.pixelsPerDegree=void 0,this.pixelsPerDegree2=void 0,this.pixelsPerMeter=void 0}return(0,ne.Z)(Z,[{key:"refresh",value:function(){var M=this.cameraService.getZoom(),R=this.cameraService.getZoomScale(),te=this.cameraService.getCenter(),ve=cn({latitude:te[1],zoom:M}),ut=ve.pixelsPerMeter,Nt=ve.pixelsPerDegree;this.viewportCenter=te,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=ut,this.pixelsPerDegree=Nt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===di.l.LNGLAT||this.coordinateSystem===di.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===di.l.LNGLAT_OFFSET?this.calculateLnglatOffset(te,M):this.coordinateSystem===di.l.P20_OFFSET&&this.calculateLnglatOffset(te,M,R,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(M){this.coordinateSystem=M}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(M,R,te,ve){var ut=cn({latitude:M[1],zoom:R,scale:te,flipY:ve,highPrecision:!0}),Nt=ut.pixelsPerMeter,Pt=ut.pixelsPerDegree,Sr=ut.pixelsPerDegree2,Ur=this.cameraService.getViewMatrix(),Fn=this.cameraService.getProjectionMatrix(),Gn=Er.multiply([],Fn,Ur),vi=this.cameraService.projectFlat([Math.fround(M[0]),Math.fround(M[1])],Math.pow(2,R));this.viewportCenterProjection=yn.fF([],[vi[0],vi[1],0,1],Gn),Ur=this.cameraService.getViewMatrixUncentered()||Ur,Gn=Er.multiply([],Fn,Ur),Gn=Er.multiply([],Gn,yo),this.cameraService.setViewProjectionMatrix(Gn),this.pixelsPerMeter=Nt,this.pixelsPerDegree=Pt,this.pixelsPerDegree2=Sr}}]),Z}(),Ci),Oi=(0,Wr.Z)(_i.prototype,"cameraService",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i))||Qi),Rn=x(63349),Dn=x(50840),hi=x.n(Dn),jn=x(89648),Oa,hs,Li,La,gu,su,ga,so;function Ga(Z){var N=Ha();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function Ha(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var Ho={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancle"},sa=(Oa=(0,w.b2)(),hs=(0,w.f3)(q.v.IMapService),Li=(0,w.f3)(q.v.ILogService),Oa(La=(gu=(so=function(Z){(0,Ct.Z)(M,Z);var N=Ga(M);function M(){var R;(0,ce.Z)(this,M);for(var te=arguments.length,ve=new Array(te),ut=0;ut<te;ut++)ve[ut]=arguments[ut];return R=N.call.apply(N,[this].concat(ve)),(0,dr.Z)(R,"mapService",su,(0,Rn.Z)(R)),(0,dr.Z)(R,"logger",ga,(0,Rn.Z)(R)),R.hammertime=void 0,R.lastClickTime=0,R.lastClickXY=[-1,-1],R.clickTimer=void 0,R.$containter=void 0,R.onDrag=function(Nt){var Pt=R.interactionEvent(Nt);Pt.type=Ho[Pt.type],R.emit(jn.s.Drag,Pt)},R.onHammer=function(Nt){Nt.srcEvent.stopPropagation();var Pt=R.interactionEvent(Nt);R.emit(jn.s.Hover,Pt)},R.onTouch=function(Nt){var Pt=Nt.touches[0];R.onHover({x:Pt.pageX,y:Pt.pageY,type:"touch"})},R.onHover=function(Nt){var Pt=Nt.clientX,Sr=Nt.clientY,Ur=Pt,Fn=Sr,Gn=Nt.type,vi=R.mapService.getMapContainer();if(vi){var mi=vi.getBoundingClientRect(),ci=mi.top,ji=mi.left;Ur=Ur-ji-vi.clientLeft,Fn=Fn-ci-vi.clientTop}var Gi=R.mapService.containerToLngLat([Ur,Fn]);if(Gn==="click"){if("ontouchstart"in document.documentElement)return;R.isDoubleTap(Ur,Fn,Gi);return}if(Gn==="touch"){R.isDoubleTap(Ur,Fn,Gi);return}Gn!=="click"&&Gn!=="dblclick"&&R.emit(jn.s.Hover,{x:Ur,y:Fn,lngLat:Gi,type:Gn,target:Nt})},R}return(0,ne.Z)(M,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(jn.s.Hover)}},{key:"triggerHover",value:function(te){var ve=te.x,ut=te.y;this.emit(jn.s.Hover,{x:ve,y:ut})}},{key:"triggerSelect",value:function(te){this.emit(jn.s.Select,{featureId:te})}},{key:"triggerActive",value:function(te){this.emit(jn.s.Active,{featureId:te})}},{key:"addEventListenerOnMap",value:function(){var te=this.mapService.getMapContainer();if(te){var ve=new(hi()).Manager(te);ve.add(new(hi()).Tap({event:"dblclick",taps:2})),ve.add(new(hi()).Tap({event:"click"})),ve.add(new(hi()).Pan({threshold:0,pointers:0})),ve.add(new(hi()).Press({})),ve.on("dblclick click",this.onHammer),ve.on("panstart panmove panend pancancel",this.onDrag),te.addEventListener("mousemove",this.onHover),te.addEventListener("mousedown",this.onHover,!0),te.addEventListener("mouseup",this.onHover),te.addEventListener("contextmenu",this.onHover),this.hammertime=ve,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var te=this.mapService.getMapContainer();te&&(te.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),te.removeEventListener("mousedown",this.onHover),te.removeEventListener("mouseup",this.onHover),te.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(te){var ve=te.type,ut=te.pointerType,Nt,Pt;ut==="touch"?(Pt=Math.floor(te.pointers[0].clientY),Nt=Math.floor(te.pointers[0].clientX)):(Pt=Math.floor(te.srcEvent.y),Nt=Math.floor(te.srcEvent.x));var Sr=this.mapService.getMapContainer();if(Sr){var Ur=Sr.getBoundingClientRect(),Fn=Ur.top,Gn=Ur.left;Nt-=Gn,Pt-=Fn}var vi=this.mapService.containerToLngLat([Nt,Pt]);return{x:Nt,y:Pt,lngLat:vi,type:ve,target:te.srcEvent}}},{key:"isDoubleTap",value:function(te,ve,ut){var Nt=this,Pt=new Date().getTime(),Sr="click";Pt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-te)<10&&Math.abs(this.lastClickXY[1]-ve)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Sr="dblclick",this.emit(jn.s.Hover,{x:te,y:ve,lngLat:ut,type:Sr})):(this.lastClickTime=Pt,this.lastClickXY=[te,ve],this.clickTimer=setTimeout(function(){Sr="click",Nt.emit(jn.s.Hover,{x:te,y:ve,lngLat:ut,type:Sr})},400))}}]),M}(p()),so),su=(0,Wr.Z)(gu.prototype,"mapService",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga=(0,Wr.Z)(gu.prototype,"logger",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gu))||La),Wa=x(92137),Ea=x(87757),ya=x.n(Ea),ia=x(7648),ol,ns,to,Aa,fa,fe,Pe,ft,ur,en,kn,Vi;function qi(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function Xa(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?qi(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):qi(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}var Ya=(ol=(0,w.b2)(),ns=(0,w.f3)(q.v.IRendererService),to=(0,w.f3)(q.v.IGlobalConfigService),Aa=(0,w.f3)(q.v.IInteractionService),fa=(0,w.f3)(q.v.ILayerService),ol(fe=(Pe=(Vi=function(){function Z(){var N=this;(0,ce.Z)(this,Z),(0,dr.Z)(this,"rendererService",ft,this),(0,dr.Z)(this,"configService",ur,this),(0,dr.Z)(this,"interactionService",en,this),(0,dr.Z)(this,"layerService",kn,this),this.pickingFBO=void 0,this.width=0,this.height=0,this.alreadyInPicking=!1,this.pickBufferScale=1,this.pickFromPickingFBO=function(M,R){var te,ve=R.x,ut=R.y,Nt=R.lngLat,Pt=R.type,Sr=R.target,Ur=!1,Fn=N.rendererService,Gn=Fn.getViewportSize,vi=Fn.readPixels,mi=Fn.getContainer,ci=mi().getBoundingClientRect(),ji=ci.width,Gi=ci.height;ji*=be.SO.DPR,Gi*=be.SO.DPR;var Ao=M.getLayerConfig(),No=Ao.enableHighlight,Ko=Ao.enableSelect,$a=ve*be.SO.DPR,Da=ut*be.SO.DPR;if($a>ji-1*be.SO.DPR||$a<0||Da>Gi-1*be.SO.DPR||Da<0)return!1;var ma;if(ma=vi({x:Math.floor($a/N.pickBufferScale),y:Math.floor((Gi-(ut+1)*be.SO.DPR)/N.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:N.pickingFBO}),ma[0]!==0||ma[1]!==0||ma[2]!==0){var ao=(0,be.W0)(ma),ms=M.getSource().getFeatureById(ao);ao!==M.getCurrentPickId()&&Pt==="mousemove"&&(Pt="mouseenter");var Bo={x:ve,y:ut,type:Pt,lngLat:Nt,featureId:ao,feature:ms,target:Sr};ms&&(Ur=!0,M.setCurrentPickId(ao),N.triggerHoverOnLayer(M,Bo))}else{var $o={x:ve,y:ut,lngLat:Nt,type:M.getCurrentPickId()!==null&&Pt==="mousemove"?"mouseout":"un"+Pt,featureId:null,target:Sr,feature:null};N.triggerHoverOnLayer(M,Xa(Xa({},$o),{},{type:"unpick"})),N.triggerHoverOnLayer(M,$o),M.setCurrentPickId(null)}if(No&&N.highlightPickedFeature(M,ma),Ko&&Pt==="click"&&((te=ma)===null||te===void 0?void 0:te.toString())!==[0,0,0,0].toString()){var vo=(0,be.W0)(ma);M.getCurrentSelectedId()===null||vo!==M.getCurrentSelectedId()?(N.selectFeature(M,ma),M.setCurrentSelectedId(vo)):(N.selectFeature(M,new Uint8Array([0,0,0,0])),M.setCurrentSelectedId(null))}return Ur}}return(0,ne.Z)(Z,[{key:"init",value:function(M){var R=this.rendererService,te=R.createTexture2D,ve=R.createFramebuffer,ut=R.getViewportSize,Nt=R.getContainer,Pt=Nt().getBoundingClientRect(),Sr=Pt.width,Ur=Pt.height;Sr*=be.SO.DPR,Ur*=be.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(M).pickBufferScale||1,this.pickingFBO=ve({color:te({width:Math.round(Sr/this.pickBufferScale),height:Math.round(Ur/this.pickBufferScale),wrapS:ia.gl.CLAMP_TO_EDGE,wrapT:ia.gl.CLAMP_TO_EDGE})}),this.interactionService.on(jn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var N=(0,Wa.Z)(ya().mark(function R(te,ve,ut){var Nt=this,Pt,Sr,Ur,Fn;return ya().wrap(function(vi){for(;;)switch(vi.prev=vi.next){case 0:Pt=this.rendererService,Sr=Pt.useFramebuffer,Ur=Pt.clear,Fn=Pt.getContainer,this.resizePickingFBO(),Sr(this.pickingFBO,function(){Ur({framebuffer:Nt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),te.hooks.beforePickingEncode.call(),te.renderModels(),te.hooks.afterPickingEncode.call();var mi=Nt.pickBox(te,ve);ut(mi)});case 3:case"end":return vi.stop()}},R,this)}));function M(R,te,ve){return N.apply(this,arguments)}return M}()},{key:"pickBox",value:function(M,R){var te=this,ve=R.map(function($o){var vo=$o<0?0:$o;return Math.floor(vo*be.SO.DPR/te.pickBufferScale)}),ut=(0,yr.Z)(ve,4),Nt=ut[0],Pt=ut[1],Sr=ut[2],Ur=ut[3],Fn=this.rendererService,Gn=Fn.getViewportSize,vi=Fn.readPixels,mi=Fn.getContainer,ci=mi().getBoundingClientRect(),ji=ci.width,Gi=ci.height;if(ji*=be.SO.DPR,Gi*=be.SO.DPR,Nt>(ji-1)*be.SO.DPR/this.pickBufferScale||Sr<0||Pt>(Gi-1)*be.SO.DPR/this.pickBufferScale||Ur<0)return[];var Ao,No=Math.min(ji/this.pickBufferScale,Sr)-Nt,Ko=Math.min(Gi/this.pickBufferScale,Ur)-Pt;Ao=vi({x:Nt,y:Math.floor(Gi/this.pickBufferScale-(Ur+1)),width:No,height:Ko,data:new Uint8Array(No*Ko*4),framebuffer:this.pickingFBO});for(var $a=[],Da={},ma=0;ma<Ao.length/4;ma=ma+1){var ao=Ao.slice(ma*4,ma*4+4),ms=(0,be.W0)(ao);if(ms!==-1&&!Da[ms]){var Bo=M.getSource().getFeatureById(ms);$a.push(Bo),Da[ms]=!0}}return $a}},{key:"pickingAllLayer",value:function(){var N=(0,Wa.Z)(ya().mark(function R(te){return ya().wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){ut.next=2;break}return ut.abrupt("return");case 2:return this.alreadyInPicking=!0,ut.next=5,this.pickingLayers(te);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return ut.stop()}},R,this)}));function M(R){return N.apply(this,arguments)}return M}()},{key:"resizePickingFBO",value:function(){var M=this.rendererService.getContainer,R=M().getBoundingClientRect(),te=R.width,ve=R.height;te*=be.SO.DPR,ve*=be.SO.DPR,(this.width!==te||this.height!==ve)&&(this.pickingFBO.resize({width:Math.round(te/this.pickBufferScale),height:Math.round(ve/this.pickBufferScale)}),this.width=te,this.height=ve)}},{key:"pickingLayers",value:function(){var N=(0,Wa.Z)(ya().mark(function R(te){var ve=this,ut,Nt,Pt,Sr,Ur;return ya().wrap(function(Gn){for(;;)switch(Gn.prev=Gn.next){case 0:ut=this.rendererService,Nt=ut.getViewportSize,Pt=ut.useFramebuffer,Sr=ut.clear,Ur=ut.getContainer,this.resizePickingFBO(),Pt(this.pickingFBO,function(){var vi=ve.layerService.getLayers();vi.filter(function(mi){return mi.needPick(te.type)}).reverse().some(function(mi){Sr({framebuffer:ve.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),mi.hooks.beforePickingEncode.call(),mi.renderModels(),mi.hooks.afterPickingEncode.call();var ci=ve.pickFromPickingFBO(mi,te);return ci&&!mi.getLayerConfig().enablePropagation})});case 3:case"end":return Gn.stop()}},R,this)}));function M(R){return N.apply(this,arguments)}return M}()},{key:"triggerHoverOnLayer",value:function(M,R){M.emit(R.type,R)}},{key:"isEventCrash",value:function(M){var R=!0;return M.target.path.map(function(te){te.classList&&te.classList.forEach(function(ve){(ve==="l7-marker"||ve==="l7-popup")&&(R=!1)})}),R}},{key:"highlightPickedFeature",value:function(M,R){var te=(0,yr.Z)(R,3),ve=te[0],ut=te[1],Nt=te[2];M.hooks.beforeHighlight.call([ve,ut,Nt])}},{key:"selectFeature",value:function(M,R){var te=(0,yr.Z)(R,3),ve=te[0],ut=te[1],Nt=te[2];M.hooks.beforeSelect.call([ve,ut,Nt])}}]),Z}(),Vi),ft=(0,Wr.Z)(Pe.prototype,"rendererService",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ur=(0,Wr.Z)(Pe.prototype,"configService",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en=(0,Wr.Z)(Pe.prototype,"interactionService",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn=(0,Wr.Z)(Pe.prototype,"layerService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe))||fe),Wo=function(){function Z(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ce.Z)(this,Z),this.autoStart=void 0,this.startTime=0,this.oldTime=0,this.running=!1,this.elapsedTime=0,this.autoStart=N}return(0,ne.Z)(Z,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var M=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var R=(typeof performance=="undefined"?Date:performance).now();M=(R-this.oldTime)/1e3,this.oldTime=R,this.elapsedTime+=M}return M}}]),Z}(),xs,jl,Ku,Do,Cs,uo,Ps,Ca,pi=(xs=(0,w.b2)(),jl=(0,w.f3)(q.v.IRendererService),Ku=(0,w.f3)(q.v.IGlobalConfigService),xs(Do=(Cs=(Ca=function(){function Z(){(0,ce.Z)(this,Z),this.clock=new Wo,this.alreadyInRendering=!1,this.layers=[],this.layerRenderID=void 0,this.sceneInited=!1,this.animateInstanceCount=0,(0,dr.Z)(this,"renderService",uo,this),(0,dr.Z)(this,"configService",Ps,this)}return(0,ne.Z)(Z,[{key:"add",value:function(M){this.sceneInited&&M.init(),this.layers.push(M)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(M){M.inited||M.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(M){return this.layers.find(function(R){return R.id===M})}},{key:"getLayerByName",value:function(M){return this.layers.find(function(R){return R.name===M})}},{key:"remove",value:function(M){var R=this.layers.indexOf(M);R>-1&&this.layers.splice(R,1),M.emit("remove",null),M.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(M){return M.inited}).filter(function(M){return M.isVisible()}).forEach(function(M){M.hooks.beforeRenderData.call(),M.hooks.beforeRender.call(),M.render(),M.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(M,R){return M.zIndex-R.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(M){return M.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),Z}(),Ca),uo=(0,Wr.Z)(Cs.prototype,"renderService",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ps=(0,Wr.Z)(Cs.prototype,"configService",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cs))||Do),sl=x(81253),Ra=x(85061),zn=x(14293),Ks=x.n(zn),Zl=function(){function Z(N){var M=this;(0,ce.Z)(this,Z),this.name=void 0,this.type=void 0,this.scale=void 0,this.descriptor=void 0,this.featureBufferLayout=[],this.needRescale=!1,this.needRemapping=!1,this.needRegenerateVertices=!1,this.featureRange={startIndex:0,endIndex:Infinity},this.vertexAttribute=void 0,this.defaultCallback=function(R){if(R.length===0){var te;return((te=M.scale)===null||te===void 0?void 0:te.defaultValues)||[]}return R.map(function(ve,ut){var Nt,Pt=(Nt=M.scale)===null||Nt===void 0?void 0:Nt.scalers[ut].func,Sr=Pt(ve);return Sr})},this.setProps(N)}return(0,ne.Z)(Z,[{key:"setProps",value:function(M){Object.assign(this,M)}},{key:"mapping",value:function(M){var R;if((R=this.scale)!==null&&R!==void 0&&R.callback){var te,ve=(te=this.scale)===null||te===void 0?void 0:te.callback.apply(te,(0,Ra.Z)(M));if(!Ks()(ve))return[ve]}return this.defaultCallback(M)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),Z}(),lo,je,Tt,gr,In,Yi,_a;function Ba(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function aa(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?Ba(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):Ba(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function Pa(Z){return new Promise(function(N){return setTimeout(N,Z)})}var ko=(lo={},(0,Y.Z)(lo,ia.gl.FLOAT,4),(0,Y.Z)(lo,ia.gl.UNSIGNED_BYTE,1),(0,Y.Z)(lo,ia.gl.UNSIGNED_SHORT,2),lo),Mo=(je=(0,w.b2)(),Tt=(0,w.f3)(q.v.IRendererService),je(gr=(In=(_a=function(){function Z(){(0,ce.Z)(this,Z),this.attributesAndIndices=void 0,(0,dr.Z)(this,"rendererService",Yi,this),this.attributes=[],this.triangulation=void 0,this.featureLayout={sizePerElement:0,elements:[]}}return(0,ne.Z)(Z,[{key:"registerStyleAttribute",value:function(M){var R=this.getLayerStyleAttribute(M.name||"");return R?R.setProps(M):(R=new Zl(M),this.attributes.push(R)),R}},{key:"updateStyleAttribute",value:function(M,R,te){var ve=this.getLayerStyleAttribute(M);ve||(ve=this.registerStyleAttribute(aa(aa({},R),{},{name:M})));var ut=R.scale;ut&&ve&&(ve.scale=ut,ve.needRescale=!0,ve.needRemapping=!0,ve.needRegenerateVertices=!0,te&&te.featureRange&&(ve.featureRange=te.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(M){return this.attributes.find(function(R){return R.name===M})}},{key:"getLayerAttributeScale",value:function(M){var R,te=this.getLayerStyleAttribute(M),ve=te==null||(R=te.scale)===null||R===void 0?void 0:R.scalers;return ve&&ve[0]?ve[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(M,R){var te=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,ve=arguments.length>3?arguments[3]:void 0,ut=this.attributes.find(function(Ko){return Ko.name===M});if(ut&&ut.descriptor){var Nt=ut.descriptor,Pt=Nt.update,Sr=Nt.buffer,Ur=Nt.size,Fn=Ur===void 0?0:Ur,Gn=ko[Sr.type||ia.gl.FLOAT];if(Pt){var vi=this.featureLayout,mi=vi.elements,ci=vi.sizePerElement,ji=mi.slice(te,ve);if(!ji.length)return;var Gi=ji[0].offset,Ao=Gi*Fn*Gn,No=ji.map(function(Ko,$a){for(var Da=Ko.featureIdx,ma=Ko.vertices,ao=Ko.normals,ms=ma.length/ci,Bo=[],$o=0;$o<ms;$o++){var vo=ao?ao.slice($o*3,$o*3+3):[];Bo.push.apply(Bo,(0,Ra.Z)(Pt(R[Da],Da,ma.slice($o*ci,$o*ci+ci),$a,vo)))}return Bo}).reduce(function(Ko,$a){return Ko.push.apply(Ko,(0,Ra.Z)($a)),Ko},[]);ut.vertexAttribute.updateBuffer({data:No,offset:Ao})}}}},{key:"createAttributesAndIndices",value:function(M,R){var te=this;this.featureLayout={sizePerElement:0,elements:[]},R&&(this.triangulation=R);var ve=this.attributes.map(function(Gi){return Gi.resetDescriptor(),Gi.descriptor}),ut=0,Nt=[],Pt=[],Sr=[],Ur=3;M.forEach(function(Gi,Ao){var No=te.triangulation(Gi),Ko=No.indices,$a=No.vertices,Da=No.normals,ma=No.size;Ko.forEach(function($o){Pt.push($o+ut)}),Ur=ma;var ao=$a.length/ma;te.featureLayout.sizePerElement=Ur,te.featureLayout.elements.push({featureIdx:Ao,vertices:$a,normals:Da,offset:ut}),ut+=ao;for(var ms=function(vo){var Xs=(Da==null?void 0:Da.slice(vo*3,vo*3+3))||[],yl=$a.slice(vo*ma,vo*ma+ma);ve.forEach(function(Ds,_l){if(Ds&&Ds.update){var Ys;(Ys=Ds.buffer.data).push.apply(Ys,(0,Ra.Z)(Ds.update(Gi,Ao,yl,vo,Xs)))}})},Bo=0;Bo<ao;Bo++)ms(Bo)});var Fn=this.rendererService,Gn=Fn.createAttribute,vi=Fn.createBuffer,mi=Fn.createElements,ci={};ve.forEach(function(Gi,Ao){if(Gi){var No=Gi.buffer,Ko=Gi.update,$a=Gi.name,Da=(0,sl.Z)(Gi,["buffer","update","name"]),ma=Gn(aa({buffer:vi(No)},Da));ci[Gi.name||""]=ma,te.attributes[Ao].vertexAttribute=ma}});var ji=mi({data:Pt,type:ia.gl.UNSIGNED_INT,count:Pt.length});return this.attributesAndIndices={attributes:ci,elements:ji},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var M;this.attributes.forEach(function(R){R.vertexAttribute&&R.vertexAttribute.destroy()}),(M=this.attributesAndIndices)===null||M===void 0||M.elements.destroy(),this.attributes=[]}}]),Z}(),_a),Yi=(0,Wr.Z)(In.prototype,"rendererService",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),In))||gr),Ri=x(34155);function wl(Z){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof Ri!="undefined"&&typeof Ri.versions=="object"&&Boolean(Ri.versions.electron))return!0;const N=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,M=Z||N;return!!(M&&M.indexOf("Electron")>=0)}var Us=x(34155);function ps(){return!(typeof Us=="object"&&String(Us)==="[object process]"&&!Us.browser)||wl()}function Vl(){return ps()&&typeof document!="undefined"}const co=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",is=ps();function as(Z){try{const N=window[Z],M="__storage_test__";return N.setItem(M,M),N.removeItem(M),N}catch(N){return null}}class uu{constructor(N,M,R="sessionStorage"){this.storage=as(R),this.id=N,this.config={},Object.assign(this.config,M),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(N){return this.config={},this.updateConfiguration(N)}updateConfiguration(N){if(Object.assign(this.config,N),this.storage){const M=JSON.stringify(this.config);this.storage.setItem(this.id,M)}return this}_loadConfiguration(){let N={};if(this.storage){const M=this.storage.getItem(this.id);N=M?JSON.parse(M):{}}return Object.assign(this.config,N),this}}function Ms(Z){let N;return Z<10?N="".concat(Z.toFixed(2),"ms"):Z<100?N="".concat(Z.toFixed(1),"ms"):Z<1e3?N="".concat(Z.toFixed(0),"ms"):N="".concat((Z/1e3).toFixed(2),"s"),N}function pc(Z,N=8){const M=Math.max(N-Z.length,0);return"".concat(" ".repeat(M)).concat(Z)}function vf(Z,N=8){const M=Math.max(N-Z.length,0);return"".concat(Z).concat(" ".repeat(M))}function xa(Z,N={}){const M=1e-16,{isInteger:R=!1}=N;if(Array.isArray(Z)||ArrayBuffer.isView(Z))return mf(Z,N);if(!Number.isFinite(Z))return String(Z);if(Math.abs(Z)<M)return R?"0":"0.";if(R||Math.abs(Z)>100&&Math.abs(Z)<1e4)return Z.toFixed(0);const te=Z.toPrecision(2);return te.indexOf(".0")===te.length-2?te.slice(0,-1):te}function mf(Z,N){const{maxElts:M=16,size:R=1}=N;let te="[";for(let ut=0;ut<Z.length&&ut<M;++ut)ut>0&&(te+=",".concat(ut%R==0?" ":"")),te+=xa(Z[ut],N);const ve=Z.length>M?"...":"]";return"".concat(te).concat(ve)}function lu(Z,N,M,R=600){const te=Z.src.replace(/\(/g,"%28").replace(/\)/g,"%29");Z.width>R&&(M=Math.min(M,R/Z.width));const ve=Z.width*M,ut=Z.height*M,Nt=["font-size:1px;","padding:".concat(Math.floor(ut/2),"px ").concat(Math.floor(ve/2),"px;"),"line-height:".concat(ut,"px;"),"background:url(".concat(te,");"),"background-size:".concat(ve,"px ").concat(ut,"px;"),"color:transparent;"].join("");return["".concat(N," %c+"),Nt]}const Gl={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function Ic(Z){return typeof Z=="string"?Gl[Z.toUpperCase()]||Gl.WHITE:Z}function Oc(Z,N,M){return!is&&typeof Z=="string"&&(N&&(N=Ic(N),Z="[".concat(N,"m").concat(Z,"[39m")),M&&(N=Ic(M),Z="[".concat(M+10,"m").concat(Z,"[49m"))),Z}function ro(Z,N=["constructor"]){const M=Object.getPrototypeOf(Z),R=Object.getOwnPropertyNames(M);for(const te of R)typeof Z[te]=="function"&&(N.find(ve=>te===ve)||(Z[te]=Z[te].bind(Z)))}function yu(Z,N){if(!Z)throw new Error(N||"Assertion failed")}var $u=x(34155);const Ua={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof x.g!="undefined"&&x.g,document:typeof document!="undefined"&&document,process:typeof $u=="object"&&$u},Lc=Ua.self||Ua.window||Ua.global,Tl=Ua.window||Ua.self||Ua.global,Ou=Ua.global||Ua.self||Ua.window,ul=Ua.document||{},Hl=Ua.process||{},Ju=console;function Is(){let Z;if(is&&Tl.performance)Z=Tl.performance.now();else if(Hl.hrtime){const N=Hl.hrtime();Z=N[0]*1e3+N[1]/1e6}else Z=Date.now();return Z}const Al={debug:is&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Cl={enabled:!0,level:0};function Ui(){}const dc={},gf={once:!0};function Wl(Z){for(const N in Z)for(const M in Z[N])return M||"untitled";return"empty"}class Jc{constructor({id:N}={id:""}){this.id=N,this.VERSION=co,this._startTs=Is(),this._deltaTs=Is(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new uu("__probe-".concat(this.id,"__"),Cl),this.userData={},this.timeStamp("".concat(this.id," started")),ro(this),Object.seal(this)}set level(N){this.setLevel(N)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Is()-this._startTs).toPrecision(10))}getDelta(){return Number((Is()-this._deltaTs).toPrecision(10))}set priority(N){this.level=N}get priority(){return this.level}getPriority(){return this.level}enable(N=!0){return this._storage.updateConfiguration({enabled:N}),this}setLevel(N){return this._storage.updateConfiguration({level:N}),this}assert(N,M){yu(N,M)}warn(N){return this._getLogFunction(0,N,Al.warn,arguments,gf)}error(N){return this._getLogFunction(0,N,Al.error,arguments)}deprecated(N,M){return this.warn("`".concat(N,"` is deprecated and will be removed in a later version. Use `").concat(M,"` instead"))}removed(N,M){return this.error("`".concat(N,"` has been removed. Use `").concat(M,"` instead"))}probe(N,M){return this._getLogFunction(N,M,Al.log,arguments,{time:!0,once:!0})}log(N,M){return this._getLogFunction(N,M,Al.debug,arguments)}info(N,M){return this._getLogFunction(N,M,console.info,arguments)}once(N,M){return this._getLogFunction(N,M,Al.debug||Al.info,arguments,gf)}table(N,M,R){return M?this._getLogFunction(N,M,console.table||Ui,R&&[R],{tag:Wl(M)}):Ui}image({logLevel:N,priority:M,image:R,message:te="",scale:ve=1}){return this._shouldLog(N||M)?is?Lu({image:R,message:te,scale:ve}):ll({image:R,message:te,scale:ve}):Ui}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(N){return this._storage.config[N]}set(N,M){this._storage.updateConfiguration({[N]:M})}time(N,M){return this._getLogFunction(N,M,console.time?console.time:console.info)}timeEnd(N,M){return this._getLogFunction(N,M,console.timeEnd?console.timeEnd:console.info)}timeStamp(N,M){return this._getLogFunction(N,M,console.timeStamp||Ui)}group(N,M,R={collapsed:!1}){R=Xl({logLevel:N,message:M,opts:R});const{collapsed:te}=R;return R.method=(te?console.groupCollapsed:console.group)||console.info,this._getLogFunction(R)}groupCollapsed(N,M,R={}){return this.group(N,M,Object.assign({},R,{collapsed:!0}))}groupEnd(N){return this._getLogFunction(N,"",console.groupEnd||Ui)}withGroup(N,M,R){this.group(N,M)();try{R()}finally{this.groupEnd(N)()}}trace(){console.trace&&console.trace()}_shouldLog(N){return this.isEnabled()&&this.getLevel()>=Rc(N)}_getLogFunction(N,M,R,te=[],ve){if(this._shouldLog(N)){ve=Xl({logLevel:N,message:M,args:te,opts:ve}),R=R||ve.method,yu(R),ve.total=this.getTotal(),ve.delta=this.getDelta(),this._deltaTs=Is();const ut=ve.tag||ve.message;if(ve.once)if(!dc[ut])dc[ut]=Is();else return Ui;return M=Yl(this.id,ve.message,ve),R.bind(console,M,...ve.args)}return Ui}}Jc.VERSION=co;function Rc(Z){if(!Z)return 0;let N;switch(typeof Z){case"number":N=Z;break;case"object":N=Z.logLevel||Z.priority||0;break;default:return 0}return yu(Number.isFinite(N)&&N>=0),N}function Xl(Z){const{logLevel:N,message:M}=Z;Z.logLevel=Rc(N);const R=Z.args?Array.from(Z.args):[];for(;R.length&&R.shift()!==M;);switch(Z.args=R,typeof N){case"string":case"function":M!==void 0&&R.unshift(M),Z.message=N;break;case"object":Object.assign(Z,N);break;default:}typeof Z.message=="function"&&(Z.message=Z.message());const te=typeof Z.message;return yu(te==="string"||te==="object"),Object.assign(Z,Z.opts)}function Yl(Z,N,M){if(typeof N=="string"){const R=M.time?pc(Ms(M.total)):"";N=M.time?"".concat(Z,": ").concat(R,"  ").concat(N):"".concat(Z,": ").concat(N),N=Oc(N,M.color,M.background)}return N}function ll({image:Z,message:N="",scale:M=1}){let R=null;try{R=x(75307)}catch(te){}return R?()=>R(Z,{fit:"box",width:"".concat(Math.round(80*M),"%")}).then(te=>console.log(te)):Ui}function Lu({image:Z,message:N="",scale:M=1}){if(typeof Z=="string"){const te=new Image;return te.onload=()=>{const ve=lu(te,N,M);console.log(...ve)},te.src=Z,Ui}const R=Z.nodeName||"";if(R.toLowerCase()==="img")return console.log(...lu(Z,N,M)),Ui;if(R.toLowerCase()==="canvas"){const te=new Image;return te.onload=()=>console.log(...lu(te,N,M)),te.src=Z.toDataURL(),Ui}return Ui}var Pl,cl,cu=new Jc({id:"L7"}).enable(!1);cu.priority=5;var Dc=(Pl=(0,w.b2)(),Pl(cl=function(){function Z(){(0,ce.Z)(this,Z)}return(0,ne.Z)(Z,[{key:"error",value:function(M){cu.error(M)()}},{key:"warn",value:function(M){cu.probe(1,M)()}},{key:"info",value:function(M){cu.info(3,M)()}},{key:"debug",value:function(M){cu.probe(4,M)()}}]),Z}())||cl),Ml=x(46343),$s=x(67709),Qc=x.n($s),yf=window.document.documentElement.style,qc=0;function ba(Z){var N=Z;if(typeof Z=="string"&&(N=document.getElementById(Z)),N){var M=document.createElement("div");return M.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,M.id="l7-scene-".concat(qc++),M.classList.add("l7-scene"),N.appendChild(M),M}return null}var Il,Ol,Ru,fl,vc,Du,kc,ef,tf,Ll,zc,Fc,Nc,hl,Bc,ku,Ma,Kl,Ka,Qu,Fi,Ta,js,$l,Rl,Jl,_f,xf,Dl,zu,Fu,no,ds,pl,fo,Tn;function Zs(Z){var N=mc();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var kl=(Il=(0,w.b2)(),Ol=(0,w.f3)(q.v.SceneID),Ru=(0,w.f3)(q.v.IIconService),fl=(0,w.f3)(q.v.IFontService),vc=(0,w.f3)(q.v.IControlService),Du=(0,w.f3)(q.v.ILogService),kc=(0,w.f3)(q.v.IGlobalConfigService),ef=(0,w.f3)(q.v.IMapService),tf=(0,w.f3)(q.v.ICoordinateSystemService),Ll=(0,w.f3)(q.v.IRendererService),zc=(0,w.f3)(q.v.ILayerService),Fc=(0,w.f3)(q.v.ICameraService),Nc=(0,w.f3)(q.v.IInteractionService),hl=(0,w.f3)(q.v.IPickingService),Bc=(0,w.f3)(q.v.IShaderModuleService),ku=(0,w.f3)(q.v.IMarkerService),Ma=(0,w.f3)(q.v.IPopupService),Il(Kl=(Ka=(Tn=function(Z){(0,Ct.Z)(M,Z);var N=Zs(M);function M(){var R;return(0,ce.Z)(this,M),R=N.call(this),R.destroyed=!1,R.loaded=!1,R.loadFont=!1,R.fontFamily="",(0,dr.Z)(R,"id",Qu,(0,Rn.Z)(R)),(0,dr.Z)(R,"iconService",Fi,(0,Rn.Z)(R)),(0,dr.Z)(R,"fontService",Ta,(0,Rn.Z)(R)),(0,dr.Z)(R,"controlService",js,(0,Rn.Z)(R)),(0,dr.Z)(R,"logger",$l,(0,Rn.Z)(R)),(0,dr.Z)(R,"configService",Rl,(0,Rn.Z)(R)),(0,dr.Z)(R,"map",Jl,(0,Rn.Z)(R)),(0,dr.Z)(R,"coordinateSystemService",_f,(0,Rn.Z)(R)),(0,dr.Z)(R,"rendererService",xf,(0,Rn.Z)(R)),(0,dr.Z)(R,"layerService",Dl,(0,Rn.Z)(R)),(0,dr.Z)(R,"cameraService",zu,(0,Rn.Z)(R)),(0,dr.Z)(R,"interactionService",Fu,(0,Rn.Z)(R)),(0,dr.Z)(R,"pickingService",no,(0,Rn.Z)(R)),(0,dr.Z)(R,"shaderModuleService",ds,(0,Rn.Z)(R)),(0,dr.Z)(R,"markerService",pl,(0,Rn.Z)(R)),(0,dr.Z)(R,"popupService",fo,(0,Rn.Z)(R)),R.inited=!1,R.initPromise=void 0,R.rendering=!1,R.$container=void 0,R.canvas=void 0,R.markerContainer=void 0,R.hooks=void 0,R.handleWindowResized=function(){R.emit("resize"),R.$container&&(R.initContainer(),be.SO.triggerResize(),R.coordinateSystemService.needRefresh=!0,R.render())},R.handleMapCameraChanged=function(te){R.cameraService.update(te),R.render()},R.hooks={init:new Ml.zj},R}return(0,ne.Z)(M,[{key:"init",value:function(te){var ve=this;this.configService.setSceneConfig(this.id,te),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Wa.Z)(ya().mark(function ut(){return ya().wrap(function(Pt){for(;;)switch(Pt.prev=Pt.next){case 0:return Pt.next=2,new Promise(function(Sr){ve.map.onCameraChanged(function(Ur){ve.cameraService.init(),ve.cameraService.update(Ur),ve.map.version!=="GAODE2.x"&&Sr()}),ve.map.version!=="GAODE2.x"?ve.map.init():Sr()});case 2:if(!(ve.map.version==="GAODE2.x"&&ve.map.initViewPort)){Pt.next=6;break}return Pt.next=5,ve.map.init();case 5:ve.map.initViewPort();case 6:ve.map.onCameraChanged(ve.handleMapCameraChanged),ve.map.addMarkerContainer(),ve.markerService.addMarkers(),ve.markerService.addMarkerLayers(),ve.popupService.initPopup(),ve.interactionService.init(),ve.interactionService.on(jn.s.Drag,ve.addSceneEvent.bind(ve)),ve.logger.debug("map ".concat(ve.id," loaded"));case 14:case"end":return Pt.stop()}},ut)}))),this.hooks.init.tapPromise("initRenderer",(0,Wa.Z)(ya().mark(function ut(){var Nt;return ya().wrap(function(Sr){for(;;)switch(Sr.prev=Sr.next){case 0:if(Nt=ba(ve.configService.getSceneConfig(ve.id).id||""),ve.$container=Nt,!Nt){Sr.next=11;break}return ve.canvas=be.SO.create("canvas","",Nt),ve.setCanvas(),Sr.next=7,ve.rendererService.init(ve.canvas,ve.configService.getSceneConfig(ve.id));case 7:Qc()(ve.$container,ve.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(ve.handleWindowResized),Sr.next=12;break;case 11:ve.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:ve.pickingService.init(ve.id),ve.logger.debug("scene ".concat(ve.id," renderer loaded"));case 14:case"end":return Sr.stop()}},ut)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(te){this.logger.debug("add layer ".concat(te.name," to scene ").concat(this.id)),this.layerService.add(te),this.render()}},{key:"render",value:function(){var R=(0,Wa.Z)(ya().mark(function ve(){return ya().wrap(function(Nt){for(;;)switch(Nt.prev=Nt.next){case 0:if(!(this.rendering||this.destroyed)){Nt.next=2;break}return Nt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Nt.next=16;break}return Nt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Nt.next=10;break}return Nt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return Nt.stop()}},ve,this)}));function te(){return R.apply(this,arguments)}return te}()},{key:"addFontFace",value:function(te,ve){this.fontFamily=te;var ut=document.createElement("style");ut.type="text/css",ut.innerText=`
        @font-face{
            font-family: '`.concat(te,`';
            src: url('`).concat(ve,`') format('woff2'),
            url('`).concat(ve,`') format('woff'),
            url('`).concat(ve,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(ut),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(te){var ve,ut=(ve=this.$container)===null||ve===void 0?void 0:ve.getElementsByTagName("canvas")[0];this.render();var Nt=te==="jpg"?ut==null?void 0:ut.toDataURL("image/jpeg"):ut==null?void 0:ut.toDataURL("image/png");return Nt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var te=this.$container.parentElement;te!==null&&(this.markerContainer=be.SO.create("div","l7-marker-container",te))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,$s.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var te,ve,ut=be.SO.DPR,Nt=((te=this.$container)===null||te===void 0?void 0:te.clientWidth)||400,Pt=((ve=this.$container)===null||ve===void 0?void 0:ve.clientHeight)||300,Sr=this.canvas;Sr&&(Sr.width=Nt*ut,Sr.height=Pt*ut,Sr.style.width="".concat(Nt,"px"),Sr.style.height="".concat(Pt,"px")),this.rendererService.viewport({x:0,y:0,width:ut*Nt,height:ut*Pt})}},{key:"setCanvas",value:function(){var te,ve,ut=be.SO.DPR,Nt=((te=this.$container)===null||te===void 0?void 0:te.clientWidth)||400,Pt=((ve=this.$container)===null||ve===void 0?void 0:ve.clientHeight)||300,Sr=this.canvas;Sr.width=Nt*ut,Sr.height=Pt*ut,Sr.style.width="".concat(Nt,"px"),Sr.style.height="".concat(Pt,"px")}},{key:"addSceneEvent",value:function(te){this.emit(te.type,te)}}]),M}(E.EventEmitter),Tn),Qu=(0,Wr.Z)(Ka.prototype,"id",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fi=(0,Wr.Z)(Ka.prototype,"iconService",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=(0,Wr.Z)(Ka.prototype,"fontService",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),js=(0,Wr.Z)(Ka.prototype,"controlService",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$l=(0,Wr.Z)(Ka.prototype,"logger",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rl=(0,Wr.Z)(Ka.prototype,"configService",[kc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=(0,Wr.Z)(Ka.prototype,"map",[ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f=(0,Wr.Z)(Ka.prototype,"coordinateSystemService",[tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xf=(0,Wr.Z)(Ka.prototype,"rendererService",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl=(0,Wr.Z)(Ka.prototype,"layerService",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu=(0,Wr.Z)(Ka.prototype,"cameraService",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fu=(0,Wr.Z)(Ka.prototype,"interactionService",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=(0,Wr.Z)(Ka.prototype,"pickingService",[hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds=(0,Wr.Z)(Ka.prototype,"shaderModuleService",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pl=(0,Wr.Z)(Ka.prototype,"markerService",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fo=(0,Wr.Z)(Ka.prototype,"popupService",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka))||Kl),fu=x(44908),Vs=x.n(fu);function dl(Z){var N=0;switch(Z){case"vec2":case"ivec2":N=2;break;case"vec3":case"ivec3":N=3;break;case"vec4":case"ivec4":case"mat2":N=4;break;case"mat3":N=9;break;case"mat4":N=16;break;default:}return N}var Jr=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function gc(Z){var N={};return Z=Z.replace(Jr,function(M,R,te){var ve=te.split(":"),ut=ve[0].trim(),Nt="";switch(ve.length>1&&(Nt=ve[1].trim()),R){case"bool":Nt=Nt==="true";break;case"float":case"int":Nt=Number(Nt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Nt?Nt=Nt.replace("[","").replace("]","").split(",").reduce(function(Pt,Sr){return Pt.push(Number(Sr.trim())),Pt},[]):Nt=new Array(dl(R)).fill(0);break;default:}return N[ut]=Nt,"uniform ".concat(R," ").concat(ut,`;
`)}),{content:Z,uniforms:N}}var Ql,Nu,Gs;function bs(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function vl(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?bs(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):bs(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}var yc="#define PI 3.14159265359",Hs=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,qu=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Uc=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,ql=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,rf=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,jc=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,_u=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Js=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Di=/precision\s+(high|low|medium)p\s+float/,Bu=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,os=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Io=(Ql=(0,w.b2)(),Ql(Nu=(Gs=function(){function Z(){(0,ce.Z)(this,Z),this.moduleCache={},this.rawContentCache={}}return(0,ne.Z)(Z,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:yc,fs:yc}),this.registerModule("decode",{vs:Hs,fs:""}),this.registerModule("projection",{vs:_u,fs:""}),this.registerModule("project",{vs:jc,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Js}),this.registerModule("lighting",{vs:Uc,fs:""}),this.registerModule("light",{vs:qu,fs:""}),this.registerModule("picking",{vs:rf,fs:ql})}},{key:"registerModule",value:function(M,R){if(!this.rawContentCache[M]){var te=R.vs,ve=R.fs,ut=R.uniforms,Nt=gc(te),Pt=Nt.content,Sr=Nt.uniforms,Ur=gc(ve),Fn=Ur.content,Gn=Ur.uniforms;this.rawContentCache[M]={fs:Fn,uniforms:vl(vl(vl({},Sr),Gn),ut),vs:Pt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(M){var R=this;if(this.moduleCache[M])return this.moduleCache[M];var te=this.rawContentCache[M].vs,ve=this.rawContentCache[M].fs,ut=this.processModule(te,[],"vs"),Nt=ut.content,Pt=ut.includeList,Sr=this.processModule(ve,[],"fs"),Ur=Sr.content,Fn=Sr.includeList,Gn=Ur,vi=Vs()(Pt.concat(Fn).concat(M)).reduce(function(mi,ci){return vl(vl({},mi),R.rawContentCache[ci].uniforms)},{});return Di.test(Ur)||(Gn=Bu+Ur),this.moduleCache[M]={fs:Gn.trim(),uniforms:vi,vs:Nt.trim()},this.moduleCache[M]}},{key:"processModule",value:function(M,R,te){var ve=this,ut=M.replace(os,function(Nt,Pt){var Sr=Pt.split(" "),Ur=Sr[0].replace(/"/g,"");if(R.indexOf(Ur)>-1)return"";var Fn=ve.rawContentCache[Ur][te];R.push(Ur);var Gn=ve.processModule(Fn,R,te),vi=Gn.content;return vi});return{content:ut,includeList:R}}}]),Z}(),Gs))||Nu),xu=x(66213),Qs=x(92364),qs,ss,zl,Zn,Mn,ec,zo=(qs=(0,w.b2)(),ss=(0,w.f3)(q.v.IShaderModuleService),qs(zl=(Zn=(ec=function(){function Z(){(0,ce.Z)(this,Z),(0,dr.Z)(this,"shaderModuleService",Mn,this),this.rendererService=void 0,this.cameraService=void 0,this.mapService=void 0,this.interactionService=void 0,this.layerService=void 0,this.config=void 0}return(0,ne.Z)(Z,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Qs.G.Normal}},{key:"init",value:function(M,R){this.config=R,this.rendererService=M.getContainer().get(q.v.IRendererService),this.cameraService=M.getContainer().get(q.v.ICameraService),this.mapService=M.getContainer().get(q.v.IMapService),this.interactionService=M.getContainer().get(q.v.IInteractionService),this.layerService=M.getContainer().get(q.v.ILayerService)}},{key:"render",value:function(M){}}]),Z}(),ec),Mn=(0,Wr.Z)(Zn.prototype,"shaderModuleService",[ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn))||zl),To,Fo;function bu(Z){var N=Su();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function Su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var tc=(To=(0,w.b2)(),To(Fo=function(Z){(0,Ct.Z)(M,Z);var N=bu(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(te,ve){(0,xu.Z)((0,S.Z)(M.prototype),"init",this).call(this,te,ve)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),M}(zo))||Fo),ea,_o,Zc,Uu,_c,Eu;function Os(Z,N){var M;if(typeof Symbol=="undefined"||Z[Symbol.iterator]==null){if(Array.isArray(Z)||(M=Fl(Z))||N&&Z&&typeof Z.length=="number"){M&&(Z=M);var R=0,te=function(){};return{s:te,n:function(){return R>=Z.length?{done:!0}:{done:!1,value:Z[R++]}},e:function(Sr){throw Sr},f:te}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ve=!0,ut=!1,Nt;return{s:function(){M=Z[Symbol.iterator]()},n:function(){var Sr=M.next();return ve=Sr.done,Sr},e:function(Sr){ut=!0,Nt=Sr},f:function(){try{!ve&&M.return!=null&&M.return()}finally{if(ut)throw Nt}}}}function Fl(Z,N){if(!!Z){if(typeof Z=="string")return wu(Z,N);var M=Object.prototype.toString.call(Z).slice(8,-1);if(M==="Object"&&Z.constructor&&(M=Z.constructor.name),M==="Map"||M==="Set")return Array.from(Z);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return wu(Z,N)}}function wu(Z,N){(N==null||N>Z.length)&&(N=Z.length);for(var M=0,R=new Array(N);M<N;M++)R[M]=Z[M];return R}var Vc=(ea=(0,w.b2)(),_o=(0,w.f3)(q.v.IPostProcessor),ea(Zc=(Uu=(Eu=function(){function Z(){(0,ce.Z)(this,Z),this.passes=[],(0,dr.Z)(this,"postProcessor",_c,this),this.layer=void 0,this.renderFlag=void 0,this.width=0,this.height=0}return(0,ne.Z)(Z,[{key:"setLayer",value:function(M){this.layer=M}},{key:"setRenderFlag",value:function(M){this.renderFlag=M}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var N=(0,Wa.Z)(ya().mark(function R(){var te,ve,ut;return ya().wrap(function(Pt){for(;;)switch(Pt.prev=Pt.next){case 0:te=Os(this.passes),Pt.prev=1,te.s();case 3:if((ve=te.n()).done){Pt.next=9;break}return ut=ve.value,Pt.next=7,ut.render(this.layer);case 7:Pt.next=3;break;case 9:Pt.next=14;break;case 11:Pt.prev=11,Pt.t0=Pt.catch(1),te.e(Pt.t0);case 14:return Pt.prev=14,te.f(),Pt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return Pt.stop()}},R,this,[[1,11,14,17]])}));function M(){return N.apply(this,arguments)}return M}()},{key:"resize",value:function(M,R){(this.width!==M||this.height!==R)&&(this.width=M,this.height=R)}},{key:"add",value:function(M,R){M.getType()===Qs.G.PostProcessing?this.postProcessor.add(M,this.layer,R):(M.init(this.layer,R),this.passes.push(M))}},{key:"insert",value:function(M,R,te){M.init(this.layer,R),this.passes.splice(te,0,M)}},{key:"destroy",value:function(){this.passes.length=0}}]),Z}(),Eu),_c=(0,Wr.Z)(Uu.prototype,"postProcessor",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uu))||Zc),Nl,rc,Gc,el,eu,xc;function tl(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function ju(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?tl(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):tl(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function nc(Z){var N=Tu();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function Tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var hu=(Nl=(0,w.b2)(),rc=(0,w.f3)(q.v.ILogService),Nl(Gc=(el=(xc=function(Z){(0,Ct.Z)(M,Z);var N=nc(M);function M(){var R;(0,ce.Z)(this,M);for(var te=arguments.length,ve=new Array(te),ut=0;ut<te;ut++)ve[ut]=arguments[ut];return R=N.call.apply(N,[this].concat(ve)),(0,dr.Z)(R,"logger",eu,(0,Rn.Z)(R)),R.pickingFBO=void 0,R.layer=void 0,R.width=0,R.height=0,R.alreadyInRendering=!1,R.pickFromPickingFBO=function(Nt){var Pt=Nt.x,Sr=Nt.y,Ur=Nt.lngLat,Fn=Nt.type;if(!(!R.layer.isVisible()||!R.layer.needPick(Fn))){var Gn=R.rendererService,vi=Gn.getViewportSize,mi=Gn.readPixels,ci=Gn.useFramebuffer,ji=vi(),Gi=ji.width,Ao=ji.height,No=R.layer.getLayerConfig(),Ko=No.enableHighlight,$a=No.enableSelect,Da=Pt*be.SO.DPR,ma=Sr*be.SO.DPR;if(!(Da>Gi||Da<0||ma>Ao||ma<0)){var ao;ci(R.pickingFBO,function(){var ms;if(ao=mi({x:Math.round(Da),y:Math.round(Ao-(Sr+1)*be.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:R.pickingFBO}),ao[0]!==0||ao[1]!==0||ao[2]!==0){R.logger.debug("picked");var Bo=(0,be.W0)(ao),$o=R.layer.getSource().getFeatureById(Bo),vo={x:Pt,y:Sr,type:Fn,lngLat:Ur,featureId:Bo,feature:$o};$o&&(R.layer.setCurrentPickId(Bo),R.triggerHoverOnLayer(vo))}else{var Xs={x:Pt,y:Sr,lngLat:Ur,type:R.layer.getCurrentPickId()===null?"un"+Fn:"mouseout",featureId:null,feature:null};R.triggerHoverOnLayer(ju(ju({},Xs),{},{type:"unpick"})),R.triggerHoverOnLayer(Xs),R.layer.setCurrentPickId(null)}Ko&&R.highlightPickedFeature(ao),$a&&Fn==="click"&&((ms=ao)===null||ms===void 0?void 0:ms.toString())!==[0,0,0,0].toString()&&R.selectFeature(ao)})}}},R}return(0,ne.Z)(M,[{key:"getType",value:function(){return Qs.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(te,ve){(0,xu.Z)((0,S.Z)(M.prototype),"init",this).call(this,te,ve),this.layer=te;var ut=this.rendererService,Nt=ut.createTexture2D,Pt=ut.createFramebuffer,Sr=ut.getViewportSize,Ur=Sr(),Fn=Ur.width,Gn=Ur.height;this.pickingFBO=Pt({color:Nt({width:Fn,height:Gn,wrapS:ia.gl.CLAMP_TO_EDGE,wrapT:ia.gl.CLAMP_TO_EDGE})}),this.interactionService.on(jn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(jn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(jn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(te){var ve=this;if(!this.alreadyInRendering){var ut=this.rendererService,Nt=ut.getViewportSize,Pt=ut.useFramebuffer,Sr=ut.clear,Ur=Nt(),Fn=Ur.width,Gn=Ur.height;this.alreadyInRendering=!0,(this.width!==Fn||this.height!==Gn)&&(this.pickingFBO.resize({width:Fn,height:Gn}),this.width=Fn,this.height=Gn),Pt(this.pickingFBO,function(){Sr({framebuffer:ve.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var vi=ve.layer.multiPassRenderer.getRenderFlag();ve.layer.multiPassRenderer.setRenderFlag(!1),te.hooks.beforePickingEncode.call(),te.render(),te.hooks.afterPickingEncode.call(),ve.layer.multiPassRenderer.setRenderFlag(vi),ve.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(te){this.layer.emit(te.type,te)}},{key:"highlightPickedFeature",value:function(te){var ve=(0,yr.Z)(te,3),ut=ve[0],Nt=ve[1],Pt=ve[2];this.layer.hooks.beforeHighlight.call([ut,Nt,Pt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(te){var ve=(0,yr.Z)(te,3),ut=ve[0],Nt=ve[1],Pt=ve[2];this.layer.hooks.beforeSelect.call([ut,Nt,Pt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(te){var ve=te.featureId,ut=(0,be.Z6)(ve);this.selectFeature(new Uint8Array(ut))}},{key:"highlightFeatureHandle",value:function(te){var ve=te.featureId,ut=(0,be.Z6)(ve);this.highlightPickedFeature(new Uint8Array(ut))}}]),M}(zo),xc),eu=(0,Wr.Z)(el.prototype,"logger",[rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el))||Gc),Au=x(69530),ic,bc;function ac(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function n(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?ac(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):ac(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function u(Z){var N=a();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var h=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,g=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,b=(ic=(0,w.b2)(),ic(bc=function(Z){(0,Ct.Z)(M,Z);var N=u(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:g,fs:h});var te=this.shaderModuleService.getModule("blur-pass"),ve=te.vs,ut=te.fs,Nt=te.uniforms,Pt=this.rendererService.getViewportSize(),Sr=Pt.width,Ur=Pt.height;return{vs:ve,fs:ut,uniforms:n(n({},Nt),{},{u_ViewportSize:[Sr,Ur]})}}},{key:"convertOptionsToUniforms",value:function(te){var ve={};return Ks()(te.blurRadius)||(ve.u_BlurDir=[te.blurRadius,0]),ve}}]),M}(Au.Z))||bc),A,L;function V(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function ee(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?V(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):V(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function de(Z){var N=_e();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function _e(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var xe=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Xe=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ge=(A=(0,w.b2)(),A(L=function(Z){(0,Ct.Z)(M,Z);var N=de(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Xe,fs:xe});var te=this.shaderModuleService.getModule("blur-pass"),ve=te.vs,ut=te.fs,Nt=te.uniforms,Pt=this.rendererService.getViewportSize(),Sr=Pt.width,Ur=Pt.height;return{vs:ve,fs:ut,uniforms:ee(ee({},Nt),{},{u_ViewportSize:[Sr,Ur]})}}},{key:"convertOptionsToUniforms",value:function(te){var ve={};return Ks()(te.blurRadius)||(ve.u_BlurDir=[0,te.blurRadius]),ve}}]),M}(Au.Z))||L),nt,ke;function rt(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function ht(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?rt(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):rt(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function Bt(Z){var N=or();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function or(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var rr=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,lr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lr=(nt=(0,w.b2)(),nt(ke=function(Z){(0,Ct.Z)(M,Z);var N=Bt(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:lr,fs:rr});var te=this.shaderModuleService.getModule("colorhalftone-pass"),ve=te.vs,ut=te.fs,Nt=te.uniforms,Pt=this.rendererService.getViewportSize(),Sr=Pt.width,Ur=Pt.height;return{vs:ve,fs:ut,uniforms:ht(ht({},Nt),{},{u_ViewportSize:[Sr,Ur]})}}}]),M}(Au.Z))||ke),rn,Yr;function _n(Z){var N=Bn();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function Bn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var Xn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Hn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ta=(rn=(0,w.b2)(),rn(Yr=function(Z){(0,Ct.Z)(M,Z);var N=_n(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Hn,fs:Xn}),this.shaderModuleService.getModule("copy-pass")}}]),M}(Au.Z))||Yr),xn,ii;function Si(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function ri(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?Si(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):Si(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function ai(Z){var N=wi();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function wi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var ni=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Jn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xo=(xn=(0,w.b2)(),xn(ii=function(Z){(0,Ct.Z)(M,Z);var N=ai(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Jn,fs:ni});var te=this.shaderModuleService.getModule("hexagonalpixelate-pass"),ve=te.vs,ut=te.fs,Nt=te.uniforms,Pt=this.rendererService.getViewportSize(),Sr=Pt.width,Ur=Pt.height;return{vs:ve,fs:ut,uniforms:ri(ri({},Nt),{},{u_ViewportSize:[Sr,Ur]})}}}]),M}(Au.Z))||ii),ja,Xo;function Oo(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function Za(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?Oo(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):Oo(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function ho(Z){var N=Ss();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function Ss(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var Yo=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Zu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,us=(ja=(0,w.b2)(),ja(Xo=function(Z){(0,Ct.Z)(M,Z);var N=ho(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Zu,fs:Yo});var te=this.shaderModuleService.getModule("ink-pass"),ve=te.vs,ut=te.fs,Nt=te.uniforms,Pt=this.rendererService.getViewportSize(),Sr=Pt.width,Ur=Pt.height;return{vs:ve,fs:ut,uniforms:Za(Za({},Nt),{},{u_ViewportSize:[Sr,Ur]})}}}]),M}(Au.Z))||Xo),Ls,Rs;function ml(Z){var N=gl();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function gl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var Ws=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,rl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bl=(Ls=(0,w.b2)(),Ls(Rs=function(Z){(0,Ct.Z)(M,Z);var N=ml(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:rl,fs:Ws}),this.shaderModuleService.getModule("noise-pass")}}]),M}(Au.Z))||Rs),tu,nl;function ru(Z){var N=io();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function io(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var Vu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Es=(tu=(0,w.b2)(),tu(nl=function(Z){(0,Ct.Z)(M,Z);var N=ru(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Vu,fs:Cu}),this.shaderModuleService.getModule("sepia-pass")}}]),M}(Au.Z))||nl),Ki,Lo,po,pu,vs,du,Gu,Hu=(Ki=(0,w.b2)(),Lo=(0,w.f3)(q.v.IRendererService),po=(0,w.zY)(),Ki(pu=(vs=(Gu=function(){function Z(){(0,ce.Z)(this,Z),(0,dr.Z)(this,"rendererService",du,this),this.passes=[],this.readFBO=void 0,this.writeFBO=void 0}return(0,ne.Z)(Z,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var N=(0,Wa.Z)(ya().mark(function R(te){var ve,ut;return ya().wrap(function(Pt){for(;;)switch(Pt.prev=Pt.next){case 0:ve=0;case 1:if(!(ve<this.passes.length)){Pt.next=10;break}return ut=this.passes[ve],ut.setRenderToScreen(this.isLastEnabledPass(ve)),Pt.next=6,ut.render(te);case 6:ve!==this.passes.length-1&&this.swap();case 7:ve++,Pt.next=1;break;case 10:case"end":return Pt.stop()}},R,this)}));function M(R){return N.apply(this,arguments)}return M}()},{key:"resize",value:function(M,R){this.readFBO.resize({width:M,height:R}),this.writeFBO.resize({width:M,height:R})}},{key:"add",value:function(M,R,te){M.init(R,te),this.passes.push(M)}},{key:"insert",value:function(M,R,te,ve){M.init(te,ve),this.passes.splice(R,0,M)}},{key:"getPostProcessingPassByName",value:function(M){return this.passes.find(function(R){return R.getName()===M})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(M){for(var R=M+1;R<this.passes.length;R++)if(this.passes[R].isEnabled())return!1;return!0}},{key:"swap",value:function(){var M=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=M}}]),Z}(),Gu),du=(0,Wr.Z)(vs.prototype,"rendererService",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Wr.Z)(vs.prototype,"init",[po],Object.getOwnPropertyDescriptor(vs.prototype,"init"),vs.prototype),vs))||pu),Wu,nu;function Ul(Z){var N=nf();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function nf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var Pu=(Wu=(0,w.b2)(),Wu(nu=function(Z){(0,Ct.Z)(M,Z);var N=Ul(M);function M(){return(0,ce.Z)(this,M),N.apply(this,arguments)}return(0,ne.Z)(M,[{key:"getType",value:function(){return Qs.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(te,ve){(0,xu.Z)((0,S.Z)(M.prototype),"init",this).call(this,te,ve)}},{key:"render",value:function(te){var ve=this.rendererService,ut=ve.useFramebuffer,Nt=ve.clear;ut(null,function(){Nt({color:[0,0,0,0],depth:1,stencil:0}),te.multiPassRenderer.setRenderFlag(!1),te.render(),te.multiPassRenderer.setRenderFlag(!0)})}}]),M}(zo))||nu),va,Qf,If,Of,il,Lf,vh,oc;function mh(Z,N){var M=Object.keys(Z);if(Object.getOwnPropertySymbols){var R=Object.getOwnPropertySymbols(Z);N&&(R=R.filter(function(te){return Object.getOwnPropertyDescriptor(Z,te).enumerable})),M.push.apply(M,R)}return M}function bf(Z){for(var N=1;N<arguments.length;N++){var M=arguments[N]!=null?arguments[N]:{};N%2?mh(Object(M),!0).forEach(function(R){(0,Y.Z)(Z,R,M[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Z,Object.getOwnPropertyDescriptors(M)):mh(Object(M)).forEach(function(R){Object.defineProperty(Z,R,Object.getOwnPropertyDescriptor(M,R))})}return Z}function gh(Z){var N=sc();return function(){var R=(0,S.Z)(Z),te;if(N){var ve=(0,S.Z)(this).constructor;te=Reflect.construct(R,arguments,ve)}else te=R.apply(this,arguments);return(0,kt.Z)(this,te)}}function sc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Z){return!1}}var af=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Rf=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,qf=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Df(Z,N){for(var M=0,R=1/N,te=Z;te>0;)M=M+R*(te%N),te=Math.floor(te/N),R=R/N;return M}var eh=1,yh=(va=(0,w.b2)(),Qf=(0,w.f3)(q.v.IShaderModuleService),If=(0,w.f3)(q.v.ILogService),va(Of=(il=(oc=function(Z){(0,Ct.Z)(M,Z);var N=gh(M);function M(){var R;(0,ce.Z)(this,M);for(var te=arguments.length,ve=new Array(te),ut=0;ut<te;ut++)ve[ut]=arguments[ut];return R=N.call.apply(N,[this].concat(ve)),(0,dr.Z)(R,"shaderModuleService",Lf,(0,Rn.Z)(R)),(0,dr.Z)(R,"logger",vh,(0,Rn.Z)(R)),R.haltonSequence=[],R.accumulatingId=0,R.frame=0,R.timer=void 0,R.sampleRenderTarget=void 0,R.prevRenderTarget=void 0,R.outputRenderTarget=void 0,R.copyRenderTarget=void 0,R.blendModel=void 0,R.outputModel=void 0,R.copyModel=void 0,R}return(0,ne.Z)(M,[{key:"getType",value:function(){return Qs.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(te,ve){(0,xu.Z)((0,S.Z)(M.prototype),"init",this).call(this,te,ve);var ut=this.rendererService,Nt=ut.createFramebuffer,Pt=ut.createTexture2D;this.sampleRenderTarget=Nt({color:Pt({width:1,height:1,wrapS:ia.gl.CLAMP_TO_EDGE,wrapT:ia.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Nt({color:Pt({width:1,height:1,wrapS:ia.gl.CLAMP_TO_EDGE,wrapT:ia.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Nt({color:Pt({width:1,height:1,wrapS:ia.gl.CLAMP_TO_EDGE,wrapT:ia.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Nt({color:Pt({width:1,height:1,wrapS:ia.gl.CLAMP_TO_EDGE,wrapT:ia.gl.CLAMP_TO_EDGE})});for(var Sr=0;Sr<30;Sr++)this.haltonSequence.push([Df(Sr,2),Df(Sr,3)]);this.blendModel=this.createTriangleModel("blend-pass",af),this.outputModel=this.createTriangleModel("copy-pass",Rf,{blend:{enable:!0,func:{srcRGB:ia.gl.ONE,dstRGB:ia.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:ia.gl.ONE,dstAlpha:ia.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:ia.gl.FUNC_ADD,alpha:ia.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Rf)}},{key:"render",value:function(te){var ve=this,ut=this.rendererService,Nt=ut.clear,Pt=ut.getViewportSize,Sr=ut.useFramebuffer,Ur=Pt(),Fn=Ur.width,Gn=Ur.height;this.sampleRenderTarget.resize({width:Fn,height:Gn}),this.prevRenderTarget.resize({width:Fn,height:Gn}),this.outputRenderTarget.resize({width:Fn,height:Gn}),this.copyRenderTarget.resize({width:Fn,height:Gn}),this.resetFrame(),this.stopAccumulating();var vi=te.multiPassRenderer.getPostProcessor().getReadFBO();Sr(vi,function(){Nt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:vi}),te.multiPassRenderer.setRenderFlag(!1),te.render(),te.multiPassRenderer.setRenderFlag(!0)});var mi=function ci(ji){!ve.accumulatingId||ji!==ve.accumulatingId||ve.isFinished()||(ve.doRender(te),requestAnimationFrame(function(){ci(ji)}))};this.accumulatingId=eh++,this.timer=window.setTimeout(function(){mi(ve.accumulatingId)},50)}},{key:"doRender",value:function(te){var ve=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var ut=this.rendererService,Nt=ut.clear,Pt=ut.getViewportSize,Sr=ut.useFramebuffer,Ur=Pt(),Fn=Ur.width,Gn=Ur.height,vi=te.getLayerConfig(),mi=vi.jitterScale,ci=mi===void 0?1:mi,ji=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ji[0]*2-1)/Fn*ci,(ji[1]*2-1)/Gn*ci),te.multiPassRenderer.setRenderFlag(!1),te.hooks.beforeRender.call(),Sr(this.sampleRenderTarget,function(){Nt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ve.sampleRenderTarget}),te.render()}),te.hooks.afterRender.call(),te.multiPassRenderer.setRenderFlag(!0);var Gi=te.getLayerConfig();Sr(this.outputRenderTarget,function(){ve.blendModel.draw({uniforms:{u_opacity:Gi.opacity||1,u_MixRatio:ve.frame===0?1:.9,u_Diffuse1:ve.sampleRenderTarget,u_Diffuse2:ve.frame===0?te.multiPassRenderer.getPostProcessor().getReadFBO():ve.prevRenderTarget}})}),this.frame===0&&Nt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Sr(this.copyRenderTarget,function(){ve.outputModel.draw({uniforms:{u_Texture:ve.outputRenderTarget}})}),Sr(te.multiPassRenderer.getPostProcessor().getReadFBO(),function(){ve.copyModel.draw({uniforms:{u_Texture:ve.copyRenderTarget}})}),te.multiPassRenderer.getPostProcessor().render(te));var Ao=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ao,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(te,ve,ut){this.shaderModuleService.registerModule(te,{vs:qf,fs:ve});var Nt=this.shaderModuleService.getModule(te),Pt=Nt.vs,Sr=Nt.fs,Ur=Nt.uniforms,Fn=this.rendererService,Gn=Fn.createAttribute,vi=Fn.createBuffer,mi=Fn.createModel;return mi(bf({vs:Pt,fs:Sr,attributes:{a_Position:Gn({buffer:vi({data:[-4,-4,4,-4,0,4],type:ia.gl.FLOAT}),size:2})},uniforms:bf({},Ur),depth:{enable:!1},count:3},ut))}}]),M}(zo),oc),Lf=(0,Wr.Z)(il.prototype,"shaderModuleService",[Qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=(0,Wr.Z)(il.prototype,"logger",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il))||Of),uc=new w.W2;uc.bind(q.v.IGlobalConfigService).to(jt).inSingletonScope(),uc.bind(q.v.IShaderModuleService).to(Io).inSingletonScope(),uc.bind(q.v.ILogService).to(Dc).inSingletonScope(),(0,w.GW)((0,w.b2)(),E.EventEmitter),uc.bind(q.v.IEventEmitter).to(E.EventEmitter);var _h=(0,z.Z)(uc,!1),kf=function(N){var M=_h.lazyInject(N);return function(R,te,ve){M.call(this,R,te),ve&&(ve.initializer=function(){return R[te]})}},Uh=function(N){var M=_h.lazyMultiInject(N);return function(R,te,ve){M.call(this,R,te),ve&&(ve.initializer=function(){return R[te]})}},Sc=uc,zf=0;function bo(){var Z=new w.W2;return Z.parent=uc,Z.bind(q.v.SceneID).toConstantValue("".concat(zf++)),Z.bind(q.v.ILayerService).to(pi).inSingletonScope(),Z.bind(q.v.ISceneService).to(kl).inSingletonScope(),Z.bind(q.v.ICameraService).to(gt).inSingletonScope(),Z.bind(q.v.ICoordinateSystemService).to(Zi).inSingletonScope(),Z.bind(q.v.IInteractionService).to(sa).inSingletonScope(),Z.bind(q.v.IPickingService).to(Ya).inSingletonScope(),Z.bind(q.v.IControlService).to(mr).inSingletonScope(),Z.bind(q.v.IMarkerService).to(Ei).inSingletonScope(),Z.bind(q.v.IIconService).to(Vt).inSingletonScope(),Z.bind(q.v.IFontService).to(qe).inSingletonScope(),Z.bind(q.v.IPopupService).to(G).inSingletonScope(),Z.bind(q.v.INormalPass).to(tc).whenTargetNamed("clear"),Z.bind(q.v.INormalPass).to(hu).whenTargetNamed("pixelPicking"),Z.bind(q.v.INormalPass).to(Pu).whenTargetNamed("render"),Z.bind(q.v.INormalPass).to(yh).whenTargetNamed("taa"),Z.bind(q.v.IFactoryNormalPass).toFactory(function(N){return function(M){return N.container.getNamed(q.v.INormalPass,M)}}),Z.bind(q.v.IPostProcessingPass).to(ta).whenTargetNamed("copy"),Z.bind(q.v.IPostProcessingPass).to(b).whenTargetNamed("blurH"),Z.bind(q.v.IPostProcessingPass).to(Ge).whenTargetNamed("blurV"),Z.bind(q.v.IPostProcessingPass).to(Bl).whenTargetNamed("noise"),Z.bind(q.v.IPostProcessingPass).to(Es).whenTargetNamed("sepia"),Z.bind(q.v.IPostProcessingPass).to(Lr).whenTargetNamed("colorHalftone"),Z.bind(q.v.IPostProcessingPass).to(xo).whenTargetNamed("hexagonalPixelate"),Z.bind(q.v.IPostProcessingPass).to(us).whenTargetNamed("ink"),Z.bind(q.v.IFactoryPostProcessingPass).toFactory(function(N){return function(M){var R=N.container.getNamed(q.v.IPostProcessingPass,M);return R.setName(M),R}}),Z}function Hc(Z){var N=new w.W2;return N.parent=Z,N.bind(q.v.IStyleAttributeService).to(Mo).inSingletonScope(),N.bind(q.v.IMultiPassRenderer).to(Vc).inSingletonScope(),N.bind(q.v.IPostProcessor).to(Hu).inSingletonScope(),N}},2811:function(){},64532:function(){},4594:function(pr,O,x){"use strict";x.d(O,{l:function(){return J}});var J={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(pr,O,x){"use strict";x.d(O,{d:function(){return J}});var J;(function(E){E.TOPRIGHT="topright",E.TOPLEFT="topleft",E.BOTTOMRIGHT="bottomright",E.BOTTOMLEFT="bottomleft"})(J||(J={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(pr,O,x){"use strict";x.d(O,{l:function(){return J},k:function(){return E}});var J;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(J||(J={}));var E={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(pr,O,x){"use strict";x.d(O,{s:function(){return J}});var J;(function(E){E.Hover="hover",E.Click="click",E.Select="select",E.Active="active",E.Drag="drag"})(J||(J={}))},90919:function(){},77252:function(pr,O,x){"use strict";x.d(O,{h:function(){return J}});var J;(function(E){E.normal="normal",E.additive="additive",E.subtractive="subtractive",E.min="min",E.max="max",E.none="none"})(J||(J={}))},31251:function(pr,O,x){"use strict";x.d(O,{vY:function(){return J},ee:function(){return E},GC:function(){return p}});var J;(function(w){w.LINEAR="linear",w.POWER="power",w.LOG="log",w.IDENTITY="identity",w.TIME="time",w.QUANTILE="quantile",w.QUANTIZE="quantize",w.THRESHOLD="threshold",w.CAT="cat"})(J||(J={}));var E;(function(w){w.CONSTANT="constant",w.VARIABLE="variable"})(E||(E={}));var p;(function(w){w[w.Attribute=0]="Attribute",w[w.InstancedAttribute=1]="InstancedAttribute",w[w.Uniform=2]="Uniform"})(p||(p={}))},79042:function(){},16606:function(pr,O,x){"use strict";x.d(O,{I:function(){return J}});var J=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(pr,O,x){"use strict";x.d(O,{G:function(){return J}});var J;(function(E){E.Normal="normal",E.PostProcessing="post-processing"})(J||(J={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(pr,O,x){"use strict";x.d(O,{gl:function(){return J}});var J;(function(E){E[E.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",E[E.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",E[E.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",E[E.POINTS=0]="POINTS",E[E.LINES=1]="LINES",E[E.LINE_LOOP=2]="LINE_LOOP",E[E.LINE_STRIP=3]="LINE_STRIP",E[E.TRIANGLES=4]="TRIANGLES",E[E.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",E[E.TRIANGLE_FAN=6]="TRIANGLE_FAN",E[E.ZERO=0]="ZERO",E[E.ONE=1]="ONE",E[E.SRC_COLOR=768]="SRC_COLOR",E[E.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",E[E.SRC_ALPHA=770]="SRC_ALPHA",E[E.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",E[E.DST_ALPHA=772]="DST_ALPHA",E[E.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",E[E.DST_COLOR=774]="DST_COLOR",E[E.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",E[E.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",E[E.FUNC_ADD=32774]="FUNC_ADD",E[E.BLEND_EQUATION=32777]="BLEND_EQUATION",E[E.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",E[E.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",E[E.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",E[E.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",E[E.MAX_EXT=32776]="MAX_EXT",E[E.MIN_EXT=32775]="MIN_EXT",E[E.BLEND_DST_RGB=32968]="BLEND_DST_RGB",E[E.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",E[E.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",E[E.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",E[E.CONSTANT_COLOR=32769]="CONSTANT_COLOR",E[E.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",E[E.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",E[E.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",E[E.BLEND_COLOR=32773]="BLEND_COLOR",E[E.ARRAY_BUFFER=34962]="ARRAY_BUFFER",E[E.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",E[E.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",E[E.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",E[E.STREAM_DRAW=35040]="STREAM_DRAW",E[E.STATIC_DRAW=35044]="STATIC_DRAW",E[E.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",E[E.BUFFER_SIZE=34660]="BUFFER_SIZE",E[E.BUFFER_USAGE=34661]="BUFFER_USAGE",E[E.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",E[E.FRONT=1028]="FRONT",E[E.BACK=1029]="BACK",E[E.FRONT_AND_BACK=1032]="FRONT_AND_BACK",E[E.CULL_FACE=2884]="CULL_FACE",E[E.BLEND=3042]="BLEND",E[E.DITHER=3024]="DITHER",E[E.STENCIL_TEST=2960]="STENCIL_TEST",E[E.DEPTH_TEST=2929]="DEPTH_TEST",E[E.SCISSOR_TEST=3089]="SCISSOR_TEST",E[E.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",E[E.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",E[E.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",E[E.NO_ERROR=0]="NO_ERROR",E[E.INVALID_ENUM=1280]="INVALID_ENUM",E[E.INVALID_VALUE=1281]="INVALID_VALUE",E[E.INVALID_OPERATION=1282]="INVALID_OPERATION",E[E.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",E[E.CW=2304]="CW",E[E.CCW=2305]="CCW",E[E.LINE_WIDTH=2849]="LINE_WIDTH",E[E.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",E[E.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",E[E.CULL_FACE_MODE=2885]="CULL_FACE_MODE",E[E.FRONT_FACE=2886]="FRONT_FACE",E[E.DEPTH_RANGE=2928]="DEPTH_RANGE",E[E.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",E[E.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",E[E.DEPTH_FUNC=2932]="DEPTH_FUNC",E[E.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",E[E.STENCIL_FUNC=2962]="STENCIL_FUNC",E[E.STENCIL_FAIL=2964]="STENCIL_FAIL",E[E.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",E[E.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",E[E.STENCIL_REF=2967]="STENCIL_REF",E[E.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",E[E.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",E[E.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",E[E.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",E[E.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",E[E.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",E[E.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",E[E.VIEWPORT=2978]="VIEWPORT",E[E.SCISSOR_BOX=3088]="SCISSOR_BOX",E[E.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",E[E.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",E[E.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",E[E.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",E[E.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",E[E.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",E[E.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",E[E.RED_BITS=3410]="RED_BITS",E[E.GREEN_BITS=3411]="GREEN_BITS",E[E.BLUE_BITS=3412]="BLUE_BITS",E[E.ALPHA_BITS=3413]="ALPHA_BITS",E[E.DEPTH_BITS=3414]="DEPTH_BITS",E[E.STENCIL_BITS=3415]="STENCIL_BITS",E[E.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",E[E.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",E[E.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",E[E.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",E[E.SAMPLES=32937]="SAMPLES",E[E.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",E[E.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",E[E.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",E[E.DONT_CARE=4352]="DONT_CARE",E[E.FASTEST=4353]="FASTEST",E[E.NICEST=4354]="NICEST",E[E.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",E[E.BYTE=5120]="BYTE",E[E.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",E[E.SHORT=5122]="SHORT",E[E.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",E[E.INT=5124]="INT",E[E.UNSIGNED_INT=5125]="UNSIGNED_INT",E[E.FLOAT=5126]="FLOAT",E[E.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",E[E.ALPHA=6406]="ALPHA",E[E.RGB=6407]="RGB",E[E.RGBA=6408]="RGBA",E[E.LUMINANCE=6409]="LUMINANCE",E[E.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",E[E.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",E[E.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",E[E.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",E[E.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",E[E.VERTEX_SHADER=35633]="VERTEX_SHADER",E[E.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",E[E.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",E[E.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",E[E.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",E[E.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",E[E.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",E[E.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",E[E.SHADER_TYPE=35663]="SHADER_TYPE",E[E.DELETE_STATUS=35712]="DELETE_STATUS",E[E.LINK_STATUS=35714]="LINK_STATUS",E[E.VALIDATE_STATUS=35715]="VALIDATE_STATUS",E[E.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",E[E.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",E[E.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",E[E.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",E[E.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",E[E.NEVER=512]="NEVER",E[E.LESS=513]="LESS",E[E.EQUAL=514]="EQUAL",E[E.LEQUAL=515]="LEQUAL",E[E.GREATER=516]="GREATER",E[E.NOTEQUAL=517]="NOTEQUAL",E[E.GEQUAL=518]="GEQUAL",E[E.ALWAYS=519]="ALWAYS",E[E.KEEP=7680]="KEEP",E[E.REPLACE=7681]="REPLACE",E[E.INCR=7682]="INCR",E[E.DECR=7683]="DECR",E[E.INVERT=5386]="INVERT",E[E.INCR_WRAP=34055]="INCR_WRAP",E[E.DECR_WRAP=34056]="DECR_WRAP",E[E.VENDOR=7936]="VENDOR",E[E.RENDERER=7937]="RENDERER",E[E.VERSION=7938]="VERSION",E[E.NEAREST=9728]="NEAREST",E[E.LINEAR=9729]="LINEAR",E[E.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",E[E.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",E[E.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",E[E.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",E[E.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",E[E.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",E[E.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",E[E.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",E[E.TEXTURE_2D=3553]="TEXTURE_2D",E[E.TEXTURE=5890]="TEXTURE",E[E.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",E[E.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",E[E.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",E[E.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",E[E.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",E[E.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",E[E.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",E[E.TEXTURE0=33984]="TEXTURE0",E[E.TEXTURE1=33985]="TEXTURE1",E[E.TEXTURE2=33986]="TEXTURE2",E[E.TEXTURE3=33987]="TEXTURE3",E[E.TEXTURE4=33988]="TEXTURE4",E[E.TEXTURE5=33989]="TEXTURE5",E[E.TEXTURE6=33990]="TEXTURE6",E[E.TEXTURE7=33991]="TEXTURE7",E[E.TEXTURE8=33992]="TEXTURE8",E[E.TEXTURE9=33993]="TEXTURE9",E[E.TEXTURE10=33994]="TEXTURE10",E[E.TEXTURE11=33995]="TEXTURE11",E[E.TEXTURE12=33996]="TEXTURE12",E[E.TEXTURE13=33997]="TEXTURE13",E[E.TEXTURE14=33998]="TEXTURE14",E[E.TEXTURE15=33999]="TEXTURE15",E[E.TEXTURE16=34e3]="TEXTURE16",E[E.TEXTURE17=34001]="TEXTURE17",E[E.TEXTURE18=34002]="TEXTURE18",E[E.TEXTURE19=34003]="TEXTURE19",E[E.TEXTURE20=34004]="TEXTURE20",E[E.TEXTURE21=34005]="TEXTURE21",E[E.TEXTURE22=34006]="TEXTURE22",E[E.TEXTURE23=34007]="TEXTURE23",E[E.TEXTURE24=34008]="TEXTURE24",E[E.TEXTURE25=34009]="TEXTURE25",E[E.TEXTURE26=34010]="TEXTURE26",E[E.TEXTURE27=34011]="TEXTURE27",E[E.TEXTURE28=34012]="TEXTURE28",E[E.TEXTURE29=34013]="TEXTURE29",E[E.TEXTURE30=34014]="TEXTURE30",E[E.TEXTURE31=34015]="TEXTURE31",E[E.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",E[E.REPEAT=10497]="REPEAT",E[E.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",E[E.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",E[E.FLOAT_VEC2=35664]="FLOAT_VEC2",E[E.FLOAT_VEC3=35665]="FLOAT_VEC3",E[E.FLOAT_VEC4=35666]="FLOAT_VEC4",E[E.INT_VEC2=35667]="INT_VEC2",E[E.INT_VEC3=35668]="INT_VEC3",E[E.INT_VEC4=35669]="INT_VEC4",E[E.BOOL=35670]="BOOL",E[E.BOOL_VEC2=35671]="BOOL_VEC2",E[E.BOOL_VEC3=35672]="BOOL_VEC3",E[E.BOOL_VEC4=35673]="BOOL_VEC4",E[E.FLOAT_MAT2=35674]="FLOAT_MAT2",E[E.FLOAT_MAT3=35675]="FLOAT_MAT3",E[E.FLOAT_MAT4=35676]="FLOAT_MAT4",E[E.SAMPLER_2D=35678]="SAMPLER_2D",E[E.SAMPLER_CUBE=35680]="SAMPLER_CUBE",E[E.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",E[E.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",E[E.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",E[E.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",E[E.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",E[E.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",E[E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",E[E.COMPILE_STATUS=35713]="COMPILE_STATUS",E[E.LOW_FLOAT=36336]="LOW_FLOAT",E[E.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",E[E.HIGH_FLOAT=36338]="HIGH_FLOAT",E[E.LOW_INT=36339]="LOW_INT",E[E.MEDIUM_INT=36340]="MEDIUM_INT",E[E.HIGH_INT=36341]="HIGH_INT",E[E.FRAMEBUFFER=36160]="FRAMEBUFFER",E[E.RENDERBUFFER=36161]="RENDERBUFFER",E[E.RGBA4=32854]="RGBA4",E[E.RGB5_A1=32855]="RGB5_A1",E[E.RGB565=36194]="RGB565",E[E.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",E[E.STENCIL_INDEX=6401]="STENCIL_INDEX",E[E.STENCIL_INDEX8=36168]="STENCIL_INDEX8",E[E.DEPTH_STENCIL=34041]="DEPTH_STENCIL",E[E.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",E[E.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",E[E.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",E[E.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",E[E.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",E[E.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",E[E.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",E[E.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",E[E.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",E[E.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",E[E.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",E[E.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",E[E.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",E[E.NONE=0]="NONE",E[E.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",E[E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",E[E.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",E[E.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",E[E.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",E[E.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",E[E.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",E[E.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",E[E.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",E[E.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",E[E.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",E[E.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(J||(J={}))},69530:function(pr,O,x){"use strict";x.d(O,{Z:function(){return bt}});var J=x(96156),E=x(55770),p=x(6610),w=x(5991),z=x(3473),q=x(11700),Y=x.n(q),ce=x(14293),ne=x.n(ce),be=x(68929),we=x.n(be),Me=x(86700),Kt=x(58881),Zt=x(72302),Xt=x(92364),zt,Lt,yt,pt,Pr,Ht;function ar(Fe,Ae){var Ne=Object.keys(Fe);if(Object.getOwnPropertySymbols){var xt=Object.getOwnPropertySymbols(Fe);Ae&&(xt=xt.filter(function(nr){return Object.getOwnPropertyDescriptor(Fe,nr).enumerable})),Ne.push.apply(Ne,xt)}return Ne}function mt(Fe){for(var Ae=1;Ae<arguments.length;Ae++){var Ne=arguments[Ae]!=null?arguments[Ae]:{};Ae%2?ar(Object(Ne),!0).forEach(function(xt){(0,J.Z)(Fe,xt,Ne[xt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Fe,Object.getOwnPropertyDescriptors(Ne)):ar(Object(Ne)).forEach(function(xt){Object.defineProperty(Fe,xt,Object.getOwnPropertyDescriptor(Ne,xt))})}return Fe}var Ye=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bt=(zt=(0,Me.b2)(),Lt=(0,Me.f3)(Zt.v.IShaderModuleService),zt(yt=(pt=(Ht=function(){function Fe(){(0,p.Z)(this,Fe),(0,E.Z)(this,"shaderModuleService",Pr,this),this.rendererService=void 0,this.config=void 0,this.quad=Ye,this.enabled=!0,this.renderToScreen=!1,this.model=void 0,this.name=void 0,this.optionsToUpdate={}}return(0,w.Z)(Fe,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Ne){this.name=Ne}},{key:"getType",value:function(){return Xt.G.PostProcessing}},{key:"init",value:function(Ne,xt){this.config=xt,this.rendererService=Ne.getContainer().get(Zt.v.IRendererService);var nr=this.rendererService,re=nr.createAttribute,Ee=nr.createBuffer,ae=nr.createModel,me=this.setupShaders(),Te=me.vs,Je=me.fs,dt=me.uniforms;this.model=ae({vs:Te,fs:Je,attributes:{a_Position:re({buffer:Ee({data:[-4,-4,4,-4,0,4],type:Kt.gl.FLOAT}),size:2})},uniforms:mt(mt({u_Texture:null},dt),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Ne){var xt=this,nr=Ne.multiPassRenderer.getPostProcessor(),re=this.rendererService,Ee=re.useFramebuffer,ae=re.getViewportSize,me=re.clear,Te=ae(),Je=Te.width,dt=Te.height;Ee(this.renderToScreen?null:nr.getWriteFBO(),function(){me({framebuffer:nr.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),xt.model.draw({uniforms:mt({u_Texture:nr.getReadFBO(),u_ViewportSize:[Je,dt]},xt.convertOptionsToUniforms(xt.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Ne){this.enabled=Ne}},{key:"setRenderToScreen",value:function(Ne){this.renderToScreen=Ne}},{key:"updateOptions",value:function(Ne){this.optionsToUpdate=mt(mt({},this.optionsToUpdate),Ne)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Ne){var xt={};return Object.keys(Ne).forEach(function(nr){ne()(Ne[nr])||(xt["u_".concat(Y()(we()(nr)))]=Ne[nr])}),xt}}]),Fe}(),Ht),Pr=(0,z.Z)(pt.prototype,"shaderModuleService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pt))||yt)},19793:function(pr,O,x){"use strict";x.d(O,{P:function(){return J}});var J=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(pr,O,x){"use strict";x.d(O,{v:function(){return J}});var J={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(pr,O,x){"use strict";var J=x(74691),E=null;function p(Fe){return E.indexOf(Fe)}var w=2,z=4,q=64,Y=128,ce=256,ne=512,be=8192,we=16384,Me=32768,Kt=null,Zt=131072,Xt=262144,zt=524288,Lt=1048576,yt=2097152,pt=4194304,Pr=8388608,Ht=16777216,ar=null;function mt(Fe,Ae){return Fe=_clamp(Math.floor(Fe),0,255),Ae=_clamp(Math.floor(Ae),0,255),256*Fe+Ae}function Ye(Fe){var Ae=Fe.color,Ne=Fe.radius,xt=Fe.tileX,nr=Fe.tileY,re=Fe.shape,Ee=Fe.opacity,ae=Fe.stroke,me=Fe.strokeWidth,Te=Fe.strokeOpacity,Je=[],dt=[],$t=[],Fr=[mt(Ae[0],Ae[1]),mt(Ae[2],Ae[3])],zr=[mt(ae[0],ae[1]),mt(ae[2],ae[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(ln){var tr=_slicedToArray(ln,2),oe=tr[0],ge=tr[1];Je.push([].concat(Fr,[(oe+1)*Pr+(ge+1)*yt+getShapeIndex(re)*Zt+Ne,(xt+512)*zt+(nr+512)*q])),dt.push([].concat(zr,[me,Te])),$t.push([Ee,0,0,0])}),{packedBuffer:Je,packedBuffer2:dt,packedBuffer3:$t}}function bt(Fe,Ae){if(Fe===0&&!Ae)return 0;if(Fe===1&&Ae)return 4294967295;var Ne=Ae?1:0,xt=Math.floor(Fe*127);return xt*ar+Ne*Ht+xt*Zt+Ne*Kt+xt*ne+Ne*ce+xt*w+Ne}},12641:function(pr,O,x){"use strict";x.d(O,{zP:function(){return Qy},JE:function(){return Qg},ns:function(){return Jy}});var J=x(67294),E=(0,J.createContext)({});function p(){return(0,J.useContext)(E)}var w=x(58881),z=x(96156),q=x(28481),Y=x(6610),ce=x(5991),ne=x(10379),be=x(46070),we=x(77608),Me=x(6901),Kt=x(26729);function Zt(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Xt(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Zt(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Zt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function zt(i){var f=Lt();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Lt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var yt;(function(i){i.TOPRIGHT="topright",i.TOPLEFT="topleft",i.BOTTOMRIGHT="bottomright",i.BOTTOMLEFT="bottomleft"})(yt||(yt={}));var pt=0,Pr=function(i){(0,ne.Z)(o,i);var f=zt(o);function o(s){var l;return(0,Y.Z)(this,o),l=f.call(this),l.controlOption=void 0,l.container=void 0,l.sceneContainer=void 0,l.mapsService=void 0,l.renderService=void 0,l.layerService=void 0,l.controlService=void 0,l.isShow=void 0,l.controlOption=Xt(Xt({},l.getDefault()),s||{}),l}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{position:yt.TOPRIGHT,name:"".concat(pt++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(w.vK.IMapService),this.renderService=l.get(w.vK.IRendererService),this.layerService=l.get(w.vK.ILayerService),this.controlService=l.get(w.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,y=this.controlOption.position,T=this.controlService.controlCorners[y];return Me.SO.addClass(d,"l7-control"),y.indexOf("bottom")!==-1?T.insertBefore(d,T.firstChild):T.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Me.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Me.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Me.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}(Kt.EventEmitter),Ht=x(63349);function ar(i){var f=mt();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function mt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ye=function(i){(0,ne.Z)(o,i);var f=ar(o);function o(s){var l;return(0,Y.Z)(this,o),l=f.call(this,s),l.layerControlInputs=void 0,l.layers=void 0,l.lastZIndex=void 0,l.handlingClick=void 0,l.layersLink=void 0,l.baseLayersList=void 0,l.separator=void 0,l.overlaysList=void 0,l.form=void 0,l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Me.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,Ht.Z)(l)),l}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:w.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;Me.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var y=d-(this.container.offsetTop+50);return y<this.form.clientHeight?(Me.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=y+"px"):Me.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Me.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=Me.SO.create("div",l),y=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var T=this.form=Me.SO.create("form",l+"-list");y&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=Me.SO.create("a",l+"-toggle",d);var P=this.layersLink;P.title="Layers",y||this.expand(),this.baseLayersList=Me.SO.create("div",l+"-base",T),this.separator=Me.SO.create("div",l+"-separator",T),this.overlaysList=Me.SO.create("div",l+"-overlays",T),d.appendChild(T)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,y=d.baseLayers,T=y===void 0?{}:y,P=d.overlayers,D=P===void 0?{}:P;Object.keys(T).forEach(function(Q,X){l.addLayer(T[Q],Q,!1)}),Object.keys(D).forEach(function(Q,X){l.addLayer(D[Q],Q,!0)})}},{key:"update",value:function(){if(!this.container)return this;Me.SO.empty(this.baseLayersList),Me.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,y,T,P=0;for(y=0;y<this.layers.length;y++)T=this.layers[y],this.addItem(T),d=d||T.overlay,l=l||!T.overlay,P+=T.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&P>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,y,T=this.mapsService.getZoom(),P=l.length-1;P>=0;P--)if(d=l[P],y=this.layerService.getLayer(d.layerId),y&&y.inited){var D=y.getMinZoom(),Q=y.getMaxZoom();d.disabled=T<D||T>Q}}},{key:"addLayer",value:function(l,d,y){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:y});var T=this.controlOption,P=T.sortLayers,D=T.sortFunction,Q=T.autoZIndex;P&&this.layers.sort(function(X,le){return D(X.layer,le.layer,X.name,le.name)}),Q&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),y=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;y&&this.emit(y,d)}},{key:"createRadioElement",value:function(l,d){var y='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",T=document.createElement("div");return T.innerHTML=y,T.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),y=this.layerService.getLayer(l.layer.id),T=y&&y.inited&&l.layer.isVisible(),P;l.overlay?(P=document.createElement("input"),P.type="checkbox",P.className="l7-control-layers-selector",P.defaultChecked=T):P=this.createRadioElement("l7-base-layers",T),this.layerControlInputs.push(P),P.layerId=l.layer.id,P.addEventListener("click",this.onInputClick);var D=document.createElement("span");D.innerHTML=" "+l.name;var Q=document.createElement("div");d.appendChild(Q),Q.appendChild(P),Q.appendChild(D);var X=l.overlay?this.overlaysList:this.baseLayersList;return X.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,y,T=[],P=[];this.handlingClick=!0;for(var D=l.length-1;D>=0;D--)d=l[D],y=this.layerService.getLayer(d.layerId),d.checked?T.push(y):d.checked||P.push(y);P.forEach(function(Q){Q.hide()}),T.forEach(function(Q){Q.show()}),this.handlingClick=!1}}]),o}(Pr);function bt(i){var f=Fe();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Fe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ae=function(i){(0,ne.Z)(o,i);var f=bt(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{position:yt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=Me.SO.create("div",l),y=Me.SO.create("a","l7-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://antv.alipay.com/l7",y.setAttribute("aria-label","AntV logo"),y.setAttribute("rel","noopener nofollow"),d.appendChild(y),d}},{key:"onRemove",value:function(){return null}}]),o}(Pr);function Ne(i){var f=xt();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function xt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var nr=function(i){(0,ne.Z)(o,i);var f=Ne(o);function o(s){var l;return(0,Y.Z)(this,o),l=f.call(this,s),l.mScale=void 0,l.iScale=void 0,(0,Me.Ev)(["update"],(0,Ht.Z)(l)),l}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{position:yt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=Me.SO.create("div",l);this.addScales(l+"-line",d);var y=this.controlOption.updateWhenIdle;return this.mapsService.on(y?"moveend":"mapmove",this.update),this.mapsService.on(y?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,y=l.getSize()[1]/2,T=l.containerToLngLat([0,y]),P=l.containerToLngLat([d,y]),D=(0,Me.yM)([T.lng,T.lat],[P.lng,P.lat]);this.updateScales(D)}},{key:"updateScales",value:function(l){var d=this.controlOption,y=d.metric,T=d.imperial;y&&l&&this.updateMetric(l),T&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),y=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,y,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,y,T,P;d>5280?(y=d/5280,T=this.getRoundNum(y),this.updateScale(this.iScale,T+" mi",T/y)):(P=this.getRoundNum(d),this.updateScale(this.iScale,P+" ft",P/d))}},{key:"updateScale",value:function(l,d,y){var T=this.controlOption.maxWidth;l.style.width=Math.round(T*y)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),y=l/d;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,d*y}},{key:"addScales",value:function(l,d){var y=this.controlOption,T=y.metric,P=y.imperial;T&&(this.mScale=Me.SO.create("div",l,d)),P&&(this.iScale=Me.SO.create("div",l,d))}}]),o}(Pr);function re(i){var f=Ee();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ae=function(i){(0,ne.Z)(o,i);var f=re(o);function o(s){var l;return(0,Y.Z)(this,o),l=f.call(this,s),l.disabled=void 0,l.zoomInButton=void 0,l.zoomOutButton=void 0,(0,Me.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,Ht.Z)(l)),l}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{position:yt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=Me.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,y,T,P){var D=Me.SO.create("a",y,T);return D.innerHTML=l,D.title=d,D.href="javascript:void(0)",D.addEventListener("click",P),D}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";Me.SO.removeClass(this.zoomInButton,d),Me.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&Me.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Me.SO.addClass(this.zoomInButton,d)}}]),o}(Pr);function me(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Te(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?me(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):me(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Je(i){var f=dt();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function dt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var $t=function(i){(0,ne.Z)(o,i);var f=Je(o);function o(s){var l;return(0,Y.Z)(this,o),l=f.call(this),l.markerOption=void 0,l.defaultMarker=void 0,l.popup=void 0,l.mapsService=void 0,l.sceneSerive=void 0,l.lngLat=void 0,l.scene=void 0,l.added=!1,l.eventHandle=function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})},l.markerOption=Te(Te({},l.getDefault()),s),(0,Me.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,Ht.Z)(l)),l.init(),l}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:Me.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(w.vK.IMapService),this.sceneSerive=l.get(w.vK.ISceneService);var d=this.markerOption,y=d.element,T=d.draggable;return this.mapsService.getMarkerContainer().appendChild(y),this.registerMarkerEvent(y),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Me.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var y=this.markerOption.element;return y&&Me.SO.remove(y),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.anchor;this.updatePosition(),Me.SO.setTransform(d,"".concat(Me.rQ[y]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.offsets,T=this.lngLat,P=T.lng,D=T.lat,Q=this.mapsService.getBounds(),X=this.mapsService.lngLatToContainer([P,D]);if(d){d.style.display="block";var le=this.mapsService.getContainer(),Ue=0,tt=0;if(le&&(Ue=le.scrollWidth,tt=le.scrollHeight),Math.abs(Q[0][0])>180||Math.abs(Q[1][0])>180){if(X.x>Ue){var Ot=this.mapsService.lngLatToContainer([P-360,D]);X.x=Ot.x}if(X.x<0){var xr=this.mapsService.lngLatToContainer([P+360,D]);X.x=xr.x}}(X.x>Ue||X.x<0||X.y>tt||X.y<0)&&(d.style.display="none"),d.style.left=X.x+y[0]+"px",d.style.top=X.y-y[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,y=this.markerOption,T=y.color,P=y.anchor;if(!d){this.defaultMarker=!0,d=Me.SO.create("div"),this.markerOption.element=d;var D=document.createElementNS("http://www.w3.org/2000/svg","svg");D.setAttributeNS(null,"display","block"),D.setAttributeNS(null,"height","48px"),D.setAttributeNS(null,"width","48px"),D.setAttributeNS(null,"viewBox","0 0 1024 1024");var Q=document.createElementNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),Q.setAttributeNS(null,"fill",T),D.appendChild(Q),d.appendChild(D)}Me.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(X){var le,Ue,tt=((le=l.markerOption)===null||le===void 0?void 0:le.style)&&((Ue=l.markerOption)===null||Ue===void 0?void 0:Ue.style[X]);d&&(d.style[X]=tt)}),d.addEventListener("click",function(X){l.onMapClick(X)}),d.addEventListener("click",this.eventHandle),(0,Me.zi)(d,P,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}(Kt.EventEmitter),Fr=x(82492),zr=x.n(Fr),ln=x(69848),tr=x.n(ln);function oe(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function ge(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?oe(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):oe(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Re(i){var f=qe();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Ct=function(i){(0,ne.Z)(o,i);var f=Re(o);function o(s){var l,d;return(0,Y.Z)(this,o),d=f.call(this),d.markers=[],d.markerLayerOption=void 0,d.clusterIndex=void 0,d.points=[],d.clusterMarkers=[],d.mapsService=void 0,d.scene=void 0,d.zoom=void 0,d.bbox=void 0,d.markerLayerOption=zr()(d.getDefault(),s),(0,Me.Ev)(["update"],(0,Ht.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,ce.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(w.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var y=l.getLnglat(),T=y.lng,P=y.lat,D={geometry:{type:"Point",coordinates:[T,P]},properties:ge(ge({},l.getExtData()),{},{marker_id:d})};this.points.push(D)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,y=l.minZoom,T=y===void 0?0:y,P=l.maxZoom;this.clusterIndex=new(tr())({radius:d,minZoom:T,maxZoom:P}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var y=this,T=l[0].concat(l[1]),P=this.clusterIndex.getClusters(T,d);this.clusterMarkers.forEach(function(D){D.remove()}),this.clusterMarkers=[],P.forEach(function(D){var Q,X=y.markerLayerOption.clusterOption,le=X.field,Ue=X.method;if(D.properties&&(Q=D.properties)!==null&&Q!==void 0&&Q.cluster_id){var tt,Ot=y.getLeaves((tt=D.properties)===null||tt===void 0?void 0:tt.cluster_id);if(D.properties.clusterData=Ot,le&&Ue){var xr=Ot==null?void 0:Ot.map(function(Vn){var Mi=(0,z.Z)({},le,Vn.properties[le]);return Mi}),Tr=Me.a5.getColumn(xr,le),jr=Me.a5.getSatByColumn(Ue,Tr),dn="point_"+Ue;D.properties[dn]=jr.toFixed(2)}}var bn=y.clusterMarker(D);y.clusterMarkers.push(bn),bn.addTo(y.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,y):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,y=d,T=y.element,P=T===void 0?this.generateElement.bind(this):T,D=new $t({element:P(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return D}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Me.oO)(this.bbox,d))&&(this.bbox=(0,Me.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=Me.SO.create("div","l7-marker-cluster"),y=Me.SO.create("div","",d),T=Me.SO.create("span","",y),P=this.markerLayerOption.clusterOption,D=P.field,Q=P.method;l.properties.point_count=l.properties.point_count||1;var X=D&&Q?l.properties["point_"+Q]||l.properties[D]:l.properties.point_count;return T.textContent=X,d}}]),o}(Kt.EventEmitter);function kt(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function S(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?kt(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):kt(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function F(i){var f=he();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function he(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Be=function(i){(0,ne.Z)(o,i);var f=F(o);function o(s){var l;return(0,Y.Z)(this,o),l=f.call(this),l.popupOption=void 0,l.mapsService=void 0,l.sceneSerive=void 0,l.lngLat=void 0,l.content=void 0,l.closeButton=void 0,l.timeoutInstance=void 0,l.container=void 0,l.tip=void 0,l.scene=void 0,l.popupOption=S(S({},l.getdefault()),s),(0,Me.Ev)(["update","onClickClose","remove"],(0,Ht.Z)(l)),l}return(0,ce.Z)(o,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(w.vK.IMapService),this.sceneSerive=l.get(w.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),y=window.document.createElement("body"),T;for(y.innerHTML=l;T=y.firstChild,!!T;)d.appendChild(T);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Me.SO.remove(this.content),this.content=Me.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Me.SO.create("button","l7-popup-close-button",this.content),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,y){var T=window.document.createElement(l);return d!==void 0&&(T.className=d),y&&y.appendChild(T),T}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Me.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,y=this.popupOption,T=y.className,P=y.maxWidth,D=y.anchor;if(!(!this.mapsService||!d||!this.content)){var Q=this.mapsService.getMarkerContainer();if(!this.container&&Q){this.container=this.creatDom("div","l7-popup",Q),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),T&&T.split(" ").forEach(function(le){return l.container.classList.add(le)});var X=this.popupOption.stopPropagation;X&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(le){l.container.addEventListener(le,function(Ue){Ue.stopPropagation()})})}P&&this.container.style.maxWidth!==P&&(this.container.style.maxWidth=P),this.updatePosition(),Me.SO.setTransform(this.container,"".concat(Me.rQ[D])),(0,Me.zi)(this.container,D,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,y=l.lat,T=this.popupOption.offsets,P=this.mapsService.lngLatToContainer([d,y]);this.container.style.left=P.x+T[0]+"px",this.container.style.top=P.y-T[1]+"px"}}}]),o}(Kt.EventEmitter);x(68982)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var $e=x(92137),vt=x(87757),wt=x.n(vt),H=x(86700),Wt=x(81550),Vt=x.n(Wt),yr=function(){function i(f,o){(0,Y.Z)(this,i),this.attribute=void 0,this.buffer=void 0;var s=o.buffer,l=o.offset,d=o.stride,y=o.normalized,T=o.size,P=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:y||!1,divisor:P||0},T&&(this.attribute.size=T)}return(0,ce.Z)(i,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),i}(),Er,Ar,Mr,Ke,gt,ct,sr,Qr,st,Mt,Jt,mr,gn,Cn,yi=(Er={},(0,z.Z)(Er,w.gl.POINTS,"points"),(0,z.Z)(Er,w.gl.LINES,"lines"),(0,z.Z)(Er,w.gl.LINE_LOOP,"line loop"),(0,z.Z)(Er,w.gl.LINE_STRIP,"line strip"),(0,z.Z)(Er,w.gl.TRIANGLES,"triangles"),(0,z.Z)(Er,w.gl.TRIANGLE_FAN,"triangle fan"),(0,z.Z)(Er,w.gl.TRIANGLE_STRIP,"triangle strip"),Er),Ei=(Ar={},(0,z.Z)(Ar,w.gl.STATIC_DRAW,"static"),(0,z.Z)(Ar,w.gl.DYNAMIC_DRAW,"dynamic"),(0,z.Z)(Ar,w.gl.STREAM_DRAW,"stream"),Ar),Ii=(Mr={},(0,z.Z)(Mr,w.gl.BYTE,"int8"),(0,z.Z)(Mr,w.gl.UNSIGNED_INT,"int16"),(0,z.Z)(Mr,w.gl.INT,"int32"),(0,z.Z)(Mr,w.gl.UNSIGNED_BYTE,"uint8"),(0,z.Z)(Mr,w.gl.UNSIGNED_SHORT,"uint16"),(0,z.Z)(Mr,w.gl.UNSIGNED_INT,"uint32"),(0,z.Z)(Mr,w.gl.FLOAT,"float"),Mr),Ji=(Ke={},(0,z.Z)(Ke,w.gl.ALPHA,"alpha"),(0,z.Z)(Ke,w.gl.LUMINANCE,"luminance"),(0,z.Z)(Ke,w.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,z.Z)(Ke,w.gl.RGB,"rgb"),(0,z.Z)(Ke,w.gl.RGBA,"rgba"),(0,z.Z)(Ke,w.gl.RGBA4,"rgba4"),(0,z.Z)(Ke,w.gl.RGB5_A1,"rgb5 a1"),(0,z.Z)(Ke,w.gl.RGB565,"rgb565"),(0,z.Z)(Ke,w.gl.DEPTH_COMPONENT,"depth"),(0,z.Z)(Ke,w.gl.DEPTH_STENCIL,"depth stencil"),Ke),li=(gt={},(0,z.Z)(gt,w.gl.DONT_CARE,"dont care"),(0,z.Z)(gt,w.gl.NICEST,"nice"),(0,z.Z)(gt,w.gl.FASTEST,"fast"),gt),G=(ct={},(0,z.Z)(ct,w.gl.NEAREST,"nearest"),(0,z.Z)(ct,w.gl.LINEAR,"linear"),(0,z.Z)(ct,w.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,z.Z)(ct,w.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,z.Z)(ct,w.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,z.Z)(ct,w.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ct),I=(sr={},(0,z.Z)(sr,w.gl.REPEAT,"repeat"),(0,z.Z)(sr,w.gl.CLAMP_TO_EDGE,"clamp"),(0,z.Z)(sr,w.gl.MIRRORED_REPEAT,"mirror"),sr),j=(Qr={},(0,z.Z)(Qr,w.gl.NONE,"none"),(0,z.Z)(Qr,w.gl.BROWSER_DEFAULT_WEBGL,"browser"),Qr),K=(st={},(0,z.Z)(st,w.gl.NEVER,"never"),(0,z.Z)(st,w.gl.ALWAYS,"always"),(0,z.Z)(st,w.gl.LESS,"less"),(0,z.Z)(st,w.gl.LEQUAL,"lequal"),(0,z.Z)(st,w.gl.GREATER,"greater"),(0,z.Z)(st,w.gl.GEQUAL,"gequal"),(0,z.Z)(st,w.gl.EQUAL,"equal"),(0,z.Z)(st,w.gl.NOTEQUAL,"notequal"),st),ie=(Mt={},(0,z.Z)(Mt,w.gl.FUNC_ADD,"add"),(0,z.Z)(Mt,w.gl.MIN_EXT,"min"),(0,z.Z)(Mt,w.gl.MAX_EXT,"max"),(0,z.Z)(Mt,w.gl.FUNC_SUBTRACT,"subtract"),(0,z.Z)(Mt,w.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Mt),Oe=(Jt={},(0,z.Z)(Jt,w.gl.ZERO,"zero"),(0,z.Z)(Jt,w.gl.ONE,"one"),(0,z.Z)(Jt,w.gl.SRC_COLOR,"src color"),(0,z.Z)(Jt,w.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,z.Z)(Jt,w.gl.SRC_ALPHA,"src alpha"),(0,z.Z)(Jt,w.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,z.Z)(Jt,w.gl.DST_COLOR,"dst color"),(0,z.Z)(Jt,w.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,z.Z)(Jt,w.gl.DST_ALPHA,"dst alpha"),(0,z.Z)(Jt,w.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,z.Z)(Jt,w.gl.CONSTANT_COLOR,"constant color"),(0,z.Z)(Jt,w.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,z.Z)(Jt,w.gl.CONSTANT_ALPHA,"constant alpha"),(0,z.Z)(Jt,w.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,z.Z)(Jt,w.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Jt),He=(mr={},(0,z.Z)(mr,w.gl.NEVER,"never"),(0,z.Z)(mr,w.gl.ALWAYS,"always"),(0,z.Z)(mr,w.gl.LESS,"less"),(0,z.Z)(mr,w.gl.LEQUAL,"lequal"),(0,z.Z)(mr,w.gl.GREATER,"greater"),(0,z.Z)(mr,w.gl.GEQUAL,"gequal"),(0,z.Z)(mr,w.gl.EQUAL,"equal"),(0,z.Z)(mr,w.gl.NOTEQUAL,"notequal"),mr),ue=(gn={},(0,z.Z)(gn,w.gl.ZERO,"zero"),(0,z.Z)(gn,w.gl.KEEP,"keep"),(0,z.Z)(gn,w.gl.REPLACE,"replace"),(0,z.Z)(gn,w.gl.INVERT,"invert"),(0,z.Z)(gn,w.gl.INCR,"increment"),(0,z.Z)(gn,w.gl.DECR,"decrement"),(0,z.Z)(gn,w.gl.INCR_WRAP,"increment wrap"),(0,z.Z)(gn,w.gl.DECR_WRAP,"decrement wrap"),gn),De=(Cn={},(0,z.Z)(Cn,w.gl.FRONT,"front"),(0,z.Z)(Cn,w.gl.BACK,"back"),Cn),St=function(){function i(f,o){(0,Y.Z)(this,i),this.buffer=void 0;var s=o.data,l=o.usage,d=o.type;this.buffer=f.buffer({data:s,usage:Ei[l||w.gl.STATIC_DRAW],type:Ii[d||w.gl.UNSIGNED_BYTE]})}return(0,ce.Z)(i,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,l=o.offset;this.buffer.subdata(s,l)}}]),i}(),Ir=function(){function i(f,o){(0,Y.Z)(this,i),this.elements=void 0;var s=o.data,l=o.usage,d=o.type,y=o.count;this.elements=f.elements({data:s,usage:Ei[l||w.gl.STATIC_DRAW],type:Ii[d||w.gl.UNSIGNED_BYTE],count:y})}return(0,ce.Z)(i,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),i}(),Br=function(){function i(f,o){(0,Y.Z)(this,i),this.framebuffer=void 0;var s=o.width,l=o.height,d=o.color,y=o.colors,T=o.depth,P=o.stencil,D={width:s,height:l};Array.isArray(y)&&(D.colors=y.map(function(Q){return Q.get()})),d&&typeof d!="boolean"&&(D.color=d.get()),this.framebuffer=f.framebuffer(D)}return(0,ce.Z)(i,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.framebuffer.resize(s,l)}}]),i}(),jt=x(90484),dr=x(36719),Wr=x.n(dr),yn=x(68630),vr=x.n(yn);function vn(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function $r(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?vn(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):vn(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var cn=function(){function i(f,o){(0,Y.Z)(this,i),this.reGl=void 0,this.destroyed=!1,this.drawCommand=void 0,this.drawParams=void 0,this.options=void 0,this.uniforms={},this.reGl=f;var s=o.vs,l=o.fs,d=o.attributes,y=o.uniforms,T=o.primitive,P=o.count,D=o.elements,Q=o.depth,X=o.blend,le=o.stencil,Ue=o.cull,tt=o.instances,Ot={};this.options=o,y&&(this.uniforms=this.extractUniforms(y),Object.keys(y).forEach(function(jr){Ot[jr]=f.prop(jr)}));var xr={};Object.keys(d).forEach(function(jr){xr[jr]=d[jr].get()});var Tr={attributes:xr,frag:l,uniforms:Ot,vert:s,primitive:yi[T===void 0?w.gl.TRIANGLES:T]};tt&&(Tr.instances=tt),P&&(Tr.count=P),D&&(Tr.elements=D.get()),this.initDepthDrawParams({depth:Q},Tr),this.initBlendDrawParams({blend:X},Tr),this.initStencilDrawParams({stencil:le},Tr),this.initCullDrawParams({cull:Ue},Tr),this.drawCommand=f(Tr),this.drawParams=Tr}return(0,ce.Z)(i,[{key:"addUniforms",value:function(o){this.uniforms=$r($r({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=$r($r({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(s).forEach(function(d){var y=(0,jt.Z)(s[d]);y==="boolean"||y==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var l=o.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:K[l.func||w.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var l=o.blend;if(l){var d=l.enable,y=l.func,T=l.equation,P=l.color,D=P===void 0?[0,0,0,0]:P;s.blend={enable:!!d,func:{srcRGB:Oe[y&&y.srcRGB||w.gl.SRC_ALPHA],srcAlpha:Oe[y&&y.srcAlpha||w.gl.SRC_ALPHA],dstRGB:Oe[y&&y.dstRGB||w.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Oe[y&&y.dstAlpha||w.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:ie[T&&T.rgb||w.gl.FUNC_ADD],alpha:ie[T&&T.alpha||w.gl.FUNC_ADD]},color:D}}}},{key:"initStencilDrawParams",value:function(o,s){var l=o.stencil;if(l){var d=l.enable,y=l.mask,T=y===void 0?-1:y,P=l.func,D=P===void 0?{cmp:w.gl.ALWAYS,ref:0,mask:-1}:P,Q=l.opFront,X=Q===void 0?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:Q,le=l.opBack,Ue=le===void 0?{fail:w.gl.KEEP,zfail:w.gl.KEEP,zpass:w.gl.KEEP}:le;s.stencil={enable:!!d,mask:T,func:$r($r({},D),{},{cmp:He[D.cmp]}),opFront:{fail:ue[X.fail],zfail:ue[X.zfail],zpass:ue[X.zpass]},opBack:{fail:ue[Ue.fail],zfail:ue[Ue.zfail],zpass:ue[Ue.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var l=o.cull;if(l){var d=l.enable,y=l.face,T=y===void 0?w.gl.BACK:y;s.cull={enable:!!d,face:De[T]}}}},{key:"extractUniforms",value:function(o){var s=this,l={};return Object.keys(o).forEach(function(d){s.extractUniformsRecursively(d,o[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,s,l,d){var y=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||Wr()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(o)]=s;return}vr()(s)&&Object.keys(s).forEach(function(T){y.extractUniformsRecursively(T,s[T],l,"".concat(d&&d+".").concat(o))}),Array.isArray(s)&&s.forEach(function(T,P){Object.keys(T).forEach(function(D){y.extractUniformsRecursively(D,T[D],l,"".concat(d&&d+".").concat(o,"[").concat(P,"]"))})})}}]),i}(),di=function(){function i(f,o){(0,Y.Z)(this,i),this.texture=void 0,this.width=void 0,this.height=void 0;var s=o.data,l=o.type,d=l===void 0?w.gl.UNSIGNED_BYTE:l,y=o.width,T=o.height,P=o.flipY,D=P===void 0?!1:P,Q=o.format,X=Q===void 0?w.gl.RGBA:Q,le=o.mipmap,Ue=le===void 0?!1:le,tt=o.wrapS,Ot=tt===void 0?w.gl.CLAMP_TO_EDGE:tt,xr=o.wrapT,Tr=xr===void 0?w.gl.CLAMP_TO_EDGE:xr,jr=o.aniso,dn=jr===void 0?0:jr,bn=o.alignment,Vn=bn===void 0?1:bn,Mi=o.premultiplyAlpha,ti=Mi===void 0?!1:Mi,ra=o.mag,Ia=ra===void 0?w.gl.NEAREST:ra,Fa=o.min,gi=Fa===void 0?w.gl.NEAREST:Fa,wa=o.colorSpace,oo=wa===void 0?w.gl.BROWSER_DEFAULT_WEBGL:wa;this.width=y,this.height=T;var Yu={width:y,height:T,type:Ii[d],format:Ji[X],wrapS:I[Ot],wrapT:I[Tr],mag:G[Ia],min:G[gi],alignment:Vn,flipY:D,colorSpace:j[oo],premultiplyAlpha:ti,aniso:dn};s&&(Yu.data=s),typeof Ue=="number"?Yu.mipmap=li[Ue]:typeof Ue=="boolean"&&(Yu.mipmap=Ue),this.texture=f.texture(Yu)}return(0,ce.Z)(i,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),i}(),hn,bi,Qi,_i=(hn=(0,H.b2)(),hn(bi=(Qi=function(){function i(){var f=this;(0,Y.Z)(this,i),this.gl=void 0,this.$container=void 0,this.canvas=void 0,this.width=void 0,this.height=void 0,this.isDirty=void 0,this.createModel=function(o){return new cn(f.gl,o)},this.createAttribute=function(o){return new yr(f.gl,o)},this.createBuffer=function(o){return new St(f.gl,o)},this.createElements=function(o){return new Ir(f.gl,o)},this.createTexture2D=function(o){return new di(f.gl,o)},this.createFramebuffer=function(o){return new Br(f.gl,o)},this.useFramebuffer=function(o,s){f.gl({framebuffer:o?o.get():null})(s)},this.clear=function(o){var s=o.color,l=o.depth,d=o.stencil,y=o.framebuffer,T=y===void 0?null:y,P={color:s,depth:l,stencil:d};P.framebuffer=T===null?T:T.get(),f.gl.clear(P)},this.viewport=function(o){var s=o.x,l=o.y,d=o.width,y=o.height;f.gl._gl.viewport(s,l,d,y),f.width=d,f.height=y,f.gl._refresh()},this.readPixels=function(o){var s=o.framebuffer,l=o.x,d=o.y,y=o.width,T=o.height,P={x:l,y:d,width:y,height:T};return s&&(P.framebuffer=s.get()),f.gl.read(P)},this.getViewportSize=function(){return{width:f.gl._gl.drawingBufferWidth,height:f.gl._gl.drawingBufferHeight}},this.getContainer=function(){var o;return(o=f.canvas)===null||o===void 0?void 0:o.parentElement},this.getCanvas=function(){return f.canvas},this.getGLContext=function(){return f.gl._gl},this.destroy=function(){f.gl.destroy()}}return(0,ce.Z)(i,[{key:"init",value:function(){var f=(0,$e.Z)(wt().mark(function s(l,d){var y=this;return wt().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.canvas=l,P.next=3,new Promise(function(D,Q){Vt()({canvas:y.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(le,Ue){(le||!Ue)&&Q(le),D(Ue)}})});case 3:this.gl=P.sent;case 4:case"end":return P.stop()}},s,this)}));function o(s,l){return f.apply(this,arguments)}return o}()},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),i}(),Qi))||bi);function Oi(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ci(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Oi(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Oi(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var yo=function(){function i(f){(0,Y.Z)(this,i),this.sceneService=void 0,this.mapService=void 0,this.controlService=void 0,this.layerService=void 0,this.iconService=void 0,this.markerService=void 0,this.popupService=void 0,this.fontService=void 0,this.interactionService=void 0,this.container=void 0;var o=f.id,s=f.map,l=(0,w.Hp)();this.container=l,s.setContainer(l,o),l.bind(w.vK.IRendererService).to(_i).inSingletonScope(),this.sceneService=l.get(w.vK.ISceneService),this.mapService=l.get(w.vK.IMapService),this.iconService=l.get(w.vK.IIconService),this.fontService=l.get(w.vK.IFontService),this.controlService=l.get(w.vK.IControlService),this.layerService=l.get(w.vK.ILayerService),this.markerService=l.get(w.vK.IMarkerService),this.interactionService=l.get(w.vK.IInteractionService),this.popupService=l.get(w.vK.IPopupService),this.initComponent(o),this.sceneService.init(f),this.initControl()}return(0,ce.Z)(i,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var d=new o(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,w.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(l){var d=(0,q.Z)(l,2),y=d[0],T=d[1];s.fontService.addIconFont(y,T)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){w.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"off",value:function(o,s){w.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,y=l.animate;this.mapService.fitBounds(o,s||Ci(Ci({},d),{},{animate:y}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(w.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:Me.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,l=o.logoPosition;s&&this.addControl(new Ae({position:l}))}}]),i}(),Zi=x(81253),Rn=x(55770),Dn=x(3473),hi=x(13218),jn=x.n(hi),Oa=x(23560),hs=x.n(Oa),Li=x(46343),La=x(86387),gu=x.n(La),su,ga,so,Ga,Ha,Ho;function sa(i){return i.map(function(f){return typeof f=="string"&&(f=[f,{}]),f})}var Wa=(su=(0,H.b2)(),ga=(0,H.f3)(w.vK.IGlobalConfigService),su(so=(Ga=(Ho=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"configService",Ha,this),this.enabled=void 0}return(0,ce.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.rendererService,y=s.postProcessingPassFactory,T=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var P=o.getLayerConfig(),D=P.enableMultiPassRenderer,Q=P.passes,X=Q===void 0?[]:Q;l.enabled=!!D&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,X,y,T),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,l,d){var y=o.multiPassRenderer,T=o.getLayerConfig(),P=T.enablePicking,D=T.enableTAA;return P&&y.add(d("pixelPicking")),y}}]),i}(),Ho),Ha=(0,Dn.Z)(Ga.prototype,"configService",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ga))||so),Ea,ya=(Ea={},(0,z.Z)(Ea,w.BlendType.additive,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,z.Z)(Ea,w.BlendType.none,{enable:!1}),(0,z.Z)(Ea,w.BlendType.normal,{enable:!0,func:{srcRGB:w.gl.SRC_ALPHA,dstRGB:w.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,z.Z)(Ea,w.BlendType.subtractive,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE,srcAlpha:w.gl.ZERO,dstAlpha:w.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:w.gl.FUNC_SUBTRACT,alpha:w.gl.FUNC_SUBTRACT}}),(0,z.Z)(Ea,w.BlendType.max,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE},equation:{rgb:w.gl.MAX_EXT}}),(0,z.Z)(Ea,w.BlendType.min,{enable:!0,func:{srcRGB:w.gl.ONE,dstRGB:w.gl.ONE},equation:{rgb:w.gl.MIN_EXT}}),Ea),ia={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},ol,ns,to,Aa,fa,fe,Pe,ft;function ur(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=en(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,T;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,T=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw T}}}}function en(i,f){if(!!i){if(typeof i=="string")return kn(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return kn(i,f)}}function kn(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Vi(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function qi(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Vi(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Vi(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Xa(i){var f=Ya();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Wo=0,xs=(ol=(0,w.yT)(w.vK.ILogService),ns=(0,w.yT)(w.vK.IGlobalConfigService),to=(0,w.yT)(w.vK.IShaderModuleService),Aa=(ft=function(i){(0,ne.Z)(o,i);var f=Xa(o);function o(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Y.Z)(this,o),s=f.call(this),s.id="".concat(Wo++),s.name="".concat(Wo),s.type=void 0,s.visible=!0,s.zIndex=0,s.minZoom=void 0,s.maxZoom=void 0,s.inited=!1,s.layerModelNeedUpdate=!1,s.pickedFeatureID=null,s.selectedFeatureID=null,s.styleNeedUpdate=!1,s.dataState={dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1},s.hooks={init:new Li.oI,afterInit:new Li.oI,beforeRender:new Li.oI,beforeRenderData:new Li.gg,afterRender:new Li.ni,beforePickingEncode:new Li.ni,afterPickingEncode:new Li.ni,beforeHighlight:new Li.ni(["pickedColor"]),afterHighlight:new Li.ni,beforeSelect:new Li.ni(["pickedColor"]),afterSelect:new Li.ni,beforeDestroy:new Li.ni,afterDestroy:new Li.ni},s.models=[],s.multiPassRenderer=void 0,s.plugins=void 0,s.sourceOption=void 0,s.layerModel=void 0,(0,Rn.Z)(s,"logger",fa,(0,Ht.Z)(s)),(0,Rn.Z)(s,"configService",fe,(0,Ht.Z)(s)),(0,Rn.Z)(s,"shaderModuleService",Pe,(0,Ht.Z)(s)),s.cameraService=void 0,s.coordinateService=void 0,s.iconService=void 0,s.fontService=void 0,s.pickingService=void 0,s.rendererService=void 0,s.layerService=void 0,s.interactionService=void 0,s.mapService=void 0,s.styleAttributeService=void 0,s.layerSource=void 0,s.postProcessingPassFactory=void 0,s.normalPassFactory=void 0,s.animateOptions={enable:!1},s.container=void 0,s.encodedData=void 0,s.configSchema=void 0,s.currentPickId=null,s.rawConfig=void 0,s.needUpdateConfig=void 0,s.pendingStyleAttributes=[],s.scaleOptions={},s.animateStartTime=void 0,s.aniamateStatus=!1,s.sourceEvent=function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),y=d.autoFit,T=d.fitBoundsOptions;y&&s.fitBounds(T),s.emit("dataUpdate"),s.reRender()},s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,ce.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=qi(qi({},this.needUpdateConfig),l);else{var d=this.container.get(w.vK.SceneID);this.configService.setLayerConfig(d,this.id,qi(qi(qi({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(w.vK.SceneID),y=this.rawConfig.enableMultiPassRenderer,T=y===void 0?!1:y;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:T}),this.iconService=this.container.get(w.vK.IIconService),this.fontService=this.container.get(w.vK.IFontService),this.rendererService=this.container.get(w.vK.IRendererService),this.layerService=this.container.get(w.vK.ILayerService),this.interactionService=this.container.get(w.vK.IInteractionService),this.pickingService=this.container.get(w.vK.IPickingService),this.mapService=this.container.get(w.vK.IMapService),this.cameraService=this.container.get(w.vK.ICameraService),this.coordinateService=this.container.get(w.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(w.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(w.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(w.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(w.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(X){var le=X.attributeName,Ue=X.attributeField,tt=X.attributeValues,Ot=X.updateOptions;l.styleAttributeService.updateStyleAttribute(le,{scale:qi({field:Ue},l.splitValuesAndCallbackInAttribute(tt,l.getLayerConfig()[le]))},Ot)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(w.vK.ILayerPlugin);var P=ur(this.plugins),D;try{for(P.s();!(D=P.n()).done;){var Q=D.value;Q.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(X){P.e(X)}finally{P.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(qi(qi({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,y){return this.updateStyleAttribute("color",l,d,y),this}},{key:"texture",value:function(l,d,y){return this.updateStyleAttribute("texture",l,d,y),this}},{key:"rotate",value:function(l,d,y){return this.updateStyleAttribute("rotate",l,d,y),this}},{key:"size",value:function(l,d,y){return this.updateStyleAttribute("size",l,d,y),this}},{key:"filter",value:function(l,d,y){return this.updateStyleAttribute("filter",l,d,y),this}},{key:"shape",value:function(l,d,y){return this.updateStyleAttribute("shape",l,d,y),this}},{key:"label",value:function(l,d,y){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:y}),this}},{key:"animate",value:function(l){var d={};return jn()(l)?(d.enable=!0,d=qi(qi({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var y=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){y.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,y=l.passes,T=(0,Zi.Z)(l,["passes"]);return y&&sa(y).forEach(function(P){var D=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(P[0]);D&&D.updateOptions(P[1])}),this.rawConfig=qi(qi({},this.rawConfig),T),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return jn()(l)?this.scaleOptions=qi(qi({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"render",value:function(){return this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=jn()(l)?!0:l,jn()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var y=this;if(jn()(l)){var T=l.x,P=T===void 0?0:T,D=l.y,Q=D===void 0?0:D;this.updateLayerConfig({highlightColor:jn()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:P,y:Q})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:jn()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Me.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=jn()(l)?!0:l,jn()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var y=this;if(jn()(l)){var T=l.x,P=T===void 0?0:T,D=l.y,Q=D===void 0?0:D;this.updateLayerConfig({selectColor:jn()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:P,y:Q})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:jn()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Me.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),y=d.visible,T=d.minZoom,P=T===void 0?-Infinity:T,D=d.maxZoom,Q=D===void 0?Infinity:D;return!!y&&l>=P&&l<=Q}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),y=d.extent,T=y.some(function(P){return Math.abs(P)===Infinity});return T?this:(this.mapService.fitBounds([[y[0],y[1]],[y[2],y[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=gu()([ia,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var y=d.ticks().map(function(P){return(0,z.Z)({value:P},l,d(P))});return y}else if(d.invertExtent){var T=d.range().map(function(P){return(0,z.Z)({value:d.invertExtent(P)},l,P)});return T}}else return[]}},{key:"pick",value:function(l){var d=l.x,y=l.y;this.interactionService.triggerHover({x:d,y})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,y=l.vertexShader,T=l.fragmentShader,P=l.triangulation,D=(0,Zi.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(d,{vs:y,fs:T});var Q=this.shaderModuleService.getModule(d),X=Q.vs,le=Q.fs,Ue=Q.uniforms,tt=this.rendererService.createModel,Ot=this.styleAttributeService.createAttributesAndIndices(this.encodedData,P),xr=Ot.attributes,Tr=Ot.elements;return tt(qi({attributes:xr,uniforms:Ue,fs:le,vs:X,elements:Tr,blend:ya[w.BlendType.normal]},D))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),y=d.enableHighlight,T=y===void 0?!0:y,P=d.enableSelect,D=P===void 0?!0:P,Q=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&D&&(Q=!0),l==="mousemove"&&(T||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(Q=!0),this.isVisible()&&Q}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})}),this}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:hs()(l)?void 0:l||d,callback:hs()(l)?l:void 0}}},{key:"updateStyleAttribute",value:function(l,d,y,T){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:qi({field:d},this.splitValuesAndCallbackInAttribute(y,this.getLayerConfig()[d]))},T):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:y,updateOptions:T})}}]),o}(Kt.EventEmitter),ft),fa=(0,Dn.Z)(Aa.prototype,"logger",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe=(0,Dn.Z)(Aa.prototype,"configService",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pe=(0,Dn.Z)(Aa.prototype,"shaderModuleService",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa),jl,Ku,Do,Cs,uo,Ps,Ca=(jl=(0,w.yT)(w.vK.IGlobalConfigService),Ku=(0,w.yT)(w.vK.IShaderModuleService),Do=(Ps=function(){function i(f){(0,Y.Z)(this,i),this.triangulation=void 0,this.layer=void 0,(0,Rn.Z)(this,"configService",Cs,this),(0,Rn.Z)(this,"shaderModuleService",uo,this),this.rendererService=void 0,this.iconService=void 0,this.fontService=void 0,this.styleAttributeService=void 0,this.mapService=void 0,this.cameraService=void 0,this.layerService=void 0,this.layer=f,this.rendererService=f.getContainer().get(w.vK.IRendererService),this.styleAttributeService=f.getContainer().get(w.vK.IStyleAttributeService),this.mapService=f.getContainer().get(w.vK.IMapService),this.iconService=f.getContainer().get(w.vK.IIconService),this.fontService=f.getContainer().get(w.vK.IFontService),this.cameraService=f.getContainer().get(w.vK.ICameraService),this.layerService=f.getContainer().get(w.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate()}return(0,ce.Z)(i,[{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,l=s===void 0?"normal":s;return ya[w.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),i}(),Ps),Cs=(0,Dn.Z)(Do.prototype,"configService",[jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uo=(0,Dn.Z)(Do.prototype,"shaderModuleService",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Do),pi=x(85061),sl=x(9187),Ra=x.n(sl),zn=x(31437),Ks=zn.create(),Zl=zn.create(),lo=zn.create(),je=zn.create(),Tt=zn.create();function gr(i,f,o,s,l){zn.add(i,o,s),zn.normalize(i,i),f=zn.fromValues(-i[1],i[0]);var d=zn.fromValues(-o[1],o[0]);return[l/zn.dot(f,d),f]}function In(i,f){return zn.set(i,-f[1],f[0])}function Yi(i,f,o){return zn.sub(i,f,o),zn.normalize(i,i),i}function _a(i,f){return i[0]===f[0]&&i[1]===f[1]}function Ba(i){for(var f=new Map,o=0;o<i.length;o++){var s=i[0].toString()+"-"+i[1].toString();f.get(s)?(i.splice(o,1),o++):f.set(s,s)}return i}var aa=function(){function i(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Y.Z)(this,i),this.complex=void 0,this.join=void 0,this.cap=void 0,this.miterLimit=void 0,this.thickness=void 0,this.normal=void 0,this.lastFlip=-1,this.miter=zn.fromValues(0,0),this.started=!1,this.dash=!1,this.totalDistance=0,this.join=f.join||"miter",this.cap=f.cap||"butt",this.miterLimit=f.miterLimit||10,this.thickness=f.thickness||1,this.dash=f.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,ce.Z)(i,[{key:"extrude_gaode2",value:function(o,s){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,y=l.startIndex,T=1;T<d;T++){var P=o[T-1],D=s[T-1],Q=o[T],X=s[T],le=T<o.length-1?o[T+1]:null,Ue=T<s.length-1?s[T+1]:null,tt=this.segment_gaode2(l,y,P,Q,le,D,X,Ue);y+=tt}if(this.dash)for(var Ot=0;Ot<l.positions.length/6;Ot++)l.positions[Ot*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,d=s.startIndex,y=1;y<l;y++){var T=o[y-1],P=o[y],D=y<o.length-1?o[y+1]:null,Q=this.segment(s,d,T,P,D);d+=Q}if(this.dash)for(var X=0;X<s.positions.length/6;X++)s.positions[X*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,l,d,y,T,P,D){var Q=0,X=o.indices,le=o.positions,Ue=o.normals,tt=this.cap==="square",Ot=this.join==="bevel",xr=(0,Me.Z)([P[0],P[1]]),Tr=(0,Me.Z)([T[0],T[1]]);Yi(lo,d,l);var jr=0;if(this.dash&&(jr=this.lineSegmentDistance(xr,Tr),this.totalDistance+=jr),this.normal||(this.normal=zn.create(),In(this.normal,lo)),!this.started)if(this.started=!0,tt){var dn=zn.create(),bn=zn.create();zn.add(dn,this.normal,lo),zn.add(bn,this.normal,lo),Ue.push(bn[0],bn[1],0),Ue.push(dn[0],dn[1],0),le.push(l[0],l[1],0,this.totalDistance-jr,-this.thickness,0),le.push(l[0],l[1],0,this.totalDistance-jr,this.thickness,0)}else this.extrusions(le,Ue,l,this.normal,this.thickness,this.totalDistance-jr);if(X.push(s+0,s+1,s+2),y){_a(d,y)&&zn.add(y,d,zn.normalize(y,zn.subtract(y,d,l))),Yi(je,y,d);var ti=gr(Tt,zn.create(),lo,je,this.thickness),ra=(0,q.Z)(ti,2),Ia=ra[0],Fa=ra[1],gi=zn.dot(Tt,this.normal)<0?-1:1,wa=Ot;if(!wa&&this.join==="miter"){var oo=Ia;oo>this.miterLimit&&(wa=!0)}wa?(Ue.push(this.normal[0],this.normal[1],0),Ue.push(Fa[0],Fa[1],0),le.push(d[0],d[1],0,this.totalDistance,-this.thickness*gi,0),le.push(d[0],d[1],0,this.totalDistance,this.thickness*gi,0),X.push.apply(X,(0,pi.Z)(this.lastFlip!==-gi?[s,s+2,s+3]:[s+2,s+1,s+3])),X.push(s+2,s+3,s+4),In(Ks,je),zn.copy(this.normal,Ks),Ue.push(this.normal[0],this.normal[1],0),le.push(d[0],d[1],0,this.totalDistance,-this.thickness*gi,0),Q+=3):(this.extrusions(le,Ue,d,Fa,Ia,this.totalDistance),X.push.apply(X,(0,pi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),gi=-1,zn.copy(this.normal,Fa),Q+=2),this.lastFlip=gi}else{if(In(this.normal,lo),tt){var Vn=zn.create(),Mi=zn.create();zn.sub(Mi,lo,this.normal),zn.add(Vn,lo,this.normal),Ue.push(Mi[0],Mi[1],0),Ue.push(Vn[0],Vn[1],0),le.push(d[0],d[1],0,this.totalDistance,this.thickness,0),le.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(le,Ue,d,this.normal,this.thickness,this.totalDistance);X.push.apply(X,(0,pi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Q+=2}return Q}},{key:"segment",value:function(o,s,l,d,y){var T=0,P=o.indices,D=o.positions,Q=o.normals,X=this.cap==="square",le=this.join==="bevel",Ue=(0,Me.Z)([d[0],d[1]]),tt=(0,Me.Z)([l[0],l[1]]);Yi(lo,Ue,tt);var Ot=0;if(this.dash&&(Ot=this.lineSegmentDistance(Ue,tt),this.totalDistance+=Ot),this.normal||(this.normal=zn.create(),In(this.normal,lo)),!this.started)if(this.started=!0,X){var xr=zn.create(),Tr=zn.create();zn.add(xr,this.normal,lo),zn.add(Tr,this.normal,lo),Q.push(Tr[0],Tr[1],0),Q.push(xr[0],xr[1],0),D.push(l[0],l[1],0,this.totalDistance-Ot,-this.thickness,0),D.push(l[0],l[1],0,this.totalDistance-Ot,this.thickness,0)}else this.extrusions(D,Q,l,this.normal,this.thickness,this.totalDistance-Ot);if(P.push(s+0,s+1,s+2),y){var bn=(0,Me.Z)([y[0],y[1]]);_a(Ue,bn)&&zn.add(bn,Ue,zn.normalize(bn,zn.subtract(bn,Ue,tt))),Yi(je,bn,Ue);var Vn=gr(Tt,zn.create(),lo,je,this.thickness),Mi=(0,q.Z)(Vn,2),ti=Mi[0],ra=Mi[1],Ia=zn.dot(Tt,this.normal)<0?-1:1,Fa=le;if(!Fa&&this.join==="miter"){var gi=ti;gi>this.miterLimit&&(Fa=!0)}Fa?(Q.push(this.normal[0],this.normal[1],0),Q.push(ra[0],ra[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ia,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness*Ia,0),P.push.apply(P,(0,pi.Z)(this.lastFlip!==-Ia?[s,s+2,s+3]:[s+2,s+1,s+3])),P.push(s+2,s+3,s+4),In(Ks,je),zn.copy(this.normal,Ks),Q.push(this.normal[0],this.normal[1],0),D.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ia,0),T+=3):(this.extrusions(D,Q,d,ra,ti,this.totalDistance),P.push.apply(P,(0,pi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Ia=-1,zn.copy(this.normal,ra),T+=2),this.lastFlip=Ia}else{if(In(this.normal,lo),X){var jr=zn.create(),dn=zn.create();zn.sub(dn,lo,this.normal),zn.add(jr,lo,this.normal),Q.push(dn[0],dn[1],0),Q.push(jr[0],jr[1],0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0),D.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(D,Q,d,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,pi.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),T+=2}return T}},{key:"extrusions",value:function(o,s,l,d,y,T){s.push(d[0],d[1],0),s.push(d[0],d[1],0),o.push(l[0],l[1],0,T,-y,0),o.push(l[0],l[1],0,T,y,0)}},{key:"lineSegmentDistance",value:function(o,s){var l=s[0]-o[0],d=s[1]-o[1];return Math.sqrt(l*l+d*d)}}]),i}(),Pa=x(81763),ko=x.n(Pa);function Mo(i){if(ko()(i[0]))return i;if(ko()(i[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ko()(i[0][0][0])){var f=i,o=0,s=0,l=0;return f.forEach(function(d){d.forEach(function(y){o+=y[0],s+=y[1],l++})}),[o/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ri=x(77160);function wl(i){var f=i[0][0],o=i[0][i[0].length-1];f[0]===o[0]&&f[1]===o[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var s=i[0].length,l=Ra().flatten(i),d=l.vertices,y=l.dimensions,T=[],P=[],D=0;D<d.length/y;D++)y===2?T.push(d[D*2],d[D*2+1],1):T.push(d[D*3],d[D*3+1],1);var Q=Ra()(l.vertices,l.holes,l.dimensions);P.push.apply(P,(0,pi.Z)(Q));for(var X=function(tt){var Ot=l.vertices.slice(tt*y,(tt+1)*y),xr=l.vertices.slice((tt+1)*y,(tt+2)*y);xr.length===0&&(xr=l.vertices.slice(0,y));var Tr=T.length/3;T.push(Ot[0],Ot[1],1,xr[0],xr[1],1,Ot[0],Ot[1],0,xr[0],xr[1],0),P.push.apply(P,(0,pi.Z)([0,2,1,2,3,1].map(function(jr){return jr+Tr})))},le=0;le<s;le++)X(le);return{positions:T,index:P}}function Us(i){var f=Ra().flatten(i),o=Ra()(f.vertices,f.holes,f.dimensions);return{positions:f.vertices,index:o}}function ps(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=i[0][0],s=i[0][i[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(i[0]=i[0].slice(0,i[0].length-1));for(var l=i[0].length,d=Ra().flatten(i),y=d.vertices,T=d.dimensions,P=[],D=[],Q=[],X=0;X<y.length/T;X++)T===2?P.push(y[X*2],y[X*2+1],1,-1,-1):P.push(y[X*3],y[X*3+1],1,-1,-1),Q.push(0,0,1);var le=Ra()(d.vertices,d.holes,d.dimensions);D.push.apply(D,(0,pi.Z)(le));for(var Ue=function(xr){var Tr=d.vertices.slice(xr*T,(xr+1)*T),jr=d.vertices.slice((xr+1)*T,(xr+2)*T);jr.length===0&&(jr=d.vertices.slice(0,T));var dn=P.length/5;P.push(Tr[0],Tr[1],1,0,0,jr[0],jr[1],1,.1,0,Tr[0],Tr[1],0,0,.8,jr[0],jr[1],0,.1,.8);var bn=Vl([jr[0],jr[1],1],[Tr[0],Tr[1],0],[Tr[0],Tr[1],1],f);Q.push.apply(Q,(0,pi.Z)(bn).concat((0,pi.Z)(bn),(0,pi.Z)(bn),(0,pi.Z)(bn))),D.push.apply(D,(0,pi.Z)([1,2,0,3,2,1].map(function(Vn){return Vn+dn})))},tt=0;tt<l;tt++)Ue(tt);return{positions:P,index:D,normals:Q}}function Vl(i,f,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Ri.create(),d=Ri.create(),y=Ri.create();s&&(i=(0,Me.vP)(i),f=(0,Me.vP)(f),o=(0,Me.vP)(o));var T=Ri.fromValues.apply(Ri,(0,pi.Z)(i)),P=Ri.fromValues.apply(Ri,(0,pi.Z)(f)),D=Ri.fromValues.apply(Ri,(0,pi.Z)(o));Ri.sub(l,D,P),Ri.sub(d,T,P),Ri.cross(y,l,d);var Q=Ri.create();return Ri.normalize(Q,y),Q}var co,is;(function(i){i.CYLINDER="cylinder",i.SQUARECOLUMN="squareColumn",i.TRIANGLECOLUMN="triangleColumn",i.HEXAGONCOLUMN="hexagonColumn",i.PENTAGONCOLUMN="pentagonColumn"})(is||(is={}));var as;(function(i){i.CIRCLE="circle",i.SQUARE="square",i.TRIANGLE="triangle",i.HEXAGON="hexagon",i.PENTAGON="pentagon"})(as||(as={}));function uu(i){for(var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/i,s=[],l=0;l<i;l++)s.push(o*l+f*Math.PI/12);var d=s.map(function(y){var T=Math.sin(y+Math.PI/4),P=Math.cos(y+Math.PI/4);return[T,P,0]});return d}function Ms(){return uu(30)}function pc(){return uu(4)}function vf(){return uu(3)}function xa(){return uu(6,1)}function mf(){return uu(5)}var lu=(co={},(0,z.Z)(co,as.CIRCLE,Ms),(0,z.Z)(co,as.HEXAGON,xa),(0,z.Z)(co,as.TRIANGLE,vf),(0,z.Z)(co,as.SQUARE,pc),(0,z.Z)(co,as.PENTAGON,mf),(0,z.Z)(co,is.CYLINDER,Ms),(0,z.Z)(co,is.HEXAGONCOLUMN,xa),(0,z.Z)(co,is.TRIANGLECOLUMN,vf),(0,z.Z)(co,is.SQUARECOLUMN,pc),(0,z.Z)(co,is.PENTAGONCOLUMN,mf),co),Gl={};function Ic(i){var f=Mo(i.coordinates);return{vertices:[].concat((0,pi.Z)(f),(0,pi.Z)(f),(0,pi.Z)(f),(0,pi.Z)(f)),indices:[0,1,2,2,3,0],size:f.length}}function Oc(i){var f=i.shape,o=Hl(f,!1),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function ro(i){var f=Mo(i.coordinates);return{vertices:(0,pi.Z)(f),indices:[0],size:f.length}}function yu(i){var f=i.coordinates,o=i.originCoordinates,s=i.version,l=new aa({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=f;Array.isArray(d[0][0])||(d=[f]);var y=o;Array.isArray(y[0][0])||(y=[o]);for(var T=0;T<d.length;T++){var P=d[T],D=y[T];l.extrude_gaode2(P,D)}}else{var Q=f;Array.isArray(Q[0][0])||(Q=[f]),Q.forEach(function(le){l.extrude(le)})}var X=l.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,size:6}}function $u(i){var f=i.coordinates,o=Ra().flatten(f),s=o.vertices,l=o.dimensions,d=o.holes;return{indices:Ra()(s,d,l),vertices:s,size:l}}function Ua(i){var f=i.coordinates,o=ps(f,!0),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function Lc(i){var f=i.shape,o=Cl(f),s=o.positions,l=o.index;return{vertices:s,indices:l,size:3}}function Tl(i){var f=i.coordinates,o=[].concat((0,pi.Z)(f[0]),[0,0,1,f[1][0],f[0][1],0,1,1],(0,pi.Z)(f[1]),[0,1,0],(0,pi.Z)(f[0]),[0,0,1],(0,pi.Z)(f[1]),[0,1,0,f[0][0],f[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function Ou(i){for(var f=30,o=i.coordinates,s=[],l=[],d=function(P){s.push(P,1,P,o[0][0],o[0][1],o[1][0],o[1][1],P,-1,P,o[0][0],o[0][1],o[1][0],o[1][1]),P!==f-1&&l.push.apply(l,(0,pi.Z)([0,1,2,1,3,2].map(function(D){return P*2+D})))},y=0;y<f;y++)d(y);return{vertices:s,indices:l,size:7}}function ul(i){var f=i.coordinates;f.length===2&&f.push(0);var o=i.size,s=Ui(-1,1),l=Ui(1,1),d=Ui(-1,-1),y=Ui(1,-1),T=[].concat((0,pi.Z)(f),(0,pi.Z)(s),(0,pi.Z)(f),(0,pi.Z)(d),(0,pi.Z)(f),(0,pi.Z)(y),(0,pi.Z)(f),(0,pi.Z)(l)),P=[0,1,2,3,0,2];return{vertices:T,indices:P,size:5}}function Hl(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Gl&&Gl[i])return Gl[i];var o=lu[i]?lu[i]():lu.cylinder(),s=ps([o],f);return Gl[i]=s,s}function Ju(i,f){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(i.length/o*3),d,y,T,P=vec3.create(),D=vec3.create(),Q=vec3.create(),X=0,le=f.length;X<le;X+=3){d=f[X+0]*3,y=f[X+1]*3,T=f[X+2]*3;var Ue=[i[d],i[d+1]],tt=[i[y],i[y+1]],Ot=[i[T],i[T+1]];s&&(Ue=lngLatToMeters(Ue),tt=lngLatToMeters(tt),Ot=lngLatToMeters(Ot));var xr=Ue,Tr=_slicedToArray(xr,2),jr=Tr[0],dn=Tr[1],bn=vec3.fromValues(jr,dn,i[d+2]),Vn=tt,Mi=_slicedToArray(Vn,2),ti=Mi[0],ra=Mi[1],Ia=vec3.fromValues(ti,ra,i[y+2]),Fa=Ot,gi=_slicedToArray(Fa,2),wa=gi[0],oo=gi[1],Yu=vec3.fromValues(wa,oo,i[T+2]);vec3.sub(P,Yu,Ia),vec3.sub(D,bn,Ia),vec3.cross(Q,P,D),l[d]+=P[0],l[d+1]+=P[1],l[d+2]+=P[2],l[y]+=P[0],l[y+1]+=P[1],l[y+2]+=P[2],l[T]+=P[0],l[T+1]+=P[1],l[T+2]+=P[2]}return Is(l),l}function Is(i){for(var f=0,o=i.length;f<o;f+=3){var s=vec3.fromValues(i[f],i[f+1],i[f+2]),l=vec3.create();vec3.normalize(l,s),i.set(l,f)}}function Al(i){var f=i[0][0],o=i[0][i[0].length-1];return f[0]===o[0]&&f[1]===o[1]}function Cl(i){var f=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=lu[i]?lu[i]():lu.circle(),s=f.indexOf(i)===-1?Us([o]):wl([o]);return s}function Ui(i,f){var o=(i+1)/2,s=(f+1)/2;return[o,s]}function dc(i){var f=gf();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function gf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Wl=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Jc=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Rc=function(i){(0,ne.Z)(o,i);var f=dc(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,T=l.baseColor,P=T===void 0?"rgb(16,16,16)":T,D=l.brightColor,Q=D===void 0?"rgb(255,176,38)":D,X=l.windowColor,le=X===void 0?"rgb(30,60,89)":X,Ue=l.time,tt=Ue===void 0?0:Ue;return{u_opacity:y,u_baseColor:(0,Me.CI)(P),u_brightColor:(0,Me.CI)(Q),u_windowColor:(0,Me.CI)(le),u_time:this.layer.getLayerAnimateTime()||tt}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Jc,fragmentShader:Wl,triangulation:Ua})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,T,P,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.size,Q=D===void 0?10:D;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,T,P){var D=d.size;return[T[3],T[4]]}}})}}]),o}(Ca);function Xl(i){var f=Yl();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Yl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ll=function(i){(0,ne.Z)(o,i);var f=Xl(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="PolygonLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Rc(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(xs);function Lu(i){var f=Pl();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var cl=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,cu=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Dc=function(i){(0,ne.Z)(o,i);var f=Lu(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:cl,fragmentShader:cu,triangulation:Lc,depth:{enable:!1},primitive:w.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),o}(Ca);function Ml(i){var f=$s();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function $s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qc=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,yf=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qc=function(i){(0,ne.Z)(o,i);var f=Ml(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:y||1,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Qc,fragmentShader:yf,triangulation:Oc,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.size;return Array.isArray(D)?[D[0]]:[D]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,T,P,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),o}(Ca),ba=x(85975);function Il(i,f){for(var o=[],s=[],l=[],d=i+1,y=f+1,T=i/2,P=f/2,D=0;D<y;D++)for(var Q=D-P,X=0;X<d;X++){var le=X-T;s.push(le/T,-Q/P,0),l.push(X/i),l.push(1-D/f)}for(var Ue=0;Ue<f;Ue++)for(var tt=0;tt<i;tt++){var Ot=tt+d*Ue,xr=tt+d*(Ue+1),Tr=tt+1+d*(Ue+1),jr=tt+1+d*Ue;o.push(Ot,xr,jr),o.push(xr,Tr,jr)}return{vertices:s,indices:o,uvs:l}}var Ol,Ru,fl;function vc(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Du(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?vc(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):vc(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function kc(i){var f=ef();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var tf=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Ll=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,zc=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Fc=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,Nc=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,hl=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Bc=(Ol=(0,H.b2)(),Ol(Ru=(fl=function(i){(0,ne.Z)(o,i);var f=kc(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.colorTexture=void 0,s.heatmapFramerBuffer=void 0,s.intensityModel=void 0,s.colorModel=void 0,s.shapeType=void 0,s}return(0,ce.Z)(o,[{key:"render",value:function(){var l=this,d=this.rendererService,y=d.clear,T=d.useFramebuffer;T(this.heatmapFramerBuffer,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,y=d.createFramebuffer,T=d.clear,P=d.getViewportSize,D=d.createTexture2D,Q=d.useFramebuffer,X=this.styleAttributeService.getLayerStyleAttribute("shape"),le=(X==null||(l=X.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=le,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=le==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Ue=this.layer.getLayerConfig(),tt=Ue.rampColors,Ot=(0,Me.Cl)(tt),xr=P(),Tr=xr.width,jr=xr.height;return this.heatmapFramerBuffer=y({color:D({width:Math.floor(Tr/4),height:Math.floor(jr/4),wrapS:w.gl.CLAMP_TO_EDGE,wrapT:w.gl.CLAMP_TO_EDGE,min:w.gl.LINEAR,mag:w.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:w.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,T,P){return[T[3],T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.size,Q=D===void 0?1:D;return[Q]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:Nc,fragmentShader:Fc,triangulation:ul,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:w.gl.ONE,srcAlpha:1,dstRGB:w.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:hl,fs:zc});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,y=l.fs,T=l.uniforms,P=this.rendererService,D=P.createAttribute,Q=P.createElements,X=P.createBuffer,le=P.createModel;return le({vs:d,fs:y,attributes:{a_Position:D({buffer:X({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:w.gl.FLOAT}),size:3}),a_Uv:D({buffer:X({data:[0,1,1,1,0,0,1,0],type:w.gl.FLOAT}),size:2})},uniforms:Du({},T),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Q({data:[0,2,1,2,3,1],type:w.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.intensity,T=y===void 0?10:y,P=l.radius,D=P===void 0?5:P;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:D,u_intensity:T}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=ba.create();ba.invert(y,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,pi.Z)(y)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),y=d.width,T=d.height,P=Il(y/4,T/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Ll,fs:tf});var D=this.shaderModuleService.getModule("heatmap3dColor"),Q=D.vs,X=D.fs,le=D.uniforms,Ue=this.rendererService,tt=Ue.createAttribute,Ot=Ue.createElements,xr=Ue.createBuffer,Tr=Ue.createModel;return Tr({vs:Q,fs:X,attributes:{a_Position:tt({buffer:xr({data:P.vertices,type:w.gl.FLOAT}),size:3}),a_Uv:tt({buffer:xr({data:P.uvs,type:w.gl.FLOAT}),size:2})},primitive:w.gl.TRIANGLES,uniforms:Du({},le),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:w.gl.SRC_ALPHA,srcAlpha:1,dstRGB:w.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ot({data:P.indices,type:w.gl.UNSIGNED_INT,count:P.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),y=d.rampColors,T=(0,Me.Cl)(y);this.colorTexture=l({data:new Uint8Array(T.data),width:T.width,height:T.height,wrapS:w.gl.CLAMP_TO_EDGE,wrapT:w.gl.CLAMP_TO_EDGE,min:w.gl.NEAREST,mag:w.gl.NEAREST,flipY:!1})}}]),o}(Ca),fl))||Ru);function ku(i){var f=Ma();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Ma(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Kl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Ka=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Qu=function(i){(0,ne.Z)(o,i);var f=ku(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,T=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Ka,fragmentShader:Kl,triangulation:Lc,depth:{enable:!1},primitive:w.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var T=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[T[0],T[1],0]}}})}}]),o}(Ca),Fi={heatmap:Bc,heatmap3d:Bc,grid:Dc,grid3d:qc,hexagon:Qu},Ta=Fi;function js(i){var f=$l();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function $l(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Rl=function(i){(0,ne.Z)(o,i);var f=js(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="HeatMapLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ta[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(y){return y.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=this.getLayerConfig(),T=y.shape3d,P=this.getSource(),D=P.data.type,Q=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return Q==="heatmap"||Q==="heatmap3d"?"heatmap":D==="hexagon"?(T==null?void 0:T.indexOf(Q))===-1?"hexagon":"grid3d":D==="grid"?(T==null?void 0:T.indexOf(Q))===-1?"grid":"grid3d":"heatmap"}}]),o}(xs);function Jl(i){var f=_f();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function _f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var xf=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,Dl=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,zu=function(i){(0,ne.Z)(o,i);var f=Jl(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),y=this.rendererService.createTexture2D;return this.texture=y({height:0,width:0}),d.data.images.then(function(T){l.texture=y({data:T[0],width:T[0].width,height:T[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:Dl,fragmentShader:xf,triangulation:Tl,primitive:w.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,T,P){return[T[3],T[4]]}}})}}]),o}(Ca),Fu={image:zu},no=Fu;function ds(i){var f=pl();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var fo=function(i){(0,ne.Z)(o,i);var f=ds(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="ImageLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new no[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(xs);function Tn(i){var f=Zs();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Zs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var mc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,kl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,fu={solid:0,dash:1},Vs=function(i){(0,ne.Z)(o,i);var f=Tn(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,T=l.targetColor,P=l.textureBlend,D=P===void 0?"normal":P,Q=l.lineType,X=Q===void 0?"solid":Q,le=l.dashArray,Ue=le===void 0?[10,5]:le,tt=l.forward,Ot=tt===void 0?!0:tt,xr=l.lineTexture,Tr=xr===void 0?!1:xr,jr=l.iconStep,dn=jr===void 0?100:jr;Ue.length===2&&Ue.push(0,0);var bn=0,Vn=[0,0,0,0],Mi=[0,0,0,0];return y&&T&&(Vn=(0,Me.CI)(y),Mi=(0,Me.CI)(T),bn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:fu[X||"solid"],u_dash_array:Ue,u_blur:.9,u_lineDir:Ot?1:-1,u_texture:this.texture,u_line_texture:Tr?1:0,u_icon_step:dn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:bn,u_sourceColor:Vn,u_targetColor:Mi}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:kl,fragmentShader:mc,triangulation:Ou,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.size,X=Q===void 0?1:Q;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(y,T,P,D){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,T,P,D){var Q=l.iconService.getIconMap(),X=y.texture,le=Q[X]||{x:0,y:0},Ue=le.x,tt=le.y;return[Ue,tt]}}})}}]),o}(Ca);function dl(i){var f=Jr();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Jr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var gc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/u_opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    

    // gl_FragColor = filterColor(gl_FragColor + pattern);

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Ql=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Nu={solid:0,dash:1},Gs=function(i){(0,ne.Z)(o,i);var f=dl(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,T=l.targetColor,P=l.textureBlend,D=P===void 0?"normal":P,Q=l.lineType,X=Q===void 0?"solid":Q,le=l.dashArray,Ue=le===void 0?[10,5]:le,tt=l.lineTexture,Ot=tt===void 0?!1:tt,xr=l.iconStep,Tr=xr===void 0?100:xr;Ue.length===2&&Ue.push(0,0);var jr=0,dn=[0,0,0,0],bn=[0,0,0,0];return y&&T&&(dn=(0,Me.CI)(y),bn=(0,Me.CI)(T),jr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:Nu[X]||0,u_dash_array:Ue,u_texture:this.texture,u_line_texture:Ot?1:0,u_icon_step:Tr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:dn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Ql,fragmentShader:gc,triangulation:Ou,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.size,X=Q===void 0?1:Q;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(y,T,P,D){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,T,P,D){var Q=l.iconService.getIconMap(),X=y.texture,le=Q[X]||{x:0,y:0},Ue=le.x,tt=le.y;return[Ue,tt]}}})}}]),o}(Ca);function bs(i){var f=vl();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function vl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var yc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= u_opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
      // float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      // alpha = clamp(alpha, 0.1, 1.0);
      // if(alpha < 0.01) alpha = 0.0;
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    // float u = fract(arcRadio * count);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = filterColor(gl_FragColor + pattern);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Hs=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,qu={solid:0,dash:1},Uc=function(i){(0,ne.Z)(o,i);var f=bs(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,T=l.targetColor,P=l.textureBlend,D=P===void 0?"normal":P,Q=l.lineType,X=Q===void 0?"solid":Q,le=l.dashArray,Ue=le===void 0?[10,5]:le,tt=l.lineTexture,Ot=tt===void 0?!1:tt,xr=l.iconStep,Tr=xr===void 0?100:xr;Ue.length===2&&Ue.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var jr=0,dn=[0,0,0,0],bn=[0,0,0,0];return y&&T&&(dn=(0,Me.CI)(y),bn=(0,Me.CI)(T),jr=1),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,segmentNumber:30,u_line_type:qu[X]||0,u_dash_array:Ue,u_texture:this.texture,u_line_texture:Ot?1:0,u_icon_step:Tr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:dn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Hs,fragmentShader:yc,triangulation:Ou,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.size,X=Q===void 0?1:Q;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:w.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(y,T,P,D){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,T,P,D){var Q=l.iconService.getIconMap(),X=y.texture,le=Q[X]||{x:0,y:0},Ue=le.x,tt=le.y;return[Ue,tt]}}})}}]),o}(Ca);function ql(i){var f=rf();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var jc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
varying float v_strokeWidth;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= u_opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= u_opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // float r = max(smoothstep( 0.95, 1.0, v_strokeWidth/(v_a*2.0)), v_strokeWidth/(v_a*2.0));
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,_u=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;
// varying float v_strokeWidth;

void main() {
  
  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);
  // v_strokeWidth = project_pixel(2.0);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 10.0, 1.0)); // \u989D\u5916\u9664 10.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Js={solid:0,dash:1},Di=function(i){(0,ne.Z)(o,i);var f=ql(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,T=l.targetColor,P=l.textureBlend,D=P===void 0?"normal":P,Q=l.lineType,X=Q===void 0?"solid":Q,le=l.dashArray,Ue=le===void 0?[10,5,0,0]:le,tt=l.lineTexture,Ot=tt===void 0?!1:tt,xr=l.iconStep,Tr=xr===void 0?100:xr;Ue.length===2&&Ue.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var jr=0,dn=[0,0,0,0],bn=[0,0,0,0];return y&&T&&(dn=(0,Me.CI)(y),bn=(0,Me.CI)(T),jr=1),{u_opacity:d===void 0?1:d,u_textureBlend:D==="normal"?0:1,u_line_type:Js[X],u_dash_array:Ue,u_texture:this.texture,u_line_texture:Ot?1:0,u_icon_step:Tr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:jr,u_sourceColor:dn,u_targetColor:bn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:_u,fragmentShader:jc,triangulation:yu,primitive:w.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.lineType,T=y===void 0?"solid":y;this.styleAttributeService.registerStyleAttribute({name:"distance",type:w.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(D,Q,X,le){return[X[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:w.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(D,Q,X,le){return[X[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(D,Q,X,le){var Ue=D.size,tt=Ue===void 0?1:Ue;return Array.isArray(tt)?[tt[0],tt[1]]:[tt,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(D,Q,X,le,Ue){return Ue}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:w.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(D,Q,X,le){return[X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(D,Q,X,le){var Ue=l.iconService.getIconMap(),tt=D.texture,Ot=Ue[tt]||{x:0,y:0},xr=Ot.x,Tr=Ot.y;return[xr,Tr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,y){if(l instanceof HTMLImageElement){d(l);return}var T=new Image;T.crossOrigin="anonymous",T.onload=function(){d(T)},T.onerror=function(){y(new Error("Could not load image at "+l))},T.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(Ca),Bu={arc:Vs,arc3d:Gs,greatcircle:Uc,line:Di},os=Bu;function Io(i){var f=xu();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function xu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Qs=function(i){(0,ne.Z)(o,i);var f=Io(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="LineLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new os[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y||"line"}}]),o}(xs);function qs(i){var f=ss();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function ss(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var zl=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Zn=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Mn=function(i){(0,ne.Z)(o,i);var f=qs(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.offsets;return{u_opacity:d||1,u_offsets:y||[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Zn,fragmentShader:zl,triangulation:Oc,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,T,P){var D=d.size;if(D){var Q=[];return Array.isArray(D)&&(Q=D.length===2?[D[0],D[0],D[1]]:D),Array.isArray(D)||(Q=[D]),Q}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,T,P,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y){var T=Mo(d.coordinates);return[T[0],T[1],0]}}})}}]),o}(Ca);function ec(i){var f=zo();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var To=`#define Animate 0.0

uniform float u_blur : 0;
uniform float u_opacity : 1;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  // gl_FragColor = v_color * color_t;
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Fo=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_stroke_width : 2;
uniform vec2 u_offsets;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,bu=function(i){(0,ne.Z)(o,i);var f=ec(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,T=l.stroke,P=T===void 0?"rgb(0,0,0,0)":T,D=l.strokeWidth,Q=D===void 0?1:D,X=l.strokeOpacity,le=X===void 0?1:X,Ue=l.offsets,tt=Ue===void 0?[0,0]:Ue;return{u_opacity:y,u_stroke_width:Q,u_stroke_color:(0,Me.CI)(P),u_stroke_opacity:le,u_offsets:[-tt[0],tt[1]]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ic)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:Fo,fragmentShader:To,triangulation:Ic,depth:{enable:!1},blend:this.getBlend()})]}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:w.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,T,P,D){var Q=[1,1,-1,1,-1,-1,1,-1],X=D%4*2;return[Q[X],Q[X+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.size,X=Q===void 0?5:Q;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:w.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.shape,X=Q===void 0?2:Q,le=l.layer.getLayerConfig().shape2d,Ue=le.indexOf(X);return[Ue]}}})}}]),o}(Ca);function Su(i){var f=tc();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function tc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ea=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,_o=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Zc=function(i){(0,ne.Z)(o,i);var f=Su(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:_o,fragmentShader:ea,triangulation:ro,primitive:w.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.size;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,T,P,D){var Q=l.fontService.mapping,X=y.shape,le=l.fontService.getGlyph(X),Ue=Q[le],tt=Ue.x,Ot=Ue.y;return[tt,Ot]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:w.gl.LINEAR,min:w.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.fontWeight,T=y===void 0?"normal":y,P=d.fontFamily,D=P===void 0?"sans-serif":P,Q=this.layer.getEncodedData(),X=[];Q.forEach(function(le){var Ue=le.shape,tt=Ue===void 0?"":Ue;tt=tt.toString();var Ot=l.fontService.getGlyph(tt);X.indexOf(Ot)===-1&&X.push(Ot)}),this.fontService.setFontOptions({characterSet:X,fontWeight:T,fontFamily:D,fontSize:48})}}]),o}(Ca);function Uu(i){var f=_c();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Eu=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_stroke_width : 1;
uniform vec4 u_stroke_color : [1, 1, 1, 1];
uniform float u_stroke_opacity : 1;
uniform float u_opacity : 1;

varying float v_size;
#pragma include "picking"
void main(){
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Os=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

#pragma include "projection"
#pragma include "picking"

void main() {
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
   vec2 offset = project_pixel(u_offsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Fl=function(i){(0,ne.Z)(o,i);var f=Uu(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.updateTexture=function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:w.gl.NEAREST,min:w.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})},s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.offsets,T=y===void 0?[0,0]:y;return this.rendererService.getDirty()&&this.texture.bind(),{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_offsets:[-T[0],T[1]]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){this.texture&&this.texture.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Os,fragmentShader:Eu,triangulation:ro,primitive:w.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(y,T,P,D){var Q=y.size,X=Q===void 0?5:Q;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(y,T,P,D){var Q=l.iconService.getIconMap(),X=y.shape,le=Q[X]||{x:0,y:0},Ue=le.x,tt=le.y;return[Ue,tt]}}})}}]),o}(Ca);function wu(i){var f=Vc();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Vc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Nl=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;

#pragma include "picking"
void main() {
  gl_FragColor = v_color;
  gl_FragColor.a =gl_FragColor.a * u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,rc=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform vec2 u_offsets;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  // vec2 offset = project_pixel(u_offsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Gc(i){var f=i.coordinates;return{vertices:(0,pi.Z)(f),indices:[0],size:f.length}}var el=function(i){(0,ne.Z)(o,i);var f=wu(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,T=l.stroke,P=T===void 0?"rgb(0,0,0,0)":T,D=l.strokeWidth,Q=D===void 0?1:D,X=l.offsets,le=X===void 0?[0,0]:X;return{u_opacity:y,u_stroke_width:Q,u_stroke_color:(0,Me.CI)(P),u_offsets:[-le[0],le[1]]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:rc,fragmentShader:Nl,triangulation:Gc,depth:{enable:!1},primitive:w.gl.POINTS,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.size,Q=D===void 0?1:D;return Array.isArray(Q)?[Q[0]]:[Q]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:w.BlendType.additive}}}]),o}(Ca),eu=x(98333);function xc(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=tl(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,T;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,T=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw T}}}}function tl(i,f){if(!!i){if(typeof i=="string")return ju(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ju(i,f)}}function ju(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}var nc=function(){function i(f,o,s){(0,Y.Z)(this,i),this.boxCells=[],this.xCellCount=void 0,this.yCellCount=void 0,this.boxKeys=void 0,this.bboxes=void 0,this.width=void 0,this.height=void 0,this.xScale=void 0,this.yScale=void 0,this.boxUid=void 0;var l=this.boxCells;this.xCellCount=Math.ceil(f/s),this.yCellCount=Math.ceil(o/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=f,this.height=o,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,ce.Z)(i,[{key:"insert",value:function(o,s,l,d,y){this.forEachCell(s,l,d,y,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y)}},{key:"query",value:function(o,s,l,d,y){return this.queryHitTest(o,s,l,d,!1,y)}},{key:"hitTest",value:function(o,s,l,d,y){return this.queryHitTest(o,s,l,d,!0,y)}},{key:"insertBoxCell",value:function(o,s,l,d,y,T){this.boxCells[y].push(T)}},{key:"queryHitTest",value:function(o,s,l,d,y,T){if(l<0||o>this.width||d<0||s>this.height)return y?!1:[];var P=[];if(o<=0&&s<=0&&this.width<=l&&this.height<=d){if(y)return!0;for(var D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[D*4],y1:this.bboxes[D*4+1],x2:this.bboxes[D*4+2],y2:this.bboxes[D*4+3]});return T?P.filter(T):P}var Q={hitTest:y,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,l,d,this.queryCell,P,Q,T),y?P.length>0:P}},{key:"queryCell",value:function(o,s,l,d,y,T,P,D){var Q=P.seenUids,X=this.boxCells[y];if(X!==null){var le=this.bboxes,Ue=xc(X),tt;try{for(Ue.s();!(tt=Ue.n()).done;){var Ot=tt.value;if(!Q.box[Ot]){Q.box[Ot]=!0;var xr=Ot*4;if(o<=le[xr+2]&&s<=le[xr+3]&&l>=le[xr+0]&&d>=le[xr+1]&&(!D||D(this.boxKeys[Ot]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Ot],x1:le[xr],y1:le[xr+1],x2:le[xr+2],y2:le[xr+3]})}}}}catch(Tr){Ue.e(Tr)}finally{Ue.f()}}return!1}},{key:"forEachCell",value:function(o,s,l,d,y,T,P,D){for(var Q=this.convertToXCellCoord(o),X=this.convertToYCellCoord(s),le=this.convertToXCellCoord(l),Ue=this.convertToYCellCoord(d),tt=Q;tt<=le;tt++)for(var Ot=X;Ot<=Ue;Ot++){var xr=this.xCellCount*Ot+tt;if(y.call(this,o,s,l,d,xr,T,P,D))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),i}(),Tu=nc,hu=function(){function i(f,o){(0,Y.Z)(this,i),this.width=void 0,this.height=void 0,this.grid=void 0,this.viewportPadding=100,this.screenRightBoundary=void 0,this.screenBottomBoundary=void 0,this.gridRightBoundary=void 0,this.gridBottomBoundary=void 0,this.width=f,this.height=o,this.viewportPadding=Math.max(f,o),this.grid=new Tu(f+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=f+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=f+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,ce.Z)(i,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,y=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,y)||this.grid.hitTest(s,l,d,y)?{box:[]}:{box:[s,l,d,y]}}},{key:"insertCollisionBox",value:function(o,s){var l={featureIndex:s};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,l){var d=eu.al(s,l,0,1),y=eu.Ue(),T=ba.fromValues.apply(ba,(0,pi.Z)(o));return eu.fF(y,d,T),{x:(y[0]/y[3]+1)/2*this.width+this.viewportPadding,y:(-y[1]/y[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,l,d){return l>=0&&o<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),i}();function Au(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=ic(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,T;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,T=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw T}}}}function ic(i,f){if(!!i){if(typeof i=="string")return bc(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return bc(i,f)}}function bc(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function ac(i){var f=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":f=1;break;case"left":case"top-left":case"bottom-left":f=0;break;default:f=.5}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:f,verticalAlign:o}}function n(i,f,o,s,l){if(!!l){var d=i[s],y=d.glyph;if(y)for(var T=f[y].advance*d.scale,P=(i[s].x+T)*l,D=o;D<=s;D++)i[D].x-=P}}function u(i,f,o,s,l,d,y){var T=(f-o)*l,P=(-s*y+.5)*d,D=Au(i),Q;try{for(D.s();!(Q=D.n()).done;){var X=Q.value;X.x+=T,X.y+=P}}catch(le){D.e(le)}finally{D.f()}}function a(i,f,o,s,l,d,y){var T=-8,P=0,D=T,Q=0,X=i.positionedGlyphs,le=d==="right"?1:d==="left"?0:.5,Ue=X.length;o.forEach(function(jr){if(jr.split("").forEach(function(bn){var Vn=f[bn],Mi=0;Vn&&(X.push({glyph:bn,x:P,y:D+Mi,vertical:!1,scale:1,metrics:Vn}),P+=Vn.advance+y)}),X.length!==Ue){var dn=P-y;Q=Math.max(dn,Q),n(X,f,Ue,X.length-1,le)}P=0,D+=s});var tt=ac(l),Ot=tt.horizontalAlign,xr=tt.verticalAlign;u(X,le,Ot,xr,Q,s,o.length);var Tr=D-T;i.top+=-xr*Tr,i.bottom=i.top+Tr,i.left+=-Ot*Q,i.right=i.left+Q}function h(i,f,o,s,l,d,y){var T=-8,P=0,D=T,Q=0,X=i.positionedGlyphs,le=d==="right"?1:d==="left"?0:.5,Ue=X.length;o.forEach(function(jr){var dn=f[jr],bn=0;if(dn&&(X.push({glyph:jr,x:P,y:D+bn,vertical:!1,scale:1,metrics:dn}),P+=dn.advance+y),X.length!==Ue){var Vn=P-y;Q=Math.max(Vn,Q),n(X,f,Ue,X.length-1,le)}P=0,D+=s});var tt=ac(l),Ot=tt.horizontalAlign,xr=tt.verticalAlign;u(X,le,Ot,xr,Q,s,o.length);var Tr=D-T;i.top+=-xr*Tr,i.bottom=i.top+Tr,i.left+=-Ot*Q,i.right=i.left+Q}function g(i,f,o,s,l,d){var y=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],T=arguments.length>7?arguments[7]:void 0,P=i.split(`
`),D=[],Q={positionedGlyphs:D,top:y[1],bottom:y[1],left:y[0],right:y[0],lineCount:P.length,text:i};return T?h(Q,f,P,o,s,l,d):a(Q,f,P,o,s,l,d),D.length?Q:!1}function b(i){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=i.positionedGlyphs,l=s===void 0?[]:s,d=[],y=Au(l),T;try{for(y.s();!(T=y.n()).done;){var P=T.value,D=P.metrics,Q=4,X=D.advance*P.scale/2,le=o?[P.x+X,P.y]:[0,0],Ue=o?[0,0]:[P.x+X+f[0],P.y+f[1]],tt=(0-Q)*P.scale-X+Ue[0],Ot=(0-Q)*P.scale+Ue[1],xr=tt+D.width*P.scale,Tr=Ot+D.height*P.scale,jr={x:tt,y:Ot},dn={x:xr,y:Ot},bn={x:tt,y:Tr},Vn={x:xr,y:Tr};d.push({tl:jr,tr:dn,bl:bn,br:Vn,tex:D,glyphOffset:le})}}catch(Mi){y.e(Mi)}finally{y.f()}return d}function A(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=L(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,T;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,T=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw T}}}}function L(i,f){if(!!i){if(typeof i=="string")return V(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return V(i,f)}}function V(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function ee(i){var f=de();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function de(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var _e=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform float u_stroke_opacity: 1.0;
uniform vec4 u_stroke : [0, 0, 0, 1];
uniform float u_strokeWidth : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

#pragma include "picking"
void main() {
  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  lowp float buff = (6.0 - u_strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke.rgb, u_stroke.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,xe=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Xe(i){var f=this,o=i.id,s=[],l=[];if(!f.glyphInfoMap||!f.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=f.glyphInfoMap[o].centroid,y=d.length===2?[d[0],d[1],0]:d;return f.glyphInfoMap[o].glyphQuads.forEach(function(T,P){s.push.apply(s,(0,pi.Z)(y).concat([T.tex.x,T.tex.y+T.tex.height,T.tl.x,T.tl.y],(0,pi.Z)(y),[T.tex.x+T.tex.width,T.tex.y+T.tex.height,T.tr.x,T.tr.y],(0,pi.Z)(y),[T.tex.x+T.tex.width,T.tex.y,T.br.x,T.br.y],(0,pi.Z)(y),[T.tex.x,T.tex.y,T.bl.x,T.bl.y])),l.push(0+P*4,1+P*4,2+P*4,2+P*4,3+P*4,0+P*4)}),{vertices:s,indices:l,size:7}}var Ge=function(i){(0,ne.Z)(o,i);var f=ee(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.glyphInfo=void 0,s.glyphInfoMap={},s.texture=void 0,s.currentZoom=-1,s.extent=void 0,s.textureHeight=0,s.textCount=0,s.preTextStyle={},s.buildModels=function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:xe,fragmentShader:_e,triangulation:Xe.bind((0,Ht.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]},s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,T=l.stroke,P=T===void 0?"#fff":T,D=l.strokeWidth,Q=D===void 0?0:D,X=l.strokeOpacity,le=X===void 0?1:X,Ue=l.textAnchor,tt=Ue===void 0?"center":Ue,Ot=l.textAllowOverlap,xr=Ot===void 0?!1:Ot,Tr=l.halo,jr=Tr===void 0?.5:Tr,dn=l.gamma,bn=dn===void 0?2:dn,Vn=this.fontService,Mi=Vn.canvas,ti=Vn.mapping;return Object.keys(ti).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(ti).length),this.preTextStyle={textAnchor:tt,textAllowOverlap:xr},{u_opacity:y,u_stroke_opacity:le,u_sdf_map:this.texture,u_stroke:(0,Me.CI)(P),u_halo_blur:jr,u_gamma_scale:bn,u_sdf_map_size:[Mi.width,Mi.height],u_strokeWidth:Q}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,y=d===void 0?"center":d,T=l.textAllowOverlap,P=T===void 0?!0:T;return this.preTextStyle={textAnchor:y,textAllowOverlap:P},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,y=d===void 0?!1:d,T=this.mapService.getZoom(),P=this.mapService.getBounds(),D=(0,Me.oO)(this.extent,P);return!y&&(Math.abs(this.currentZoom-T)>1||!D)||y!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:w.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.rotate,Q=D===void 0?0:D;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:w.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,T,P){return[T[5],T[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.size,Q=D===void 0?12:D;return Array.isArray(Q)?[Q[0]]:[Q]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:w.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,T,P){return[T[3],T[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Me.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,T=l.fontFamily,P=T===void 0?"sans-serif":T,D=this.layer.getEncodedData(),Q=[];D.forEach(function(X){var le=X.shape,Ue=le===void 0?"":le;Ue=Ue.toString();var tt=A(Ue),Ot;try{for(tt.s();!(Ot=tt.n()).done;){var xr=Ot.value;Q.indexOf(xr)===-1&&Q.push(xr)}}catch(Tr){tt.e(Tr)}finally{tt.f()}}),this.fontService.setFontOptions({characterSet:Q,fontWeight:y,fontFamily:P,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,T=l.fontFamily,P=T===void 0?"sans-serif":T,D=this.layer.getEncodedData(),Q=[];D.forEach(function(X){var le=X.shape,Ue=le===void 0?"":le;Ue=Ue.toString(),Q.indexOf(Ue)===-1&&Q.push(Ue)}),this.fontService.setFontOptions({characterSet:Q,fontWeight:y,fontFamily:P,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,y=this.fontService.mapping,T=this.layer.getLayerConfig(),P=T.spacing,D=P===void 0?2:P,Q=T.textAnchor,X=Q===void 0?"center":Q,le=T.textOffset,Ue=this.layer.getEncodedData();this.glyphInfo=Ue.map(function(tt){var Ot=tt.shape,xr=Ot===void 0?"":Ot,Tr=tt.id,jr=tt.size,dn=jr===void 0?1:jr,bn=g(xr.toString(),y,dn,X,"center",D,le,l),Vn=b(bn,le,!1);return tt.shaping=bn,tt.glyphQuads=Vn,tt.centroid=Mo(tt.coordinates),tt.originCentroid=tt.version==="GAODE2.x"?Mo(tt.originCoordinates):tt.originCentroid=tt.centroid,d.glyphInfoMap[Tr]={shaping:bn,glyphQuads:Vn,centroid:Mo(tt.coordinates)},tt})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.padding,T=y===void 0?[4,4]:y,P=d.textAllowOverlap,D=P===void 0?!1:P;if(!D){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var Q=this.rendererService.getViewportSize(),X=Q.width,le=Q.height,Ue=new hu(X,le),tt=this.glyphInfo.filter(function(Ot){var xr=Ot.shaping,Tr=Ot.id,jr=Tr===void 0?0:Tr,dn=Ot.version==="GAODE2.x"?Ot.originCentroid:Ot.centroid,bn=Ot.size,Vn=bn/24,Mi=l.mapService.lngLatToContainer(dn),ti=Ue.placeCollisionBox({x1:xr.left*Vn-T[0],x2:xr.right*Vn+T[0],y1:xr.top*Vn-T[1],y2:xr.bottom*Vn+T[1],anchorPointX:Mi.x,anchorPointY:Mi.y}),ra=ti.box;return ra&&ra.length?(Ue.insertCollisionBox(ra,jr),!0):!1});tt.forEach(function(Ot){l.glyphInfoMap[Ot.id]=Ot})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,y=d===void 0?!1:d;y?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(y)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:w.gl.LINEAR,min:w.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:xe,fragmentShader:_e,triangulation:Xe.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(Ca),nt={fill:bu,image:Fl,normal:el,extrude:Mn,text:Ge,icon:Zc},ke=nt;function rt(i){var f=ht();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function ht(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Bt=function(i){(0,ne.Z)(o,i);var f=rt(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="PointLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ke[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,T=d.shape3d,P=this.iconService.getIconMap(),D=l.find(function(X){return X.hasOwnProperty("shape")});if(D){var Q=D.shape;return Q==="dot"?"normal":(y==null?void 0:y.indexOf(Q))!==-1?"fill":(T==null?void 0:T.indexOf(Q))!==-1?"extrude":P.hasOwnProperty(Q)?"image":this.fontService.getGlyph(Q)!==""?"icon":"text"}else return"normal"}}]),o}(xs);function or(i){var f=rr();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function rr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var lr=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Lr=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,rn=function(i){(0,ne.Z)(o,i);var f=or(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;return{u_opacity:y}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Lr,fragmentShader:lr,triangulation:Ua})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(d,y,T,P,D){return D}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(d,y,T,P){var D=d.size,Q=D===void 0?10:D;return Array.isArray(Q)?[Q[0]]:[Q]}}})}}]),o}(Ca);function Yr(i){var f=_n();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function _n(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var Bn=`uniform float u_opacity: 1.0;
varying vec4 v_Color;

#pragma include "picking"

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Xn=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"
#pragma include "picking"

void main() {
  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Hn=function(i){(0,ne.Z)(o,i);var f=Yr(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;return{u_opacity:y}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Xn,fragmentShader:Bn,triangulation:$u,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(Ca),ta={fill:Hn,line:Di,extrude:rn,text:Ge,point_fill:bu,point_image:Fl,point_normal:el,point_extrude:Mn},xn=ta;function ii(i){var f=Si();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Si(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ri=function(i){(0,ne.Z)(o,i);var f=ii(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="PolygonLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new xn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y==="fill"?"fill":y==="extrude"?"extrude":y==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,T=d.shape3d,P=this.iconService.getIconMap(),D=l.find(function(X){return X.hasOwnProperty("shape")});if(D){var Q=D.shape;return Q==="dot"?"point_normal":(y==null?void 0:y.indexOf(Q))!==-1?"point_fill":(T==null?void 0:T.indexOf(Q))!==-1?"point_extrude":P.hasOwnProperty(Q)?"point_image":"text"}else return"fill"}}]),o}(xs);function ai(i){var f=wi();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function wi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ni=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Jn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,xo=function(i){(0,ne.Z)(o,i);var f=ai(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.texture=void 0,s.colorTexture=void 0,s}return(0,ce.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,T=l.clampLow,P=T===void 0?!0:T,D=l.clampHigh,Q=D===void 0?!0:D,X=l.noDataValue,le=X===void 0?-9999999:X,Ue=l.domain,tt=Ue===void 0?[0,1]:Ue;return this.updateColorTexure(),{u_opacity:y||1,u_texture:this.texture,u_domain:tt,u_clampLow:P,u_clampHigh:typeof Q!="undefined"?Q:P,u_noDataValue:le,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,y=l.data.dataArray[0];this.texture=d({data:y.data,width:y.width,height:y.height,format:w.gl.LUMINANCE,type:w.gl.FLOAT});var T=this.layer.getLayerConfig(),P=T.rampColors,D=(0,Me.Cl)(P);return this.colorTexture=d({data:D.data,width:D.width,height:D.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Jn,fragmentShader:ni,triangulation:Tl,primitive:w.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(d,y,T,P){return[T[3],T[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),y=d.rampColors,T=(0,Me.Cl)(y);this.colorTexture=l({data:T.data,width:T.width,height:T.height,flipY:!1})}}]),o}(Ca),ja={raster:xo,raster3d:xo},Xo=ja;function Oo(i){var f=Za();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Za(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}var ho=function(i){(0,ne.Z)(o,i);var f=Oo(o);function o(){var s;(0,Y.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=f.call.apply(f,[this].concat(d)),s.type="RasterLayer",s}return(0,ce.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Xo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(xs),Ss=x(50361),Yo=x.n(Ss),Zu,us,Ls,Rs,ml,gl,Ws,rl,Bl,tu,nl,ru;function io(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Vu(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?io(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):io(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Cu=(Zu=(0,H.b2)(),us=(0,H.f3)(w.vK.IGlobalConfigService),Ls=(0,H.f3)(w.vK.ILogService),Rs=(0,H.f3)(w.vK.IMapService),ml=(0,H.f3)(w.vK.IFontService),Zu(gl=(Ws=(ru=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"configService",rl,this),(0,Rn.Z)(this,"logger",Bl,this),(0,Rn.Z)(this,"mapService",tu,this),(0,Rn.Z)(this,"fontService",nl,this)}return(0,ce.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var y=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,D=y.filter(function(X){return X.needRemapping}),Q=P;T!=null&&T.needRemapping&&T!==null&&T!==void 0&&T.scale&&(Q=P.filter(function(X){return l.applyAttributeMapping(T,X)[0]})),D.length&&(T!=null&&T.needRemapping?(o.setEncodedData(l.mapping(y,Q)),T.needRemapping=!1):o.setEncodedData(l.mapping(D,Q,o.getEncodedData())),l.logger.debug("remapping finished"),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,D=P;T!=null&&T.scale&&(D=P.filter(function(Q){return l.applyAttributeMapping(T,Q)[0]})),o.setEncodedData(this.mapping(y,D))}},{key:"mapping",value:function(o,s,l){var d=this,y=s.map(function(T,P){var D=l?l[P]:{},Q=Vu({id:T._id,coordinates:T.coordinates},D);return o.filter(function(X){return X.scale!==void 0}).forEach(function(X){var le=d.applyAttributeMapping(X,T);X.needRemapping=!1,X.name==="color"&&(le=le.map(function(Ue){return(0,Me.CI)(Ue)})),Q[X.name]=Array.isArray(le)&&le.length===1?le[0]:le,X.name==="shape"&&(Q.shape=d.fontService.getIconFontKey(Q[X.name]))}),Q});return y.length>0&&this.mapService.version==="GAODE2.x"&&(typeof y[0].coordinates[0]=="number"?y.map(function(T){T.version="GAODE2.x",T.originCoordinates=Yo()(T.coordinates),T.coordinates=d.mapService.lngLatToCoord(T.coordinates)}):y.map(function(T){T.version="GAODE2.x",T.originCoordinates=Yo()(T.coordinates),T.coordinates=d.mapService.lngLatToCoords(T.coordinates)})),y}},{key:"applyAttributeMapping",value:function(o,s){var l;if(!o.scale)return[];var d=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],y=[];return d.forEach(function(T){var P,D=T.field;(s.hasOwnProperty(D)||((P=o.scale)===null||P===void 0?void 0:P.type)==="variable")&&y.push(s[D])}),o.mapping?o.mapping(y):[]}}]),i}(),ru),rl=(0,Dn.Z)(Ws.prototype,"configService",[us],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bl=(0,Dn.Z)(Ws.prototype,"logger",[Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu=(0,Dn.Z)(Ws.prototype,"mapService",[Rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nl=(0,Dn.Z)(Ws.prototype,"fontService",[ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ws))||gl),Es={},Ki={},Lo=function(f){return Ki[f]},po=function(f,o){Ki[f]=o},pu=function(f){return Es[f]},vs=function(f,o){Es[f]=o},du={},Gu={},Hu=34,Wu=10,nu=13;function Ul(i){return new Function("d","return {"+i.map(function(f,o){return JSON.stringify(f)+": d["+o+'] || ""'}).join(",")+"}")}function nf(i,f){var o=Ul(i);return function(s,l){return f(o(s),l,i)}}function Pu(i){var f=Object.create(null),o=[];return i.forEach(function(s){for(var l in s)l in f||o.push(f[l]=l)}),o}function va(i,f){var o=i+"",s=o.length;return s<f?new Array(f-s+1).join(0)+o:o}function Qf(i){return i<0?"-"+va(-i,6):i>9999?"+"+va(i,6):va(i,4)}function If(i){var f=i.getUTCHours(),o=i.getUTCMinutes(),s=i.getUTCSeconds(),l=i.getUTCMilliseconds();return isNaN(i)?"Invalid Date":Qf(i.getUTCFullYear(),4)+"-"+va(i.getUTCMonth()+1,2)+"-"+va(i.getUTCDate(),2)+(l?"T"+va(f,2)+":"+va(o,2)+":"+va(s,2)+"."+va(l,3)+"Z":s?"T"+va(f,2)+":"+va(o,2)+":"+va(s,2)+"Z":o||f?"T"+va(f,2)+":"+va(o,2)+"Z":"")}function Of(i){var f=new RegExp('["'+i+`
\r]`),o=i.charCodeAt(0);function s(X,le){var Ue,tt,Ot=l(X,function(xr,Tr){if(Ue)return Ue(xr,Tr-1);tt=xr,Ue=le?nf(xr,le):Ul(xr)});return Ot.columns=tt||[],Ot}function l(X,le){var Ue=[],tt=X.length,Ot=0,xr=0,Tr,jr=tt<=0,dn=!1;X.charCodeAt(tt-1)===Wu&&--tt,X.charCodeAt(tt-1)===nu&&--tt;function bn(){if(jr)return Gu;if(dn)return dn=!1,du;var Mi,ti=Ot,ra;if(X.charCodeAt(ti)===Hu){for(;Ot++<tt&&X.charCodeAt(Ot)!==Hu||X.charCodeAt(++Ot)===Hu;);return(Mi=Ot)>=tt?jr=!0:(ra=X.charCodeAt(Ot++))===Wu?dn=!0:ra===nu&&(dn=!0,X.charCodeAt(Ot)===Wu&&++Ot),X.slice(ti+1,Mi-1).replace(/""/g,'"')}for(;Ot<tt;){if((ra=X.charCodeAt(Mi=Ot++))===Wu)dn=!0;else if(ra===nu)dn=!0,X.charCodeAt(Ot)===Wu&&++Ot;else if(ra!==o)continue;return X.slice(ti,Mi)}return jr=!0,X.slice(ti,tt)}for(;(Tr=bn())!==Gu;){for(var Vn=[];Tr!==du&&Tr!==Gu;)Vn.push(Tr),Tr=bn();le&&(Vn=le(Vn,xr++))==null||Ue.push(Vn)}return Ue}function d(X,le){return X.map(function(Ue){return le.map(function(tt){return Q(Ue[tt])}).join(i)})}function y(X,le){return le==null&&(le=Pu(X)),[le.map(Q).join(i)].concat(d(X,le)).join(`
`)}function T(X,le){return le==null&&(le=Pu(X)),d(X,le).join(`
`)}function P(X){return X.map(D).join(`
`)}function D(X){return X.map(Q).join(i)}function Q(X){return X==null?"":X instanceof Date?If(X):f.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:s,parseRows:l,format:y,formatBody:T,formatRows:P,formatRow:D,formatValue:Q}}var il=Of(","),Lf=il.parse,vh=il.parseRows,oc=il.format,mh=il.formatBody,bf=il.formatRows,gh=il.formatRow,sc=il.formatValue,af=x(38163),Rf=x.n(af);function qf(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Df(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?qf(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):qf(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function eh(i,f){var o=f.x,s=f.y,l=f.x1,d=f.y1,y=f.coordinates,T=[];return i.forEach(function(P,D){var Q=[];if(o&&s&&(Q=[parseFloat(P[o]),parseFloat(P[s])]),o&&s&&l&&d){var X=[parseFloat(P[o]),parseFloat(P[s])],le=[parseFloat(P[l]),parseFloat(P[d])];Q=[X,le]}if(y){var Ue="Polygon";Array.isArray(y[0])||(Ue="Point"),Array.isArray(y[0])&&!Array.isArray(y[0][0])&&(Ue="LineString");var tt={type:Ue,coordinates:(0,pi.Z)(P[y])};Rf()(tt,!0),Q=tt.coordinates}var Ot=Df(Df({},P),{},{_id:D,coordinates:Q});T.push(Ot)}),{dataArray:T}}function yh(i,f){var o=Lf(i);return eh(o,f)}var uc=x(40271);function _h(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function kf(i){if(Array.isArray(i))return i;if(i.type==="Feature"){if(i.geometry!==null)return i.geometry.coordinates}else if(i.coordinates)return i.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Uh(i){if(i.length>1&&isNumber(i[0])&&isNumber(i[1]))return!0;if(Array.isArray(i[0])&&i[0].length)return Uh(i[0]);throw new Error("coordinates must only contain numbers")}function Sc(i,f,o){if(!f||!o)throw new Error("type and name required");if(!i||i.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+i.type)}function zf(i,f,o){if(!i)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!i||i.type!=="Feature"||!i.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!i.geometry||i.geometry.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+i.geometry.type)}function bo(i,f,o){if(!i)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!i||i.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,l=i.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==f)throw new Error("Invalid input to "+o+": must be a "+f+", given "+d.geometry.type)}}function Hc(i){return i.type==="Feature"?i.geometry:i}function Z(i,f){return i.type==="FeatureCollection"?"FeatureCollection":i.type==="GeometryCollection"?"GeometryCollection":i.type==="Feature"&&i.geometry!==null?i.geometry.type:i.type}function N(i,f,o){if(i!==null)for(var s,l,d,y,T,P,D,Q=0,X=0,le,Ue=i.type,tt=Ue==="FeatureCollection",Ot=Ue==="Feature",xr=tt?i.features.length:1,Tr=0;Tr<xr;Tr++){D=tt?i.features[Tr].geometry:Ot?i.geometry:i,le=D?D.type==="GeometryCollection":!1,T=le?D.geometries.length:1;for(var jr=0;jr<T;jr++){var dn=0,bn=0;if(y=le?D.geometries[jr]:D,y!==null){P=y.coordinates;var Vn=y.type;switch(Q=o&&(Vn==="Polygon"||Vn==="MultiPolygon")?1:0,Vn){case null:break;case"Point":if(f(P,X,Tr,dn,bn)===!1)return!1;X++,dn++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(f(P[s],X,Tr,dn,bn)===!1)return!1;X++,Vn==="MultiPoint"&&dn++}Vn==="LineString"&&dn++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(l=0;l<P[s].length-Q;l++){if(f(P[s][l],X,Tr,dn,bn)===!1)return!1;X++}Vn==="MultiLineString"&&dn++,Vn==="Polygon"&&bn++}Vn==="Polygon"&&dn++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(bn=0,l=0;l<P[s].length;l++){for(d=0;d<P[s][l].length-Q;d++){if(f(P[s][l][d],X,Tr,dn,bn)===!1)return!1;X++}bn++}dn++}break;case"GeometryCollection":for(s=0;s<y.geometries.length;s++)if(N(y.geometries[s],f,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function M(i,f,o,s){var l=o;return N(i,function(d,y,T,P,D){y===0&&o===void 0?l=d:l=f(l,d,y,T,P,D)},s),l}function R(i,f){var o;switch(i.type){case"FeatureCollection":for(o=0;o<i.features.length&&f(i.features[o].properties,o)!==!1;o++);break;case"Feature":f(i.properties,0);break}}function te(i,f,o){var s=o;return R(i,function(l,d){d===0&&o===void 0?s=l:s=f(s,l,d)}),s}function ve(i,f){if(i.type==="Feature")f(i,0);else if(i.type==="FeatureCollection")for(var o=0;o<i.features.length&&f(i.features[o],o)!==!1;o++);}function ut(i,f,o){var s=o;return ve(i,function(l,d){d===0&&o===void 0?s=l:s=f(s,l,d)}),s}function Nt(i){var f=[];return N(i,function(o){f.push(o)}),f}function Pt(i,f){var o,s,l,d,y,T,P,D,Q,X,le=0,Ue=i.type==="FeatureCollection",tt=i.type==="Feature",Ot=Ue?i.features.length:1;for(o=0;o<Ot;o++){for(T=Ue?i.features[o].geometry:tt?i.geometry:i,D=Ue?i.features[o].properties:tt?i.properties:{},Q=Ue?i.features[o].bbox:tt?i.bbox:void 0,X=Ue?i.features[o].id:tt?i.id:void 0,P=T?T.type==="GeometryCollection":!1,y=P?T.geometries.length:1,l=0;l<y;l++){if(d=P?T.geometries[l]:T,d===null){if(f(null,le,D,Q,X)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(f(d,le,D,Q,X)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(f(d.geometries[s],le,D,Q,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}le++}}function Sr(i,f,o){var s=o;return Pt(i,function(l,d,y,T,P){d===0&&o===void 0?s=l:s=f(s,l,d,y,T,P)}),s}function Ur(i,f){Pt(i,function(o,s,l,d,y){var T=o===null?null:o.type;switch(T){case null:case"Point":case"LineString":case"Polygon":return f((0,uc.zL)(o,l,{bbox:d,id:y}),s,0)===!1?!1:void 0}var P;switch(T){case"MultiPoint":P="Point";break;case"MultiLineString":P="LineString";break;case"MultiPolygon":P="Polygon";break}for(var D=0;D<o.coordinates.length;D++){var Q=o.coordinates[D],X={type:P,coordinates:Q};if(f((0,uc.zL)(X,l),s,D)===!1)return!1}})}function Fn(i,f,o){var s=o;return Ur(i,function(l,d,y){d===0&&y===0&&o===void 0?s=l:s=f(s,l,d,y)}),s}function Gn(i,f){Ur(i,function(o,s,l){var d=0;if(!!o.geometry){var y=o.geometry.type;if(!(y==="Point"||y==="MultiPoint")){var T,P=0,D=0,Q=0;if(N(o,function(X,le,Ue,tt,Ot){if(T===void 0||s>P||tt>D||Ot>Q){T=X,P=s,D=tt,Q=Ot,d=0;return}var xr=lineString([T,X],o.properties);if(f(xr,s,l,Ot,d)===!1)return!1;d++,T=X})===!1)return!1}}})}function vi(i,f,o){var s=o,l=!1;return Gn(i,function(d,y,T,P,D){l===!1&&o===void 0?s=d:s=f(s,d,y,T,P,D),l=!0}),s}function mi(i,f){if(!i)throw new Error("geojson is required");Ur(i,function(o,s,l){if(o.geometry!==null){var d=o.geometry.type,y=o.geometry.coordinates;switch(d){case"LineString":if(f(o,s,l,0,0)===!1)return!1;break;case"Polygon":for(var T=0;T<y.length;T++)if(f(lineString(y[T],o.properties),s,l,T)===!1)return!1;break}}})}function ci(i,f,o){var s=o;return mi(i,function(l,d,y,T){d===0&&o===void 0?s=l:s=f(s,l,d,y,T)}),s}function ji(i,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var o=f.featureIndex||0,s=f.multiFeatureIndex||0,l=f.geometryIndex||0,d=f.segmentIndex||0,y=f.properties,T;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),y=y||i.features[o].properties,T=i.features[o].geometry;break;case"Feature":y=y||i.properties,T=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=i;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var P=T.coordinates;switch(T.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=P.length+d-1),lineString([P[d],P[d+1]],y,f);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d-1),lineString([P[l][d],P[l][d+1]],y,f);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d-1),lineString([P[s][d],P[s][d+1]],y,f);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d-1),lineString([P[s][l][d],P[s][l][d+1]],y,f)}throw new Error("geojson is invalid")}function Gi(i,f){if(f=f||{},!isObject(f))throw new Error("options is invalid");var o=f.featureIndex||0,s=f.multiFeatureIndex||0,l=f.geometryIndex||0,d=f.coordIndex||0,y=f.properties,T;switch(i.type){case"FeatureCollection":o<0&&(o=i.features.length+o),y=y||i.features[o].properties,T=i.features[o].geometry;break;case"Feature":y=y||i.properties,T=i.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=i;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var P=T.coordinates;switch(T.type){case"Point":return point(P,y,f);case"MultiPoint":return s<0&&(s=P.length+s),point(P[s],y,f);case"LineString":return d<0&&(d=P.length+d),point(P[d],y,f);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d),point(P[l][d],y,f);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d),point(P[s][d],y,f);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d),point(P[s][l][d],y,f)}throw new Error("geojson is invalid")}function Ao(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function No(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Ao(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Ao(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Ko(i,f){var o=[],s={};if(i.features=i.features.filter(function(d){var y=d.geometry;return d!=null&&y&&y.type&&y.coordinates&&y.coordinates.length>0}),Rf()(i,!0),i.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Ur(i,function(d,y){var T=kf(d),P=y,D=No(No({},d.properties),{},{coordinates:T,_id:P});o.push(D)}),{dataArray:o,featureKeys:s}}function $a(i,f){var o=f.extent,s=new Promise(function(d){Da(i,function(y){d(y)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function Da(i,f){var o=i,s=[];if(typeof o=="string")(0,Me.gJ)({url:o},function(y,T){s.push(T),f(s)});else{var l=o.length,d=0;o.forEach(function(y){(0,Me.gJ)({url:y},function(T,P){d++,s.push(P),d===l&&f(s)})})}return $a}function ma(i,f){var o=f.extent,s=f.width,l=f.height,d=f.min,y=f.max,T={_id:1,dataArray:[{_id:1,data:Array.from(i),width:s,height:l,min:d,max:y,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return T}var ao=x(30236),ms=x.n(ao),Bo=x(47037),$o=x.n(Bo);function vo(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Xs(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?vo(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):vo(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function yl(i,f){var o=f.radius,s=o===void 0?40:o,l=f.maxZoom,d=l===void 0?18:l,y=f.minZoom,T=y===void 0?0:y,P=f.zoom,D=P===void 0?2:P;if(i.pointIndex){var Q=i.pointIndex.getClusters(i.extent,Math.floor(D));return i.dataArray=Ds(Q),i}var X=new(tr())({radius:s,minZoom:T,maxZoom:d}),le={type:"FeatureCollection",features:[]};return le.features=i.dataArray.map(function(Ue){return{type:"Feature",geometry:{type:"Point",coordinates:Ue.coordinates},properties:Xs({},Ue)}}),X.load(le.features),X}function Ds(i){return i.map(function(f,o){return Xs({coordinates:f.geometry.coordinates,_id:o+1},f.properties)})}function _l(i){if(i.length===0)throw new Error("max requires at least one data point");for(var f=i[0],o=1;o<i.length;o++)i[o]>f&&(f=i[o]);return f}function Ys(i){if(i.length===0)throw new Error("min requires at least one data point");for(var f=i[0],o=1;o<i.length;o++)i[o]<f&&(f=i[o]);return f}function Ff(i){if(i.length===0)return 0;for(var f=i[0],o=0,s,l=1;l<i.length;l++)s=f+i[l]*1,Math.abs(f)>=Math.abs(i[l])?o+=f-s+i[l]:o+=i[l]-s+f,f=s;return f+o*1}function jh(i){if(i.length===0)throw new Error("mean requires at least one data point");return Ff(i)/i.length}var Mu={min:Ys,max:_l,mean:jh,sum:Ff};function xl(i,f){return i.map(function(o){return o[f]*1})}function Uo(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Iu(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Uo(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Uo(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Zh(i){var f=hp();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function hp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function pp(i,f){if(Array.isArray(f))return f}var Vh=function(i){(0,ne.Z)(o,i);var f=Zh(o);function o(s,l){var d;return(0,Y.Z)(this,o),d=f.call(this),d.data=void 0,d.extent=void 0,d.hooks={init:new Li.ni},d.parser={type:"geojson"},d.transforms=[],d.cluster=!1,d.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},d.mapService=void 0,d.invalidExtent=!1,d.originData=void 0,d.rawData=void 0,d.cfg={},d.clusterIndex=void 0,d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,ce.Z)(o,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,y=this.clusterOptions,T=y.method,P=T===void 0?"sum":T,D=y.field,Q=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,Q.forEach(function(X){X.id||(X.properties.point_count=1)}),(D||hs()(P))&&(Q=Q.map(function(X){var le=X.id;if(le){var Ue=d.clusterIndex.getLeaves(le,Infinity),tt=Ue.map(function(Tr){return Tr.properties}),Ot;if($o()(P)&&D){var xr=xl(tt,D);Ot=Mu[P](xr)}hs()(P)&&(Ot=P(tt)),X.properties.stat=Ot}else X.properties.point_count=1;return X})),this.data=Lo("geojson")({type:"FeatureCollection",features:Q}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,y=d===void 0?"geojson":d;if(y==="geojson"&&!this.cluster){var T=l<this.originData.features.length?this.originData.features[l]:"null",P=Yo()(T);if(this.transforms.length!==0){var D=this.data.dataArray.find(function(Q){return Q._id===l});P.properties=D}return P}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var y=this.data.dataArray.find(function(T){return T[l]===name});return y==null?void 0:y._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,Me.yA)((0,Me.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=ms()(this.cfg,l,pp);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=Iu(Iu({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",y=Lo(d);this.data=y(this.originData,l),this.extent=(0,Me.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(y){var T=y.type,P=pu(T)(l.data,y);Object.assign(l.data,P)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=yl(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Kt.EventEmitter);function iu(i,f){var o=f.callback;return o&&(i.dataArray=i.dataArray.filter(o)),i}function xh(i,f){var o;if(typeof Symbol=="undefined"||i[Symbol.iterator]==null){if(Array.isArray(i)||(o=Gh(i))||f&&i&&typeof i.length=="number"){o&&(i=o);var s=0,l=function(){};return{s:l,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(D){throw D},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,T;return{s:function(){o=i[Symbol.iterator]()},n:function(){var D=o.next();return d=D.done,D},e:function(D){y=!0,T=D},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw T}}}}function Gh(i,f){if(!!i){if(typeof i=="string")return bh(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return bh(i,f)}}function bh(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}var Sh=6378e3;function Hh(i,f){var o=i.dataArray,s=f.size,l=s===void 0?10:s,d=l/(2*Math.PI*Sh)*(256<<20)/2,y=dp(o,l),T=y.gridHash,P=y.gridOffset,D=vp(T,P,f);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:D}}function dp(i,f){var o=Infinity,s=-Infinity,l,d=xh(i),y;try{for(d.s();!(y=d.n()).done;){var T=y.value;l=T.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,s=l>s?l:s)}}catch(dn){d.e(dn)}finally{d.f()}var P=(o+s)/2,D=Wh(f,P);if(D.xOffset<=0||D.yOffset<=0)return{gridHash:{},gridOffset:D};var Q={},X=xh(i),le;try{for(X.s();!(le=X.n()).done;){var Ue=le.value,tt=Ue.coordinates[1],Ot=Ue.coordinates[0];if(Number.isFinite(tt)&&Number.isFinite(Ot)){var xr=Math.floor((tt+90)/D.yOffset),Tr=Math.floor((Ot+180)/D.xOffset),jr="".concat(xr,"-").concat(Tr);Q[jr]=Q[jr]||{count:0,points:[]},Q[jr].count+=1,Q[jr].points.push(Ue)}}}catch(dn){X.e(dn)}finally{X.f()}return{gridHash:Q,gridOffset:D}}function Wh(i,f){var o=Xh(i),s=Eh(f,i);return{yOffset:o,xOffset:s}}function Xh(i){return i/Sh*(180/Math.PI)}function Eh(i,f){return f/Sh*(180/Math.PI)/Math.cos(i*Math.PI/180)}function vp(i,f,o){return Object.keys(i).reduce(function(s,l,d){var y=l.split("-"),T=parseInt(y[0],10),P=parseInt(y[1],10),D={};if(o.field&&o.method){var Q=Me.a5.getColumn(i[l].points,o.field);D[o.method]=Me.a5.statMap[o.method](Q)}return Object.assign(D,{_id:d,coordinates:(0,Me.Z)([-180+f.xOffset*(P+.5),-90+f.yOffset*(T+.5)]),rawData:i[l].points,count:i[l].count}),s.push(D),s},[])}var Sf=Math.PI/3,Ef=[0,Sf,2*Sf,3*Sf,4*Sf,5*Sf];function Yh(i){return i[0]}function U(i){return i[1]}function Se(){var i=0,f=0,o=1,s=1,l=Yh,d=U,y,T,P;function D(X){var le={},Ue=[],tt,Ot=X.length;for(tt=0;tt<Ot;++tt)if(!(isNaN(Tr=+l.call(null,xr=X[tt],tt,X))||isNaN(jr=+d.call(null,xr,tt,X)))){var xr,Tr,jr,dn=Math.round(jr=jr/P),bn=Math.round(Tr=Tr/T-(dn&1)/2),Vn=jr-dn;if(Math.abs(Vn)*3>1){var Mi=Tr-bn,ti=bn+(Tr<bn?-1:1)/2,ra=dn+(jr<dn?-1:1),Ia=Tr-ti,Fa=jr-ra;Mi*Mi+Vn*Vn>Ia*Ia+Fa*Fa&&(bn=ti+(dn&1?1:-1)/2,dn=ra)}var gi=bn+"-"+dn,wa=le[gi];wa?wa.push(xr):(Ue.push(wa=le[gi]=[xr]),wa.x=(bn+(dn&1)/2)*T,wa.y=dn*P)}return Ue}function Q(X){var le=0,Ue=0;return Ef.map(function(tt){var Ot=Math.sin(tt)*X,xr=-Math.cos(tt)*X,Tr=Ot-le,jr=xr-Ue;return le=Ot,Ue=xr,[Tr,jr]})}return D.hexagon=function(X){return"m"+Q(X==null?y:+X).join("l")+"z"},D.centers=function(){for(var X=[],le=Math.round(f/P),Ue=Math.round(i/T),tt=le*P;tt<s+y;tt+=P,++le)for(var Ot=Ue*T+(le&1)*T/2;Ot<o+T/2;Ot+=T)X.push([Ot,tt]);return X},D.mesh=function(){var X=Q(y).slice(0,4).join("l");return D.centers().map(function(le){return"M"+le+"m"+X}).join("")},D.x=function(X){return arguments.length?(l=X,D):l},D.y=function(X){return arguments.length?(d=X,D):d},D.radius=function(X){return arguments.length?(y=+X,T=y*2*Math.sin(Sf),P=y*1.5,D):y},D.size=function(X){return arguments.length?(i=f=0,o=+X[0],s=+X[1],D):[o-i,s-f]},D.extent=function(X){return arguments.length?(i=+X[0][0],f=+X[0][1],o=+X[1][0],s=+X[1][1],D):[[i,f],[o,s]]},D.radius(1)}function ze(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Qt(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?ze(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):ze(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var wr=6378e3;function Yt(i,f){var o=i.dataArray,s=f.size,l=s===void 0?10:s,d=f.method,y=d===void 0?"sum":d,T=l/(2*Math.PI*wr)*(256<<20)/2,P=o.map(function(le){var Ue=(0,Me.Z)(le.coordinates),tt=(0,q.Z)(Ue,2),Ot=tt[0],xr=tt[1];return Qt(Qt({},le),{},{coordinates:[Ot,xr]})}),D=Se().radius(T).x(function(le){return le.coordinates[0]}).y(function(le){return le.coordinates[1]}),Q=D(P),X={dataArray:Q.map(function(le,Ue){var tt;if(f.field&&y){var Ot=Me.a5.getColumn(le,f.field);le[y]=Me.a5.statMap[y](Ot)}return tt={},(0,z.Z)(tt,f.method,le[y]),(0,z.Z)(tt,"count",le.length),(0,z.Z)(tt,"rawData",le),(0,z.Z)(tt,"coordinates",[le.x,le.y]),(0,z.Z)(tt,"_id",Ue),tt}),radius:T,xOffset:T,yOffset:T,type:"hexagon"};return X}function fr(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Zr(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?fr(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):fr(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Xr(i,f){var o=f.sourceField,s=f.targetField,l=f.data,d={};return l.forEach(function(y){d[y[o]]=y}),i.dataArray=i.dataArray.map(function(y){var T=y[s];return Zr(Zr({},y),d[T])}),i}function qr(i,f){var o=f.callback;return o&&(i.dataArray=i.dataArray.map(o)),i}var Kr=x(4771),nn=Vh;po("geojson",Ko),po("image",$a),po("csv",yh),po("json",eh),po("raster",ma),vs("cluster",yl),vs("filter",iu),vs("join",Xr),vs("map",qr),vs("grid",Hh),vs("hexagon",Yt);var fn,Vr,an,Ft=(fn=(0,H.b2)(),fn(Vr=(an=function(){function i(){(0,Y.Z)(this,i),this.mapService=void 0}return(0,ce.Z)(i,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(w.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var d=o.sourceOption,y=d.data,T=d.options;o.setSource(new nn(y,T))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),l=s.cluster,d=s.clusterOptions,y=d.zoom,T=y===void 0?0:y,P=d.maxZoom,D=P===void 0?16:P,Q=this.mapService.getZoom()-1,X=o.dataState.dataSourceNeedUpdate;return l&&(X||Math.abs(T-Q)>1)&&D>T?(s.updateClusterData(Math.floor(Q)),!0):!1}}]),i}(),an))||Vr),cr=x(44908),Hr=x.n(cr),mn=x(14293),Dr=x.n(mn);function wn(i,f){return i<f?-1:i>f?1:i>=f?0:NaN}function Nr(i){return i.length===1&&(i=sn(i)),{left:function(f,o,s,l){for(s==null&&(s=0),l==null&&(l=f.length);s<l;){var d=s+l>>>1;i(f[d],o)<0?s=d+1:l=d}return s},right:function(f,o,s,l){for(s==null&&(s=0),l==null&&(l=f.length);s<l;){var d=s+l>>>1;i(f[d],o)>0?l=d:s=d+1}return s}}}function sn(i){return function(f,o){return wn(i(f),o)}}var Rr=Nr(wn),on=Rr.right,Yn=Rr.left,$n=null;function un(i,f){var o=i.length,s=-1,l,d,y;if(f==null){for(;++s<o;)if((l=i[s])!=null&&l>=l)for(d=y=l;++s<o;)(l=i[s])!=null&&(d>l&&(d=l),y<l&&(y=l))}else for(;++s<o;)if((l=f(i[s],s,i))!=null&&l>=l)for(d=y=l;++s<o;)(l=f(i[s],s,i))!=null&&(d>l&&(d=l),y<l&&(y=l));return[d,y]}var kr=Array.prototype,Or=kr.slice,fi=kr.map,Qn=Math.sqrt(50),On=Math.sqrt(10),Ni=Math.sqrt(2);function Ti(i,f,o){var s,l=-1,d,y,T;if(f=+f,i=+i,o=+o,i===f&&o>0)return[i];if((s=f<i)&&(d=i,i=f,f=d),(T=Bi(i,f,o))===0||!isFinite(T))return[];if(T>0)for(i=Math.ceil(i/T),f=Math.floor(f/T),y=new Array(d=Math.ceil(f-i+1));++l<d;)y[l]=(i+l)*T;else for(i=Math.floor(i*T),f=Math.ceil(f*T),y=new Array(d=Math.ceil(i-f+1));++l<d;)y[l]=(i-l)/T;return s&&y.reverse(),y}function Bi(i,f,o){var s=(f-i)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=Qn?10:d>=On?5:d>=Ni?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=Qn?10:d>=On?5:d>=Ni?2:1)}function ca(i,f,o){var s=Math.abs(f-i)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=Qn?l*=10:d>=On?l*=5:d>=Ni&&(l*=2),f<i?-l:l}function Jo(){var i=identity,f=extent,o=sturges;function s(l){var d,y=l.length,T,P=new Array(y);for(d=0;d<y;++d)P[d]=i(l[d],d,l);var D=f(P),Q=D[0],X=D[1],le=o(P,Q,X);Array.isArray(le)||(le=tickStep(Q,X,le),le=range(Math.ceil(Q/le)*le,X,le));for(var Ue=le.length;le[0]<=Q;)le.shift(),--Ue;for(;le[Ue-1]>X;)le.pop(),--Ue;var tt=new Array(Ue+1),Ot;for(d=0;d<=Ue;++d)Ot=tt[d]=[],Ot.x0=d>0?le[d-1]:Q,Ot.x1=d<Ue?le[d]:X;for(d=0;d<y;++d)T=P[d],Q<=T&&T<=X&&tt[bisect(le,T,0,Ue)].push(l[d]);return tt}return s.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),s):i},s.domain=function(l){return arguments.length?(f=typeof l=="function"?l:constant([l[0],l[1]]),s):f},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function ks(i,f,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-f)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function Hi(i,f){return i<f?-1:i>f?1:i>=f?0:NaN}function So(i){return i.length===1&&(i=Ja(i)),{left:function(f,o,s,l){for(s==null&&(s=0),l==null&&(l=f.length);s<l;){var d=s+l>>>1;i(f[d],o)<0?s=d+1:l=d}return s},right:function(f,o,s,l){for(s==null&&(s=0),l==null&&(l=f.length);s<l;){var d=s+l>>>1;i(f[d],o)>0?l=d:s=d+1}return s}}}function Ja(i){return function(f,o){return Hi(i(f),o)}}var jo=So(Hi),ls=jo.right,ws=jo.left,Qo=ls,Ts=Array.prototype,qo=Ts.slice,zi=Ts.map,As=Math.sqrt(50),ha=Math.sqrt(10),qn=Math.sqrt(2);function Wi(i,f,o){var s,l=-1,d,y,T;if(f=+f,i=+i,o=+o,i===f&&o>0)return[i];if((s=f<i)&&(d=i,i=f,f=d),(T=$i(i,f,o))===0||!isFinite(T))return[];if(T>0)for(i=Math.ceil(i/T),f=Math.floor(f/T),y=new Array(d=Math.ceil(f-i+1));++l<d;)y[l]=(i+l)*T;else for(i=Math.floor(i*T),f=Math.ceil(f*T),y=new Array(d=Math.ceil(i-f+1));++l<d;)y[l]=(i-l)/T;return s&&y.reverse(),y}function $i(i,f,o){var s=(f-i)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=As?10:d>=ha?5:d>=qn?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=As?10:d>=ha?5:d>=qn?2:1)}function Co(i,f,o){var s=Math.abs(f-i)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=As?l*=10:d>=ha?l*=5:d>=qn&&(l*=2),f<i?-l:l}function bl(){var i=identity,f=extent,o=sturges;function s(l){var d,y=l.length,T,P=new Array(y);for(d=0;d<y;++d)P[d]=i(l[d],d,l);var D=f(P),Q=D[0],X=D[1],le=o(P,Q,X);Array.isArray(le)||(le=tickStep(Q,X,le),le=range(Math.ceil(Q/le)*le,X,le));for(var Ue=le.length;le[0]<=Q;)le.shift(),--Ue;for(;le[Ue-1]>X;)le.pop(),--Ue;var tt=new Array(Ue+1),Ot;for(d=0;d<=Ue;++d)Ot=tt[d]=[],Ot.x0=d>0?le[d-1]:Q,Ot.x1=d<Ue?le[d]:X;for(d=0;d<y;++d)T=P[d],Q<=T&&T<=X&&tt[bisect(le,T,0,Ue)].push(l[d]);return tt}return s.value=function(l){return arguments.length?(i=typeof l=="function"?l:constant(l),s):i},s.domain=function(l){return arguments.length?(f=typeof l=="function"?l:constant([l[0],l[1]]),s):f},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function Ec(i,f,o){return i=map.call(i,number).sort(ascending),Math.ceil((o-f)/(2*(quantile(i,.75)-quantile(i,.25))*Math.pow(i.length,-1/3)))}function Ve(i){return i===null?NaN:+i}function qt(i,f,o){if(o==null&&(o=Ve),!!(s=i.length)){if((f=+f)<=0||s<2)return+o(i[0],0,i);if(f>=1)return+o(i[s-1],s-1,i);var s,l=(s-1)*f,d=Math.floor(l),y=+o(i[d],d,i),T=+o(i[d+1],d+1,i);return y+(T-y)*(l-d)}}var Ut="$";function An(){}An.prototype=Xi.prototype={constructor:An,has:function(i){return Ut+i in this},get:function(i){return this[Ut+i]},set:function(i,f){return this[Ut+i]=f,this},remove:function(i){var f=Ut+i;return f in this&&delete this[f]},clear:function(){for(var i in this)i[0]===Ut&&delete this[i]},keys:function(){var i=[];for(var f in this)f[0]===Ut&&i.push(f.slice(1));return i},values:function(){var i=[];for(var f in this)f[0]===Ut&&i.push(this[f]);return i},entries:function(){var i=[];for(var f in this)f[0]===Ut&&i.push({key:f.slice(1),value:this[f]});return i},size:function(){var i=0;for(var f in this)f[0]===Ut&&++i;return i},empty:function(){for(var i in this)if(i[0]===Ut)return!1;return!0},each:function(i){for(var f in this)f[0]===Ut&&i(this[f],f.slice(1),this)}};function Xi(i,f){var o=new An;if(i instanceof An)i.each(function(T,P){o.set(P,T)});else if(Array.isArray(i)){var s=-1,l=i.length,d;if(f==null)for(;++s<l;)o.set(s,i[s]);else for(;++s<l;)o.set(f(d=i[s],s,i),d)}else if(i)for(var y in i)o.set(y,i[y]);return o}var Ie=Xi;function ye(){var i=[],f=[],o,s,l;function d(T,P,D,Q){if(P>=i.length)return o!=null&&T.sort(o),s!=null?s(T):T;for(var X=-1,le=T.length,Ue=i[P++],tt,Ot,xr=map(),Tr,jr=D();++X<le;)(Tr=xr.get(tt=Ue(Ot=T[X])+""))?Tr.push(Ot):xr.set(tt,[Ot]);return xr.each(function(dn,bn){Q(jr,bn,d(dn,P,D,Q))}),jr}function y(T,P){if(++P>i.length)return T;var D,Q=f[P-1];return s!=null&&P>=i.length?D=T.entries():(D=[],T.each(function(X,le){D.push({key:le,values:y(X,P)})})),Q!=null?D.sort(function(X,le){return Q(X.key,le.key)}):D}return l={object:function(T){return d(T,0,it,It)},map:function(T){return d(T,0,Dt,lt)},entries:function(T){return y(d(T,0,Dt,lt),0)},key:function(T){return i.push(T),l},sortKeys:function(T){return f[i.length-1]=T,l},sortValues:function(T){return o=T,l},rollup:function(T){return s=T,l}}}function it(){return{}}function It(i,f,o){i[f]=o}function Dt(){return map()}function lt(i,f,o){i.set(f,o)}function at(){}var _t=Ie.prototype;at.prototype=Le.prototype={constructor:at,has:_t.has,add:function(i){return i+="",this[Ut+i]=i,this},remove:_t.remove,clear:_t.clear,values:_t.keys,size:_t.size,empty:_t.empty,each:_t.each};function Le(i,f){var o=new at;if(i instanceof at)i.each(function(d){o.add(d)});else if(i){var s=-1,l=i.length;if(f==null)for(;++s<l;)o.add(i[s]);else for(;++s<l;)o.add(f(i[s],s,i))}return o}var et=null,Ce=Array.prototype,Et=Ce.map,Rt=Ce.slice;function _r(i,f){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(f).domain(i);break}return this}function er(i,f){switch(arguments.length){case 0:break;case 1:this.interpolator(i);break;default:this.interpolator(f).domain(i);break}return this}var br={name:"implicit"};function Gr(){var i=Ie(),f=[],o=[],s=br;function l(d){var y=d+"",T=i.get(y);if(!T){if(s!==br)return s;i.set(y,T=f.push(d))}return o[(T-1)%o.length]}return l.domain=function(d){if(!arguments.length)return f.slice();f=[],i=Ie();for(var y=-1,T=d.length,P,D;++y<T;)i.has(D=(P=d[y])+"")||i.set(D,f.push(P));return l},l.range=function(d){return arguments.length?(o=Rt.call(d),l):o.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return Gr(f,o).unknown(s)},_r.apply(l,arguments),l}function Un(){var i=ordinal().unknown(void 0),f=i.domain,o=i.range,s=[0,1],l,d,y=!1,T=0,P=0,D=.5;delete i.unknown;function Q(){var X=f().length,le=s[1]<s[0],Ue=s[le-0],tt=s[1-le];l=(tt-Ue)/Math.max(1,X-T+P*2),y&&(l=Math.floor(l)),Ue+=(tt-Ue-l*(X-T))*D,d=l*(1-T),y&&(Ue=Math.round(Ue),d=Math.round(d));var Ot=sequence(X).map(function(xr){return Ue+l*xr});return o(le?Ot.reverse():Ot)}return i.domain=function(X){return arguments.length?(f(X),Q()):f()},i.range=function(X){return arguments.length?(s=[+X[0],+X[1]],Q()):s.slice()},i.rangeRound=function(X){return s=[+X[0],+X[1]],y=!0,Q()},i.bandwidth=function(){return d},i.step=function(){return l},i.round=function(X){return arguments.length?(y=!!X,Q()):y},i.padding=function(X){return arguments.length?(T=Math.min(1,P=+X),Q()):T},i.paddingInner=function(X){return arguments.length?(T=Math.min(1,X),Q()):T},i.paddingOuter=function(X){return arguments.length?(P=+X,Q()):P},i.align=function(X){return arguments.length?(D=Math.max(0,Math.min(1,X)),Q()):D},i.copy=function(){return Un(f(),s).round(y).paddingInner(T).paddingOuter(P).align(D)},initRange.apply(Q(),arguments)}function ki(i){var f=i.copy;return i.padding=i.paddingOuter,delete i.paddingInner,delete i.paddingOuter,i.copy=function(){return ki(f())},i}function Nn(){return ki(Un.apply(null,arguments).paddingInner(1))}var oi=x(26257),Ai=x(73626);function pa(i,f){return i=+i,f=+f,function(o){return Math.round(i*(1-o)+f*o)}}function Zo(i){return function(){return i}}function au(i){return+i}var Nf=[0,1];function Vo(i){return i}function Bf(i,f){return(f-=i=+i)?function(o){return(o-i)/f}:Zo(isNaN(f)?NaN:.5)}function al(i){var f=i[0],o=i[i.length-1],s;return f>o&&(s=f,f=o,o=s),function(l){return Math.max(f,Math.min(o,l))}}function Uf(i,f,o){var s=i[0],l=i[1],d=f[0],y=f[1];return l<s?(s=Bf(l,s),d=o(y,d)):(s=Bf(s,l),d=o(d,y)),function(T){return d(s(T))}}function jf(i,f,o){var s=Math.min(i.length,f.length)-1,l=new Array(s),d=new Array(s),y=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),f=f.slice().reverse());++y<s;)l[y]=Bf(i[y],i[y+1]),d[y]=o(f[y],f[y+1]);return function(T){var P=Qo(i,T,1,s)-1;return d[P](l[P](T))}}function th(i,f){return f.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function wf(){var i=Nf,f=Nf,o=oi.Z,s,l,d,y=Vo,T,P,D;function Q(){return T=Math.min(i.length,f.length)>2?jf:Uf,P=D=null,X}function X(le){return isNaN(le=+le)?d:(P||(P=T(i.map(s),f,o)))(s(y(le)))}return X.invert=function(le){return y(l((D||(D=T(f,i.map(s),Ai.Z)))(le)))},X.domain=function(le){return arguments.length?(i=Et.call(le,au),y===Vo||(y=al(i)),Q()):i.slice()},X.range=function(le){return arguments.length?(f=Rt.call(le),Q()):f.slice()},X.rangeRound=function(le){return f=Rt.call(le),o=pa,Q()},X.clamp=function(le){return arguments.length?(y=le?al(i):Vo,X):y!==Vo},X.interpolate=function(le){return arguments.length?(o=le,Q()):o},X.unknown=function(le){return arguments.length?(d=le,X):d},function(le,Ue){return s=le,l=Ue,Q()}}function mp(i,f){return wf()(i,f)}var gs=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Qa(i){if(!(f=gs.exec(i)))throw new Error("invalid format: "+i);var f;return new Kh({fill:f[1],align:f[2],sign:f[3],symbol:f[4],zero:f[5],width:f[6],comma:f[7],precision:f[8]&&f[8].slice(1),trim:f[9],type:f[10]})}Qa.prototype=Kh.prototype;function Kh(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}Kh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Hp(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function wh(i,f){if((o=(i=f?i.toExponential(f-1):i.toExponential()).indexOf("e"))<0)return null;var o,s=i.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+i.slice(o+1)]}function Zf(i){return i=wh(Math.abs(i)),i?i[1]:NaN}function Wp(i,f){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Zf(f)/3)))*3-Zf(Math.abs(i)))}function gp(i,f){return function(o,s){for(var l=o.length,d=[],y=0,T=i[0],P=0;l>0&&T>0&&(P+T+1>s&&(T=Math.max(1,s-P)),d.push(o.substring(l-=T,l+T)),!((P+=T+1)>s));)T=i[y=(y+1)%i.length];return d.reverse().join(f)}}function Vf(i){return function(f){return f.replace(/[0-9]/g,function(o){return i[+o]})}}function Gf(i){e:for(var f=i.length,o=1,s=-1,l;o<f;++o)switch(i[o]){case".":s=l=o;break;case"0":s===0&&(s=o),l=o;break;default:if(!+i[o])break e;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(l+1):i}var yp;function ys(i,f){var o=wh(i,f);if(!o)return i+"";var s=o[0],l=o[1],d=l-(yp=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,y=s.length;return d===y?s:d>y?s+new Array(d-y+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+wh(i,Math.max(0,f+d-1))[0]}function rh(i,f){var o=wh(i,f);if(!o)return i+"";var s=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var Wc={"%":function(i,f){return(i*100).toFixed(f)},b:function(i){return Math.round(i).toString(2)},c:function(i){return i+""},d:Hp,e:function(i,f){return i.toExponential(f)},f:function(i,f){return i.toFixed(f)},g:function(i,f){return i.toPrecision(f)},o:function(i){return Math.round(i).toString(8)},p:function(i,f){return rh(i*100,f)},r:rh,s:ys,X:function(i){return Math.round(i).toString(16).toUpperCase()},x:function(i){return Math.round(i).toString(16)}};function Th(i){return i}var Ah=Array.prototype.map,$h=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function nh(i){var f=i.grouping===void 0||i.thousands===void 0?Th:gp(Ah.call(i.grouping,Number),i.thousands+""),o=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",l=i.decimal===void 0?".":i.decimal+"",d=i.numerals===void 0?Th:Vf(Ah.call(i.numerals,String)),y=i.percent===void 0?"%":i.percent+"",T=i.minus===void 0?"-":i.minus+"",P=i.nan===void 0?"NaN":i.nan+"";function D(X){X=Qa(X);var le=X.fill,Ue=X.align,tt=X.sign,Ot=X.symbol,xr=X.zero,Tr=X.width,jr=X.comma,dn=X.precision,bn=X.trim,Vn=X.type;Vn==="n"?(jr=!0,Vn="g"):Wc[Vn]||(dn===void 0&&(dn=12),bn=!0,Vn="g"),(xr||le==="0"&&Ue==="=")&&(xr=!0,le="0",Ue="=");var Mi=Ot==="$"?o:Ot==="#"&&/[boxX]/.test(Vn)?"0"+Vn.toLowerCase():"",ti=Ot==="$"?s:/[%p]/.test(Vn)?y:"",ra=Wc[Vn],Ia=/[defgprs%]/.test(Vn);dn=dn===void 0?6:/[gprs]/.test(Vn)?Math.max(1,Math.min(21,dn)):Math.max(0,Math.min(20,dn));function Fa(gi){var wa=Mi,oo=ti,Yu,up,lp;if(Vn==="c")oo=ra(gi)+oo,gi="";else{gi=+gi;var cp=gi<0||1/gi<0;if(gi=isNaN(gi)?P:ra(Math.abs(gi),dn),bn&&(gi=Gf(gi)),cp&&+gi==0&&tt!=="+"&&(cp=!1),wa=(cp?tt==="("?tt:T:tt==="-"||tt==="("?"":tt)+wa,oo=(Vn==="s"?$h[8+yp/3]:"")+oo+(cp&&tt==="("?")":""),Ia){for(Yu=-1,up=gi.length;++Yu<up;)if(lp=gi.charCodeAt(Yu),48>lp||lp>57){oo=(lp===46?l+gi.slice(Yu+1):gi.slice(Yu))+oo,gi=gi.slice(0,Yu);break}}}jr&&!xr&&(gi=f(gi,Infinity));var fp=wa.length+gi.length+oo.length,df=fp<Tr?new Array(Tr-fp+1).join(le):"";switch(jr&&xr&&(gi=f(df+gi,df.length?Tr-oo.length:Infinity),df=""),Ue){case"<":gi=wa+gi+oo+df;break;case"=":gi=wa+df+gi+oo;break;case"^":gi=df.slice(0,fp=df.length>>1)+wa+gi+oo+df.slice(fp);break;default:gi=df+wa+gi+oo;break}return d(gi)}return Fa.toString=function(){return X+""},Fa}function Q(X,le){var Ue=D((X=Qa(X),X.type="f",X)),tt=Math.max(-8,Math.min(8,Math.floor(Zf(le)/3)))*3,Ot=Math.pow(10,-tt),xr=$h[8+tt/3];return function(Tr){return Ue(Ot*Tr)+xr}}return{format:D,formatPrefix:Q}}var lc,Jh,_p;Ad({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Ad(i){return lc=nh(i),Jh=lc.format,_p=lc.formatPrefix,lc}function zs(i,f){return i=Math.abs(i),f=Math.abs(f)-i,Math.max(0,Zf(f)-Zf(i))+1}function Tf(i){return Math.max(0,-Zf(Math.abs(i)))}function Xp(i,f,o,s){var l=Co(i,f,o),d;switch(s=Qa(s==null?",f":s),s.type){case"s":{var y=Math.max(Math.abs(i),Math.abs(f));return s.precision==null&&!isNaN(d=Wp(l,y))&&(s.precision=d),_p(s,y)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=zs(l,Math.max(Math.abs(i),Math.abs(f))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=Tf(l))&&(s.precision=d-(s.type==="%")*2);break}}return Jh(s)}function e(i){var f=i.domain;return i.ticks=function(o){var s=f();return Wi(s[0],s[s.length-1],o==null?10:o)},i.tickFormat=function(o,s){var l=f();return Xp(l[0],l[l.length-1],o==null?10:o,s)},i.nice=function(o){o==null&&(o=10);var s=f(),l=0,d=s.length-1,y=s[l],T=s[d],P;return T<y&&(P=y,y=T,T=P,P=l,l=d,d=P),P=$i(y,T,o),P>0?(y=Math.floor(y/P)*P,T=Math.ceil(T/P)*P,P=$i(y,T,o)):P<0&&(y=Math.ceil(y*P)/P,T=Math.floor(T*P)/P,P=$i(y,T,o)),P>0?(s[l]=Math.floor(y/P)*P,s[d]=Math.ceil(T/P)*P,f(s)):P<0&&(s[l]=Math.ceil(y*P)/P,s[d]=Math.floor(T*P)/P,f(s)),i},i}function t(){var i=mp(Vo,Vo);return i.copy=function(){return th(i,t())},_r.apply(i,arguments),e(i)}function r(i){var f;function o(s){return isNaN(s=+s)?f:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(i=Et.call(s,au),o):i.slice()},o.unknown=function(s){return arguments.length?(f=s,o):f},o.copy=function(){return r(i).unknown(f)},i=arguments.length?Et.call(i,au):[0,1],e(o)}function c(i,f){i=i.slice();var o=0,s=i.length-1,l=i[o],d=i[s],y;return d<l&&(y=o,o=s,s=y,y=l,l=d,d=y),i[o]=f.floor(l),i[s]=f.ceil(d),i}function v(i){return Math.log(i)}function m(i){return Math.exp(i)}function _(i){return-Math.log(-i)}function C(i){return-Math.exp(-i)}function k(i){return isFinite(i)?+("1e"+i):i<0?0:i}function B(i){return i===10?k:i===Math.E?Math.exp:function(f){return Math.pow(i,f)}}function W(i){return i===Math.E?Math.log:i===10&&Math.log10||i===2&&Math.log2||(i=Math.log(i),function(f){return Math.log(f)/i})}function $(i){return function(f){return-i(-f)}}function se(i){var f=i(v,m),o=f.domain,s=10,l,d;function y(){return l=W(s),d=B(s),o()[0]<0?(l=$(l),d=$(d),i(_,C)):i(v,m),f}return f.base=function(T){return arguments.length?(s=+T,y()):s},f.domain=function(T){return arguments.length?(o(T),y()):o()},f.ticks=function(T){var P=o(),D=P[0],Q=P[P.length-1],X;(X=Q<D)&&(le=D,D=Q,Q=le);var le=l(D),Ue=l(Q),tt,Ot,xr,Tr=T==null?10:+T,jr=[];if(!(s%1)&&Ue-le<Tr){if(le=Math.round(le)-1,Ue=Math.round(Ue)+1,D>0){for(;le<Ue;++le)for(Ot=1,tt=d(le);Ot<s;++Ot)if(xr=tt*Ot,!(xr<D)){if(xr>Q)break;jr.push(xr)}}else for(;le<Ue;++le)for(Ot=s-1,tt=d(le);Ot>=1;--Ot)if(xr=tt*Ot,!(xr<D)){if(xr>Q)break;jr.push(xr)}}else jr=Wi(le,Ue,Math.min(Ue-le,Tr)).map(d);return X?jr.reverse():jr},f.tickFormat=function(T,P){if(P==null&&(P=s===10?".0e":","),typeof P!="function"&&(P=Jh(P)),T===Infinity)return P;T==null&&(T=10);var D=Math.max(1,s*T/f.ticks().length);return function(Q){var X=Q/d(Math.round(l(Q)));return X*s<s-.5&&(X*=s),X<=D?P(Q):""}},f.nice=function(){return o(c(o(),{floor:function(T){return d(Math.floor(l(T)))},ceil:function(T){return d(Math.ceil(l(T)))}}))},f}function pe(){var i=se(wf()).domain([1,10]);return i.copy=function(){return th(i,pe()).base(i.base())},_r.apply(i,arguments),i}function Ze(i){return function(f){return Math.sign(f)*Math.log1p(Math.abs(f/i))}}function We(i){return function(f){return Math.sign(f)*Math.expm1(Math.abs(f))*i}}function ot(i){var f=1,o=i(Ze(f),We(f));return o.constant=function(s){return arguments.length?i(Ze(f=+s),We(f)):f},linearish(o)}function Qe(){var i=ot(transformer());return i.copy=function(){return copy(i,Qe()).constant(i.constant())},initRange.apply(i,arguments)}function At(i){return function(f){return f<0?-Math.pow(-f,i):Math.pow(f,i)}}function Gt(i){return i<0?-Math.sqrt(-i):Math.sqrt(i)}function ir(i){return i<0?-i*i:i*i}function hr(i){var f=i(Vo,Vo),o=1;function s(){return o===1?i(Vo,Vo):o===.5?i(Gt,ir):i(At(o),At(1/o))}return f.exponent=function(l){return arguments.length?(o=+l,s()):o},e(f)}function Cr(){var i=hr(wf());return i.copy=function(){return th(i,Cr()).exponent(i.exponent())},_r.apply(i,arguments),i}function tn(){return Cr.apply(null,arguments).exponent(.5)}function pn(){var i=[],f=[],o=[],s;function l(){var y=0,T=Math.max(1,f.length);for(o=new Array(T-1);++y<T;)o[y-1]=qt(i,y/T);return d}function d(y){return isNaN(y=+y)?s:f[Qo(o,y)]}return d.invertExtent=function(y){var T=f.indexOf(y);return T<0?[NaN,NaN]:[T>0?o[T-1]:i[0],T<o.length?o[T]:i[i.length-1]]},d.domain=function(y){if(!arguments.length)return i.slice();i=[];for(var T=0,P=y.length,D;T<P;++T)D=y[T],D!=null&&!isNaN(D=+D)&&i.push(D);return i.sort(Hi),l()},d.range=function(y){return arguments.length?(f=Rt.call(y),l()):f.slice()},d.unknown=function(y){return arguments.length?(s=y,d):s},d.quantiles=function(){return o.slice()},d.copy=function(){return pn().domain(i).range(f).unknown(s)},_r.apply(d,arguments)}function Wn(){var i=0,f=1,o=1,s=[.5],l=[0,1],d;function y(P){return P<=P?l[Qo(s,P,0,o)]:d}function T(){var P=-1;for(s=new Array(o);++P<o;)s[P]=((P+1)*f-(P-o)*i)/(o+1);return y}return y.domain=function(P){return arguments.length?(i=+P[0],f=+P[1],T()):[i,f]},y.range=function(P){return arguments.length?(o=(l=Rt.call(P)).length-1,T()):l.slice()},y.invertExtent=function(P){var D=l.indexOf(P);return D<0?[NaN,NaN]:D<1?[i,s[0]]:D>=o?[s[o-1],f]:[s[D-1],s[D]]},y.unknown=function(P){return arguments.length&&(d=P),y},y.thresholds=function(){return s.slice()},y.copy=function(){return Wn().domain([i,f]).range(l).unknown(d)},_r.apply(e(y),arguments)}function Sn(){var i=[.5],f=[0,1],o,s=1;function l(d){return d<=d?f[Qo(i,d,0,s)]:o}return l.domain=function(d){return arguments.length?(i=Rt.call(d),s=Math.min(i.length,f.length-1),l):i.slice()},l.range=function(d){return arguments.length?(f=Rt.call(d),s=Math.min(i.length,f.length-1),l):f.slice()},l.invertExtent=function(d){var y=f.indexOf(d);return[i[y-1],i[y]]},l.unknown=function(d){return arguments.length?(o=d,l):o},l.copy=function(){return Sn().domain(i).range(f).unknown(o)},_r.apply(l,arguments)}var Kn=new Date,En=new Date;function si(i,f,o,s){function l(d){return i(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return i(d=new Date(+d)),d},l.ceil=function(d){return i(d=new Date(d-1)),f(d,1),i(d),d},l.round=function(d){var y=l(d),T=l.ceil(d);return d-y<T-d?y:T},l.offset=function(d,y){return f(d=new Date(+d),y==null?1:Math.floor(y)),d},l.range=function(d,y,T){var P=[],D;if(d=l.ceil(d),T=T==null?1:Math.floor(T),!(d<y)||!(T>0))return P;do P.push(D=new Date(+d)),f(d,T),i(d);while(D<d&&d<y);return P},l.filter=function(d){return si(function(y){if(y>=y)for(;i(y),!d(y);)y.setTime(y-1)},function(y,T){if(y>=y)if(T<0)for(;++T<=0;)for(;f(y,-1),!d(y););else for(;--T>=0;)for(;f(y,1),!d(y););})},o&&(l.count=function(d,y){return Kn.setTime(+d),En.setTime(+y),i(Kn),i(En),Math.floor(o(Kn,En))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(y){return s(y)%d==0}:function(y){return l.count(0,y)%d==0}):l}),l}var ui=si(function(i){i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,f){i.setFullYear(i.getFullYear()+f)},function(i,f){return f.getFullYear()-i.getFullYear()},function(i){return i.getFullYear()});ui.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:si(function(f){f.setFullYear(Math.floor(f.getFullYear()/i)*i),f.setMonth(0,1),f.setHours(0,0,0,0)},function(f,o){f.setFullYear(f.getFullYear()+o*i)})};var Ln=ui,na=ui.range,Pi=si(function(i){i.setDate(1),i.setHours(0,0,0,0)},function(i,f){i.setMonth(i.getMonth()+f)},function(i,f){return f.getMonth()-i.getMonth()+(f.getFullYear()-i.getFullYear())*12},function(i){return i.getMonth()}),ua=Pi,ei=Pi.range,la=1e3,Va=6e4,Ro=36e5,Po=864e5,mo=6048e5;function qa(i){return si(function(f){f.setDate(f.getDate()-(f.getDay()+7-i)%7),f.setHours(0,0,0,0)},function(f,o){f.setDate(f.getDate()+o*7)},function(f,o){return(o-f-(o.getTimezoneOffset()-f.getTimezoneOffset())*Va)/mo})}var cs=qa(0),es=qa(1),vu=qa(2),Fs=qa(3),_s=qa(4),ts=qa(5),Ns=qa(6),oa=cs.range,eo=es.range,ka=vu.range,da=Fs.range,Xu=_s.range,mu=ts.range,Eo=Ns.range,rs=si(function(i){i.setHours(0,0,0,0)},function(i,f){i.setDate(i.getDate()+f)},function(i,f){return(f-i-(f.getTimezoneOffset()-i.getTimezoneOffset())*Va)/Po},function(i){return i.getDate()-1}),Bs=rs,Sa=rs.range,wc=si(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*la-i.getMinutes()*Va)},function(i,f){i.setTime(+i+f*Ro)},function(i,f){return(f-i)/Ro},function(i){return i.getHours()}),Sl=wc,of=wc.range,Go=si(function(i){i.setTime(i-i.getMilliseconds()-i.getSeconds()*la)},function(i,f){i.setTime(+i+f*Va)},function(i,f){return(f-i)/Va},function(i){return i.getMinutes()}),Xc=Go,Tc=Go.range,Hf=si(function(i){i.setTime(i-i.getMilliseconds())},function(i,f){i.setTime(+i+f*la)},function(i,f){return(f-i)/la},function(i){return i.getUTCSeconds()}),Wf=Hf,Ch=Hf.range,cc=si(function(){},function(i,f){i.setTime(+i+f)},function(i,f){return f-i});cc.every=function(i){return i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?si(function(f){f.setTime(Math.floor(f/i)*i)},function(f,o){f.setTime(+f+o*i)},function(f,o){return(o-f)/i}):cc};var ih=cc,xp=cc.range;function fc(i){return si(function(f){f.setUTCDate(f.getUTCDate()-(f.getUTCDay()+7-i)%7),f.setUTCHours(0,0,0,0)},function(f,o){f.setUTCDate(f.getUTCDate()+o*7)},function(f,o){return(o-f)/mo})}var ah=fc(0),Xf=fc(1),Qh=fc(2),sf=fc(3),Yc=fc(4),oh=fc(5),Af=fc(6),Ph=ah.range,bp=Xf.range,Sp=Qh.range,qh=sf.range,ep=Yc.range,Ep=oh.range,tp=Af.range,sh=si(function(i){i.setUTCHours(0,0,0,0)},function(i,f){i.setUTCDate(i.getUTCDate()+f)},function(i,f){return(f-i)/Po},function(i){return i.getUTCDate()-1}),uh=sh,wp=sh.range,Cf=si(function(i){i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,f){i.setUTCFullYear(i.getUTCFullYear()+f)},function(i,f){return f.getUTCFullYear()-i.getUTCFullYear()},function(i){return i.getUTCFullYear()});Cf.every=function(i){return!isFinite(i=Math.floor(i))||!(i>0)?null:si(function(f){f.setUTCFullYear(Math.floor(f.getUTCFullYear()/i)*i),f.setUTCMonth(0,1),f.setUTCHours(0,0,0,0)},function(f,o){f.setUTCFullYear(f.getUTCFullYear()+o*i)})};var Pf=Cf,Mh=Cf.range;function Yf(i){if(0<=i.y&&i.y<100){var f=new Date(-1,i.m,i.d,i.H,i.M,i.S,i.L);return f.setFullYear(i.y),f}return new Date(i.y,i.m,i.d,i.H,i.M,i.S,i.L)}function uf(i){if(0<=i.y&&i.y<100){var f=new Date(Date.UTC(-1,i.m,i.d,i.H,i.M,i.S,i.L));return f.setUTCFullYear(i.y),f}return new Date(Date.UTC(i.y,i.m,i.d,i.H,i.M,i.S,i.L))}function lf(i,f,o){return{y:i,m:f,d:o,H:0,M:0,S:0,L:0}}function lh(i){var f=i.dateTime,o=i.date,s=i.time,l=i.periods,d=i.days,y=i.shortDays,T=i.months,P=i.shortMonths,D=cf(l),Q=wo(l),X=cf(d),le=wo(d),Ue=cf(y),tt=wo(y),Ot=cf(T),xr=wo(T),Tr=cf(P),jr=wo(P),dn={a:cp,A:fp,b:df,B:d0,c:null,d:Dh,e:Dh,f:Kf,g:ff,G:Rp,H:td,I:Kc,j:Md,L:Mp,m:ch,M:fh,p:v0,q:m0,Q:Fp,s:dh,S:hh,u:ph,U:rd,V:nd,w:id,W:Op,x:null,X:null,y:Lp,Y:ad,Z:Dp,"%":zh},bn={a:g0,A:y0,b:_0,B:x0,c:null,d:kp,e:kp,f:ud,g:kd,G:Fd,H:zp,I:od,j:sd,L:ap,m:kh,M:ld,p:b0,q:S0,Q:Fp,s:dh,S:op,u:Id,U:cd,V:Od,w:Ld,W:Rd,x:null,X:null,y:Dd,Y:zd,Z:$c,"%":zh},Vn={a:Fa,A:gi,b:wa,B:oo,c:Yu,d:Lh,e:Lh,f:Qp,g:Cc,G:Ih,H:Pp,I:Pp,j:Cp,L:Jp,m:ip,M:Rh,p:Ia,q:Oh,Q:ed,s:El,S:$p,u:Pd,U:Mf,V:Ap,w:Ac,W:Kp,x:up,X:lp,y:Cc,Y:Ih,Z:np,"%":qp};dn.x=Mi(o,dn),dn.X=Mi(s,dn),dn.c=Mi(f,dn),bn.x=Mi(o,bn),bn.X=Mi(s,bn),bn.c=Mi(f,bn);function Mi(xi,Na){return function(go){var Pn=[],hc=-1,fs=0,Pc=xi.length,Mc,Bh,Zm;for(go instanceof Date||(go=new Date(+go));++hc<Pc;)xi.charCodeAt(hc)===37&&(Pn.push(xi.slice(fs,hc)),(Bh=rp[Mc=xi.charAt(++hc)])!=null?Mc=xi.charAt(++hc):Bh=Mc==="e"?" ":"0",(Zm=Na[Mc])&&(Mc=Zm(go,Bh)),Pn.push(Mc),fs=hc+1);return Pn.push(xi.slice(fs,hc)),Pn.join("")}}function ti(xi,Na){return function(go){var Pn=lf(1900,void 0,1),hc=ra(Pn,xi,go+="",0),fs,Pc;if(hc!=go.length)return null;if("Q"in Pn)return new Date(Pn.Q);if("s"in Pn)return new Date(Pn.s*1e3+("L"in Pn?Pn.L:0));if(Na&&!("Z"in Pn)&&(Pn.Z=0),"p"in Pn&&(Pn.H=Pn.H%12+Pn.p*12),Pn.m===void 0&&(Pn.m="q"in Pn?Pn.q:0),"V"in Pn){if(Pn.V<1||Pn.V>53)return null;"w"in Pn||(Pn.w=1),"Z"in Pn?(fs=uf(lf(Pn.y,0,1)),Pc=fs.getUTCDay(),fs=Pc>4||Pc===0?Xf.ceil(fs):Xf(fs),fs=uh.offset(fs,(Pn.V-1)*7),Pn.y=fs.getUTCFullYear(),Pn.m=fs.getUTCMonth(),Pn.d=fs.getUTCDate()+(Pn.w+6)%7):(fs=Yf(lf(Pn.y,0,1)),Pc=fs.getDay(),fs=Pc>4||Pc===0?es.ceil(fs):es(fs),fs=Bs.offset(fs,(Pn.V-1)*7),Pn.y=fs.getFullYear(),Pn.m=fs.getMonth(),Pn.d=fs.getDate()+(Pn.w+6)%7)}else("W"in Pn||"U"in Pn)&&("w"in Pn||(Pn.w="u"in Pn?Pn.u%7:"W"in Pn?1:0),Pc="Z"in Pn?uf(lf(Pn.y,0,1)).getUTCDay():Yf(lf(Pn.y,0,1)).getDay(),Pn.m=0,Pn.d="W"in Pn?(Pn.w+6)%7+Pn.W*7-(Pc+5)%7:Pn.w+Pn.U*7-(Pc+6)%7);return"Z"in Pn?(Pn.H+=Pn.Z/100|0,Pn.M+=Pn.Z%100,uf(Pn)):Yf(Pn)}}function ra(xi,Na,go,Pn){for(var hc=0,fs=Na.length,Pc=go.length,Mc,Bh;hc<fs;){if(Pn>=Pc)return-1;if(Mc=Na.charCodeAt(hc++),Mc===37){if(Mc=Na.charAt(hc++),Bh=Vn[Mc in rp?Na.charAt(hc++):Mc],!Bh||(Pn=Bh(xi,go,Pn))<0)return-1}else if(Mc!=go.charCodeAt(Pn++))return-1}return Pn}function Ia(xi,Na,go){var Pn=D.exec(Na.slice(go));return Pn?(xi.p=Q[Pn[0].toLowerCase()],go+Pn[0].length):-1}function Fa(xi,Na,go){var Pn=Ue.exec(Na.slice(go));return Pn?(xi.w=tt[Pn[0].toLowerCase()],go+Pn[0].length):-1}function gi(xi,Na,go){var Pn=X.exec(Na.slice(go));return Pn?(xi.w=le[Pn[0].toLowerCase()],go+Pn[0].length):-1}function wa(xi,Na,go){var Pn=Tr.exec(Na.slice(go));return Pn?(xi.m=jr[Pn[0].toLowerCase()],go+Pn[0].length):-1}function oo(xi,Na,go){var Pn=Ot.exec(Na.slice(go));return Pn?(xi.m=xr[Pn[0].toLowerCase()],go+Pn[0].length):-1}function Yu(xi,Na,go){return ra(xi,f,Na,go)}function up(xi,Na,go){return ra(xi,o,Na,go)}function lp(xi,Na,go){return ra(xi,s,Na,go)}function cp(xi){return y[xi.getDay()]}function fp(xi){return d[xi.getDay()]}function df(xi){return P[xi.getMonth()]}function d0(xi){return T[xi.getMonth()]}function v0(xi){return l[+(xi.getHours()>=12)]}function m0(xi){return 1+~~(xi.getMonth()/3)}function g0(xi){return y[xi.getUTCDay()]}function y0(xi){return d[xi.getUTCDay()]}function _0(xi){return P[xi.getUTCMonth()]}function x0(xi){return T[xi.getUTCMonth()]}function b0(xi){return l[+(xi.getUTCHours()>=12)]}function S0(xi){return 1+~~(xi.getUTCMonth()/3)}return{format:function(xi){var Na=Mi(xi+="",dn);return Na.toString=function(){return xi},Na},parse:function(xi){var Na=ti(xi+="",!1);return Na.toString=function(){return xi},Na},utcFormat:function(xi){var Na=Mi(xi+="",bn);return Na.toString=function(){return xi},Na},utcParse:function(xi){var Na=ti(xi+="",!0);return Na.toString=function(){return xi},Na}}}var rp={"-":"",_:" ","0":"0"},ou=/^\s*\d+/,Tp=/^%/,Yp=/[\\^$*+?|[\]().{}]/g;function za(i,f,o){var s=i<0?"-":"",l=(s?-i:i)+"",d=l.length;return s+(d<o?new Array(o-d+1).join(f)+l:l)}function Cd(i){return i.replace(Yp,"\\$&")}function cf(i){return new RegExp("^(?:"+i.map(Cd).join("|")+")","i")}function wo(i){for(var f={},o=-1,s=i.length;++o<s;)f[i[o].toLowerCase()]=o;return f}function Ac(i,f,o){var s=ou.exec(f.slice(o,o+1));return s?(i.w=+s[0],o+s[0].length):-1}function Pd(i,f,o){var s=ou.exec(f.slice(o,o+1));return s?(i.u=+s[0],o+s[0].length):-1}function Mf(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.U=+s[0],o+s[0].length):-1}function Ap(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.V=+s[0],o+s[0].length):-1}function Kp(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.W=+s[0],o+s[0].length):-1}function Ih(i,f,o){var s=ou.exec(f.slice(o,o+4));return s?(i.y=+s[0],o+s[0].length):-1}function Cc(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function np(i,f,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(f.slice(o,o+6));return s?(i.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Oh(i,f,o){var s=ou.exec(f.slice(o,o+1));return s?(i.q=s[0]*3-3,o+s[0].length):-1}function ip(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.m=s[0]-1,o+s[0].length):-1}function Lh(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.d=+s[0],o+s[0].length):-1}function Cp(i,f,o){var s=ou.exec(f.slice(o,o+3));return s?(i.m=0,i.d=+s[0],o+s[0].length):-1}function Pp(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.H=+s[0],o+s[0].length):-1}function Rh(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.M=+s[0],o+s[0].length):-1}function $p(i,f,o){var s=ou.exec(f.slice(o,o+2));return s?(i.S=+s[0],o+s[0].length):-1}function Jp(i,f,o){var s=ou.exec(f.slice(o,o+3));return s?(i.L=+s[0],o+s[0].length):-1}function Qp(i,f,o){var s=ou.exec(f.slice(o,o+6));return s?(i.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function qp(i,f,o){var s=Tp.exec(f.slice(o,o+1));return s?o+s[0].length:-1}function ed(i,f,o){var s=ou.exec(f.slice(o));return s?(i.Q=+s[0],o+s[0].length):-1}function El(i,f,o){var s=ou.exec(f.slice(o));return s?(i.s=+s[0],o+s[0].length):-1}function Dh(i,f){return za(i.getDate(),f,2)}function td(i,f){return za(i.getHours(),f,2)}function Kc(i,f){return za(i.getHours()%12||12,f,2)}function Md(i,f){return za(1+Bs.count(Ln(i),i),f,3)}function Mp(i,f){return za(i.getMilliseconds(),f,3)}function Kf(i,f){return Mp(i,f)+"000"}function ch(i,f){return za(i.getMonth()+1,f,2)}function fh(i,f){return za(i.getMinutes(),f,2)}function hh(i,f){return za(i.getSeconds(),f,2)}function ph(i){var f=i.getDay();return f===0?7:f}function rd(i,f){return za(cs.count(Ln(i)-1,i),f,2)}function Ip(i){var f=i.getDay();return f>=4||f===0?_s(i):_s.ceil(i)}function nd(i,f){return i=Ip(i),za(_s.count(Ln(i),i)+(Ln(i).getDay()===4),f,2)}function id(i){return i.getDay()}function Op(i,f){return za(es.count(Ln(i)-1,i),f,2)}function Lp(i,f){return za(i.getFullYear()%100,f,2)}function ff(i,f){return i=Ip(i),za(i.getFullYear()%100,f,2)}function ad(i,f){return za(i.getFullYear()%1e4,f,4)}function Rp(i,f){var o=i.getDay();return i=o>=4||o===0?_s(i):_s.ceil(i),za(i.getFullYear()%1e4,f,4)}function Dp(i){var f=i.getTimezoneOffset();return(f>0?"-":(f*=-1,"+"))+za(f/60|0,"0",2)+za(f%60,"0",2)}function kp(i,f){return za(i.getUTCDate(),f,2)}function zp(i,f){return za(i.getUTCHours(),f,2)}function od(i,f){return za(i.getUTCHours()%12||12,f,2)}function sd(i,f){return za(1+uh.count(Pf(i),i),f,3)}function ap(i,f){return za(i.getUTCMilliseconds(),f,3)}function ud(i,f){return ap(i,f)+"000"}function kh(i,f){return za(i.getUTCMonth()+1,f,2)}function ld(i,f){return za(i.getUTCMinutes(),f,2)}function op(i,f){return za(i.getUTCSeconds(),f,2)}function Id(i){var f=i.getUTCDay();return f===0?7:f}function cd(i,f){return za(ah.count(Pf(i)-1,i),f,2)}function fd(i){var f=i.getUTCDay();return f>=4||f===0?Yc(i):Yc.ceil(i)}function Od(i,f){return i=fd(i),za(Yc.count(Pf(i),i)+(Pf(i).getUTCDay()===4),f,2)}function Ld(i){return i.getUTCDay()}function Rd(i,f){return za(Xf.count(Pf(i)-1,i),f,2)}function Dd(i,f){return za(i.getUTCFullYear()%100,f,2)}function kd(i,f){return i=fd(i),za(i.getUTCFullYear()%100,f,2)}function zd(i,f){return za(i.getUTCFullYear()%1e4,f,4)}function Fd(i,f){var o=i.getUTCDay();return i=o>=4||o===0?Yc(i):Yc.ceil(i),za(i.getUTCFullYear()%1e4,f,4)}function $c(){return"+0000"}function zh(){return"%"}function Fp(i){return+i}function dh(i){return Math.floor(+i/1e3)}var $f,Xd,Vm,Gm,Hm;Wm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Wm(i){return $f=lh(i),Xd=$f.format,Vm=$f.parse,Gm=$f.utcFormat,Hm=$f.utcParse,$f}var Np=1e3,Bp=Np*60,Up=Bp*60,jp=Up*24,Xm=jp*7,Yd=jp*30,Nd=jp*365;function Ym(i){return new Date(i)}function Km(i){return i instanceof Date?+i:+new Date(+i)}function Kd(i,f,o,s,l,d,y,T,P){var D=mp(Vo,Vo),Q=D.invert,X=D.domain,le=P(".%L"),Ue=P(":%S"),tt=P("%I:%M"),Ot=P("%I %p"),xr=P("%a %d"),Tr=P("%b %d"),jr=P("%B"),dn=P("%Y"),bn=[[y,1,Np],[y,5,5*Np],[y,15,15*Np],[y,30,30*Np],[d,1,Bp],[d,5,5*Bp],[d,15,15*Bp],[d,30,30*Bp],[l,1,Up],[l,3,3*Up],[l,6,6*Up],[l,12,12*Up],[s,1,jp],[s,2,2*jp],[o,1,Xm],[f,1,Yd],[f,3,3*Yd],[i,1,Nd]];function Vn(ti){return(y(ti)<ti?le:d(ti)<ti?Ue:l(ti)<ti?tt:s(ti)<ti?Ot:f(ti)<ti?o(ti)<ti?xr:Tr:i(ti)<ti?jr:dn)(ti)}function Mi(ti,ra,Ia,Fa){if(ti==null&&(ti=10),typeof ti=="number"){var gi=Math.abs(Ia-ra)/ti,wa=So(function(oo){return oo[2]}).right(bn,gi);wa===bn.length?(Fa=Co(ra/Nd,Ia/Nd,ti),ti=i):wa?(wa=bn[gi/bn[wa-1][2]<bn[wa][2]/gi?wa-1:wa],Fa=wa[1],ti=wa[0]):(Fa=Math.max(Co(ra,Ia,ti),1),ti=T)}return Fa==null?ti:ti.every(Fa)}return D.invert=function(ti){return new Date(Q(ti))},D.domain=function(ti){return arguments.length?X(Et.call(ti,Km)):X().map(Ym)},D.ticks=function(ti,ra){var Ia=X(),Fa=Ia[0],gi=Ia[Ia.length-1],wa=gi<Fa,oo;return wa&&(oo=Fa,Fa=gi,gi=oo),oo=Mi(ti,Fa,gi,ra),oo=oo?oo.range(Fa,gi+1):[],wa?oo.reverse():oo},D.tickFormat=function(ti,ra){return ra==null?Vn:P(ra)},D.nice=function(ti,ra){var Ia=X();return(ti=Mi(ti,Ia[0],Ia[Ia.length-1],ra))?X(c(Ia,ti)):D},D.copy=function(){return th(D,Kd(i,f,o,s,l,d,y,T,P))},D}function $m(){return _r.apply(Kd(Ln,ua,cs,Bs,Sl,Xc,Wf,ih,Xd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function E0(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function hd(){var i=0,f=1,o,s,l,d,y=identity,T=!1,P;function D(Q){return isNaN(Q=+Q)?P:y(l===0?.5:(Q=(d(Q)-o)*l,T?Math.max(0,Math.min(1,Q)):Q))}return D.domain=function(Q){return arguments.length?(o=d(i=+Q[0]),s=d(f=+Q[1]),l=o===s?0:1/(s-o),D):[i,f]},D.clamp=function(Q){return arguments.length?(T=!!Q,D):T},D.interpolator=function(Q){return arguments.length?(y=Q,D):y},D.unknown=function(Q){return arguments.length?(P=Q,D):P},function(Q){return d=Q,o=Q(i),s=Q(f),l=o===s?0:1/(s-o),D}}function pd(i,f){return f.domain(i.domain()).interpolator(i.interpolator()).clamp(i.clamp()).unknown(i.unknown())}function Jm(){var i=linearish(hd()(identity));return i.copy=function(){return pd(i,Jm())},initInterpolator.apply(i,arguments)}function Qm(){var i=loggish(hd()).domain([1,10]);return i.copy=function(){return pd(i,Qm()).base(i.base())},initInterpolator.apply(i,arguments)}function qm(){var i=symlogish(hd());return i.copy=function(){return pd(i,qm()).constant(i.constant())},initInterpolator.apply(i,arguments)}function $d(){var i=powish(hd());return i.copy=function(){return pd(i,$d()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function w0(){return $d.apply(null,arguments).exponent(.5)}function eg(){var i=[],f=identity;function o(s){if(!isNaN(s=+s))return f((bisect(i,s)-1)/(i.length-1))}return o.domain=function(s){if(!arguments.length)return i.slice();i=[];for(var l=0,d=s.length,y;l<d;++l)y=s[l],y!=null&&!isNaN(y=+y)&&i.push(y);return i.sort(ascending),o},o.interpolator=function(s){return arguments.length?(f=s,o):f},o.copy=function(){return eg(f).domain(i)},initInterpolator.apply(o,arguments)}function dd(){var i=0,f=.5,o=1,s,l,d,y,T,P=identity,D,Q=!1,X;function le(Ue){return isNaN(Ue=+Ue)?X:(Ue=.5+((Ue=+D(Ue))-l)*(Ue<l?y:T),P(Q?Math.max(0,Math.min(1,Ue)):Ue))}return le.domain=function(Ue){return arguments.length?(s=D(i=+Ue[0]),l=D(f=+Ue[1]),d=D(o=+Ue[2]),y=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),le):[i,f,o]},le.clamp=function(Ue){return arguments.length?(Q=!!Ue,le):Q},le.interpolator=function(Ue){return arguments.length?(P=Ue,le):P},le.unknown=function(Ue){return arguments.length?(X=Ue,le):X},function(Ue){return D=Ue,s=Ue(i),l=Ue(f),d=Ue(o),y=s===l?0:.5/(l-s),T=l===d?0:.5/(d-l),le}}function tg(){var i=linearish(dd()(identity));return i.copy=function(){return copy(i,tg())},initInterpolator.apply(i,arguments)}function rg(){var i=loggish(dd()).domain([.1,1,10]);return i.copy=function(){return copy(i,rg()).base(i.base())},initInterpolator.apply(i,arguments)}function ng(){var i=symlogish(dd());return i.copy=function(){return copy(i,ng()).constant(i.constant())},initInterpolator.apply(i,arguments)}function Jd(){var i=powish(dd());return i.copy=function(){return copy(i,Jd()).exponent(i.exponent())},initInterpolator.apply(i,arguments)}function T0(){return Jd.apply(null,arguments).exponent(.5)}var hf,Qd,qd,ev,tv,vd,rv,nv,iv,ig=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ag=(hf={},(0,z.Z)(hf,w.ScaleTypes.LINEAR,t),(0,z.Z)(hf,w.ScaleTypes.POWER,Cr),(0,z.Z)(hf,w.ScaleTypes.LOG,pe),(0,z.Z)(hf,w.ScaleTypes.IDENTITY,r),(0,z.Z)(hf,w.ScaleTypes.TIME,$m),(0,z.Z)(hf,w.ScaleTypes.QUANTILE,pn),(0,z.Z)(hf,w.ScaleTypes.QUANTIZE,Wn),(0,z.Z)(hf,w.ScaleTypes.THRESHOLD,Sn),(0,z.Z)(hf,w.ScaleTypes.CAT,Gr),hf),og=(Qd=(0,H.b2)(),qd=(0,H.f3)(w.vK.IGlobalConfigService),ev=(0,H.f3)(w.vK.ILogService),Qd(tv=(vd=(iv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"configService",rv,this),(0,Rn.Z)(this,"logger",nv,this),this.scaleCache={},this.scaleOptions={}}return(0,ce.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),T=o.getSource().data.dataArray;T.length!==0&&l.caculateScalesForAttributes(y||[],T)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),T=o.getSource().data.dataArray;return l.caculateScalesForAttributes(y||[],T),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes();if(y){var T=o.getSource().data.dataArray;if(T.length===0)return;var P=y.filter(function(D){return D.needRescale});P.length&&(l.caculateScalesForAttributes(P,T),l.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var l=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var y=d.scale,T=d.name;y.names=l.parseFields(d.scale.field||[]);var P=[];y.names.forEach(function(D){P.push(l.getOrCreateScale(D,d,s))}),P.some(function(D){return D.type===w.StyleScaleType.VARIABLE})?(y.type=w.StyleScaleType.VARIABLE,P.forEach(function(D){if(!y.callback){var Q;if(y.values&&y.values!=="text"){var X;if(((X=D.option)===null||X===void 0?void 0:X.type)==="linear"&&y.values.length>2){var le=D.scale.ticks(y.values.length);T==="color"&&D.scale.domain(le)}D.scale.range(y.values)}else((Q=D.option)===null||Q===void 0?void 0:Q.type)==="cat"&&D.scale.range(D.option.domain)}})):(y.type=w.StyleScaleType.CONSTANT,y.defaultValues=P.map(function(D,Q){return D.scale(y.names[Q])})),y.scalers=P.map(function(D){return{field:D.field,func:D.scale,option:D.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,l){var d,y=[o,s.name].join("_"),T=(d=s.scale)===null||d===void 0?void 0:d.values,P=this.createScale(o,s.name,T,l);return P}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:$o()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,l,d){var y,T,P=this.scaleOptions[s]&&((y=this.scaleOptions[s])===null||y===void 0?void 0:y.field)===o?this.scaleOptions[s]:this.scaleOptions[o],D={field:o,scale:void 0,type:w.StyleScaleType.VARIABLE,option:P};if(!d||!d.length)return P&&P.type?D.scale=this.createDefaultScale(P):(D.scale=Gr([o]),D.type=w.StyleScaleType.CONSTANT),D;var Q=(T=d.find(function(Ue){return!Dr()(Ue[o])}))===null||T===void 0?void 0:T[o];if(this.isNumber(o)||Dr()(Q)&&!P)D.scale=Gr([o]),D.type=w.StyleScaleType.CONSTANT;else{var X=P&&P.type||this.getDefaultType(Q);l==="text"&&(X=w.ScaleTypes.CAT);var le=this.createDefaultScaleConfig(X,o,d);Object.assign(le,P),D.scale=this.createDefaultScale(le),D.option=le}return D}},{key:"getDefaultType",value:function(o){var s=w.ScaleTypes.LINEAR;return typeof o=="string"&&(s=ig.test(o)?w.ScaleTypes.TIME:w.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,l){var d={type:o},y=(l==null?void 0:l.map(function(T){return T[s]}))||[];return o!==w.ScaleTypes.CAT&&o!==w.ScaleTypes.QUANTILE?d.domain=un(y):o===w.ScaleTypes.CAT?d.domain=Hr()(y):o===w.ScaleTypes.QUANTILE&&(d.domain=y),d}},{key:"createDefaultScale",value:function(o){var s=o.type,l=o.domain,d=ag[s]();return l&&d.domain(l),d}}]),i}(),iv),rv=(0,Dn.Z)(vd.prototype,"configService",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=(0,Dn.Z)(vd.prototype,"logger",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd))||tv),av,ov,sv,uv,md,lv,cv,fv;function hv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function sg(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?hv(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):hv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var ug=(av=(0,H.b2)(),ov=(0,H.f3)(w.vK.ICameraService),sv=(0,H.f3)(w.vK.IRendererService),av(uv=(md=(fv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"cameraService",lv,this),(0,Rn.Z)(this,"rendererService",cv,this)}return(0,ce.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(sg({},o.layerModel.getAnimateUniforms()))})})}}]),i}(),fv),lv=(0,Dn.Z)(md.prototype,"cameraService",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cv=(0,Dn.Z)(md.prototype,"rendererService",[sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md))||uv),pv,dv,lg=(pv=(0,H.b2)(),pv(dv=function(){function i(){(0,Y.Z)(this,i)}return(0,ce.Z)(i,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),i}())||dv),vv,mv,cg=(vv=(0,H.b2)(),vv(mv=function(){function i(){(0,Y.Z)(this,i)}return(0,ce.Z)(i,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(d)},100)})}}]),i}())||mv),gv,yv;function _v(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Zp(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?_v(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):_v(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var xv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},fg={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},hg={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},pg={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},A0=null;function dg(i){var f={u_DirectionalLights:new Array(3).fill(Zp({},hg)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Zp({},pg)),u_NumOfSpotLights:0};return(!i||!i.length)&&(i=[fg]),i.forEach(function(o,s){var l=o.type,d=l===void 0?"directional":l,y=(0,Zi.Z)(o,["type"]),T=xv[d].lights,P=xv[d].num,D=f[P];f[T][D]=Zp(Zp({},f[T][D]),y),f[P]++}),f}var vg=(gv=(0,H.b2)(),gv(yv=function(){function i(){(0,Y.Z)(this,i)}return(0,ce.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),l=s.enableLighting;l&&o.models.forEach(function(d){return d.addUniforms(Zp({},dg()))})})}}]),i}())||yv),bv,Sv,gd={NONE:0,ENCODE:1,HIGHLIGHT:2},mg=(bv=(0,H.b2)(),bv(Sv=function(){function i(){(0,Y.Z)(this,i)}return(0,ce.Z)(i,[{key:"apply",value:function(o,s){var l=s.rendererService,d=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),T=y.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:w.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(D,Q){var X=D.id;return T?(0,Me.Z6)(X):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),T=y.enablePicking;T&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:gd.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),T=y.enablePicking;T&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:gd.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(y){var T=o.getLayerConfig(),P=T.highlightColor,D=typeof P=="string"?(0,Me.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,Me.W0)(new Uint8Array(y))}),o.models.forEach(function(Q){return Q.addUniforms({u_PickingStage:gd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:D.map(function(X){return X*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(y){var T=o.getLayerConfig(),P=T.selectColor,D=typeof P=="string"?(0,Me.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,Me.W0)(new Uint8Array(y))}),o.models.forEach(function(Q){return Q.addUniforms({u_PickingStage:gd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:D.map(function(X){return X*255})})})})}}]),i}())||Sv),Ev,wv,Tv,Bd,Av,Cv,gg=(Ev=(0,H.b2)(),wv=(0,H.f3)(w.vK.ILogService),Ev(Tv=(Bd=(Cv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"logger",Av,this)}return(0,ce.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:w.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(l,d,y){return y.length===2?[y[0],y[1],0]:[y[0],y[1],y[2]]}}}),o.registerStyleAttribute({name:"filter",type:w.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(l,d){var y=l.filter;return y?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:w.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(l,d){var y=l.color;return!y||!y.length?[1,1,1,1]:y}}})}}]),i}(),Cv),Av=(0,Dn.Z)(Bd.prototype,"logger",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd))||Tv),Pv,Mv,Iv,Ov,Lv,Rv,sp,Dv,kv,zv,Fv,Nv,yg=(Pv=(0,H.b2)(),Mv=(0,H.f3)(w.vK.ICameraService),Iv=(0,H.f3)(w.vK.ICoordinateSystemService),Ov=(0,H.f3)(w.vK.IRendererService),Lv=(0,H.f3)(w.vK.IMapService),Pv(Rv=(sp=(Nv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"cameraService",Dv,this),(0,Rn.Z)(this,"coordinateSystemService",kv,this),(0,Rn.Z)(this,"rendererService",zv,this),(0,Rn.Z)(this,"mapService",Fv,this)}return(0,ce.Z)(i,[{key:"apply",value:function(o){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),y=s.mapService.getCustomCoordCenter());var T=s.rendererService.getViewportSize(),P=T.width,D=T.height;o.models.forEach(function(Q){var X;Q.addUniforms((X={},(0,z.Z)(X,w.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,z.Z)(X,w.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,z.Z)(X,w.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,z.Z)(X,w.CameraUniform.Zoom,s.cameraService.getZoom()),(0,z.Z)(X,w.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,z.Z)(X,w.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,z.Z)(X,w.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,z.Z)(X,w.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,z.Z)(X,w.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,z.Z)(X,w.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,z.Z)(X,w.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,z.Z)(X,w.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,z.Z)(X,w.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,z.Z)(X,w.CoordinateUniform.Mvp,d),(0,z.Z)(X,"u_SceneCenterMKT",y),(0,z.Z)(X,"u_ViewportSize",[P,D]),(0,z.Z)(X,"u_DevicePixelRatio",window.devicePixelRatio),(0,z.Z)(X,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,z.Z)(X,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),X))})})}}]),i}(),Nv),Dv=(0,Dn.Z)(sp.prototype,"cameraService",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kv=(0,Dn.Z)(sp.prototype,"coordinateSystemService",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zv=(0,Dn.Z)(sp.prototype,"rendererService",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=(0,Dn.Z)(sp.prototype,"mapService",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp))||Rv),Bv,Uv,_g=(Bv=(0,H.b2)(),Bv(Uv=function(){function i(){(0,Y.Z)(this,i)}return(0,ce.Z)(i,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),i}())||Uv),jv,Zv,Vv,Ud,Gv,Hv,xg=(jv=(0,H.b2)(),Zv=(0,H.f3)(w.vK.ILogService),jv(Vv=(Ud=(Hv=function(){function i(){(0,Y.Z)(this,i),(0,Rn.Z)(this,"logger",Gv,this)}return(0,ce.Z)(i,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[],T=d.getLayerStyleAttribute("filter"),P=d.getLayerStyleAttribute("shape");if(T&&T.needRegenerateVertices||P&&P.needRegenerateVertices){o.layerModelNeedUpdate=!0,y.forEach(function(D){return D.needRegenerateVertices=!1});return}y.filter(function(D){return D.needRegenerateVertices}).forEach(function(D){d.updateAttributeByFeatureRange(D.name,o.getEncodedData(),D.featureRange.startIndex,D.featureRange.endIndex),D.needRegenerateVertices=!1,l.logger.debug("regenerate vertex attributes: ".concat(D.name," finished"))})}},{key:"initStyleAttribute",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[];y.filter(function(T){return T.needRegenerateVertices}).forEach(function(T){d.updateAttributeByFeatureRange(T.name,o.getEncodedData(),T.featureRange.startIndex,T.featureRange.endIndex),T.needRegenerateVertices=!1,l.logger.debug("init vertex attributes: ".concat(T.name," finished"))})}}]),i}(),Hv),Gv=(0,Dn.Z)(Ud.prototype,"logger",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud))||Vv);w.nC.bind(w.vK.ILayerPlugin).to(Ft).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(gg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(og).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Cu).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(cg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(xg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(_g).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(Wa).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(yg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(ug).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(vg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(mg).inRequestScope(),w.nC.bind(w.vK.ILayerPlugin).to(lg).inRequestScope();var C0="2.4.2";function Wv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function P0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Wv(Object(o),!0).forEach(function(s){bg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Wv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function bg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function M0(i,f){return Tg(i)||wg(i,f)||Eg(i,f)||Sg()}function Sg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eg(i,f){if(!!i){if(typeof i=="string")return Xv(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Xv(i,f)}}function Xv(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function wg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function Tg(i){if(Array.isArray(i))return i}var I0=null,O0=null,Yv,Kv,yd,$v,Jv,Qv;function qv(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function em(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?qv(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):qv(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}var Ag=(Yv=(0,w.yT)(w.vK.ILogService),Kv=(0,w.yT)(w.vK.IGlobalConfigService),yd=(Qv=function(){function i(f){(0,Y.Z)(this,i),(0,Rn.Z)(this,"logger",$v,this),(0,Rn.Z)(this,"configService",Jv,this),this.config=void 0,this.config=f}return(0,ce.Z)(i,[{key:"setContainer",value:function(o,s){o.bind(w.vK.MapConfig).toConstantValue(em(em({},this.config),{},{id:s})),o.bind(w.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),i}(),Qv),$v=(0,Dn.Z)(yd.prototype,"logger",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jv=(0,Dn.Z)(yd.prototype,"configService",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd),Cg=x(6158),Pg=x.n(Cg),jd;(function(i){i["GAODE1.x"]="GAODE1.x",i["GAODE2.x"]="GAODE2.x",i.MAPBOX="MAPBOX",i.L7MAP="L7MAP"})(jd||(jd={}));function Vp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function _d(i,f){var o=eu.fF([],f,i);return eu.bA(o,o,1/o[3]),o}function L0(i,f){var o=i%f;return o<0?f+o:o}function R0(i,f,o){return o*f+(1-o)*i}function Fh(i,f){if(!i)throw new Error(f||"viewport-mercator-project: assertion failed.")}var pf=Math.PI,tm=pf/4,Jf=pf/180,rm=180/pf,Zd=512,Vd=4003e4,Mg=1.5;function nm(i){return Math.pow(2,i)}function Ig(i){return Math.log2(i)}function xd(i,f){var o=(0,q.Z)(i,2),s=o[0],l=o[1];Fh(Number.isFinite(s)&&Number.isFinite(f)),Fh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),f*=Zd;var d=s*Jf,y=l*Jf,T=f*(d+pf)/(2*pf),P=f*(pf-Math.log(Math.tan(tm+y*.5)))/(2*pf);return[T,P]}function Gd(i,f){var o=(0,q.Z)(i,2),s=o[0],l=o[1];f*=Zd;var d=s/f*(2*pf)-pf,y=2*(Math.atan(Math.exp(pf-l/f*(2*pf)))-tm);return[d*rm,y*rm]}function D0(i){var f=i.latitude;assert(Number.isFinite(f));var o=Math.cos(f*Jf);return Ig(Vd*o)-9}function im(i){var f=i.latitude,o=i.longitude,s=i.zoom,l=i.scale,d=i.highPrecision,y=d===void 0?!1:d;l=l!==void 0?l:nm(s),Fh(Number.isFinite(f)&&Number.isFinite(o)&&Number.isFinite(l));var T={},P=Zd*l,D=Math.cos(f*Jf),Q=P/360,X=Q/D,le=P/Vd/D;if(T.pixelsPerMeter=[le,-le,le],T.metersPerPixel=[1/le,-1/le,1/le],T.pixelsPerDegree=[Q,-X,le],T.degreesPerPixel=[1/Q,-1/X,1/le],y){var Ue=Jf*Math.tan(f*Jf)/D,tt=Q*Ue/2,Ot=P/Vd*Ue,xr=Ot/X*le;T.pixelsPerDegree2=[0,-tt,Ot],T.pixelsPerMeter2=[xr,0,xr]}return T}function k0(i,f){var o=_slicedToArray(i,3),s=o[0],l=o[1],d=o[2],y=_slicedToArray(f,3),T=y[0],P=y[1],D=y[2],Q=1,X=im({longitude:s,latitude:l,scale:Q,highPrecision:!0}),le=X.pixelsPerMeter,Ue=X.pixelsPerMeter2,tt=xd(i,Q);tt[0]+=T*(le[0]+Ue[0]*P),tt[1]+=P*(le[1]+Ue[1]*P);var Ot=Gd(tt,Q),xr=(d||0)+(D||0);return Number.isFinite(d)||Number.isFinite(D)?[Ot[0],Ot[1],xr]:Ot}function Og(i){var f=i.height,o=i.pitch,s=i.bearing,l=i.altitude,d=i.center,y=d===void 0?null:d,T=i.flipY,P=T===void 0?!1:T,D=Vp();return ba.translate(D,D,[0,0,-l]),ba.scale(D,D,[1,1,1/f]),ba.rotateX(D,D,-o*Jf),ba.rotateZ(D,D,s*Jf),P&&ba.scale(D,D,[1,-1,1]),y&&ba.translate(D,D,Ri.negate([],y)),D}function Lg(i){var f=i.width,o=i.height,s=i.altitude,l=s===void 0?Mg:s,d=i.pitch,y=d===void 0?0:d,T=i.nearZMultiplier,P=T===void 0?1:T,D=i.farZMultiplier,Q=D===void 0?1:D,X=y*Jf,le=Math.atan(.5/l),Ue=Math.sin(le)*l/Math.sin(Math.PI/2-X-le),tt=Math.cos(Math.PI/2-X)*Ue+l;return{fov:2*Math.atan(o/2/l),aspect:f/o,focalDistance:l,near:P,far:tt*Q}}function Rg(i){var f=i.width,o=i.height,s=i.pitch,l=i.altitude,d=i.nearZMultiplier,y=i.farZMultiplier,T=Lg({width:f,height:o,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:y}),P=T.fov,D=T.aspect,Q=T.near,X=T.far,le=ba.perspective([],P,D,Q,X);return le}function Dg(i,f){var o=(0,q.Z)(i,3),s=o[0],l=o[1],d=o[2],y=d===void 0?0:d;return Fh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(y)),_d(f,[s,l,y,1])}function am(i,f){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,q.Z)(i,3),l=s[0],d=s[1],y=s[2];if(Fh(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(y)){var T=_d(f,[l,d,y,1]);return T}var P=_d(f,[l,d,0,1]),D=_d(f,[l,d,1,1]),Q=P[2],X=D[2],le=Q===X?0:((o||0)-Q)/(X-Q);return zn.lerp([],P,D,le)}var om=Vp(),kg=function(){function i(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=f.width,s=f.height,l=f.viewMatrix,d=l===void 0?om:l,y=f.projectionMatrix,T=y===void 0?om:y;(0,Y.Z)(this,i),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=T;var P=Vp();ba.multiply(P,P,this.projectionMatrix),ba.multiply(P,P,this.viewMatrix),this.viewProjectionMatrix=P;var D=Vp();ba.scale(D,D,[this.width/2,-this.height/2,1]),ba.translate(D,D,[1,-1,0]),ba.multiply(D,D,this.viewProjectionMatrix);var Q=ba.invert(Vp(),D);if(!Q)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=D,this.pixelUnprojectionMatrix=Q,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,ce.Z)(i,[{key:"equals",value:function(o){return o instanceof i?o.width===this.width&&o.height===this.height&&ba.equals(o.projectionMatrix,this.projectionMatrix)&&ba.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,y=this.projectPosition(o),T=Dg(y,this.pixelProjectionMatrix),P=(0,q.Z)(T,2),D=P[0],Q=P[1],X=d?Q:this.height-Q;return o.length===2?[D,X]:[D,X,T[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,y=s.targetZ,T=(0,q.Z)(o,3),P=T[0],D=T[1],Q=T[2],X=d?D:this.height-D,le=y&&y*this.pixelsPerMeter,Ue=am([P,X,Q],this.pixelUnprojectionMatrix,le),tt=this.unprojectPosition(Ue),Ot=(0,q.Z)(tt,3),xr=Ot[0],Tr=Ot[1],jr=Ot[2];return Number.isFinite(Q)?[xr,Tr,jr]:Number.isFinite(y)?[xr,Tr,y]:[xr,Tr]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),l=(0,q.Z)(s,2),d=l[0],y=l[1],T=(o[2]||0)*this.pixelsPerMeter;return[d,y,T]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),l=(0,q.Z)(s,2),d=l[0],y=l[1],T=(o[2]||0)/this.pixelsPerMeter;return[d,y,T]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),i}();function zg(i){var f=i.width,o=i.height,s=i.bounds,l=i.minExtent,d=l===void 0?0:l,y=i.maxZoom,T=y===void 0?24:y,P=i.padding,D=P===void 0?0:P,Q=i.offset,X=Q===void 0?[0,0]:Q,le=(0,q.Z)(s,2),Ue=(0,q.Z)(le[0],2),tt=Ue[0],Ot=Ue[1],xr=(0,q.Z)(le[1],2),Tr=xr[0],jr=xr[1];if(Number.isFinite(D)){var dn=D;D={top:dn,bottom:dn,left:dn,right:dn}}else Fh(Number.isFinite(D.top)&&Number.isFinite(D.bottom)&&Number.isFinite(D.left)&&Number.isFinite(D.right));var bn=new sm({width:f,height:o,longitude:0,latitude:0,zoom:0}),Vn=bn.project([tt,jr]),Mi=bn.project([Tr,Ot]),ti=[Math.max(Math.abs(Mi[0]-Vn[0]),d),Math.max(Math.abs(Mi[1]-Vn[1]),d)],ra=[f-D.left-D.right-Math.abs(X[0])*2,o-D.top-D.bottom-Math.abs(X[1])*2];Fh(ra[0]>0&&ra[1]>0);var Ia=ra[0]/ti[0],Fa=ra[1]/ti[1],gi=(D.right-D.left)/2/Ia,wa=(D.bottom-D.top)/2/Fa,oo=[(Mi[0]+Vn[0])/2+gi,(Mi[1]+Vn[1])/2+wa],Yu=bn.unproject(oo),up=bn.zoom+Math.log2(Math.abs(Math.min(Ia,Fa)));return{longitude:Yu[0],latitude:Yu[1],zoom:Math.min(up,T)}}var sm=function(i){(0,ne.Z)(f,i);function f(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,y=s.latitude,T=y===void 0?0:y,P=s.longitude,D=P===void 0?0:P,Q=s.zoom,X=Q===void 0?0:Q,le=s.pitch,Ue=le===void 0?0:le,tt=s.bearing,Ot=tt===void 0?0:tt,xr=s.altitude,Tr=xr===void 0?1.5:xr,jr=s.nearZMultiplier,dn=s.farZMultiplier;(0,Y.Z)(this,f),l=l||1,d=d||1;var bn=nm(X);Tr=Math.max(.75,Tr);var Vn=xd([D,T],bn);Vn[2]=0;var Mi=Rg({width:l,height:d,pitch:Ue,bearing:Ot,altitude:Tr,nearZMultiplier:jr||1/d,farZMultiplier:dn||1.01}),ti=Og({height:d,center:Vn,pitch:Ue,bearing:Ot,altitude:Tr,flipY:!0});return o=(0,be.Z)(this,(0,we.Z)(f).call(this,{width:l,height:d,viewMatrix:ti,projectionMatrix:Mi})),o.latitude=T,o.longitude=D,o.zoom=X,o.pitch=Ue,o.bearing=Ot,o.altitude=Tr,o.scale=bn,o.center=Vn,o.pixelsPerMeter=im((0,Ht.Z)((0,Ht.Z)(o))).pixelsPerMeter[2],Object.freeze((0,Ht.Z)((0,Ht.Z)(o))),o}return(0,ce.Z)(f,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return xd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Gd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,y=am(d,this.pixelUnprojectionMatrix),T=xd(l,this.scale),P=zn.add([],T,zn.negate([],y)),D=zn.add([],this.center,P);return Gd(D,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,y=this.height,T=zg(Object.assign({width:d,height:y,bounds:s},l)),P=T.longitude,D=T.latitude,Q=T.zoom;return new f({width:d,height:y,longitude:P,latitude:D,zoom:Q})}}]),f}(kg),Fg=function(){function i(){(0,Y.Z)(this,i),this.viewport=void 0}return(0,ce.Z)(i,[{key:"syncWithMapCamera",value:function(o){var s=o.center,l=o.zoom,d=o.pitch,y=o.bearing,T=o.viewportHeight,P=o.viewportWidth;this.viewport=new sm({width:P,height:T,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:y})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),i}(),um={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},lm,cm,fm,hm,pm,dm,vm,Nh,mm,gm,ym,_m,xm,bm;function Sm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Ng(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Sm(Object(o),!0).forEach(function(s){(0,z.Z)(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Sm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}x(68982)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Pg();var Em={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Bg=0,Ug=12,wm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",jg=(lm=(0,H.b2)(),cm=(0,H.f3)(w.vK.MapConfig),fm=(0,H.f3)(w.vK.IGlobalConfigService),hm=(0,H.f3)(w.vK.ILogService),pm=(0,H.f3)(w.vK.ICoordinateSystemService),dm=(0,H.f3)(w.vK.IEventEmitter),lm(vm=(Nh=(bm=function(){function i(){var f=this;(0,Y.Z)(this,i),this.version=jd.MAPBOX,this.map=void 0,(0,Rn.Z)(this,"config",mm,this),(0,Rn.Z)(this,"configService",gm,this),(0,Rn.Z)(this,"logger",ym,this),(0,Rn.Z)(this,"coordinateSystemService",_m,this),(0,Rn.Z)(this,"eventEmitter",xm,this),this.viewport=void 0,this.markerContainer=void 0,this.cameraChangedCallback=void 0,this.$mapContainer=void 0,this.handleCameraChanged=function(){var o=f.map.getCenter().wrap(),s=o.lat,l=o.lng;f.viewport.syncWithMapCamera({bearing:f.map.getBearing(),center:[l,s],viewportHeight:f.map.transform.height,pitch:f.map.getPitch(),viewportWidth:f.map.transform.width,zoom:f.map.getZoom(),cameraHeight:0});var d=f.config.offsetZoom,y=d===void 0?Ug:d;f.viewport.getZoom()>y?f.coordinateSystemService.setCoordinateSystem(w.CoordinateSystem.LNGLAT_OFFSET):f.coordinateSystemService.setCoordinateSystem(w.CoordinateSystem.LNGLAT),f.cameraChangedCallback(f.viewport)}}return(0,ce.Z)(i,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=Me.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){w.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on(Em[o]||o,s)}},{key:"off",value:function(o,s){this.map.off(Em[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),d=l.x,y=d===void 0?0:d,T=l.y,P=T===void 0?0:T,D=l.z,Q=D===void 0?0:D;return{x:y,y:P,z:Q}}},{key:"getModelMatrix",value:function(o,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},T=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),P=T.meterInMercatorCoordinateUnits(),D=ba.create();return ba.translate(D,D,Ri.fromValues(T.x-y.x,T.y-y.y,T.z||0-y.z)),ba.scale(D,D,Ri.fromValues(P*d[0],-P*d[1],P*d[2])),ba.rotateX(D,D,l[0]),ba.rotateY(D,D,l[1]),ba.rotateZ(D,D,l[2]),D}},{key:"init",value:function(){var f=(0,$e.Z)(wt().mark(function s(){var l,d,y,T,P,D,Q,X,le,Ue,tt,Ot,xr;return wt().wrap(function(jr){for(;;)switch(jr.prev=jr.next){case 0:l=this.config,d=l.id,y=d===void 0?"map":d,T=l.attributionControl,P=T===void 0?!1:T,D=l.style,Q=D===void 0?"light":D,X=l.token,le=X===void 0?wm:X,Ue=l.rotation,tt=Ue===void 0?0:Ue,Ot=l.mapInstance,xr=(0,Zi.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new Fg,!Ot&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),le===wm&&Q!=="blank"&&!window.mapboxgl.accessToken&&!Ot&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!Ot&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=le),Ot?(this.map=Ot,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(Ng({container:this.$mapContainer,style:this.getMapStyle(Q),attributionControl:P,bearing:tt},xr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return jr.stop()}},s,this)}));function o(){return f.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(s=this.eventEmitter).emit.apply(s,[o].concat(d))}},{key:"once",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(s=this.eventEmitter).once.apply(s,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+Bg++,s.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:um[o]?um[o]:o}}]),i}(),bm),mm=(0,Dn.Z)(Nh.prototype,"config",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=(0,Dn.Z)(Nh.prototype,"configService",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym=(0,Dn.Z)(Nh.prototype,"logger",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m=(0,Dn.Z)(Nh.prototype,"coordinateSystemService",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm=(0,Dn.Z)(Nh.prototype,"eventEmitter",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh))||vm);function Zg(i){var f=Vg();return function(){var s=(0,we.Z)(i),l;if(f){var d=(0,we.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,be.Z)(this,l)}}function Vg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}x(68982)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Gg=function(i){(0,ne.Z)(o,i);var f=Zg(o);function o(){return(0,Y.Z)(this,o),f.apply(this,arguments)}return(0,ce.Z)(o,[{key:"getServiceConstructor",value:function(){return jg}}]),o}(Ag);function Tm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Am(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Tm(Object(o),!0).forEach(function(s){Hg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Tm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function Hg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function Wg(i,f){return $g(i)||Kg(i,f)||Yg(i,f)||Xg()}function Xg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yg(i,f){if(!!i){if(typeof i=="string")return Cm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Cm(i,f)}}function Cm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Kg(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function $g(i){if(Array.isArray(i))return i}var Jg=J.memo(function(i){var f=i.style,o=i.className,s=i.map,l=i.option,d=i.onSceneLoaded,y=(0,J.createRef)(),T=(0,J.useState)(),P=Wg(T,2),D=P[0],Q=P[1];return(0,J.useEffect)(function(){var X=new yo(Am(Am({id:y.current},l),{},{map:new Gg(s)}));return X.on("loaded",function(){Q(X),d&&d(X)}),function(){X.destroy()}},[]),(0,J.useEffect)(function(){D&&s.style&&D.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,J.useEffect)(function(){D&&s.zoom&&D.setZoom(s.zoom)},[s.zoom]),(0,J.useEffect)(function(){D&&s.center&&D.setCenter(s.center)},[JSON.stringify(s.center)]),(0,J.useEffect)(function(){D&&s.pitch!==void 0&&D.setPitch(s.pitch||0)},[s.pitch]),(0,J.useEffect)(function(){D&&s.rotation&&D.setRotation(s.rotation)},[s.rotation]),J.createElement(E.Provider,{value:D},(0,J.createElement)("div",{ref:y,style:f,className:o},D&&i.children))}),Qg=Jg;function Pm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function z0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Pm(Object(o),!0).forEach(function(s){qg(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Pm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function qg(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function F0(i,f){return ny(i)||ry(i,f)||ty(i,f)||ey()}function ey(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ty(i,f){if(!!i){if(typeof i=="string")return Mm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Mm(i,f)}}function Mm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function ry(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function ny(i){if(Array.isArray(i))return i}var N0=null,B0=null;function Im(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function U0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Im(Object(o),!0).forEach(function(s){iy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Im(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function iy(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function j0(i,f){return uy(i)||sy(i,f)||oy(i,f)||ay()}function ay(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oy(i,f){if(!!i){if(typeof i=="string")return Om(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Om(i,f)}}function Om(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function sy(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function uy(i){if(Array.isArray(i))return i}var Z0=null,V0=null;function G0(i,f){return hy(i)||fy(i,f)||cy(i,f)||ly()}function ly(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cy(i,f){if(!!i){if(typeof i=="string")return Lm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Lm(i,f)}}function Lm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function fy(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function hy(i){if(Array.isArray(i))return i}var H0=null,W0=null;function Rm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function X0(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Rm(Object(o),!0).forEach(function(s){py(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Rm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function py(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function Y0(i,f){if(i==null)return{};var o=dy(i,f),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(f.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function dy(i,f){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(f.indexOf(l)>=0)&&(o[l]=i[l]);return o}var K0=null,Dm=x(73935);function vy(i,f){return _y(i)||yy(i,f)||gy(i,f)||my()}function my(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gy(i,f){if(!!i){if(typeof i=="string")return km(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return km(i,f)}}function km(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function yy(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function _y(i){if(Array.isArray(i))return i}var xy=J.useEffect,by=J.useState;function $0(i){var f=i.className,o=i.style,s=i.children,l=i.position,d=useSceneValue(),y=by(function(){return document.createElement("div")}),T=vy(y,1),P=T[0];return xy(function(){var D=new Control({position:l});return D.onAdd=function(){if(f&&(P.className=f),o){var Q=Object.keys(o).map(function(X){return"".concat(X,":").concat(o[X])}).join(";");P.style.cssText=Q}return P},d.addControl(D),function(){d.removeControl(D)}},[]),createPortal(s,P)}var zm=(0,J.createContext)({});function J0(){return useContext(zm)}var Sy=J.useEffect,Ey=J.memo(function(f){var o=f.layer,s=f.active;return Sy(function(){o.active(s.option)},[JSON.stringify(s)]),null}),wy=J.useEffect,Ty=J.memo(function(f){var o=f.layer,s=f.animate;return wy(function(){o.animate(s)},[JSON.stringify(s)]),null}),Ay=J.useEffect,Cy=J.memo(function(f){var o=f.layer,s=f.color;return Ay(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Py=J.useEffect,My=J.memo(function(f){var o=f.layer,s=f.filter;return Py(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Iy=J.useEffect,Oy=J.memo(function(f){var o=f.layer,s=f.scale;return Iy(function(){o.scale(s.values)},[s.values]),null}),Ly=J.useEffect,Ry=J.memo(function(f){var o=f.layer,s=f.select;return Ly(function(){o.select(s.option)},[JSON.stringify(s)]),null}),Dy=J.useEffect,ky=J.memo(function(f){var o=f.layer,s=f.shape;return Dy(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),zy=J.useEffect,Fy=J.memo(function(f){var o=f.layer,s=f.size;return zy(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ny=["data"];function By(i,f){if(i==null)return{};var o=Uy(i,f),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(i);for(l=0;l<d.length;l++)s=d[l],!(f.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(i,s)||(o[s]=i[s]))}return o}function Uy(i,f){if(i==null)return{};var o={},s=Object.keys(i),l,d;for(d=0;d<s.length;d++)l=s[d],!(f.indexOf(l)>=0)&&(o[l]=i[l]);return o}var jy=J.useEffect,Zy=J.memo(function(f){var o=f.layer,s=f.source,l=s.data,d=By(s,Ny);return jy(function(){o.inited?o.setData(l,d):o.source(l,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),Vy=J.useEffect,Gy=J.memo(function(f){var o=f.layer,s=f.style;return Vy(function(){o.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Hy(i,f){return Ky(i)||Yy(i,f)||Xy(i,f)||Wy()}function Wy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xy(i,f){if(!!i){if(typeof i=="string")return Fm(i,f);var o=Object.prototype.toString.call(i).slice(8,-1);if(o==="Object"&&i.constructor&&(o=i.constructor.name),o==="Map"||o==="Set")return Array.from(i);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Fm(i,f)}}function Fm(i,f){(f==null||f>i.length)&&(f=i.length);for(var o=0,s=new Array(f);o<f;o++)s[o]=i[o];return s}function Yy(i,f){var o=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,T;try{for(o=o.call(i);!(l=(y=o.next()).done)&&(s.push(y.value),!(f&&s.length===f));l=!0);}catch(P){d=!0,T=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw T}}return s}}function Ky(i){if(Array.isArray(i))return i}var Gp=J.useEffect,$y=J.useState;function Nm(i,f){var o=f.source,s=f.color,l=f.shape,d=f.style,y=f.size,T=f.scale,P=f.active,D=f.select,Q=f.filter,X=f.animate,le=f.options,Ue=f.onLayerLoaded,tt=p(),Ot=$y(function(){var jr;switch(i){case"polygonLayer":jr=new ri(le);break;case"lineLayer":jr=new Qs(le);break;case"pointLayer":jr=new Bt(le);break;case"heatmapLayer":jr=new Rl(le);break;case"rasterLayer":jr=new ho(le);break;case"imageLayer":jr=new fo(le);break;case"citybuildingLayer":jr=new ll(le);break;default:jr=new ri(le)}return jr.on("inited",function(){Ue&&Ue(jr,tt)}),jr}),xr=Hy(Ot,1),Tr=xr[0];return Gp(function(){return tt.addLayer(Tr),function(){tt.removeLayer(Tr)}},[]),Gp(function(){Tr.inited&&le&&Tr.updateLayerConfig(le)},[le==null?void 0:le.minZoom,le==null?void 0:le.maxZoom,le==null?void 0:le.visible]),Gp(function(){Tr.inited&&(le==null?void 0:le.zIndex)&&Tr.setIndex(le.zIndex)},[le==null?void 0:le.zIndex]),Gp(function(){Tr.inited&&(le==null?void 0:le.blend)&&Tr.setBlend(le.blend)},[le==null?void 0:le.blend]),Gp(function(){tt.render()}),J.createElement(zm.Provider,{value:Tr},J.createElement(Zy,{layer:Tr,source:o}),T&&J.createElement(Oy,{layer:Tr,scale:T}),s&&J.createElement(Cy,{layer:Tr,color:s}),y&&J.createElement(Fy,{layer:Tr,size:y}),l&&J.createElement(ky,{layer:Tr,shape:l}),d&&J.createElement(Gy,{layer:Tr,style:d}),P&&J.createElement(Ey,{layer:Tr,active:P}),D&&J.createElement(Ry,{layer:Tr,select:D}),Q&&J.createElement(My,{layer:Tr,filter:Q}),X&&J.createElement(Ty,{layer:Tr,animate:X}),f.children)}var Q0=null,q0=null,Jy=J.memo(function(f){return Nm("pointLayer",f)}),Qy=J.memo(function(f){return Nm("heatmapLayer",f)}),e_=null,t_=null,r_=null,n_=J.useEffect,i_=null,a_=null;function bd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bd=function(o){return typeof o}:bd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},bd(i)}function Bm(i,f){var o=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);f&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),o.push.apply(o,s)}return o}function Sd(i){for(var f=1;f<arguments.length;f++){var o=arguments[f]!=null?arguments[f]:{};f%2?Bm(Object(o),!0).forEach(function(s){qy(i,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(o)):Bm(Object(o)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(o,s))})}return i}function qy(i,f,o){return f in i?Object.defineProperty(i,f,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[f]=o,i}function e0(i,f){if(!(i instanceof f))throw new TypeError("Cannot call a class as a function")}function Um(i,f){for(var o=0;o<f.length;o++){var s=f[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function t0(i,f,o){return f&&Um(i.prototype,f),o&&Um(i,o),i}function r0(i,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),f&&Hd(i,f)}function Hd(i,f){return Hd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Hd(i,f)}function n0(i){var f=o0();return function(){var s=Ed(i),l;if(f){var d=Ed(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return i0(this,l)}}function i0(i,f){return f&&(bd(f)==="object"||typeof f=="function")?f:a0(i)}function a0(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function o0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Ed(i){return Ed=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Ed(i)}var o_=function(i){r0(o,i);var f=n0(o);function o(s){var l;return e0(this,o),l=f.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return t0(o,[{key:"componentDidMount",value:function(){var l,d=this.props,y=d.lnglat,T=d.children,P=d.option,D=d.lngLat,Q=new Be(Sd(Sd({},P),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));y&&Q.setLnglat(y),D&&Q.setLnglat(D),T&&Q.setDOMContent(this.el),this.popup=Q,this.scene.addPopup(Q)}},{key:"componentDidUpdate",value:function(l){var d,y,T,P,D,Q,X=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(y=l.lnglat)===null||y===void 0?void 0:y.lat],le=Array.isArray(this.props.lnglat)?this.props.lnglat:[(T=this.props)===null||T===void 0||(P=T.lnglat)===null||P===void 0?void 0:P.lng,(D=this.props)===null||D===void 0||(Q=D.lnglat)===null||Q===void 0?void 0:Q.lat],Ue=X.toString()!==le.toString();if(Ue){var tt;this.popup.remove(),this.popup=new Be(Sd(Sd({},this.props.option),{},{stopPropagation:(tt=this.props.option)===null||tt===void 0?void 0:tt.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return J.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,Dm.createPortal)(l.props.children,l.el)})}}]),o}(J.PureComponent);function wd(i){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?wd=function(o){return typeof o}:wd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},wd(i)}function s0(i,f){if(!(i instanceof f))throw new TypeError("Cannot call a class as a function")}function jm(i,f){for(var o=0;o<f.length;o++){var s=f[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}function u0(i,f,o){return f&&jm(i.prototype,f),o&&jm(i,o),i}function l0(i,f){if(typeof f!="function"&&f!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(f&&f.prototype,{constructor:{value:i,writable:!0,configurable:!0}}),f&&Wd(i,f)}function Wd(i,f){return Wd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Wd(i,f)}function c0(i){var f=p0();return function(){var s=Td(i),l;if(f){var d=Td(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return f0(this,l)}}function f0(i,f){return f&&(wd(f)==="object"||typeof f=="function")?f:h0(i)}function h0(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function p0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(i){return!1}}function Td(i){return Td=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Td(i)}var s_=function(i){l0(o,i);var f=c0(o);function o(s){var l;return s0(this,o),l=f.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return u0(o,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,y=l.children,T=l.option,P=l.onMarkerLoaded,D=new $t(T);d&&D.setLnglat(d),y&&D.setElement(this.el),this.marker=D,P&&P(D),this.scene.addMarker(D)}},{key:"componentDidUpdate",value:function(l){var d,y=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());y&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return J.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,Dm.createPortal)(l.props.children,l.el)})}}]),o}(J.PureComponent),u_=J.useEffect,l_=null,c_=null,f_=J.useEffect,h_=null},4771:function(){},6901:function(pr,O,x){"use strict";x.d(O,{SO:function(){return J},z6:function(){return Mr},a5:function(){return E},Z:function(){return wt},rQ:function(){return Jt},bV:function(){return Mt},zi:function(){return mr},ds:function(){return Ar},Ev:function(){return Ke},oO:function(){return Er},W0:function(){return sr},Z6:function(){return Qr},We:function(){return qe},Cl:function(){return st},gJ:function(){return oe},vP:function(){return F},yM:function(){return Wt},yA:function(){return yr},CI:function(){return ct}});var J={};x.r(J),x.d(J,{DPR:function(){return Ye},addClass:function(){return Kt},create:function(){return we},empty:function(){return yt},getClass:function(){return Lt},getContainer:function(){return Y},getViewPortScale:function(){return mt},hasClass:function(){return Xt},printCanvas:function(){return ar},remove:function(){return Me},removeClass:function(){return Zt},setClass:function(){return zt},setTransform:function(){return Pr},splitWords:function(){return ne},triggerResize:function(){return Ht},trim:function(){return ce}});var E={};x.r(E),x.d(E,{getColumn:function(){return li},getSatByColumn:function(){return G},max:function(){return gn},mean:function(){return Ei},min:function(){return Cn},mode:function(){return Ii},statMap:function(){return Ji},sum:function(){return yi}});function p(I){var j=131,K=137,ie=0;I+="x";for(var Oe=Math.floor(9007199254740991/K),He=0;He<I.length;He++)ie>Oe&&(ie=Math.floor(ie/K)),ie=ie*j+I.charCodeAt(He);return ie}function w(I){I=I.toString();for(var j=5381,K=I.length;K;)j=j*33^I.charCodeAt(--K);return j>>>0}var z=x(28481),q=window.document.documentElement.style;function Y(I){var j=I;return typeof I=="string"&&(j=document.getElementById(I)),j}function ce(I){return I.trim?I.trim():I.replace(/^\s+|\s+$/g,"")}function ne(I){return ce(I).split(/\s+/)}function be(I){if(!q)return I[0];for(var j in I)if(I[j]&&I[j]in q)return I[j];return I[0]}function we(I,j,K){var ie=document.createElement(I);return ie.className=j||"",K&&K.appendChild(ie),ie}function Me(I){var j=I.parentNode;j&&j.removeChild(I)}function Kt(I,j){if(I.classList!==void 0)for(var K=ne(j),ie=0,Oe=K.length;ie<Oe;ie++)I.classList.add(K[ie]);else if(!Xt(I,j)){var He=Lt(I);zt(I,(He?He+" ":"")+j)}}function Zt(I,j){I.classList!==void 0?I.classList.remove(j):zt(I,ce((" "+Lt(I)+" ").replace(" "+j+" "," ")))}function Xt(I,j){if(I.classList!==void 0)return I.classList.contains(j);var K=Lt(I);return K.length>0&&new RegExp("(^|\\s)"+j+"(\\s|$)").test(K)}function zt(I,j){I instanceof HTMLElement?I.className=j:I.className.baseVal=j}function Lt(I){return I instanceof SVGElement&&(I=I.correspondingElement),I.className.baseVal===void 0?I.className:I.className.baseVal}function yt(I){for(;I&&I.firstChild;)I.removeChild(I.firstChild)}var pt=be(["transform","WebkitTransform"]);function Pr(I,j){I.style[pt]=j}function Ht(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var I=window.document.createEvent("UIEvents");I.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(I)}}function ar(I){var j=["padding: "+(I.height/2-8)+"px "+I.width/2+"px;","line-height: "+I.height+"px;","background-image: url("+I.toDataURL()+");"];console.log(`%c
`,j.join(""))}function mt(){var I,j=document.querySelector('meta[name="viewport"]');if(!j)return 1;var K=(I=j.content)===null||I===void 0?void 0:I.split(","),ie=K.find(function(Oe){var He=Oe.split("="),ue=(0,z.Z)(He,2),De=ue[0],St=ue[1];return De==="initial-scale"});return ie?ie.split("=")[1]*1:1}var Ye=mt()<1?1:window.devicePixelRatio,bt=x(6610),Fe=x(5991),Ae=x(10379),Ne=x(46070),xt=x(77608),nr=x(14665);function re(I){return Function.toString.call(I).indexOf("[native code]")!==-1}var Ee=x(51814);function ae(I,j,K){return(0,Ee.Z)()?ae=Reflect.construct:ae=function(Oe,He,ue){var De=[null];De.push.apply(De,He);var St=Function.bind.apply(Oe,De),Ir=new St;return ue&&(0,nr.Z)(Ir,ue.prototype),Ir},ae.apply(null,arguments)}function me(I){var j=typeof Map=="function"?new Map:void 0;return me=function(ie){if(ie===null||!re(ie))return ie;if(typeof ie!="function")throw new TypeError("Super expression must either be null or a function");if(typeof j!="undefined"){if(j.has(ie))return j.get(ie);j.set(ie,Oe)}function Oe(){return ae(ie,arguments,(0,xt.Z)(this).constructor)}return Oe.prototype=Object.create(ie.prototype,{constructor:{value:Oe,enumerable:!1,writable:!0,configurable:!0}}),(0,nr.Z)(Oe,ie)},me(I)}function Te(I){var j=Je();return function(){var ie=(0,xt.Z)(I),Oe;if(j){var He=(0,xt.Z)(this).constructor;Oe=Reflect.construct(ie,arguments,He)}else Oe=ie.apply(this,arguments);return(0,Ne.Z)(this,Oe)}}function Je(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(I){return!1}}var dt=function(I){(0,Ae.Z)(K,I);var j=Te(K);function K(ie,Oe,He){var ue;return(0,bt.Z)(this,K),ue=j.call(this,ie),ue.status=void 0,ue.url=void 0,ue.status=Oe,ue.url=He,ue.name=ue.constructor.name,ue.message=ie,ue}return(0,Fe.Z)(K,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),K}(me(Error));function $t(I){var j=new XMLHttpRequest;j.open("GET",I.url,!0);for(var K in I.headers)I.headers.hasOwnProperty(K)&&j.setRequestHeader(K,I.headers[K]);return j.withCredentials=I.credentials==="include",j}var Fr=function(j,K){var ie=$t(j);return ie.setRequestHeader("Accept","application/json"),ie.onerror=function(){K(new Error(ie.statusText))},ie.onload=function(){if(ie.status>=200&&ie.status<300&&ie.response){var Oe;try{Oe=JSON.parse(ie.response)}catch(He){return K(He)}K(null,Oe)}else ie.status===401?K(new dt("".concat(ie.statusText),ie.status,j.url)):K(new dt(ie.statusText,ie.status,j.url))},ie.send(),ie},zr=function(j,K){var ie=$t(j);return ie.responseType="arraybuffer",ie.onerror=function(){K(new Error(ie.statusText))},ie.onload=function(){var Oe=ie.response;if(Oe.byteLength===0&&ie.status===200)return K(new Error("http status 200 returned without content."));ie.status>=200&&ie.status<300&&ie.response?K(null,{data:Oe,cacheControl:ie.getResponseHeader("Cache-Control"),expires:ie.getResponseHeader("Expires")}):K(new dt(ie.statusText,ie.status,j.url))},ie.send(),ie};function ln(I){var j=window.document.createElement("a");return j.href=I,j.protocol===window.document.location.protocol&&j.host===window.document.location.host}var tr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",oe=function(j,K){return zr(j,function(ie,Oe){if(ie)K(ie);else if(Oe){var He=new window.Image;He.crossOrigin="anonymous";var ue=window.URL||window.webkitURL;He.onload=function(){K(null,He),ue.revokeObjectURL(He.src)};var De=new window.Blob([new Uint8Array(Oe.data)],{type:"image/png"});He.src=Oe.data.byteLength?ue.createObjectURL(De):tr}})},ge=x(40271),Re=2*Math.PI*6378137/2;function qe(I){var j=[Infinity,Infinity,-Infinity,-Infinity];return I.forEach(function(K){var ie=K.coordinates;Ct(j,ie)}),j}function Ct(I,j){return Array.isArray(j[0])?j.forEach(function(K){Ct(I,K)}):(I[0]>j[0]&&(I[0]=j[0]),I[1]>j[1]&&(I[1]=j[1]),I[2]<j[0]&&(I[2]=j[0]),I[3]<j[1]&&(I[3]=j[1])),I}function kt(I,j){return S(I,j)}function S(I,j){return Array.isArray(I[0])?I.map(function(K){return S(K,j)}):j(I)}function F(I){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,K=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};I=vt(I,j);var ie=I[0],Oe=I[1],He=ie*Re/180,ue=Math.log(Math.tan((90+Oe)*Math.PI/360))/(Math.PI/180);return ue=ue*Re/180,K.enable&&(He=Number(He.toFixed(K.decimal)),ue=Number(ue.toFixed(K.decimal))),I.length===3?[He,ue,I[2]]:[He,ue]}function he(I){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,K=I[0],ie=I[1],Oe=K/Re*180,He=ie/Re*180;return He=180/Math.PI*(2*Math.atan(Math.exp(He*Math.PI/180))-Math.PI/2),j!=null&&(Oe=Number(Oe.toFixed(j)),He=Number(He.toFixed(j))),I.length===3?[Oe,He,I[2]]:[Oe,He]}function Be(I){if(I==null)throw new Error("lng is required");return(I>180||I<-180)&&(I=I%360,I>180&&(I=-360+I),I<-180&&(I=360+I),I===0&&(I=0)),I}function $e(I){if(I==null)throw new Error("lat is required");return(I>90||I<-90)&&(I=I%180,I>90&&(I=-180+I),I<-90&&(I=180+I),I===0&&(I=0)),I}function vt(I,j){if(j===!1)return I;var K=Be(I[0]),ie=$e(I[1]);return ie>85&&(ie=85),ie<-85&&(ie=-85),I.length===3?[K,ie,I[2]]:[K,ie]}function wt(I){var j=85.0511287798,K=Math.max(Math.min(j,I[1]),-j),ie=256<<20,Oe=Math.PI/180,He=I[0]*Oe,ue=K*Oe;ue=Math.log(Math.tan(Math.PI/4+ue/2));var De=.5/Math.PI,St=.5,Ir=-.5/Math.PI;return Oe=.5,He=ie*(De*He+St),ue=ie*(Ir*ue+Oe),[Math.floor(He),Math.floor(ue)]}function H(I){var j=.5/Math.PI,K=.5,ie=-.5/Math.PI,Oe=.5,He=256<<20,ue=_slicedToArray(I,2),De=ue[0],St=ue[1];De=(De/He-K)/j,St=(St/He-Oe)/ie,St=(Math.atan(Math.pow(Math.E,St))-Math.PI/4)*2,Oe=Math.PI/180;var Ir=St/Oe,Br=De/Oe;return[Br,Ir]}function Wt(I,j,K){var ie=(0,ge.Ht)(j[1]-I[1]),Oe=(0,ge.Ht)(j[0]-I[0]),He=(0,ge.Ht)(I[1]),ue=(0,ge.Ht)(j[1]),De=Math.pow(Math.sin(ie/2),2)+Math.pow(Math.sin(Oe/2),2)*Math.cos(He)*Math.cos(ue);return(0,ge.DL)(2*Math.atan2(Math.sqrt(De),Math.sqrt(1-De)),K="meters")}function Vt(I){var j=Math.PI/180,K=85.0511287798,ie=6378137,Oe=Math.max(Math.min(K,I[1]),-K),He=Math.sin(Oe*j),ue=ie*I[0]*j,De=ie*Math.log((1+He)/(1-He))/2;return[ue,De]}function yr(I,j){var K=Math.abs(I[1][1]-I[0][1])*j,ie=Math.abs(I[1][0]-I[0][0])*j;return[[I[0][0]-ie,I[0][1]-K],[I[1][0]+ie,I[1][1]+K]]}function Er(I,j){return I[0][0]<=j[0][0]&&I[0][1]<=j[0][1]&&I[1][0]>=j[1][0]&&I[1][1]>=j[1][1]}function Ar(I){return[[I[0],I[1]],[I[2],I[3]]]}var Mr=function(){function I(){var j=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,K=arguments.length>1?arguments[1]:void 0;(0,bt.Z)(this,I),this.limit=void 0,this.cache=void 0,this.destroy=void 0,this.order=void 0,this.limit=j,this.destroy=K||this.defaultDestroy,this.order=[],this.clear()}return(0,Fe.Z)(I,[{key:"clear",value:function(){var K=this;this.order.forEach(function(ie){K.delete(ie)}),this.cache={},this.order=[]}},{key:"get",value:function(K){var ie=this.cache[K];return ie&&(this.deleteOrder(K),this.appendOrder(K)),ie}},{key:"set",value:function(K,ie){this.cache[K]?(this.delete(K),this.cache[K]=ie,this.appendOrder(K)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[K]=ie,this.appendOrder(K))}},{key:"delete",value:function(K){var ie=this.cache[K];ie&&(this.deleteCache(K),this.deleteOrder(K),this.destroy(ie,K))}},{key:"deleteCache",value:function(K){delete this.cache[K]}},{key:"deleteOrder",value:function(K){var ie=this.order.findIndex(function(Oe){return Oe===K});ie>=0&&this.order.splice(ie,1)}},{key:"appendOrder",value:function(K){this.order.push(K)}},{key:"defaultDestroy",value:function(K,ie){return null}}]),I}();function Ke(I,j){I.forEach(function(K){!j[K]||(j[K]=j[K].bind(j))})}var gt=x(2650);function ct(I){var j=gt.ZP(I),K=[0,0,0,0];return j!=null&&(K[0]=j.r/255,K[1]=j.g/255,K[2]=j.b/255,K[3]=j.opacity),K}function sr(I){var j=I&&I[0],K=I&&I[1],ie=I&&I[2],Oe=j+K*256+ie*65536-1;return Oe}function Qr(I){return[I+1&255,I+1>>8&255,I+1>>8>>8&255]}function st(I){var j=document.createElement("canvas"),K=j.getContext("2d");j.width=256,j.height=1;for(var ie=K.createLinearGradient(0,0,256,1),Oe=null,He=I.positions[0],ue=I.positions[I.positions.length-1],De=0;De<I.colors.length;++De){var St=(I.positions[De]-He)/(ue-He);ie.addColorStop(St,I.colors[De])}return K.fillStyle=ie,K.fillRect(0,0,256,1),Oe=new Uint8ClampedArray(K.getImageData(0,0,256,1).data),new ImageData(Oe,256,1)}var Mt;(function(I){I.CENTER="center",I.TOP="top",I["TOP-LEFT"]="top-left",I["TOP-RIGHT"]="top-right",I.BOTTOM="bottom",I["BOTTOM-LEFT"]="bottom-left",I.LEFT="left",I.RIGHT="right"})(Mt||(Mt={}));var Jt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mr(I,j,K){var ie=I.classList;for(var Oe in Jt)Jt.hasOwnProperty(Oe)&&ie.remove("l7-".concat(K,"-anchor-").concat(Oe));ie.add("l7-".concat(K,"-anchor-").concat(j))}function gn(I){if(I.length===0)throw new Error("max requires at least one data point");for(var j=I[0],K=1;K<I.length;K++)I[K]>j&&(j=I[K]);return j*1}function Cn(I){if(I.length===0)throw new Error("min requires at least one data point");for(var j=I[0],K=1;K<I.length;K++)I[K]<j&&(j=I[K]);return j*1}function yi(I){if(I.length===0)return 0;for(var j=I[0]*1,K=1;K<I.length;K++)j+=I[K]*1;return j}function Ei(I){if(I.length===0)throw new Error("mean requires at least one data point");return yi(I)/I.length}function Ii(I){if(I.length===0)throw new Error("mean requires at least one data point");if(I.length<3)return I[0];I.sort();for(var j=I[0],K=NaN,ie=0,Oe=1,He=1;He<I.length+1;He++)I[He]!==j?(Oe>ie&&(ie=Oe,K=j),Oe=1,j=I[He]):Oe++;return K*1}var Ji={min:Cn,max:gn,mean:Ei,sum:yi,mode:Ii};function li(I,j){return I.map(function(K){return K[j]})}function G(I,j){return Ji[I](j)}},3473:function(pr,O,x){"use strict";x.d(O,{Z:function(){return J}});function J(E,p,w,z,q){var Y={};return Object.keys(z).forEach(function(ce){Y[ce]=z[ce]}),Y.enumerable=!!Y.enumerable,Y.configurable=!!Y.configurable,("value"in Y||Y.initializer)&&(Y.writable=!0),Y=w.slice().reverse().reduce(function(ce,ne){return ne(E,p,ce)||ce},Y),q&&Y.initializer!==void 0&&(Y.value=Y.initializer?Y.initializer.call(q):void 0,Y.initializer=void 0),Y.initializer===void 0&&(Object.defineProperty(E,p,Y),Y=null),Y}},66213:function(pr,O,x){"use strict";x.d(O,{Z:function(){return p}});var J=x(77608);function E(w,z){for(;!Object.prototype.hasOwnProperty.call(w,z)&&(w=(0,J.Z)(w),w!==null););return w}function p(w,z,q){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(ce,ne,be){var we=E(ce,ne);if(!!we){var Me=Object.getOwnPropertyDescriptor(we,ne);return Me.get?Me.get.call(be):Me.value}},p(w,z,q||w)}},55770:function(pr,O,x){"use strict";x.d(O,{Z:function(){return J}});function J(E,p,w,z){!w||Object.defineProperty(E,p,{enumerable:w.enumerable,configurable:w.configurable,writable:w.writable,value:w.initializer?w.initializer.call(z):void 0})}},31795:function(pr,O,x){var J=x(75752);pr.exports.geometry=E,pr.exports.ring=w;function E(q){var Y=0,ce;switch(q.type){case"Polygon":return p(q.coordinates);case"MultiPolygon":for(ce=0;ce<q.coordinates.length;ce++)Y+=p(q.coordinates[ce]);return Y;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ce=0;ce<q.geometries.length;ce++)Y+=E(q.geometries[ce]);return Y}}function p(q){var Y=0;if(q&&q.length>0){Y+=Math.abs(w(q[0]));for(var ce=1;ce<q.length;ce++)Y-=Math.abs(w(q[ce]))}return Y}function w(q){var Y,ce,ne,be,we,Me,Kt,Zt=0,Xt=q.length;if(Xt>2){for(Kt=0;Kt<Xt;Kt++)Kt===Xt-2?(be=Xt-2,we=Xt-1,Me=0):Kt===Xt-1?(be=Xt-1,we=0,Me=1):(be=Kt,we=Kt+1,Me=Kt+2),Y=q[be],ce=q[we],ne=q[Me],Zt+=(z(ne[0])-z(Y[0]))*Math.sin(z(ce[1]));Zt=Zt*J.RADIUS*J.RADIUS/2}return Zt}function z(q){return q*Math.PI/180}},38163:function(pr,O,x){var J=x(31795);pr.exports=E;function E(ce,ne){switch(ce&&ce.type||null){case"FeatureCollection":return ce.features=ce.features.map(p(E,ne)),ce;case"GeometryCollection":return ce.geometries=ce.geometries.map(p(E,ne)),ce;case"Feature":return ce.geometry=E(ce.geometry,ne),ce;case"Polygon":case"MultiPolygon":return w(ce,ne);default:return ce}}function p(ce,ne){return function(be){return ce(be,ne)}}function w(ce,ne){return ce.type==="Polygon"?ce.coordinates=z(ce.coordinates,ne):ce.type==="MultiPolygon"&&(ce.coordinates=ce.coordinates.map(p(z,ne))),ce}function z(ce,ne){ne=!!ne,ce[0]=q(ce[0],ne);for(var be=1;be<ce.length;be++)ce[be]=q(ce[be],!ne);return ce}function q(ce,ne){return Y(ce)===ne?ce:ce.reverse()}function Y(ce){return J.ring(ce)>=0}},49296:function(pr){"use strict";pr.exports=x,pr.exports.default=x;var O=1e20;function x(z,q,Y,ce,ne,be){this.fontSize=z||24,this.buffer=q===void 0?3:q,this.cutoff=ce||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=be||"normal",this.radius=Y||8;var we=this.size=this.fontSize+this.buffer*2,Me=we+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=we,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Me*Me),this.gridInner=new Float64Array(Me*Me),this.f=new Float64Array(Me),this.z=new Float64Array(Me+1),this.v=new Uint16Array(Me),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(we/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function J(z,q,Y,ce,ne,be,we){be.fill(O,0,q*Y),we.fill(0,0,q*Y);for(var Me=(q-ce)/2,Kt=0;Kt<ne;Kt++)for(var Zt=0;Zt<ce;Zt++){var Xt=(Kt+Me)*q+Zt+Me,zt=z.data[4*(Kt*ce+Zt)+3]/255;if(zt===1)be[Xt]=0,we[Xt]=O;else if(zt===0)be[Xt]=O,we[Xt]=0;else{var Lt=Math.max(0,.5-zt),yt=Math.max(0,zt-.5);be[Xt]=Lt*Lt,we[Xt]=yt*yt}}}function E(z,q,Y,ce,ne,be,we){for(var Me=0;Me<q*Y;Me++){var Kt=Math.sqrt(ce[Me])-Math.sqrt(ne[Me]);z[Me]=Math.round(255-255*(Kt/be+we))}}x.prototype._draw=function(z,q){var Y=this.ctx.measureText(z),ce=Y.width,ne=2*this.buffer,be,we,Me,Kt,Zt,Xt,zt,Lt;q&&this.useMetrics?(Zt=Math.floor(Y.actualBoundingBoxAscent),Lt=this.buffer+Math.ceil(Y.actualBoundingBoxAscent),Xt=this.buffer,zt=this.buffer,we=Math.min(this.size,Math.ceil(Y.actualBoundingBoxRight-Y.actualBoundingBoxLeft)),Kt=Math.min(this.size-Xt,Math.ceil(Y.actualBoundingBoxAscent+Y.actualBoundingBoxDescent)),be=we+ne,Me=Kt+ne,this.ctx.textBaseline="alphabetic"):(be=we=this.size,Me=Kt=this.size,Zt=19*this.fontSize/24,Xt=zt=0,Lt=this.middle,this.ctx.textBaseline="middle");var yt;we&&Kt&&(this.ctx.clearRect(zt,Xt,we,Kt),this.ctx.fillText(z,this.buffer,Lt),yt=this.ctx.getImageData(zt,Xt,we,Kt));var pt=new Uint8ClampedArray(be*Me);return J(yt,be,Me,we,Kt,this.gridOuter,this.gridInner),p(this.gridOuter,be,Me,this.f,this.v,this.z),p(this.gridInner,be,Me,this.f,this.v,this.z),E(pt,be,Me,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:we,height:Kt,sdfWidth:be,sdfHeight:Me,top:Zt,left:0,advance:ce}}},x.prototype.draw=function(z){return this._draw(z,!1).data},x.prototype.drawWithMetrics=function(z){return this._draw(z,!0)};function p(z,q,Y,ce,ne,be){for(var we=0;we<q;we++)w(z,we,q,Y,ce,ne,be);for(var Me=0;Me<Y;Me++)w(z,Me*q,1,q,ce,ne,be)}function w(z,q,Y,ce,ne,be,we){var Me,Kt,Zt,Xt;for(be[0]=0,we[0]=-O,we[1]=O,Me=0;Me<ce;Me++)ne[Me]=z[q+Me*Y];for(Me=1,Kt=0,Zt=0;Me<ce;Me++){do Xt=be[Kt],Zt=(ne[Me]-ne[Xt]+Me*Me-Xt*Xt)/(Me-Xt)/2;while(Zt<=we[Kt]&&--Kt>-1);Kt++,be[Kt]=Me,we[Kt]=Zt,we[Kt+1]=O}for(Me=0,Kt=0;Me<ce;Me++){for(;we[Kt+1]<Me;)Kt++;Xt=be[Kt],z[q+Me*Y]=ne[Xt]+(Me-Xt)*(Me-Xt)}}},40271:function(pr,O,x){"use strict";x.d(O,{zL:function(){return z},DL:function(){return pt},Ht:function(){return Ye}});var J=63710088e-1,E={centimeters:J*100,centimetres:J*100,degrees:J/111325,feet:J*3.28084,inches:J*39.37,kilometers:J/1e3,kilometres:J/1e3,meters:J,metres:J,miles:J/1609.344,millimeters:J*1e3,millimetres:J*1e3,nauticalmiles:J/1852,radians:1,yards:J*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/J,yards:1.0936133},w={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function z(re,Ee,ae){ae===void 0&&(ae={});var me={type:"Feature"};return(ae.id===0||ae.id)&&(me.id=ae.id),ae.bbox&&(me.bbox=ae.bbox),me.properties=Ee||{},me.geometry=re,me}function q(re,Ee,ae){switch(ae===void 0&&(ae={}),re){case"Point":return Y(Ee).geometry;case"LineString":return we(Ee).geometry;case"Polygon":return ne(Ee).geometry;case"MultiPoint":return Xt(Ee).geometry;case"MultiLineString":return Zt(Ee).geometry;case"MultiPolygon":return zt(Ee).geometry;default:throw new Error(re+" is invalid")}}function Y(re,Ee,ae){if(ae===void 0&&(ae={}),!re)throw new Error("coordinates is required");if(!Array.isArray(re))throw new Error("coordinates must be an Array");if(re.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ae(re[0])||!Ae(re[1]))throw new Error("coordinates must contain numbers");var me={type:"Point",coordinates:re};return z(me,Ee,ae)}function ce(re,Ee,ae){return ae===void 0&&(ae={}),Kt(re.map(function(me){return Y(me,Ee)}),ae)}function ne(re,Ee,ae){ae===void 0&&(ae={});for(var me=0,Te=re;me<Te.length;me++){var Je=Te[me];if(Je.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var dt=0;dt<Je[Je.length-1].length;dt++)if(Je[Je.length-1][dt]!==Je[0][dt])throw new Error("First and last Position are not equivalent.")}var $t={type:"Polygon",coordinates:re};return z($t,Ee,ae)}function be(re,Ee,ae){return ae===void 0&&(ae={}),Kt(re.map(function(me){return ne(me,Ee)}),ae)}function we(re,Ee,ae){if(ae===void 0&&(ae={}),re.length<2)throw new Error("coordinates must be an array of two or more positions");var me={type:"LineString",coordinates:re};return z(me,Ee,ae)}function Me(re,Ee,ae){return ae===void 0&&(ae={}),Kt(re.map(function(me){return we(me,Ee)}),ae)}function Kt(re,Ee){Ee===void 0&&(Ee={});var ae={type:"FeatureCollection"};return Ee.id&&(ae.id=Ee.id),Ee.bbox&&(ae.bbox=Ee.bbox),ae.features=re,ae}function Zt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"MultiLineString",coordinates:re};return z(me,Ee,ae)}function Xt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"MultiPoint",coordinates:re};return z(me,Ee,ae)}function zt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"MultiPolygon",coordinates:re};return z(me,Ee,ae)}function Lt(re,Ee,ae){ae===void 0&&(ae={});var me={type:"GeometryCollection",geometries:re};return z(me,Ee,ae)}function yt(re,Ee){if(Ee===void 0&&(Ee=0),Ee&&!(Ee>=0))throw new Error("precision must be a positive number");var ae=Math.pow(10,Ee||0);return Math.round(re*ae)/ae}function pt(re,Ee){Ee===void 0&&(Ee="kilometers");var ae=E[Ee];if(!ae)throw new Error(Ee+" units is invalid");return re*ae}function Pr(re,Ee){Ee===void 0&&(Ee="kilometers");var ae=E[Ee];if(!ae)throw new Error(Ee+" units is invalid");return re/ae}function Ht(re,Ee){return mt(Pr(re,Ee))}function ar(re){var Ee=re%360;return Ee<0&&(Ee+=360),Ee}function mt(re){var Ee=re%(2*Math.PI);return Ee*180/Math.PI}function Ye(re){var Ee=re%360;return Ee*Math.PI/180}function bt(re,Ee,ae){if(Ee===void 0&&(Ee="kilometers"),ae===void 0&&(ae="kilometers"),!(re>=0))throw new Error("length must be a positive number");return pt(Pr(re,Ee),ae)}function Fe(re,Ee,ae){if(Ee===void 0&&(Ee="meters"),ae===void 0&&(ae="kilometers"),!(re>=0))throw new Error("area must be a positive number");var me=w[Ee];if(!me)throw new Error("invalid original units");var Te=w[ae];if(!Te)throw new Error("invalid final units");return re/me*Te}function Ae(re){return!isNaN(re)&&re!==null&&!Array.isArray(re)}function Ne(re){return!!re&&re.constructor===Object}function xt(re){if(!re)throw new Error("bbox is required");if(!Array.isArray(re))throw new Error("bbox must be an Array");if(re.length!==4&&re.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");re.forEach(function(Ee){if(!Ae(Ee))throw new Error("bbox must only contain numbers")})}function nr(re){if(!re)throw new Error("id is required");if(["string","number"].indexOf(typeof re)===-1)throw new Error("id must be a number or a string")}},17781:function(){},48583:function(pr,O,x){"use strict";var J=x(27418);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function E(Ae,Ne){if(Ae===Ne)return 0;for(var xt=Ae.length,nr=Ne.length,re=0,Ee=Math.min(xt,nr);re<Ee;++re)if(Ae[re]!==Ne[re]){xt=Ae[re],nr=Ne[re];break}return xt<nr?-1:nr<xt?1:0}function p(Ae){return x.g.Buffer&&typeof x.g.Buffer.isBuffer=="function"?x.g.Buffer.isBuffer(Ae):!!(Ae!=null&&Ae._isBuffer)}var w=x(30069),z=Object.prototype.hasOwnProperty,q=Array.prototype.slice,Y=function(){return function(){}.name==="foo"}();function ce(Ae){return Object.prototype.toString.call(Ae)}function ne(Ae){return p(Ae)||typeof x.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Ae):Ae?!!(Ae instanceof DataView||Ae.buffer&&Ae.buffer instanceof ArrayBuffer):!1}var be=pr.exports=Lt,we=/\s*function\s+([^\(\s]*)\s*/;function Me(Ae){if(!!w.isFunction(Ae)){if(Y)return Ae.name;var Ne=Ae.toString(),xt=Ne.match(we);return xt&&xt[1]}}be.AssertionError=function(Ne){this.name="AssertionError",this.actual=Ne.actual,this.expected=Ne.expected,this.operator=Ne.operator,Ne.message?(this.message=Ne.message,this.generatedMessage=!1):(this.message=Xt(this),this.generatedMessage=!0);var xt=Ne.stackStartFunction||zt;if(Error.captureStackTrace)Error.captureStackTrace(this,xt);else{var nr=new Error;if(nr.stack){var re=nr.stack,Ee=Me(xt),ae=re.indexOf(`
`+Ee);if(ae>=0){var me=re.indexOf(`
`,ae+1);re=re.substring(me+1)}this.stack=re}}},w.inherits(be.AssertionError,Error);function Kt(Ae,Ne){return typeof Ae=="string"?Ae.length<Ne?Ae:Ae.slice(0,Ne):Ae}function Zt(Ae){if(Y||!w.isFunction(Ae))return w.inspect(Ae);var Ne=Me(Ae),xt=Ne?": "+Ne:"";return"[Function"+xt+"]"}function Xt(Ae){return Kt(Zt(Ae.actual),128)+" "+Ae.operator+" "+Kt(Zt(Ae.expected),128)}function zt(Ae,Ne,xt,nr,re){throw new be.AssertionError({message:xt,actual:Ae,expected:Ne,operator:nr,stackStartFunction:re})}be.fail=zt;function Lt(Ae,Ne){Ae||zt(Ae,!0,Ne,"==",be.ok)}be.ok=Lt,be.equal=function(Ne,xt,nr){Ne!=xt&&zt(Ne,xt,nr,"==",be.equal)},be.notEqual=function(Ne,xt,nr){Ne==xt&&zt(Ne,xt,nr,"!=",be.notEqual)},be.deepEqual=function(Ne,xt,nr){yt(Ne,xt,!1)||zt(Ne,xt,nr,"deepEqual",be.deepEqual)},be.deepStrictEqual=function(Ne,xt,nr){yt(Ne,xt,!0)||zt(Ne,xt,nr,"deepStrictEqual",be.deepStrictEqual)};function yt(Ae,Ne,xt,nr){if(Ae===Ne)return!0;if(p(Ae)&&p(Ne))return E(Ae,Ne)===0;if(w.isDate(Ae)&&w.isDate(Ne))return Ae.getTime()===Ne.getTime();if(w.isRegExp(Ae)&&w.isRegExp(Ne))return Ae.source===Ne.source&&Ae.global===Ne.global&&Ae.multiline===Ne.multiline&&Ae.lastIndex===Ne.lastIndex&&Ae.ignoreCase===Ne.ignoreCase;if((Ae===null||typeof Ae!="object")&&(Ne===null||typeof Ne!="object"))return xt?Ae===Ne:Ae==Ne;if(ne(Ae)&&ne(Ne)&&ce(Ae)===ce(Ne)&&!(Ae instanceof Float32Array||Ae instanceof Float64Array))return E(new Uint8Array(Ae.buffer),new Uint8Array(Ne.buffer))===0;if(p(Ae)!==p(Ne))return!1;nr=nr||{actual:[],expected:[]};var re=nr.actual.indexOf(Ae);return re!==-1&&re===nr.expected.indexOf(Ne)?!0:(nr.actual.push(Ae),nr.expected.push(Ne),Pr(Ae,Ne,xt,nr))}function pt(Ae){return Object.prototype.toString.call(Ae)=="[object Arguments]"}function Pr(Ae,Ne,xt,nr){if(Ae==null||Ne===null||Ne===void 0)return!1;if(w.isPrimitive(Ae)||w.isPrimitive(Ne))return Ae===Ne;if(xt&&Object.getPrototypeOf(Ae)!==Object.getPrototypeOf(Ne))return!1;var re=pt(Ae),Ee=pt(Ne);if(re&&!Ee||!re&&Ee)return!1;if(re)return Ae=q.call(Ae),Ne=q.call(Ne),yt(Ae,Ne,xt);var ae=Fe(Ae),me=Fe(Ne),Te,Je;if(ae.length!==me.length)return!1;for(ae.sort(),me.sort(),Je=ae.length-1;Je>=0;Je--)if(ae[Je]!==me[Je])return!1;for(Je=ae.length-1;Je>=0;Je--)if(Te=ae[Je],!yt(Ae[Te],Ne[Te],xt,nr))return!1;return!0}be.notDeepEqual=function(Ne,xt,nr){yt(Ne,xt,!1)&&zt(Ne,xt,nr,"notDeepEqual",be.notDeepEqual)},be.notDeepStrictEqual=Ht;function Ht(Ae,Ne,xt){yt(Ae,Ne,!0)&&zt(Ae,Ne,xt,"notDeepStrictEqual",Ht)}be.strictEqual=function(Ne,xt,nr){Ne!==xt&&zt(Ne,xt,nr,"===",be.strictEqual)},be.notStrictEqual=function(Ne,xt,nr){Ne===xt&&zt(Ne,xt,nr,"!==",be.notStrictEqual)};function ar(Ae,Ne){if(!Ae||!Ne)return!1;if(Object.prototype.toString.call(Ne)=="[object RegExp]")return Ne.test(Ae);try{if(Ae instanceof Ne)return!0}catch(xt){}return Error.isPrototypeOf(Ne)?!1:Ne.call({},Ae)===!0}function mt(Ae){var Ne;try{Ae()}catch(xt){Ne=xt}return Ne}function Ye(Ae,Ne,xt,nr){var re;if(typeof Ne!="function")throw new TypeError('"block" argument must be a function');typeof xt=="string"&&(nr=xt,xt=null),re=mt(Ne),nr=(xt&&xt.name?" ("+xt.name+").":".")+(nr?" "+nr:"."),Ae&&!re&&zt(re,xt,"Missing expected exception"+nr);var Ee=typeof nr=="string",ae=!Ae&&w.isError(re),me=!Ae&&re&&!xt;if((ae&&Ee&&ar(re,xt)||me)&&zt(re,xt,"Got unwanted exception"+nr),Ae&&re&&xt&&!ar(re,xt)||!Ae&&re)throw re}be.throws=function(Ae,Ne,xt){Ye(!0,Ae,Ne,xt)},be.doesNotThrow=function(Ae,Ne,xt){Ye(!1,Ae,Ne,xt)},be.ifError=function(Ae){if(Ae)throw Ae};function bt(Ae,Ne){Ae||zt(Ae,!0,Ne,"==",bt)}be.strict=J(bt,be,{equal:be.strictEqual,deepEqual:be.deepStrictEqual,notEqual:be.notStrictEqual,notDeepEqual:be.notDeepStrictEqual}),be.strict.strict=be.strict;var Fe=Object.keys||function(Ae){var Ne=[];for(var xt in Ae)z.call(Ae,xt)&&Ne.push(xt);return Ne}},16076:function(pr){typeof Object.create=="function"?pr.exports=function(x,J){x.super_=J,x.prototype=Object.create(J.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}})}:pr.exports=function(x,J){x.super_=J;var E=function(){};E.prototype=J.prototype,x.prototype=new E,x.prototype.constructor=x}},52014:function(pr){pr.exports=function(x){return x&&typeof x=="object"&&typeof x.copy=="function"&&typeof x.fill=="function"&&typeof x.readUInt8=="function"}},30069:function(pr,O,x){var J=x(34155),E=/%[sdj%]/g;O.format=function(me){if(!Pr(me)){for(var Te=[],Je=0;Je<arguments.length;Je++)Te.push(z(arguments[Je]));return Te.join(" ")}for(var Je=1,dt=arguments,$t=dt.length,Fr=String(me).replace(E,function(ln){if(ln==="%%")return"%";if(Je>=$t)return ln;switch(ln){case"%s":return String(dt[Je++]);case"%d":return Number(dt[Je++]);case"%j":try{return JSON.stringify(dt[Je++])}catch(tr){return"[Circular]"}default:return ln}}),zr=dt[Je];Je<$t;zr=dt[++Je])Lt(zr)||!Ye(zr)?Fr+=" "+zr:Fr+=" "+z(zr);return Fr},O.deprecate=function(me,Te){if(ar(x.g.process))return function(){return O.deprecate(me,Te).apply(this,arguments)};if(J.noDeprecation===!0)return me;var Je=!1;function dt(){if(!Je){if(J.throwDeprecation)throw new Error(Te);J.traceDeprecation?console.trace(Te):console.error(Te),Je=!0}return me.apply(this,arguments)}return dt};var p={},w;O.debuglog=function(me){if(ar(w)&&(w={NODE_ENV:"production"}.NODE_DEBUG||""),me=me.toUpperCase(),!p[me])if(new RegExp("\\b"+me+"\\b","i").test(w)){var Te=J.pid;p[me]=function(){var Je=O.format.apply(O,arguments);console.error("%s %d: %s",me,Te,Je)}}else p[me]=function(){};return p[me]};function z(me,Te){var Je={seen:[],stylize:Y};return arguments.length>=3&&(Je.depth=arguments[2]),arguments.length>=4&&(Je.colors=arguments[3]),zt(Te)?Je.showHidden=Te:Te&&O._extend(Je,Te),ar(Je.showHidden)&&(Je.showHidden=!1),ar(Je.depth)&&(Je.depth=2),ar(Je.colors)&&(Je.colors=!1),ar(Je.customInspect)&&(Je.customInspect=!0),Je.colors&&(Je.stylize=q),ne(Je,me,Je.depth)}O.inspect=z,z.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},z.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function q(me,Te){var Je=z.styles[Te];return Je?"["+z.colors[Je][0]+"m"+me+"["+z.colors[Je][1]+"m":me}function Y(me,Te){return me}function ce(me){var Te={};return me.forEach(function(Je,dt){Te[Je]=!0}),Te}function ne(me,Te,Je){if(me.customInspect&&Te&&Ae(Te.inspect)&&Te.inspect!==O.inspect&&!(Te.constructor&&Te.constructor.prototype===Te)){var dt=Te.inspect(Je,me);return Pr(dt)||(dt=ne(me,dt,Je)),dt}var $t=be(me,Te);if($t)return $t;var Fr=Object.keys(Te),zr=ce(Fr);if(me.showHidden&&(Fr=Object.getOwnPropertyNames(Te)),Fe(Te)&&(Fr.indexOf("message")>=0||Fr.indexOf("description")>=0))return we(Te);if(Fr.length===0){if(Ae(Te)){var ln=Te.name?": "+Te.name:"";return me.stylize("[Function"+ln+"]","special")}if(mt(Te))return me.stylize(RegExp.prototype.toString.call(Te),"regexp");if(bt(Te))return me.stylize(Date.prototype.toString.call(Te),"date");if(Fe(Te))return we(Te)}var tr="",oe=!1,ge=["{","}"];if(Xt(Te)&&(oe=!0,ge=["[","]"]),Ae(Te)){var Re=Te.name?": "+Te.name:"";tr=" [Function"+Re+"]"}if(mt(Te)&&(tr=" "+RegExp.prototype.toString.call(Te)),bt(Te)&&(tr=" "+Date.prototype.toUTCString.call(Te)),Fe(Te)&&(tr=" "+we(Te)),Fr.length===0&&(!oe||Te.length==0))return ge[0]+tr+ge[1];if(Je<0)return mt(Te)?me.stylize(RegExp.prototype.toString.call(Te),"regexp"):me.stylize("[Object]","special");me.seen.push(Te);var qe;return oe?qe=Me(me,Te,Je,zr,Fr):qe=Fr.map(function(Ct){return Kt(me,Te,Je,zr,Ct,oe)}),me.seen.pop(),Zt(qe,tr,ge)}function be(me,Te){if(ar(Te))return me.stylize("undefined","undefined");if(Pr(Te)){var Je="'"+JSON.stringify(Te).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return me.stylize(Je,"string")}if(pt(Te))return me.stylize(""+Te,"number");if(zt(Te))return me.stylize(""+Te,"boolean");if(Lt(Te))return me.stylize("null","null")}function we(me){return"["+Error.prototype.toString.call(me)+"]"}function Me(me,Te,Je,dt,$t){for(var Fr=[],zr=0,ln=Te.length;zr<ln;++zr)ae(Te,String(zr))?Fr.push(Kt(me,Te,Je,dt,String(zr),!0)):Fr.push("");return $t.forEach(function(tr){tr.match(/^\d+$/)||Fr.push(Kt(me,Te,Je,dt,tr,!0))}),Fr}function Kt(me,Te,Je,dt,$t,Fr){var zr,ln,tr;if(tr=Object.getOwnPropertyDescriptor(Te,$t)||{value:Te[$t]},tr.get?tr.set?ln=me.stylize("[Getter/Setter]","special"):ln=me.stylize("[Getter]","special"):tr.set&&(ln=me.stylize("[Setter]","special")),ae(dt,$t)||(zr="["+$t+"]"),ln||(me.seen.indexOf(tr.value)<0?(Lt(Je)?ln=ne(me,tr.value,null):ln=ne(me,tr.value,Je-1),ln.indexOf(`
`)>-1&&(Fr?ln=ln.split(`
`).map(function(oe){return"  "+oe}).join(`
`).substr(2):ln=`
`+ln.split(`
`).map(function(oe){return"   "+oe}).join(`
`))):ln=me.stylize("[Circular]","special")),ar(zr)){if(Fr&&$t.match(/^\d+$/))return ln;zr=JSON.stringify(""+$t),zr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(zr=zr.substr(1,zr.length-2),zr=me.stylize(zr,"name")):(zr=zr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),zr=me.stylize(zr,"string"))}return zr+": "+ln}function Zt(me,Te,Je){var dt=0,$t=me.reduce(function(Fr,zr){return dt++,zr.indexOf(`
`)>=0&&dt++,Fr+zr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return $t>60?Je[0]+(Te===""?"":Te+`
 `)+" "+me.join(`,
  `)+" "+Je[1]:Je[0]+Te+" "+me.join(", ")+" "+Je[1]}function Xt(me){return Array.isArray(me)}O.isArray=Xt;function zt(me){return typeof me=="boolean"}O.isBoolean=zt;function Lt(me){return me===null}O.isNull=Lt;function yt(me){return me==null}O.isNullOrUndefined=yt;function pt(me){return typeof me=="number"}O.isNumber=pt;function Pr(me){return typeof me=="string"}O.isString=Pr;function Ht(me){return typeof me=="symbol"}O.isSymbol=Ht;function ar(me){return me===void 0}O.isUndefined=ar;function mt(me){return Ye(me)&&xt(me)==="[object RegExp]"}O.isRegExp=mt;function Ye(me){return typeof me=="object"&&me!==null}O.isObject=Ye;function bt(me){return Ye(me)&&xt(me)==="[object Date]"}O.isDate=bt;function Fe(me){return Ye(me)&&(xt(me)==="[object Error]"||me instanceof Error)}O.isError=Fe;function Ae(me){return typeof me=="function"}O.isFunction=Ae;function Ne(me){return me===null||typeof me=="boolean"||typeof me=="number"||typeof me=="string"||typeof me=="symbol"||typeof me=="undefined"}O.isPrimitive=Ne,O.isBuffer=x(52014);function xt(me){return Object.prototype.toString.call(me)}function nr(me){return me<10?"0"+me.toString(10):me.toString(10)}var re=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Ee(){var me=new Date,Te=[nr(me.getHours()),nr(me.getMinutes()),nr(me.getSeconds())].join(":");return[me.getDate(),re[me.getMonth()],Te].join(" ")}O.log=function(){console.log("%s - %s",Ee(),O.format.apply(O,arguments))},O.inherits=x(16076),O._extend=function(me,Te){if(!Te||!Ye(Te))return me;for(var Je=Object.keys(Te),dt=Je.length;dt--;)me[Je[dt]]=Te[Je[dt]];return me};function ae(me,Te){return Object.prototype.hasOwnProperty.call(me,Te)}},9187:function(pr){"use strict";pr.exports=O,pr.exports.default=O;function O(re,Ee,ae){ae=ae||2;var me=Ee&&Ee.length,Te=me?Ee[0]*ae:re.length,Je=x(re,0,Te,ae,!0),dt=[];if(!Je||Je.next===Je.prev)return dt;var $t,Fr,zr,ln,tr,oe,ge;if(me&&(Je=Y(re,Ee,Je,ae)),re.length>80*ae){$t=zr=re[0],Fr=ln=re[1];for(var Re=ae;Re<Te;Re+=ae)tr=re[Re],oe=re[Re+1],tr<$t&&($t=tr),oe<Fr&&(Fr=oe),tr>zr&&(zr=tr),oe>ln&&(ln=oe);ge=Math.max(zr-$t,ln-Fr),ge=ge!==0?1/ge:0}return E(Je,dt,ae,$t,Fr,ge),dt}function x(re,Ee,ae,me,Te){var Je,dt;if(Te===nr(re,Ee,ae,me)>0)for(Je=Ee;Je<ae;Je+=me)dt=Ae(Je,re[Je],re[Je+1],dt);else for(Je=ae-me;Je>=Ee;Je-=me)dt=Ae(Je,re[Je],re[Je+1],dt);return dt&&pt(dt,dt.next)&&(Ne(dt),dt=dt.next),dt}function J(re,Ee){if(!re)return re;Ee||(Ee=re);var ae=re,me;do if(me=!1,!ae.steiner&&(pt(ae,ae.next)||yt(ae.prev,ae,ae.next)===0)){if(Ne(ae),ae=Ee=ae.prev,ae===ae.next)break;me=!0}else ae=ae.next;while(me||ae!==Ee);return Ee}function E(re,Ee,ae,me,Te,Je,dt){if(!!re){!dt&&Je&&Me(re,me,Te,Je);for(var $t=re,Fr,zr;re.prev!==re.next;){if(Fr=re.prev,zr=re.next,Je?w(re,me,Te,Je):p(re)){Ee.push(Fr.i/ae),Ee.push(re.i/ae),Ee.push(zr.i/ae),Ne(re),re=zr.next,$t=zr.next;continue}if(re=zr,re===$t){dt?dt===1?(re=z(J(re),Ee,ae),E(re,Ee,ae,me,Te,Je,2)):dt===2&&q(re,Ee,ae,me,Te,Je):E(J(re),Ee,ae,me,Te,Je,1);break}}}}function p(re){var Ee=re.prev,ae=re,me=re.next;if(yt(Ee,ae,me)>=0)return!1;for(var Te=re.next.next;Te!==re.prev;){if(zt(Ee.x,Ee.y,ae.x,ae.y,me.x,me.y,Te.x,Te.y)&&yt(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function w(re,Ee,ae,me){var Te=re.prev,Je=re,dt=re.next;if(yt(Te,Je,dt)>=0)return!1;for(var $t=Te.x<Je.x?Te.x<dt.x?Te.x:dt.x:Je.x<dt.x?Je.x:dt.x,Fr=Te.y<Je.y?Te.y<dt.y?Te.y:dt.y:Je.y<dt.y?Je.y:dt.y,zr=Te.x>Je.x?Te.x>dt.x?Te.x:dt.x:Je.x>dt.x?Je.x:dt.x,ln=Te.y>Je.y?Te.y>dt.y?Te.y:dt.y:Je.y>dt.y?Je.y:dt.y,tr=Zt($t,Fr,Ee,ae,me),oe=Zt(zr,ln,Ee,ae,me),ge=re.prevZ,Re=re.nextZ;ge&&ge.z>=tr&&Re&&Re.z<=oe;){if(ge!==re.prev&&ge!==re.next&&zt(Te.x,Te.y,Je.x,Je.y,dt.x,dt.y,ge.x,ge.y)&&yt(ge.prev,ge,ge.next)>=0||(ge=ge.prevZ,Re!==re.prev&&Re!==re.next&&zt(Te.x,Te.y,Je.x,Je.y,dt.x,dt.y,Re.x,Re.y)&&yt(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;ge&&ge.z>=tr;){if(ge!==re.prev&&ge!==re.next&&zt(Te.x,Te.y,Je.x,Je.y,dt.x,dt.y,ge.x,ge.y)&&yt(ge.prev,ge,ge.next)>=0)return!1;ge=ge.prevZ}for(;Re&&Re.z<=oe;){if(Re!==re.prev&&Re!==re.next&&zt(Te.x,Te.y,Je.x,Je.y,dt.x,dt.y,Re.x,Re.y)&&yt(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function z(re,Ee,ae){var me=re;do{var Te=me.prev,Je=me.next.next;!pt(Te,Je)&&Pr(Te,me,me.next,Je)&&Ye(Te,Je)&&Ye(Je,Te)&&(Ee.push(Te.i/ae),Ee.push(me.i/ae),Ee.push(Je.i/ae),Ne(me),Ne(me.next),me=re=Je),me=me.next}while(me!==re);return J(me)}function q(re,Ee,ae,me,Te,Je){var dt=re;do{for(var $t=dt.next.next;$t!==dt.prev;){if(dt.i!==$t.i&&Lt(dt,$t)){var Fr=Fe(dt,$t);dt=J(dt,dt.next),Fr=J(Fr,Fr.next),E(dt,Ee,ae,me,Te,Je),E(Fr,Ee,ae,me,Te,Je);return}$t=$t.next}dt=dt.next}while(dt!==re)}function Y(re,Ee,ae,me){var Te=[],Je,dt,$t,Fr,zr;for(Je=0,dt=Ee.length;Je<dt;Je++)$t=Ee[Je]*me,Fr=Je<dt-1?Ee[Je+1]*me:re.length,zr=x(re,$t,Fr,me,!1),zr===zr.next&&(zr.steiner=!0),Te.push(Xt(zr));for(Te.sort(ce),Je=0;Je<Te.length;Je++)ae=ne(Te[Je],ae),ae=J(ae,ae.next);return ae}function ce(re,Ee){return re.x-Ee.x}function ne(re,Ee){var ae=be(re,Ee);if(!ae)return Ee;var me=Fe(ae,re),Te=J(ae,ae.next);return J(me,me.next),Ee===ae?Te:Ee}function be(re,Ee){var ae=Ee,me=re.x,Te=re.y,Je=-Infinity,dt;do{if(Te<=ae.y&&Te>=ae.next.y&&ae.next.y!==ae.y){var $t=ae.x+(Te-ae.y)*(ae.next.x-ae.x)/(ae.next.y-ae.y);if($t<=me&&$t>Je){if(Je=$t,$t===me){if(Te===ae.y)return ae;if(Te===ae.next.y)return ae.next}dt=ae.x<ae.next.x?ae:ae.next}}ae=ae.next}while(ae!==Ee);if(!dt)return null;if(me===Je)return dt;var Fr=dt,zr=dt.x,ln=dt.y,tr=Infinity,oe;ae=dt;do me>=ae.x&&ae.x>=zr&&me!==ae.x&&zt(Te<ln?me:Je,Te,zr,ln,Te<ln?Je:me,Te,ae.x,ae.y)&&(oe=Math.abs(Te-ae.y)/(me-ae.x),Ye(ae,re)&&(oe<tr||oe===tr&&(ae.x>dt.x||ae.x===dt.x&&we(dt,ae)))&&(dt=ae,tr=oe)),ae=ae.next;while(ae!==Fr);return dt}function we(re,Ee){return yt(re.prev,re,Ee.prev)<0&&yt(Ee.next,re,re.next)<0}function Me(re,Ee,ae,me){var Te=re;do Te.z===null&&(Te.z=Zt(Te.x,Te.y,Ee,ae,me)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==re);Te.prevZ.nextZ=null,Te.prevZ=null,Kt(Te)}function Kt(re){var Ee,ae,me,Te,Je,dt,$t,Fr,zr=1;do{for(ae=re,re=null,Je=null,dt=0;ae;){for(dt++,me=ae,$t=0,Ee=0;Ee<zr&&($t++,me=me.nextZ,!!me);Ee++);for(Fr=zr;$t>0||Fr>0&&me;)$t!==0&&(Fr===0||!me||ae.z<=me.z)?(Te=ae,ae=ae.nextZ,$t--):(Te=me,me=me.nextZ,Fr--),Je?Je.nextZ=Te:re=Te,Te.prevZ=Je,Je=Te;ae=me}Je.nextZ=null,zr*=2}while(dt>1);return re}function Zt(re,Ee,ae,me,Te){return re=32767*(re-ae)*Te,Ee=32767*(Ee-me)*Te,re=(re|re<<8)&16711935,re=(re|re<<4)&252645135,re=(re|re<<2)&858993459,re=(re|re<<1)&1431655765,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,re|Ee<<1}function Xt(re){var Ee=re,ae=re;do(Ee.x<ae.x||Ee.x===ae.x&&Ee.y<ae.y)&&(ae=Ee),Ee=Ee.next;while(Ee!==re);return ae}function zt(re,Ee,ae,me,Te,Je,dt,$t){return(Te-dt)*(Ee-$t)-(re-dt)*(Je-$t)>=0&&(re-dt)*(me-$t)-(ae-dt)*(Ee-$t)>=0&&(ae-dt)*(Je-$t)-(Te-dt)*(me-$t)>=0}function Lt(re,Ee){return re.next.i!==Ee.i&&re.prev.i!==Ee.i&&!mt(re,Ee)&&(Ye(re,Ee)&&Ye(Ee,re)&&bt(re,Ee)&&(yt(re.prev,re,Ee.prev)||yt(re,Ee.prev,Ee))||pt(re,Ee)&&yt(re.prev,re,re.next)>0&&yt(Ee.prev,Ee,Ee.next)>0)}function yt(re,Ee,ae){return(Ee.y-re.y)*(ae.x-Ee.x)-(Ee.x-re.x)*(ae.y-Ee.y)}function pt(re,Ee){return re.x===Ee.x&&re.y===Ee.y}function Pr(re,Ee,ae,me){var Te=ar(yt(re,Ee,ae)),Je=ar(yt(re,Ee,me)),dt=ar(yt(ae,me,re)),$t=ar(yt(ae,me,Ee));return!!(Te!==Je&&dt!==$t||Te===0&&Ht(re,ae,Ee)||Je===0&&Ht(re,me,Ee)||dt===0&&Ht(ae,re,me)||$t===0&&Ht(ae,Ee,me))}function Ht(re,Ee,ae){return Ee.x<=Math.max(re.x,ae.x)&&Ee.x>=Math.min(re.x,ae.x)&&Ee.y<=Math.max(re.y,ae.y)&&Ee.y>=Math.min(re.y,ae.y)}function ar(re){return re>0?1:re<0?-1:0}function mt(re,Ee){var ae=re;do{if(ae.i!==re.i&&ae.next.i!==re.i&&ae.i!==Ee.i&&ae.next.i!==Ee.i&&Pr(ae,ae.next,re,Ee))return!0;ae=ae.next}while(ae!==re);return!1}function Ye(re,Ee){return yt(re.prev,re,re.next)<0?yt(re,Ee,re.next)>=0&&yt(re,re.prev,Ee)>=0:yt(re,Ee,re.prev)<0||yt(re,re.next,Ee)<0}function bt(re,Ee){var ae=re,me=!1,Te=(re.x+Ee.x)/2,Je=(re.y+Ee.y)/2;do ae.y>Je!=ae.next.y>Je&&ae.next.y!==ae.y&&Te<(ae.next.x-ae.x)*(Je-ae.y)/(ae.next.y-ae.y)+ae.x&&(me=!me),ae=ae.next;while(ae!==re);return me}function Fe(re,Ee){var ae=new xt(re.i,re.x,re.y),me=new xt(Ee.i,Ee.x,Ee.y),Te=re.next,Je=Ee.prev;return re.next=Ee,Ee.prev=re,ae.next=Te,Te.prev=ae,me.next=ae,ae.prev=me,Je.next=me,me.prev=Je,me}function Ae(re,Ee,ae,me){var Te=new xt(re,Ee,ae);return me?(Te.next=me.next,Te.prev=me,me.next.prev=Te,me.next=Te):(Te.prev=Te,Te.next=Te),Te}function Ne(re){re.next.prev=re.prev,re.prev.next=re.next,re.prevZ&&(re.prevZ.nextZ=re.nextZ),re.nextZ&&(re.nextZ.prevZ=re.prevZ)}function xt(re,Ee,ae){this.i=re,this.x=Ee,this.y=ae,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}O.deviation=function(re,Ee,ae,me){var Te=Ee&&Ee.length,Je=Te?Ee[0]*ae:re.length,dt=Math.abs(nr(re,0,Je,ae));if(Te)for(var $t=0,Fr=Ee.length;$t<Fr;$t++){var zr=Ee[$t]*ae,ln=$t<Fr-1?Ee[$t+1]*ae:re.length;dt-=Math.abs(nr(re,zr,ln,ae))}var tr=0;for($t=0;$t<me.length;$t+=3){var oe=me[$t]*ae,ge=me[$t+1]*ae,Re=me[$t+2]*ae;tr+=Math.abs((re[oe]-re[Re])*(re[ge+1]-re[oe+1])-(re[oe]-re[ge])*(re[Re+1]-re[oe+1]))}return dt===0&&tr===0?0:Math.abs((tr-dt)/dt)};function nr(re,Ee,ae,me){for(var Te=0,Je=Ee,dt=ae-me;Je<ae;Je+=me)Te+=(re[dt]-re[Je])*(re[Je+1]+re[dt+1]),dt=Je;return Te}O.flatten=function(re){for(var Ee=re[0][0].length,ae={vertices:[],holes:[],dimensions:Ee},me=0,Te=0;Te<re.length;Te++){for(var Je=0;Je<re[Te].length;Je++)for(var dt=0;dt<Ee;dt++)ae.vertices.push(re[Te][Je][dt]);Te>0&&(me+=re[Te-1].length,ae.holes.push(me))}return ae}},67709:function(pr){function O(J){var E=J.target||J.srcElement;E.__resizeRAF__&&cancelAnimationFrame(E.__resizeRAF__),E.__resizeRAF__=requestAnimationFrame(function(){var p=E.__resizeTrigger__,w=p&&p.__resizeListeners__;w&&w.forEach(function(z){z.call(p,J)})})}var x=function(E,p){var w=this,z=w.document,q,Y=z.attachEvent;typeof navigator!="undefined"&&(q=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ce(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",O)}if(!E.__resizeListeners__)if(E.__resizeListeners__=[],Y)E.__resizeTrigger__=E,E.attachEvent("onresize",O);else{getComputedStyle(E).position==="static"&&(E.style.position="relative");var ne=E.__resizeTrigger__=z.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=E,ne.onload=ce,ne.type="text/html",q&&E.appendChild(ne),ne.data="about:blank",q||E.appendChild(ne)}E.__resizeListeners__.push(p)};pr.exports=typeof window=="undefined"?x:x.bind(window),pr.exports.unbind=function(J,E){var p=document.attachEvent,w=J.__resizeListeners__||[];if(E){var z=w.indexOf(E);z!==-1&&w.splice(z,1)}else w=J.__resizeListeners__=[];if(!w.length){if(p)J.detachEvent("onresize",O);else if(J.__resizeTrigger__){var q=J.__resizeTrigger__.contentDocument,Y=q&&q.defaultView;Y&&(Y.removeEventListener("resize",O),delete Y.__resizeTrigger__),J.__resizeTrigger__=!J.removeChild(J.__resizeTrigger__)}delete J.__resizeListeners__}}},26729:function(pr){"use strict";var O=Object.prototype.hasOwnProperty,x="~";function J(){}Object.create&&(J.prototype=Object.create(null),new J().__proto__||(x=!1));function E(q,Y,ce){this.fn=q,this.context=Y,this.once=ce||!1}function p(q,Y,ce,ne,be){if(typeof ce!="function")throw new TypeError("The listener must be a function");var we=new E(ce,ne||q,be),Me=x?x+Y:Y;return q._events[Me]?q._events[Me].fn?q._events[Me]=[q._events[Me],we]:q._events[Me].push(we):(q._events[Me]=we,q._eventsCount++),q}function w(q,Y){--q._eventsCount==0?q._events=new J:delete q._events[Y]}function z(){this._events=new J,this._eventsCount=0}z.prototype.eventNames=function(){var Y=[],ce,ne;if(this._eventsCount===0)return Y;for(ne in ce=this._events)O.call(ce,ne)&&Y.push(x?ne.slice(1):ne);return Object.getOwnPropertySymbols?Y.concat(Object.getOwnPropertySymbols(ce)):Y},z.prototype.listeners=function(Y){var ce=x?x+Y:Y,ne=this._events[ce];if(!ne)return[];if(ne.fn)return[ne.fn];for(var be=0,we=ne.length,Me=new Array(we);be<we;be++)Me[be]=ne[be].fn;return Me},z.prototype.listenerCount=function(Y){var ce=x?x+Y:Y,ne=this._events[ce];return ne?ne.fn?1:ne.length:0},z.prototype.emit=function(Y,ce,ne,be,we,Me){var Kt=x?x+Y:Y;if(!this._events[Kt])return!1;var Zt=this._events[Kt],Xt=arguments.length,zt,Lt;if(Zt.fn){switch(Zt.once&&this.removeListener(Y,Zt.fn,void 0,!0),Xt){case 1:return Zt.fn.call(Zt.context),!0;case 2:return Zt.fn.call(Zt.context,ce),!0;case 3:return Zt.fn.call(Zt.context,ce,ne),!0;case 4:return Zt.fn.call(Zt.context,ce,ne,be),!0;case 5:return Zt.fn.call(Zt.context,ce,ne,be,we),!0;case 6:return Zt.fn.call(Zt.context,ce,ne,be,we,Me),!0}for(Lt=1,zt=new Array(Xt-1);Lt<Xt;Lt++)zt[Lt-1]=arguments[Lt];Zt.fn.apply(Zt.context,zt)}else{var yt=Zt.length,pt;for(Lt=0;Lt<yt;Lt++)switch(Zt[Lt].once&&this.removeListener(Y,Zt[Lt].fn,void 0,!0),Xt){case 1:Zt[Lt].fn.call(Zt[Lt].context);break;case 2:Zt[Lt].fn.call(Zt[Lt].context,ce);break;case 3:Zt[Lt].fn.call(Zt[Lt].context,ce,ne);break;case 4:Zt[Lt].fn.call(Zt[Lt].context,ce,ne,be);break;default:if(!zt)for(pt=1,zt=new Array(Xt-1);pt<Xt;pt++)zt[pt-1]=arguments[pt];Zt[Lt].fn.apply(Zt[Lt].context,zt)}}return!0},z.prototype.on=function(Y,ce,ne){return p(this,Y,ce,ne,!1)},z.prototype.once=function(Y,ce,ne){return p(this,Y,ce,ne,!0)},z.prototype.removeListener=function(Y,ce,ne,be){var we=x?x+Y:Y;if(!this._events[we])return this;if(!ce)return w(this,we),this;var Me=this._events[we];if(Me.fn)Me.fn===ce&&(!be||Me.once)&&(!ne||Me.context===ne)&&w(this,we);else{for(var Kt=0,Zt=[],Xt=Me.length;Kt<Xt;Kt++)(Me[Kt].fn!==ce||be&&!Me[Kt].once||ne&&Me[Kt].context!==ne)&&Zt.push(Me[Kt]);Zt.length?this._events[we]=Zt.length===1?Zt[0]:Zt:w(this,we)}return this},z.prototype.removeAllListeners=function(Y){var ce;return Y?(ce=x?x+Y:Y,this._events[ce]&&w(this,ce)):(this._events=new J,this._eventsCount=0),this},z.prototype.off=z.prototype.removeListener,z.prototype.addListener=z.prototype.on,z.prefixed=x,z.EventEmitter=z,pr.exports=z},85975:function(pr,O,x){"use strict";x.r(O),x.d(O,{create:function(){return E},clone:function(){return p},copy:function(){return w},fromValues:function(){return z},set:function(){return q},identity:function(){return Y},transpose:function(){return ce},invert:function(){return ne},adjoint:function(){return be},determinant:function(){return we},multiply:function(){return Me},translate:function(){return Kt},scale:function(){return Zt},rotate:function(){return Xt},rotateX:function(){return zt},rotateY:function(){return Lt},rotateZ:function(){return yt},fromTranslation:function(){return pt},fromScaling:function(){return Pr},fromRotation:function(){return Ht},fromXRotation:function(){return ar},fromYRotation:function(){return mt},fromZRotation:function(){return Ye},fromRotationTranslation:function(){return bt},fromQuat2:function(){return Fe},getTranslation:function(){return Ae},getScaling:function(){return Ne},getRotation:function(){return xt},fromRotationTranslationScale:function(){return nr},fromRotationTranslationScaleOrigin:function(){return re},fromQuat:function(){return Ee},frustum:function(){return ae},perspective:function(){return me},perspectiveFromFieldOfView:function(){return Te},ortho:function(){return Je},lookAt:function(){return dt},targetTo:function(){return $t},str:function(){return Fr},frob:function(){return zr},add:function(){return ln},subtract:function(){return tr},multiplyScalar:function(){return oe},multiplyScalarAndAdd:function(){return ge},exactEquals:function(){return Re},equals:function(){return qe},mul:function(){return Ct},sub:function(){return kt}});var J=x(49685);function E(){var S=new J.WT(16);return J.WT!=Float32Array&&(S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=0,S[12]=0,S[13]=0,S[14]=0),S[0]=1,S[5]=1,S[10]=1,S[15]=1,S}function p(S){var F=new J.WT(16);return F[0]=S[0],F[1]=S[1],F[2]=S[2],F[3]=S[3],F[4]=S[4],F[5]=S[5],F[6]=S[6],F[7]=S[7],F[8]=S[8],F[9]=S[9],F[10]=S[10],F[11]=S[11],F[12]=S[12],F[13]=S[13],F[14]=S[14],F[15]=S[15],F}function w(S,F){return S[0]=F[0],S[1]=F[1],S[2]=F[2],S[3]=F[3],S[4]=F[4],S[5]=F[5],S[6]=F[6],S[7]=F[7],S[8]=F[8],S[9]=F[9],S[10]=F[10],S[11]=F[11],S[12]=F[12],S[13]=F[13],S[14]=F[14],S[15]=F[15],S}function z(S,F,he,Be,$e,vt,wt,H,Wt,Vt,yr,Er,Ar,Mr,Ke,gt){var ct=new J.WT(16);return ct[0]=S,ct[1]=F,ct[2]=he,ct[3]=Be,ct[4]=$e,ct[5]=vt,ct[6]=wt,ct[7]=H,ct[8]=Wt,ct[9]=Vt,ct[10]=yr,ct[11]=Er,ct[12]=Ar,ct[13]=Mr,ct[14]=Ke,ct[15]=gt,ct}function q(S,F,he,Be,$e,vt,wt,H,Wt,Vt,yr,Er,Ar,Mr,Ke,gt,ct){return S[0]=F,S[1]=he,S[2]=Be,S[3]=$e,S[4]=vt,S[5]=wt,S[6]=H,S[7]=Wt,S[8]=Vt,S[9]=yr,S[10]=Er,S[11]=Ar,S[12]=Mr,S[13]=Ke,S[14]=gt,S[15]=ct,S}function Y(S){return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function ce(S,F){if(S===F){var he=F[1],Be=F[2],$e=F[3],vt=F[6],wt=F[7],H=F[11];S[1]=F[4],S[2]=F[8],S[3]=F[12],S[4]=he,S[6]=F[9],S[7]=F[13],S[8]=Be,S[9]=vt,S[11]=F[14],S[12]=$e,S[13]=wt,S[14]=H}else S[0]=F[0],S[1]=F[4],S[2]=F[8],S[3]=F[12],S[4]=F[1],S[5]=F[5],S[6]=F[9],S[7]=F[13],S[8]=F[2],S[9]=F[6],S[10]=F[10],S[11]=F[14],S[12]=F[3],S[13]=F[7],S[14]=F[11],S[15]=F[15];return S}function ne(S,F){var he=F[0],Be=F[1],$e=F[2],vt=F[3],wt=F[4],H=F[5],Wt=F[6],Vt=F[7],yr=F[8],Er=F[9],Ar=F[10],Mr=F[11],Ke=F[12],gt=F[13],ct=F[14],sr=F[15],Qr=he*H-Be*wt,st=he*Wt-$e*wt,Mt=he*Vt-vt*wt,Jt=Be*Wt-$e*H,mr=Be*Vt-vt*H,gn=$e*Vt-vt*Wt,Cn=yr*gt-Er*Ke,yi=yr*ct-Ar*Ke,Ei=yr*sr-Mr*Ke,Ii=Er*ct-Ar*gt,Ji=Er*sr-Mr*gt,li=Ar*sr-Mr*ct,G=Qr*li-st*Ji+Mt*Ii+Jt*Ei-mr*yi+gn*Cn;return G?(G=1/G,S[0]=(H*li-Wt*Ji+Vt*Ii)*G,S[1]=($e*Ji-Be*li-vt*Ii)*G,S[2]=(gt*gn-ct*mr+sr*Jt)*G,S[3]=(Ar*mr-Er*gn-Mr*Jt)*G,S[4]=(Wt*Ei-wt*li-Vt*yi)*G,S[5]=(he*li-$e*Ei+vt*yi)*G,S[6]=(ct*Mt-Ke*gn-sr*st)*G,S[7]=(yr*gn-Ar*Mt+Mr*st)*G,S[8]=(wt*Ji-H*Ei+Vt*Cn)*G,S[9]=(Be*Ei-he*Ji-vt*Cn)*G,S[10]=(Ke*mr-gt*Mt+sr*Qr)*G,S[11]=(Er*Mt-yr*mr-Mr*Qr)*G,S[12]=(H*yi-wt*Ii-Wt*Cn)*G,S[13]=(he*Ii-Be*yi+$e*Cn)*G,S[14]=(gt*st-Ke*Jt-ct*Qr)*G,S[15]=(yr*Jt-Er*st+Ar*Qr)*G,S):null}function be(S,F){var he=F[0],Be=F[1],$e=F[2],vt=F[3],wt=F[4],H=F[5],Wt=F[6],Vt=F[7],yr=F[8],Er=F[9],Ar=F[10],Mr=F[11],Ke=F[12],gt=F[13],ct=F[14],sr=F[15];return S[0]=H*(Ar*sr-Mr*ct)-Er*(Wt*sr-Vt*ct)+gt*(Wt*Mr-Vt*Ar),S[1]=-(Be*(Ar*sr-Mr*ct)-Er*($e*sr-vt*ct)+gt*($e*Mr-vt*Ar)),S[2]=Be*(Wt*sr-Vt*ct)-H*($e*sr-vt*ct)+gt*($e*Vt-vt*Wt),S[3]=-(Be*(Wt*Mr-Vt*Ar)-H*($e*Mr-vt*Ar)+Er*($e*Vt-vt*Wt)),S[4]=-(wt*(Ar*sr-Mr*ct)-yr*(Wt*sr-Vt*ct)+Ke*(Wt*Mr-Vt*Ar)),S[5]=he*(Ar*sr-Mr*ct)-yr*($e*sr-vt*ct)+Ke*($e*Mr-vt*Ar),S[6]=-(he*(Wt*sr-Vt*ct)-wt*($e*sr-vt*ct)+Ke*($e*Vt-vt*Wt)),S[7]=he*(Wt*Mr-Vt*Ar)-wt*($e*Mr-vt*Ar)+yr*($e*Vt-vt*Wt),S[8]=wt*(Er*sr-Mr*gt)-yr*(H*sr-Vt*gt)+Ke*(H*Mr-Vt*Er),S[9]=-(he*(Er*sr-Mr*gt)-yr*(Be*sr-vt*gt)+Ke*(Be*Mr-vt*Er)),S[10]=he*(H*sr-Vt*gt)-wt*(Be*sr-vt*gt)+Ke*(Be*Vt-vt*H),S[11]=-(he*(H*Mr-Vt*Er)-wt*(Be*Mr-vt*Er)+yr*(Be*Vt-vt*H)),S[12]=-(wt*(Er*ct-Ar*gt)-yr*(H*ct-Wt*gt)+Ke*(H*Ar-Wt*Er)),S[13]=he*(Er*ct-Ar*gt)-yr*(Be*ct-$e*gt)+Ke*(Be*Ar-$e*Er),S[14]=-(he*(H*ct-Wt*gt)-wt*(Be*ct-$e*gt)+Ke*(Be*Wt-$e*H)),S[15]=he*(H*Ar-Wt*Er)-wt*(Be*Ar-$e*Er)+yr*(Be*Wt-$e*H),S}function we(S){var F=S[0],he=S[1],Be=S[2],$e=S[3],vt=S[4],wt=S[5],H=S[6],Wt=S[7],Vt=S[8],yr=S[9],Er=S[10],Ar=S[11],Mr=S[12],Ke=S[13],gt=S[14],ct=S[15],sr=F*wt-he*vt,Qr=F*H-Be*vt,st=F*Wt-$e*vt,Mt=he*H-Be*wt,Jt=he*Wt-$e*wt,mr=Be*Wt-$e*H,gn=Vt*Ke-yr*Mr,Cn=Vt*gt-Er*Mr,yi=Vt*ct-Ar*Mr,Ei=yr*gt-Er*Ke,Ii=yr*ct-Ar*Ke,Ji=Er*ct-Ar*gt;return sr*Ji-Qr*Ii+st*Ei+Mt*yi-Jt*Cn+mr*gn}function Me(S,F,he){var Be=F[0],$e=F[1],vt=F[2],wt=F[3],H=F[4],Wt=F[5],Vt=F[6],yr=F[7],Er=F[8],Ar=F[9],Mr=F[10],Ke=F[11],gt=F[12],ct=F[13],sr=F[14],Qr=F[15],st=he[0],Mt=he[1],Jt=he[2],mr=he[3];return S[0]=st*Be+Mt*H+Jt*Er+mr*gt,S[1]=st*$e+Mt*Wt+Jt*Ar+mr*ct,S[2]=st*vt+Mt*Vt+Jt*Mr+mr*sr,S[3]=st*wt+Mt*yr+Jt*Ke+mr*Qr,st=he[4],Mt=he[5],Jt=he[6],mr=he[7],S[4]=st*Be+Mt*H+Jt*Er+mr*gt,S[5]=st*$e+Mt*Wt+Jt*Ar+mr*ct,S[6]=st*vt+Mt*Vt+Jt*Mr+mr*sr,S[7]=st*wt+Mt*yr+Jt*Ke+mr*Qr,st=he[8],Mt=he[9],Jt=he[10],mr=he[11],S[8]=st*Be+Mt*H+Jt*Er+mr*gt,S[9]=st*$e+Mt*Wt+Jt*Ar+mr*ct,S[10]=st*vt+Mt*Vt+Jt*Mr+mr*sr,S[11]=st*wt+Mt*yr+Jt*Ke+mr*Qr,st=he[12],Mt=he[13],Jt=he[14],mr=he[15],S[12]=st*Be+Mt*H+Jt*Er+mr*gt,S[13]=st*$e+Mt*Wt+Jt*Ar+mr*ct,S[14]=st*vt+Mt*Vt+Jt*Mr+mr*sr,S[15]=st*wt+Mt*yr+Jt*Ke+mr*Qr,S}function Kt(S,F,he){var Be=he[0],$e=he[1],vt=he[2],wt,H,Wt,Vt,yr,Er,Ar,Mr,Ke,gt,ct,sr;return F===S?(S[12]=F[0]*Be+F[4]*$e+F[8]*vt+F[12],S[13]=F[1]*Be+F[5]*$e+F[9]*vt+F[13],S[14]=F[2]*Be+F[6]*$e+F[10]*vt+F[14],S[15]=F[3]*Be+F[7]*$e+F[11]*vt+F[15]):(wt=F[0],H=F[1],Wt=F[2],Vt=F[3],yr=F[4],Er=F[5],Ar=F[6],Mr=F[7],Ke=F[8],gt=F[9],ct=F[10],sr=F[11],S[0]=wt,S[1]=H,S[2]=Wt,S[3]=Vt,S[4]=yr,S[5]=Er,S[6]=Ar,S[7]=Mr,S[8]=Ke,S[9]=gt,S[10]=ct,S[11]=sr,S[12]=wt*Be+yr*$e+Ke*vt+F[12],S[13]=H*Be+Er*$e+gt*vt+F[13],S[14]=Wt*Be+Ar*$e+ct*vt+F[14],S[15]=Vt*Be+Mr*$e+sr*vt+F[15]),S}function Zt(S,F,he){var Be=he[0],$e=he[1],vt=he[2];return S[0]=F[0]*Be,S[1]=F[1]*Be,S[2]=F[2]*Be,S[3]=F[3]*Be,S[4]=F[4]*$e,S[5]=F[5]*$e,S[6]=F[6]*$e,S[7]=F[7]*$e,S[8]=F[8]*vt,S[9]=F[9]*vt,S[10]=F[10]*vt,S[11]=F[11]*vt,S[12]=F[12],S[13]=F[13],S[14]=F[14],S[15]=F[15],S}function Xt(S,F,he,Be){var $e=Be[0],vt=Be[1],wt=Be[2],H=Math.hypot($e,vt,wt),Wt,Vt,yr,Er,Ar,Mr,Ke,gt,ct,sr,Qr,st,Mt,Jt,mr,gn,Cn,yi,Ei,Ii,Ji,li,G,I;return H<J.Ib?null:(H=1/H,$e*=H,vt*=H,wt*=H,Wt=Math.sin(he),Vt=Math.cos(he),yr=1-Vt,Er=F[0],Ar=F[1],Mr=F[2],Ke=F[3],gt=F[4],ct=F[5],sr=F[6],Qr=F[7],st=F[8],Mt=F[9],Jt=F[10],mr=F[11],gn=$e*$e*yr+Vt,Cn=vt*$e*yr+wt*Wt,yi=wt*$e*yr-vt*Wt,Ei=$e*vt*yr-wt*Wt,Ii=vt*vt*yr+Vt,Ji=wt*vt*yr+$e*Wt,li=$e*wt*yr+vt*Wt,G=vt*wt*yr-$e*Wt,I=wt*wt*yr+Vt,S[0]=Er*gn+gt*Cn+st*yi,S[1]=Ar*gn+ct*Cn+Mt*yi,S[2]=Mr*gn+sr*Cn+Jt*yi,S[3]=Ke*gn+Qr*Cn+mr*yi,S[4]=Er*Ei+gt*Ii+st*Ji,S[5]=Ar*Ei+ct*Ii+Mt*Ji,S[6]=Mr*Ei+sr*Ii+Jt*Ji,S[7]=Ke*Ei+Qr*Ii+mr*Ji,S[8]=Er*li+gt*G+st*I,S[9]=Ar*li+ct*G+Mt*I,S[10]=Mr*li+sr*G+Jt*I,S[11]=Ke*li+Qr*G+mr*I,F!==S&&(S[12]=F[12],S[13]=F[13],S[14]=F[14],S[15]=F[15]),S)}function zt(S,F,he){var Be=Math.sin(he),$e=Math.cos(he),vt=F[4],wt=F[5],H=F[6],Wt=F[7],Vt=F[8],yr=F[9],Er=F[10],Ar=F[11];return F!==S&&(S[0]=F[0],S[1]=F[1],S[2]=F[2],S[3]=F[3],S[12]=F[12],S[13]=F[13],S[14]=F[14],S[15]=F[15]),S[4]=vt*$e+Vt*Be,S[5]=wt*$e+yr*Be,S[6]=H*$e+Er*Be,S[7]=Wt*$e+Ar*Be,S[8]=Vt*$e-vt*Be,S[9]=yr*$e-wt*Be,S[10]=Er*$e-H*Be,S[11]=Ar*$e-Wt*Be,S}function Lt(S,F,he){var Be=Math.sin(he),$e=Math.cos(he),vt=F[0],wt=F[1],H=F[2],Wt=F[3],Vt=F[8],yr=F[9],Er=F[10],Ar=F[11];return F!==S&&(S[4]=F[4],S[5]=F[5],S[6]=F[6],S[7]=F[7],S[12]=F[12],S[13]=F[13],S[14]=F[14],S[15]=F[15]),S[0]=vt*$e-Vt*Be,S[1]=wt*$e-yr*Be,S[2]=H*$e-Er*Be,S[3]=Wt*$e-Ar*Be,S[8]=vt*Be+Vt*$e,S[9]=wt*Be+yr*$e,S[10]=H*Be+Er*$e,S[11]=Wt*Be+Ar*$e,S}function yt(S,F,he){var Be=Math.sin(he),$e=Math.cos(he),vt=F[0],wt=F[1],H=F[2],Wt=F[3],Vt=F[4],yr=F[5],Er=F[6],Ar=F[7];return F!==S&&(S[8]=F[8],S[9]=F[9],S[10]=F[10],S[11]=F[11],S[12]=F[12],S[13]=F[13],S[14]=F[14],S[15]=F[15]),S[0]=vt*$e+Vt*Be,S[1]=wt*$e+yr*Be,S[2]=H*$e+Er*Be,S[3]=Wt*$e+Ar*Be,S[4]=Vt*$e-vt*Be,S[5]=yr*$e-wt*Be,S[6]=Er*$e-H*Be,S[7]=Ar*$e-Wt*Be,S}function pt(S,F){return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=F[0],S[13]=F[1],S[14]=F[2],S[15]=1,S}function Pr(S,F){return S[0]=F[0],S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=F[1],S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=F[2],S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function Ht(S,F,he){var Be=he[0],$e=he[1],vt=he[2],wt=Math.hypot(Be,$e,vt),H,Wt,Vt;return wt<J.Ib?null:(wt=1/wt,Be*=wt,$e*=wt,vt*=wt,H=Math.sin(F),Wt=Math.cos(F),Vt=1-Wt,S[0]=Be*Be*Vt+Wt,S[1]=$e*Be*Vt+vt*H,S[2]=vt*Be*Vt-$e*H,S[3]=0,S[4]=Be*$e*Vt-vt*H,S[5]=$e*$e*Vt+Wt,S[6]=vt*$e*Vt+Be*H,S[7]=0,S[8]=Be*vt*Vt+$e*H,S[9]=$e*vt*Vt-Be*H,S[10]=vt*vt*Vt+Wt,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S)}function ar(S,F){var he=Math.sin(F),Be=Math.cos(F);return S[0]=1,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=Be,S[6]=he,S[7]=0,S[8]=0,S[9]=-he,S[10]=Be,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function mt(S,F){var he=Math.sin(F),Be=Math.cos(F);return S[0]=Be,S[1]=0,S[2]=-he,S[3]=0,S[4]=0,S[5]=1,S[6]=0,S[7]=0,S[8]=he,S[9]=0,S[10]=Be,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function Ye(S,F){var he=Math.sin(F),Be=Math.cos(F);return S[0]=Be,S[1]=he,S[2]=0,S[3]=0,S[4]=-he,S[5]=Be,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=1,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function bt(S,F,he){var Be=F[0],$e=F[1],vt=F[2],wt=F[3],H=Be+Be,Wt=$e+$e,Vt=vt+vt,yr=Be*H,Er=Be*Wt,Ar=Be*Vt,Mr=$e*Wt,Ke=$e*Vt,gt=vt*Vt,ct=wt*H,sr=wt*Wt,Qr=wt*Vt;return S[0]=1-(Mr+gt),S[1]=Er+Qr,S[2]=Ar-sr,S[3]=0,S[4]=Er-Qr,S[5]=1-(yr+gt),S[6]=Ke+ct,S[7]=0,S[8]=Ar+sr,S[9]=Ke-ct,S[10]=1-(yr+Mr),S[11]=0,S[12]=he[0],S[13]=he[1],S[14]=he[2],S[15]=1,S}function Fe(S,F){var he=new J.WT(3),Be=-F[0],$e=-F[1],vt=-F[2],wt=F[3],H=F[4],Wt=F[5],Vt=F[6],yr=F[7],Er=Be*Be+$e*$e+vt*vt+wt*wt;return Er>0?(he[0]=(H*wt+yr*Be+Wt*vt-Vt*$e)*2/Er,he[1]=(Wt*wt+yr*$e+Vt*Be-H*vt)*2/Er,he[2]=(Vt*wt+yr*vt+H*$e-Wt*Be)*2/Er):(he[0]=(H*wt+yr*Be+Wt*vt-Vt*$e)*2,he[1]=(Wt*wt+yr*$e+Vt*Be-H*vt)*2,he[2]=(Vt*wt+yr*vt+H*$e-Wt*Be)*2),bt(S,F,he),S}function Ae(S,F){return S[0]=F[12],S[1]=F[13],S[2]=F[14],S}function Ne(S,F){var he=F[0],Be=F[1],$e=F[2],vt=F[4],wt=F[5],H=F[6],Wt=F[8],Vt=F[9],yr=F[10];return S[0]=Math.hypot(he,Be,$e),S[1]=Math.hypot(vt,wt,H),S[2]=Math.hypot(Wt,Vt,yr),S}function xt(S,F){var he=new J.WT(3);Ne(he,F);var Be=1/he[0],$e=1/he[1],vt=1/he[2],wt=F[0]*Be,H=F[1]*$e,Wt=F[2]*vt,Vt=F[4]*Be,yr=F[5]*$e,Er=F[6]*vt,Ar=F[8]*Be,Mr=F[9]*$e,Ke=F[10]*vt,gt=wt+yr+Ke,ct=0;return gt>0?(ct=Math.sqrt(gt+1)*2,S[3]=.25*ct,S[0]=(Er-Mr)/ct,S[1]=(Ar-Wt)/ct,S[2]=(H-Vt)/ct):wt>yr&&wt>Ke?(ct=Math.sqrt(1+wt-yr-Ke)*2,S[3]=(Er-Mr)/ct,S[0]=.25*ct,S[1]=(H+Vt)/ct,S[2]=(Ar+Wt)/ct):yr>Ke?(ct=Math.sqrt(1+yr-wt-Ke)*2,S[3]=(Ar-Wt)/ct,S[0]=(H+Vt)/ct,S[1]=.25*ct,S[2]=(Er+Mr)/ct):(ct=Math.sqrt(1+Ke-wt-yr)*2,S[3]=(H-Vt)/ct,S[0]=(Ar+Wt)/ct,S[1]=(Er+Mr)/ct,S[2]=.25*ct),S}function nr(S,F,he,Be){var $e=F[0],vt=F[1],wt=F[2],H=F[3],Wt=$e+$e,Vt=vt+vt,yr=wt+wt,Er=$e*Wt,Ar=$e*Vt,Mr=$e*yr,Ke=vt*Vt,gt=vt*yr,ct=wt*yr,sr=H*Wt,Qr=H*Vt,st=H*yr,Mt=Be[0],Jt=Be[1],mr=Be[2];return S[0]=(1-(Ke+ct))*Mt,S[1]=(Ar+st)*Mt,S[2]=(Mr-Qr)*Mt,S[3]=0,S[4]=(Ar-st)*Jt,S[5]=(1-(Er+ct))*Jt,S[6]=(gt+sr)*Jt,S[7]=0,S[8]=(Mr+Qr)*mr,S[9]=(gt-sr)*mr,S[10]=(1-(Er+Ke))*mr,S[11]=0,S[12]=he[0],S[13]=he[1],S[14]=he[2],S[15]=1,S}function re(S,F,he,Be,$e){var vt=F[0],wt=F[1],H=F[2],Wt=F[3],Vt=vt+vt,yr=wt+wt,Er=H+H,Ar=vt*Vt,Mr=vt*yr,Ke=vt*Er,gt=wt*yr,ct=wt*Er,sr=H*Er,Qr=Wt*Vt,st=Wt*yr,Mt=Wt*Er,Jt=Be[0],mr=Be[1],gn=Be[2],Cn=$e[0],yi=$e[1],Ei=$e[2],Ii=(1-(gt+sr))*Jt,Ji=(Mr+Mt)*Jt,li=(Ke-st)*Jt,G=(Mr-Mt)*mr,I=(1-(Ar+sr))*mr,j=(ct+Qr)*mr,K=(Ke+st)*gn,ie=(ct-Qr)*gn,Oe=(1-(Ar+gt))*gn;return S[0]=Ii,S[1]=Ji,S[2]=li,S[3]=0,S[4]=G,S[5]=I,S[6]=j,S[7]=0,S[8]=K,S[9]=ie,S[10]=Oe,S[11]=0,S[12]=he[0]+Cn-(Ii*Cn+G*yi+K*Ei),S[13]=he[1]+yi-(Ji*Cn+I*yi+ie*Ei),S[14]=he[2]+Ei-(li*Cn+j*yi+Oe*Ei),S[15]=1,S}function Ee(S,F){var he=F[0],Be=F[1],$e=F[2],vt=F[3],wt=he+he,H=Be+Be,Wt=$e+$e,Vt=he*wt,yr=Be*wt,Er=Be*H,Ar=$e*wt,Mr=$e*H,Ke=$e*Wt,gt=vt*wt,ct=vt*H,sr=vt*Wt;return S[0]=1-Er-Ke,S[1]=yr+sr,S[2]=Ar-ct,S[3]=0,S[4]=yr-sr,S[5]=1-Vt-Ke,S[6]=Mr+gt,S[7]=0,S[8]=Ar+ct,S[9]=Mr-gt,S[10]=1-Vt-Er,S[11]=0,S[12]=0,S[13]=0,S[14]=0,S[15]=1,S}function ae(S,F,he,Be,$e,vt,wt){var H=1/(he-F),Wt=1/($e-Be),Vt=1/(vt-wt);return S[0]=vt*2*H,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=vt*2*Wt,S[6]=0,S[7]=0,S[8]=(he+F)*H,S[9]=($e+Be)*Wt,S[10]=(wt+vt)*Vt,S[11]=-1,S[12]=0,S[13]=0,S[14]=wt*vt*2*Vt,S[15]=0,S}function me(S,F,he,Be,$e){var vt=1/Math.tan(F/2),wt;return S[0]=vt/he,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=vt,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[11]=-1,S[12]=0,S[13]=0,S[15]=0,$e!=null&&$e!==Infinity?(wt=1/(Be-$e),S[10]=($e+Be)*wt,S[14]=2*$e*Be*wt):(S[10]=-1,S[14]=-2*Be),S}function Te(S,F,he,Be){var $e=Math.tan(F.upDegrees*Math.PI/180),vt=Math.tan(F.downDegrees*Math.PI/180),wt=Math.tan(F.leftDegrees*Math.PI/180),H=Math.tan(F.rightDegrees*Math.PI/180),Wt=2/(wt+H),Vt=2/($e+vt);return S[0]=Wt,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=Vt,S[6]=0,S[7]=0,S[8]=-((wt-H)*Wt*.5),S[9]=($e-vt)*Vt*.5,S[10]=Be/(he-Be),S[11]=-1,S[12]=0,S[13]=0,S[14]=Be*he/(he-Be),S[15]=0,S}function Je(S,F,he,Be,$e,vt,wt){var H=1/(F-he),Wt=1/(Be-$e),Vt=1/(vt-wt);return S[0]=-2*H,S[1]=0,S[2]=0,S[3]=0,S[4]=0,S[5]=-2*Wt,S[6]=0,S[7]=0,S[8]=0,S[9]=0,S[10]=2*Vt,S[11]=0,S[12]=(F+he)*H,S[13]=($e+Be)*Wt,S[14]=(wt+vt)*Vt,S[15]=1,S}function dt(S,F,he,Be){var $e,vt,wt,H,Wt,Vt,yr,Er,Ar,Mr,Ke=F[0],gt=F[1],ct=F[2],sr=Be[0],Qr=Be[1],st=Be[2],Mt=he[0],Jt=he[1],mr=he[2];return Math.abs(Ke-Mt)<J.Ib&&Math.abs(gt-Jt)<J.Ib&&Math.abs(ct-mr)<J.Ib?Y(S):(yr=Ke-Mt,Er=gt-Jt,Ar=ct-mr,Mr=1/Math.hypot(yr,Er,Ar),yr*=Mr,Er*=Mr,Ar*=Mr,$e=Qr*Ar-st*Er,vt=st*yr-sr*Ar,wt=sr*Er-Qr*yr,Mr=Math.hypot($e,vt,wt),Mr?(Mr=1/Mr,$e*=Mr,vt*=Mr,wt*=Mr):($e=0,vt=0,wt=0),H=Er*wt-Ar*vt,Wt=Ar*$e-yr*wt,Vt=yr*vt-Er*$e,Mr=Math.hypot(H,Wt,Vt),Mr?(Mr=1/Mr,H*=Mr,Wt*=Mr,Vt*=Mr):(H=0,Wt=0,Vt=0),S[0]=$e,S[1]=H,S[2]=yr,S[3]=0,S[4]=vt,S[5]=Wt,S[6]=Er,S[7]=0,S[8]=wt,S[9]=Vt,S[10]=Ar,S[11]=0,S[12]=-($e*Ke+vt*gt+wt*ct),S[13]=-(H*Ke+Wt*gt+Vt*ct),S[14]=-(yr*Ke+Er*gt+Ar*ct),S[15]=1,S)}function $t(S,F,he,Be){var $e=F[0],vt=F[1],wt=F[2],H=Be[0],Wt=Be[1],Vt=Be[2],yr=$e-he[0],Er=vt-he[1],Ar=wt-he[2],Mr=yr*yr+Er*Er+Ar*Ar;Mr>0&&(Mr=1/Math.sqrt(Mr),yr*=Mr,Er*=Mr,Ar*=Mr);var Ke=Wt*Ar-Vt*Er,gt=Vt*yr-H*Ar,ct=H*Er-Wt*yr;return Mr=Ke*Ke+gt*gt+ct*ct,Mr>0&&(Mr=1/Math.sqrt(Mr),Ke*=Mr,gt*=Mr,ct*=Mr),S[0]=Ke,S[1]=gt,S[2]=ct,S[3]=0,S[4]=Er*ct-Ar*gt,S[5]=Ar*Ke-yr*ct,S[6]=yr*gt-Er*Ke,S[7]=0,S[8]=yr,S[9]=Er,S[10]=Ar,S[11]=0,S[12]=$e,S[13]=vt,S[14]=wt,S[15]=1,S}function Fr(S){return"mat4("+S[0]+", "+S[1]+", "+S[2]+", "+S[3]+", "+S[4]+", "+S[5]+", "+S[6]+", "+S[7]+", "+S[8]+", "+S[9]+", "+S[10]+", "+S[11]+", "+S[12]+", "+S[13]+", "+S[14]+", "+S[15]+")"}function zr(S){return Math.hypot(S[0],S[1],S[2],S[3],S[4],S[5],S[6],S[7],S[8],S[9],S[10],S[11],S[12],S[13],S[14],S[15])}function ln(S,F,he){return S[0]=F[0]+he[0],S[1]=F[1]+he[1],S[2]=F[2]+he[2],S[3]=F[3]+he[3],S[4]=F[4]+he[4],S[5]=F[5]+he[5],S[6]=F[6]+he[6],S[7]=F[7]+he[7],S[8]=F[8]+he[8],S[9]=F[9]+he[9],S[10]=F[10]+he[10],S[11]=F[11]+he[11],S[12]=F[12]+he[12],S[13]=F[13]+he[13],S[14]=F[14]+he[14],S[15]=F[15]+he[15],S}function tr(S,F,he){return S[0]=F[0]-he[0],S[1]=F[1]-he[1],S[2]=F[2]-he[2],S[3]=F[3]-he[3],S[4]=F[4]-he[4],S[5]=F[5]-he[5],S[6]=F[6]-he[6],S[7]=F[7]-he[7],S[8]=F[8]-he[8],S[9]=F[9]-he[9],S[10]=F[10]-he[10],S[11]=F[11]-he[11],S[12]=F[12]-he[12],S[13]=F[13]-he[13],S[14]=F[14]-he[14],S[15]=F[15]-he[15],S}function oe(S,F,he){return S[0]=F[0]*he,S[1]=F[1]*he,S[2]=F[2]*he,S[3]=F[3]*he,S[4]=F[4]*he,S[5]=F[5]*he,S[6]=F[6]*he,S[7]=F[7]*he,S[8]=F[8]*he,S[9]=F[9]*he,S[10]=F[10]*he,S[11]=F[11]*he,S[12]=F[12]*he,S[13]=F[13]*he,S[14]=F[14]*he,S[15]=F[15]*he,S}function ge(S,F,he,Be){return S[0]=F[0]+he[0]*Be,S[1]=F[1]+he[1]*Be,S[2]=F[2]+he[2]*Be,S[3]=F[3]+he[3]*Be,S[4]=F[4]+he[4]*Be,S[5]=F[5]+he[5]*Be,S[6]=F[6]+he[6]*Be,S[7]=F[7]+he[7]*Be,S[8]=F[8]+he[8]*Be,S[9]=F[9]+he[9]*Be,S[10]=F[10]+he[10]*Be,S[11]=F[11]+he[11]*Be,S[12]=F[12]+he[12]*Be,S[13]=F[13]+he[13]*Be,S[14]=F[14]+he[14]*Be,S[15]=F[15]+he[15]*Be,S}function Re(S,F){return S[0]===F[0]&&S[1]===F[1]&&S[2]===F[2]&&S[3]===F[3]&&S[4]===F[4]&&S[5]===F[5]&&S[6]===F[6]&&S[7]===F[7]&&S[8]===F[8]&&S[9]===F[9]&&S[10]===F[10]&&S[11]===F[11]&&S[12]===F[12]&&S[13]===F[13]&&S[14]===F[14]&&S[15]===F[15]}function qe(S,F){var he=S[0],Be=S[1],$e=S[2],vt=S[3],wt=S[4],H=S[5],Wt=S[6],Vt=S[7],yr=S[8],Er=S[9],Ar=S[10],Mr=S[11],Ke=S[12],gt=S[13],ct=S[14],sr=S[15],Qr=F[0],st=F[1],Mt=F[2],Jt=F[3],mr=F[4],gn=F[5],Cn=F[6],yi=F[7],Ei=F[8],Ii=F[9],Ji=F[10],li=F[11],G=F[12],I=F[13],j=F[14],K=F[15];return Math.abs(he-Qr)<=J.Ib*Math.max(1,Math.abs(he),Math.abs(Qr))&&Math.abs(Be-st)<=J.Ib*Math.max(1,Math.abs(Be),Math.abs(st))&&Math.abs($e-Mt)<=J.Ib*Math.max(1,Math.abs($e),Math.abs(Mt))&&Math.abs(vt-Jt)<=J.Ib*Math.max(1,Math.abs(vt),Math.abs(Jt))&&Math.abs(wt-mr)<=J.Ib*Math.max(1,Math.abs(wt),Math.abs(mr))&&Math.abs(H-gn)<=J.Ib*Math.max(1,Math.abs(H),Math.abs(gn))&&Math.abs(Wt-Cn)<=J.Ib*Math.max(1,Math.abs(Wt),Math.abs(Cn))&&Math.abs(Vt-yi)<=J.Ib*Math.max(1,Math.abs(Vt),Math.abs(yi))&&Math.abs(yr-Ei)<=J.Ib*Math.max(1,Math.abs(yr),Math.abs(Ei))&&Math.abs(Er-Ii)<=J.Ib*Math.max(1,Math.abs(Er),Math.abs(Ii))&&Math.abs(Ar-Ji)<=J.Ib*Math.max(1,Math.abs(Ar),Math.abs(Ji))&&Math.abs(Mr-li)<=J.Ib*Math.max(1,Math.abs(Mr),Math.abs(li))&&Math.abs(Ke-G)<=J.Ib*Math.max(1,Math.abs(Ke),Math.abs(G))&&Math.abs(gt-I)<=J.Ib*Math.max(1,Math.abs(gt),Math.abs(I))&&Math.abs(ct-j)<=J.Ib*Math.max(1,Math.abs(ct),Math.abs(j))&&Math.abs(sr-K)<=J.Ib*Math.max(1,Math.abs(sr),Math.abs(K))}var Ct=Me,kt=tr},98333:function(pr,O,x){"use strict";x.d(O,{Ue:function(){return E},al:function(){return w},bA:function(){return zt},fF:function(){return xt}});var J=x(49685);function E(){var oe=new J.WT(4);return J.WT!=Float32Array&&(oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=0),oe}function p(oe){var ge=new glMatrix.ARRAY_TYPE(4);return ge[0]=oe[0],ge[1]=oe[1],ge[2]=oe[2],ge[3]=oe[3],ge}function w(oe,ge,Re,qe){var Ct=new J.WT(4);return Ct[0]=oe,Ct[1]=ge,Ct[2]=Re,Ct[3]=qe,Ct}function z(oe,ge){return oe[0]=ge[0],oe[1]=ge[1],oe[2]=ge[2],oe[3]=ge[3],oe}function q(oe,ge,Re,qe,Ct){return oe[0]=ge,oe[1]=Re,oe[2]=qe,oe[3]=Ct,oe}function Y(oe,ge,Re){return oe[0]=ge[0]+Re[0],oe[1]=ge[1]+Re[1],oe[2]=ge[2]+Re[2],oe[3]=ge[3]+Re[3],oe}function ce(oe,ge,Re){return oe[0]=ge[0]-Re[0],oe[1]=ge[1]-Re[1],oe[2]=ge[2]-Re[2],oe[3]=ge[3]-Re[3],oe}function ne(oe,ge,Re){return oe[0]=ge[0]*Re[0],oe[1]=ge[1]*Re[1],oe[2]=ge[2]*Re[2],oe[3]=ge[3]*Re[3],oe}function be(oe,ge,Re){return oe[0]=ge[0]/Re[0],oe[1]=ge[1]/Re[1],oe[2]=ge[2]/Re[2],oe[3]=ge[3]/Re[3],oe}function we(oe,ge){return oe[0]=Math.ceil(ge[0]),oe[1]=Math.ceil(ge[1]),oe[2]=Math.ceil(ge[2]),oe[3]=Math.ceil(ge[3]),oe}function Me(oe,ge){return oe[0]=Math.floor(ge[0]),oe[1]=Math.floor(ge[1]),oe[2]=Math.floor(ge[2]),oe[3]=Math.floor(ge[3]),oe}function Kt(oe,ge,Re){return oe[0]=Math.min(ge[0],Re[0]),oe[1]=Math.min(ge[1],Re[1]),oe[2]=Math.min(ge[2],Re[2]),oe[3]=Math.min(ge[3],Re[3]),oe}function Zt(oe,ge,Re){return oe[0]=Math.max(ge[0],Re[0]),oe[1]=Math.max(ge[1],Re[1]),oe[2]=Math.max(ge[2],Re[2]),oe[3]=Math.max(ge[3],Re[3]),oe}function Xt(oe,ge){return oe[0]=Math.round(ge[0]),oe[1]=Math.round(ge[1]),oe[2]=Math.round(ge[2]),oe[3]=Math.round(ge[3]),oe}function zt(oe,ge,Re){return oe[0]=ge[0]*Re,oe[1]=ge[1]*Re,oe[2]=ge[2]*Re,oe[3]=ge[3]*Re,oe}function Lt(oe,ge,Re,qe){return oe[0]=ge[0]+Re[0]*qe,oe[1]=ge[1]+Re[1]*qe,oe[2]=ge[2]+Re[2]*qe,oe[3]=ge[3]+Re[3]*qe,oe}function yt(oe,ge){var Re=ge[0]-oe[0],qe=ge[1]-oe[1],Ct=ge[2]-oe[2],kt=ge[3]-oe[3];return Math.hypot(Re,qe,Ct,kt)}function pt(oe,ge){var Re=ge[0]-oe[0],qe=ge[1]-oe[1],Ct=ge[2]-oe[2],kt=ge[3]-oe[3];return Re*Re+qe*qe+Ct*Ct+kt*kt}function Pr(oe){var ge=oe[0],Re=oe[1],qe=oe[2],Ct=oe[3];return Math.hypot(ge,Re,qe,Ct)}function Ht(oe){var ge=oe[0],Re=oe[1],qe=oe[2],Ct=oe[3];return ge*ge+Re*Re+qe*qe+Ct*Ct}function ar(oe,ge){return oe[0]=-ge[0],oe[1]=-ge[1],oe[2]=-ge[2],oe[3]=-ge[3],oe}function mt(oe,ge){return oe[0]=1/ge[0],oe[1]=1/ge[1],oe[2]=1/ge[2],oe[3]=1/ge[3],oe}function Ye(oe,ge){var Re=ge[0],qe=ge[1],Ct=ge[2],kt=ge[3],S=Re*Re+qe*qe+Ct*Ct+kt*kt;return S>0&&(S=1/Math.sqrt(S)),oe[0]=Re*S,oe[1]=qe*S,oe[2]=Ct*S,oe[3]=kt*S,oe}function bt(oe,ge){return oe[0]*ge[0]+oe[1]*ge[1]+oe[2]*ge[2]+oe[3]*ge[3]}function Fe(oe,ge,Re,qe){var Ct=Re[0]*qe[1]-Re[1]*qe[0],kt=Re[0]*qe[2]-Re[2]*qe[0],S=Re[0]*qe[3]-Re[3]*qe[0],F=Re[1]*qe[2]-Re[2]*qe[1],he=Re[1]*qe[3]-Re[3]*qe[1],Be=Re[2]*qe[3]-Re[3]*qe[2],$e=ge[0],vt=ge[1],wt=ge[2],H=ge[3];return oe[0]=vt*Be-wt*he+H*F,oe[1]=-($e*Be)+wt*S-H*kt,oe[2]=$e*he-vt*S+H*Ct,oe[3]=-($e*F)+vt*kt-wt*Ct,oe}function Ae(oe,ge,Re,qe){var Ct=ge[0],kt=ge[1],S=ge[2],F=ge[3];return oe[0]=Ct+qe*(Re[0]-Ct),oe[1]=kt+qe*(Re[1]-kt),oe[2]=S+qe*(Re[2]-S),oe[3]=F+qe*(Re[3]-F),oe}function Ne(oe,ge){ge=ge||1;var Re,qe,Ct,kt,S,F;do Re=glMatrix.RANDOM()*2-1,qe=glMatrix.RANDOM()*2-1,S=Re*Re+qe*qe;while(S>=1);do Ct=glMatrix.RANDOM()*2-1,kt=glMatrix.RANDOM()*2-1,F=Ct*Ct+kt*kt;while(F>=1);var he=Math.sqrt((1-S)/F);return oe[0]=ge*Re,oe[1]=ge*qe,oe[2]=ge*Ct*he,oe[3]=ge*kt*he,oe}function xt(oe,ge,Re){var qe=ge[0],Ct=ge[1],kt=ge[2],S=ge[3];return oe[0]=Re[0]*qe+Re[4]*Ct+Re[8]*kt+Re[12]*S,oe[1]=Re[1]*qe+Re[5]*Ct+Re[9]*kt+Re[13]*S,oe[2]=Re[2]*qe+Re[6]*Ct+Re[10]*kt+Re[14]*S,oe[3]=Re[3]*qe+Re[7]*Ct+Re[11]*kt+Re[15]*S,oe}function nr(oe,ge,Re){var qe=ge[0],Ct=ge[1],kt=ge[2],S=Re[0],F=Re[1],he=Re[2],Be=Re[3],$e=Be*qe+F*kt-he*Ct,vt=Be*Ct+he*qe-S*kt,wt=Be*kt+S*Ct-F*qe,H=-S*qe-F*Ct-he*kt;return oe[0]=$e*Be+H*-S+vt*-he-wt*-F,oe[1]=vt*Be+H*-F+wt*-S-$e*-he,oe[2]=wt*Be+H*-he+$e*-F-vt*-S,oe[3]=ge[3],oe}function re(oe){return oe[0]=0,oe[1]=0,oe[2]=0,oe[3]=0,oe}function Ee(oe){return"vec4("+oe[0]+", "+oe[1]+", "+oe[2]+", "+oe[3]+")"}function ae(oe,ge){return oe[0]===ge[0]&&oe[1]===ge[1]&&oe[2]===ge[2]&&oe[3]===ge[3]}function me(oe,ge){var Re=oe[0],qe=oe[1],Ct=oe[2],kt=oe[3],S=ge[0],F=ge[1],he=ge[2],Be=ge[3];return Math.abs(Re-S)<=glMatrix.EPSILON*Math.max(1,Math.abs(Re),Math.abs(S))&&Math.abs(qe-F)<=glMatrix.EPSILON*Math.max(1,Math.abs(qe),Math.abs(F))&&Math.abs(Ct-he)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ct),Math.abs(he))&&Math.abs(kt-Be)<=glMatrix.EPSILON*Math.max(1,Math.abs(kt),Math.abs(Be))}var Te=null,Je=null,dt=null,$t=null,Fr=null,zr=null,ln=null,tr=function(){var oe=E();return function(ge,Re,qe,Ct,kt,S){var F,he;for(Re||(Re=4),qe||(qe=0),Ct?he=Math.min(Ct*Re+qe,ge.length):he=ge.length,F=qe;F<he;F+=Re)oe[0]=ge[F],oe[1]=ge[F+1],oe[2]=ge[F+2],oe[3]=ge[F+3],kt(oe,oe,S),ge[F]=oe[0],ge[F+1]=oe[1],ge[F+2]=oe[2],ge[F+3]=oe[3];return ge}}()},50840:function(pr,O,x){var J;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(E,p,w,z){"use strict";var q=["","webkit","Moz","MS","ms","o"],Y=p.createElement("div"),ce="function",ne=Math.round,be=Math.abs,we=Date.now;function Me(fe,Pe,ft){return setTimeout(Pr(fe,ft),Pe)}function Kt(fe,Pe,ft){return Array.isArray(fe)?(Zt(fe,ft[Pe],ft),!0):!1}function Zt(fe,Pe,ft){var ur;if(!!fe)if(fe.forEach)fe.forEach(Pe,ft);else if(fe.length!==z)for(ur=0;ur<fe.length;)Pe.call(ft,fe[ur],ur,fe),ur++;else for(ur in fe)fe.hasOwnProperty(ur)&&Pe.call(ft,fe[ur],ur,fe)}function Xt(fe,Pe,ft){var ur="DEPRECATED METHOD: "+Pe+`
`+ft+` AT 
`;return function(){var en=new Error("get-stack-trace"),kn=en&&en.stack?en.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Vi=E.console&&(E.console.warn||E.console.log);return Vi&&Vi.call(E.console,ur,kn),fe.apply(this,arguments)}}var zt;typeof Object.assign!="function"?zt=function(Pe){if(Pe===z||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var ft=Object(Pe),ur=1;ur<arguments.length;ur++){var en=arguments[ur];if(en!==z&&en!==null)for(var kn in en)en.hasOwnProperty(kn)&&(ft[kn]=en[kn])}return ft}:zt=Object.assign;var Lt=Xt(function(Pe,ft,ur){for(var en=Object.keys(ft),kn=0;kn<en.length;)(!ur||ur&&Pe[en[kn]]===z)&&(Pe[en[kn]]=ft[en[kn]]),kn++;return Pe},"extend","Use `assign`."),yt=Xt(function(Pe,ft){return Lt(Pe,ft,!0)},"merge","Use `assign`.");function pt(fe,Pe,ft){var ur=Pe.prototype,en;en=fe.prototype=Object.create(ur),en.constructor=fe,en._super=ur,ft&&zt(en,ft)}function Pr(fe,Pe){return function(){return fe.apply(Pe,arguments)}}function Ht(fe,Pe){return typeof fe==ce?fe.apply(Pe&&Pe[0]||z,Pe):fe}function ar(fe,Pe){return fe===z?Pe:fe}function mt(fe,Pe,ft){Zt(Ae(Pe),function(ur){fe.addEventListener(ur,ft,!1)})}function Ye(fe,Pe,ft){Zt(Ae(Pe),function(ur){fe.removeEventListener(ur,ft,!1)})}function bt(fe,Pe){for(;fe;){if(fe==Pe)return!0;fe=fe.parentNode}return!1}function Fe(fe,Pe){return fe.indexOf(Pe)>-1}function Ae(fe){return fe.trim().split(/\s+/g)}function Ne(fe,Pe,ft){if(fe.indexOf&&!ft)return fe.indexOf(Pe);for(var ur=0;ur<fe.length;){if(ft&&fe[ur][ft]==Pe||!ft&&fe[ur]===Pe)return ur;ur++}return-1}function xt(fe){return Array.prototype.slice.call(fe,0)}function nr(fe,Pe,ft){for(var ur=[],en=[],kn=0;kn<fe.length;){var Vi=Pe?fe[kn][Pe]:fe[kn];Ne(en,Vi)<0&&ur.push(fe[kn]),en[kn]=Vi,kn++}return ft&&(Pe?ur=ur.sort(function(Xa,Ya){return Xa[Pe]>Ya[Pe]}):ur=ur.sort()),ur}function re(fe,Pe){for(var ft,ur,en=Pe[0].toUpperCase()+Pe.slice(1),kn=0;kn<q.length;){if(ft=q[kn],ur=ft?ft+en:Pe,ur in fe)return ur;kn++}return z}var Ee=1;function ae(){return Ee++}function me(fe){var Pe=fe.ownerDocument||fe;return Pe.defaultView||Pe.parentWindow||E}var Te=/mobile|tablet|ip(ad|hone|od)|android/i,Je="ontouchstart"in E,dt=re(E,"PointerEvent")!==z,$t=Je&&Te.test(navigator.userAgent),Fr="touch",zr="pen",ln="mouse",tr="kinect",oe=25,ge=1,Re=2,qe=4,Ct=8,kt=1,S=2,F=4,he=8,Be=16,$e=S|F,vt=he|Be,wt=$e|vt,H=["x","y"],Wt=["clientX","clientY"];function Vt(fe,Pe){var ft=this;this.manager=fe,this.callback=Pe,this.element=fe.element,this.target=fe.options.inputTarget,this.domHandler=function(ur){Ht(fe.options.enable,[fe])&&ft.handler(ur)},this.init()}Vt.prototype={handler:function(){},init:function(){this.evEl&&mt(this.element,this.evEl,this.domHandler),this.evTarget&&mt(this.target,this.evTarget,this.domHandler),this.evWin&&mt(me(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ye(this.element,this.evEl,this.domHandler),this.evTarget&&Ye(this.target,this.evTarget,this.domHandler),this.evWin&&Ye(me(this.element),this.evWin,this.domHandler)}};function yr(fe){var Pe,ft=fe.options.inputClass;return ft?Pe=ft:dt?Pe=I:$t?Pe=St:Je?Pe=dr:Pe=Ei,new Pe(fe,Er)}function Er(fe,Pe,ft){var ur=ft.pointers.length,en=ft.changedPointers.length,kn=Pe&ge&&ur-en==0,Vi=Pe&(qe|Ct)&&ur-en==0;ft.isFirst=!!kn,ft.isFinal=!!Vi,kn&&(fe.session={}),ft.eventType=Pe,Ar(fe,ft),fe.emit("hammer.input",ft),fe.recognize(ft),fe.session.prevInput=ft}function Ar(fe,Pe){var ft=fe.session,ur=Pe.pointers,en=ur.length;ft.firstInput||(ft.firstInput=gt(Pe)),en>1&&!ft.firstMultiple?ft.firstMultiple=gt(Pe):en===1&&(ft.firstMultiple=!1);var kn=ft.firstInput,Vi=ft.firstMultiple,qi=Vi?Vi.center:kn.center,Xa=Pe.center=ct(ur);Pe.timeStamp=we(),Pe.deltaTime=Pe.timeStamp-kn.timeStamp,Pe.angle=Mt(qi,Xa),Pe.distance=st(qi,Xa),Mr(ft,Pe),Pe.offsetDirection=Qr(Pe.deltaX,Pe.deltaY);var Ya=sr(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=Ya.x,Pe.overallVelocityY=Ya.y,Pe.overallVelocity=be(Ya.x)>be(Ya.y)?Ya.x:Ya.y,Pe.scale=Vi?mr(Vi.pointers,ur):1,Pe.rotation=Vi?Jt(Vi.pointers,ur):0,Pe.maxPointers=ft.prevInput?Pe.pointers.length>ft.prevInput.maxPointers?Pe.pointers.length:ft.prevInput.maxPointers:Pe.pointers.length,Ke(ft,Pe);var Wo=fe.element;bt(Pe.srcEvent.target,Wo)&&(Wo=Pe.srcEvent.target),Pe.target=Wo}function Mr(fe,Pe){var ft=Pe.center,ur=fe.offsetDelta||{},en=fe.prevDelta||{},kn=fe.prevInput||{};(Pe.eventType===ge||kn.eventType===qe)&&(en=fe.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},ur=fe.offsetDelta={x:ft.x,y:ft.y}),Pe.deltaX=en.x+(ft.x-ur.x),Pe.deltaY=en.y+(ft.y-ur.y)}function Ke(fe,Pe){var ft=fe.lastInterval||Pe,ur=Pe.timeStamp-ft.timeStamp,en,kn,Vi,qi;if(Pe.eventType!=Ct&&(ur>oe||ft.velocity===z)){var Xa=Pe.deltaX-ft.deltaX,Ya=Pe.deltaY-ft.deltaY,Wo=sr(ur,Xa,Ya);kn=Wo.x,Vi=Wo.y,en=be(Wo.x)>be(Wo.y)?Wo.x:Wo.y,qi=Qr(Xa,Ya),fe.lastInterval=Pe}else en=ft.velocity,kn=ft.velocityX,Vi=ft.velocityY,qi=ft.direction;Pe.velocity=en,Pe.velocityX=kn,Pe.velocityY=Vi,Pe.direction=qi}function gt(fe){for(var Pe=[],ft=0;ft<fe.pointers.length;)Pe[ft]={clientX:ne(fe.pointers[ft].clientX),clientY:ne(fe.pointers[ft].clientY)},ft++;return{timeStamp:we(),pointers:Pe,center:ct(Pe),deltaX:fe.deltaX,deltaY:fe.deltaY}}function ct(fe){var Pe=fe.length;if(Pe===1)return{x:ne(fe[0].clientX),y:ne(fe[0].clientY)};for(var ft=0,ur=0,en=0;en<Pe;)ft+=fe[en].clientX,ur+=fe[en].clientY,en++;return{x:ne(ft/Pe),y:ne(ur/Pe)}}function sr(fe,Pe,ft){return{x:Pe/fe||0,y:ft/fe||0}}function Qr(fe,Pe){return fe===Pe?kt:be(fe)>=be(Pe)?fe<0?S:F:Pe<0?he:Be}function st(fe,Pe,ft){ft||(ft=H);var ur=Pe[ft[0]]-fe[ft[0]],en=Pe[ft[1]]-fe[ft[1]];return Math.sqrt(ur*ur+en*en)}function Mt(fe,Pe,ft){ft||(ft=H);var ur=Pe[ft[0]]-fe[ft[0]],en=Pe[ft[1]]-fe[ft[1]];return Math.atan2(en,ur)*180/Math.PI}function Jt(fe,Pe){return Mt(Pe[1],Pe[0],Wt)+Mt(fe[1],fe[0],Wt)}function mr(fe,Pe){return st(Pe[0],Pe[1],Wt)/st(fe[0],fe[1],Wt)}var gn={mousedown:ge,mousemove:Re,mouseup:qe},Cn="mousedown",yi="mousemove mouseup";function Ei(){this.evEl=Cn,this.evWin=yi,this.pressed=!1,Vt.apply(this,arguments)}pt(Ei,Vt,{handler:function(Pe){var ft=gn[Pe.type];ft&ge&&Pe.button===0&&(this.pressed=!0),ft&Re&&Pe.which!==1&&(ft=qe),!!this.pressed&&(ft&qe&&(this.pressed=!1),this.callback(this.manager,ft,{pointers:[Pe],changedPointers:[Pe],pointerType:ln,srcEvent:Pe}))}});var Ii={pointerdown:ge,pointermove:Re,pointerup:qe,pointercancel:Ct,pointerout:Ct},Ji={2:Fr,3:zr,4:ln,5:tr},li="pointerdown",G="pointermove pointerup pointercancel";E.MSPointerEvent&&!E.PointerEvent&&(li="MSPointerDown",G="MSPointerMove MSPointerUp MSPointerCancel");function I(){this.evEl=li,this.evWin=G,Vt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pt(I,Vt,{handler:function(Pe){var ft=this.store,ur=!1,en=Pe.type.toLowerCase().replace("ms",""),kn=Ii[en],Vi=Ji[Pe.pointerType]||Pe.pointerType,qi=Vi==Fr,Xa=Ne(ft,Pe.pointerId,"pointerId");kn&ge&&(Pe.button===0||qi)?Xa<0&&(ft.push(Pe),Xa=ft.length-1):kn&(qe|Ct)&&(ur=!0),!(Xa<0)&&(ft[Xa]=Pe,this.callback(this.manager,kn,{pointers:ft,changedPointers:[Pe],pointerType:Vi,srcEvent:Pe}),ur&&ft.splice(Xa,1))}});var j={touchstart:ge,touchmove:Re,touchend:qe,touchcancel:Ct},K="touchstart",ie="touchstart touchmove touchend touchcancel";function Oe(){this.evTarget=K,this.evWin=ie,this.started=!1,Vt.apply(this,arguments)}pt(Oe,Vt,{handler:function(Pe){var ft=j[Pe.type];if(ft===ge&&(this.started=!0),!!this.started){var ur=He.call(this,Pe,ft);ft&(qe|Ct)&&ur[0].length-ur[1].length==0&&(this.started=!1),this.callback(this.manager,ft,{pointers:ur[0],changedPointers:ur[1],pointerType:Fr,srcEvent:Pe})}}});function He(fe,Pe){var ft=xt(fe.touches),ur=xt(fe.changedTouches);return Pe&(qe|Ct)&&(ft=nr(ft.concat(ur),"identifier",!0)),[ft,ur]}var ue={touchstart:ge,touchmove:Re,touchend:qe,touchcancel:Ct},De="touchstart touchmove touchend touchcancel";function St(){this.evTarget=De,this.targetIds={},Vt.apply(this,arguments)}pt(St,Vt,{handler:function(Pe){var ft=ue[Pe.type],ur=Ir.call(this,Pe,ft);!ur||this.callback(this.manager,ft,{pointers:ur[0],changedPointers:ur[1],pointerType:Fr,srcEvent:Pe})}});function Ir(fe,Pe){var ft=xt(fe.touches),ur=this.targetIds;if(Pe&(ge|Re)&&ft.length===1)return ur[ft[0].identifier]=!0,[ft,ft];var en,kn,Vi=xt(fe.changedTouches),qi=[],Xa=this.target;if(kn=ft.filter(function(Ya){return bt(Ya.target,Xa)}),Pe===ge)for(en=0;en<kn.length;)ur[kn[en].identifier]=!0,en++;for(en=0;en<Vi.length;)ur[Vi[en].identifier]&&qi.push(Vi[en]),Pe&(qe|Ct)&&delete ur[Vi[en].identifier],en++;if(!!qi.length)return[nr(kn.concat(qi),"identifier",!0),qi]}var Br=2500,jt=25;function dr(){Vt.apply(this,arguments);var fe=Pr(this.handler,this);this.touch=new St(this.manager,fe),this.mouse=new Ei(this.manager,fe),this.primaryTouch=null,this.lastTouches=[]}pt(dr,Vt,{handler:function(Pe,ft,ur){var en=ur.pointerType==Fr,kn=ur.pointerType==ln;if(!(kn&&ur.sourceCapabilities&&ur.sourceCapabilities.firesTouchEvents)){if(en)Wr.call(this,ft,ur);else if(kn&&vr.call(this,ur))return;this.callback(Pe,ft,ur)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Wr(fe,Pe){fe&ge?(this.primaryTouch=Pe.changedPointers[0].identifier,yn.call(this,Pe)):fe&(qe|Ct)&&yn.call(this,Pe)}function yn(fe){var Pe=fe.changedPointers[0];if(Pe.identifier===this.primaryTouch){var ft={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(ft);var ur=this.lastTouches,en=function(){var kn=ur.indexOf(ft);kn>-1&&ur.splice(kn,1)};setTimeout(en,Br)}}function vr(fe){for(var Pe=fe.srcEvent.clientX,ft=fe.srcEvent.clientY,ur=0;ur<this.lastTouches.length;ur++){var en=this.lastTouches[ur],kn=Math.abs(Pe-en.x),Vi=Math.abs(ft-en.y);if(kn<=jt&&Vi<=jt)return!0}return!1}var vn=re(Y.style,"touchAction"),$r=vn!==z,cn="compute",di="auto",hn="manipulation",bi="none",Qi="pan-x",_i="pan-y",Oi=Zi();function Ci(fe,Pe){this.manager=fe,this.set(Pe)}Ci.prototype={set:function(fe){fe==cn&&(fe=this.compute()),$r&&this.manager.element.style&&Oi[fe]&&(this.manager.element.style[vn]=fe),this.actions=fe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var fe=[];return Zt(this.manager.recognizers,function(Pe){Ht(Pe.options.enable,[Pe])&&(fe=fe.concat(Pe.getTouchAction()))}),yo(fe.join(" "))},preventDefaults:function(fe){var Pe=fe.srcEvent,ft=fe.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var ur=this.actions,en=Fe(ur,bi)&&!Oi[bi],kn=Fe(ur,_i)&&!Oi[_i],Vi=Fe(ur,Qi)&&!Oi[Qi];if(en){var qi=fe.pointers.length===1,Xa=fe.distance<2,Ya=fe.deltaTime<250;if(qi&&Xa&&Ya)return}if(!(Vi&&kn)&&(en||kn&&ft&$e||Vi&&ft&vt))return this.preventSrc(Pe)},preventSrc:function(fe){this.manager.session.prevented=!0,fe.preventDefault()}};function yo(fe){if(Fe(fe,bi))return bi;var Pe=Fe(fe,Qi),ft=Fe(fe,_i);return Pe&&ft?bi:Pe||ft?Pe?Qi:_i:Fe(fe,hn)?hn:di}function Zi(){if(!$r)return!1;var fe={},Pe=E.CSS&&E.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ft){fe[ft]=Pe?E.CSS.supports("touch-action",ft):!0}),fe}var Rn=1,Dn=2,hi=4,jn=8,Oa=jn,hs=16,Li=32;function La(fe){this.options=zt({},this.defaults,fe||{}),this.id=ae(),this.manager=null,this.options.enable=ar(this.options.enable,!0),this.state=Rn,this.simultaneous={},this.requireFail=[]}La.prototype={defaults:{},set:function(fe){return zt(this.options,fe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(fe){if(Kt(fe,"recognizeWith",this))return this;var Pe=this.simultaneous;return fe=ga(fe,this),Pe[fe.id]||(Pe[fe.id]=fe,fe.recognizeWith(this)),this},dropRecognizeWith:function(fe){return Kt(fe,"dropRecognizeWith",this)?this:(fe=ga(fe,this),delete this.simultaneous[fe.id],this)},requireFailure:function(fe){if(Kt(fe,"requireFailure",this))return this;var Pe=this.requireFail;return fe=ga(fe,this),Ne(Pe,fe)===-1&&(Pe.push(fe),fe.requireFailure(this)),this},dropRequireFailure:function(fe){if(Kt(fe,"dropRequireFailure",this))return this;fe=ga(fe,this);var Pe=Ne(this.requireFail,fe);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(fe){return!!this.simultaneous[fe.id]},emit:function(fe){var Pe=this,ft=this.state;function ur(en){Pe.manager.emit(en,fe)}ft<jn&&ur(Pe.options.event+gu(ft)),ur(Pe.options.event),fe.additionalEvent&&ur(fe.additionalEvent),ft>=jn&&ur(Pe.options.event+gu(ft))},tryEmit:function(fe){if(this.canEmit())return this.emit(fe);this.state=Li},canEmit:function(){for(var fe=0;fe<this.requireFail.length;){if(!(this.requireFail[fe].state&(Li|Rn)))return!1;fe++}return!0},recognize:function(fe){var Pe=zt({},fe);if(!Ht(this.options.enable,[this,Pe])){this.reset(),this.state=Li;return}this.state&(Oa|hs|Li)&&(this.state=Rn),this.state=this.process(Pe),this.state&(Dn|hi|jn|hs)&&this.tryEmit(Pe)},process:function(fe){},getTouchAction:function(){},reset:function(){}};function gu(fe){return fe&hs?"cancel":fe&jn?"end":fe&hi?"move":fe&Dn?"start":""}function su(fe){return fe==Be?"down":fe==he?"up":fe==S?"left":fe==F?"right":""}function ga(fe,Pe){var ft=Pe.manager;return ft?ft.get(fe):fe}function so(){La.apply(this,arguments)}pt(so,La,{defaults:{pointers:1},attrTest:function(fe){var Pe=this.options.pointers;return Pe===0||fe.pointers.length===Pe},process:function(fe){var Pe=this.state,ft=fe.eventType,ur=Pe&(Dn|hi),en=this.attrTest(fe);return ur&&(ft&Ct||!en)?Pe|hs:ur||en?ft&qe?Pe|jn:Pe&Dn?Pe|hi:Dn:Li}});function Ga(){so.apply(this,arguments),this.pX=null,this.pY=null}pt(Ga,so,{defaults:{event:"pan",threshold:10,pointers:1,direction:wt},getTouchAction:function(){var fe=this.options.direction,Pe=[];return fe&$e&&Pe.push(_i),fe&vt&&Pe.push(Qi),Pe},directionTest:function(fe){var Pe=this.options,ft=!0,ur=fe.distance,en=fe.direction,kn=fe.deltaX,Vi=fe.deltaY;return en&Pe.direction||(Pe.direction&$e?(en=kn===0?kt:kn<0?S:F,ft=kn!=this.pX,ur=Math.abs(fe.deltaX)):(en=Vi===0?kt:Vi<0?he:Be,ft=Vi!=this.pY,ur=Math.abs(fe.deltaY))),fe.direction=en,ft&&ur>Pe.threshold&&en&Pe.direction},attrTest:function(fe){return so.prototype.attrTest.call(this,fe)&&(this.state&Dn||!(this.state&Dn)&&this.directionTest(fe))},emit:function(fe){this.pX=fe.deltaX,this.pY=fe.deltaY;var Pe=su(fe.direction);Pe&&(fe.additionalEvent=this.options.event+Pe),this._super.emit.call(this,fe)}});function Ha(){so.apply(this,arguments)}pt(Ha,so,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bi]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.scale-1)>this.options.threshold||this.state&Dn)},emit:function(fe){if(fe.scale!==1){var Pe=fe.scale<1?"in":"out";fe.additionalEvent=this.options.event+Pe}this._super.emit.call(this,fe)}});function Ho(){La.apply(this,arguments),this._timer=null,this._input=null}pt(Ho,La,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[di]},process:function(fe){var Pe=this.options,ft=fe.pointers.length===Pe.pointers,ur=fe.distance<Pe.threshold,en=fe.deltaTime>Pe.time;if(this._input=fe,!ur||!ft||fe.eventType&(qe|Ct)&&!en)this.reset();else if(fe.eventType&ge)this.reset(),this._timer=Me(function(){this.state=Oa,this.tryEmit()},Pe.time,this);else if(fe.eventType&qe)return Oa;return Li},reset:function(){clearTimeout(this._timer)},emit:function(fe){this.state===Oa&&(fe&&fe.eventType&qe?this.manager.emit(this.options.event+"up",fe):(this._input.timeStamp=we(),this.manager.emit(this.options.event,this._input)))}});function sa(){so.apply(this,arguments)}pt(sa,so,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bi]},attrTest:function(fe){return this._super.attrTest.call(this,fe)&&(Math.abs(fe.rotation)>this.options.threshold||this.state&Dn)}});function Wa(){so.apply(this,arguments)}pt(Wa,so,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:$e|vt,pointers:1},getTouchAction:function(){return Ga.prototype.getTouchAction.call(this)},attrTest:function(fe){var Pe=this.options.direction,ft;return Pe&($e|vt)?ft=fe.overallVelocity:Pe&$e?ft=fe.overallVelocityX:Pe&vt&&(ft=fe.overallVelocityY),this._super.attrTest.call(this,fe)&&Pe&fe.offsetDirection&&fe.distance>this.options.threshold&&fe.maxPointers==this.options.pointers&&be(ft)>this.options.velocity&&fe.eventType&qe},emit:function(fe){var Pe=su(fe.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,fe),this.manager.emit(this.options.event,fe)}});function Ea(){La.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pt(Ea,La,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hn]},process:function(fe){var Pe=this.options,ft=fe.pointers.length===Pe.pointers,ur=fe.distance<Pe.threshold,en=fe.deltaTime<Pe.time;if(this.reset(),fe.eventType&ge&&this.count===0)return this.failTimeout();if(ur&&en&&ft){if(fe.eventType!=qe)return this.failTimeout();var kn=this.pTime?fe.timeStamp-this.pTime<Pe.interval:!0,Vi=!this.pCenter||st(this.pCenter,fe.center)<Pe.posThreshold;this.pTime=fe.timeStamp,this.pCenter=fe.center,!Vi||!kn?this.count=1:this.count+=1,this._input=fe;var qi=this.count%Pe.taps;if(qi===0)return this.hasRequireFailures()?(this._timer=Me(function(){this.state=Oa,this.tryEmit()},Pe.interval,this),Dn):Oa}return Li},failTimeout:function(){return this._timer=Me(function(){this.state=Li},this.options.interval,this),Li},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Oa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ya(fe,Pe){return Pe=Pe||{},Pe.recognizers=ar(Pe.recognizers,ya.defaults.preset),new ns(fe,Pe)}ya.VERSION="2.0.7",ya.defaults={domEvents:!1,touchAction:cn,enable:!0,inputTarget:null,inputClass:null,preset:[[sa,{enable:!1}],[Ha,{enable:!1},["rotate"]],[Wa,{direction:$e}],[Ga,{direction:$e},["swipe"]],[Ea],[Ea,{event:"doubletap",taps:2},["tap"]],[Ho]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ia=1,ol=2;function ns(fe,Pe){this.options=zt({},ya.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||fe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=fe,this.input=yr(this),this.touchAction=new Ci(this,this.options.touchAction),to(this,!0),Zt(this.options.recognizers,function(ft){var ur=this.add(new ft[0](ft[1]));ft[2]&&ur.recognizeWith(ft[2]),ft[3]&&ur.requireFailure(ft[3])},this)}ns.prototype={set:function(fe){return zt(this.options,fe),fe.touchAction&&this.touchAction.update(),fe.inputTarget&&(this.input.destroy(),this.input.target=fe.inputTarget,this.input.init()),this},stop:function(fe){this.session.stopped=fe?ol:ia},recognize:function(fe){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(fe);var ft,ur=this.recognizers,en=Pe.curRecognizer;(!en||en&&en.state&Oa)&&(en=Pe.curRecognizer=null);for(var kn=0;kn<ur.length;)ft=ur[kn],Pe.stopped!==ol&&(!en||ft==en||ft.canRecognizeWith(en))?ft.recognize(fe):ft.reset(),!en&&ft.state&(Dn|hi|jn)&&(en=Pe.curRecognizer=ft),kn++}},get:function(fe){if(fe instanceof La)return fe;for(var Pe=this.recognizers,ft=0;ft<Pe.length;ft++)if(Pe[ft].options.event==fe)return Pe[ft];return null},add:function(fe){if(Kt(fe,"add",this))return this;var Pe=this.get(fe.options.event);return Pe&&this.remove(Pe),this.recognizers.push(fe),fe.manager=this,this.touchAction.update(),fe},remove:function(fe){if(Kt(fe,"remove",this))return this;if(fe=this.get(fe),fe){var Pe=this.recognizers,ft=Ne(Pe,fe);ft!==-1&&(Pe.splice(ft,1),this.touchAction.update())}return this},on:function(fe,Pe){if(fe!==z&&Pe!==z){var ft=this.handlers;return Zt(Ae(fe),function(ur){ft[ur]=ft[ur]||[],ft[ur].push(Pe)}),this}},off:function(fe,Pe){if(fe!==z){var ft=this.handlers;return Zt(Ae(fe),function(ur){Pe?ft[ur]&&ft[ur].splice(Ne(ft[ur],Pe),1):delete ft[ur]}),this}},emit:function(fe,Pe){this.options.domEvents&&Aa(fe,Pe);var ft=this.handlers[fe]&&this.handlers[fe].slice();if(!(!ft||!ft.length)){Pe.type=fe,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var ur=0;ur<ft.length;)ft[ur](Pe),ur++}},destroy:function(){this.element&&to(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function to(fe,Pe){var ft=fe.element;if(!!ft.style){var ur;Zt(fe.options.cssProps,function(en,kn){ur=re(ft.style,kn),Pe?(fe.oldCssProps[ur]=ft.style[ur],ft.style[ur]=en):ft.style[ur]=fe.oldCssProps[ur]||""}),Pe||(fe.oldCssProps={})}}function Aa(fe,Pe){var ft=p.createEvent("Event");ft.initEvent(fe,!0,!0),ft.gesture=Pe,Pe.target.dispatchEvent(ft)}zt(ya,{INPUT_START:ge,INPUT_MOVE:Re,INPUT_END:qe,INPUT_CANCEL:Ct,STATE_POSSIBLE:Rn,STATE_BEGAN:Dn,STATE_CHANGED:hi,STATE_ENDED:jn,STATE_RECOGNIZED:Oa,STATE_CANCELLED:hs,STATE_FAILED:Li,DIRECTION_NONE:kt,DIRECTION_LEFT:S,DIRECTION_RIGHT:F,DIRECTION_UP:he,DIRECTION_DOWN:Be,DIRECTION_HORIZONTAL:$e,DIRECTION_VERTICAL:vt,DIRECTION_ALL:wt,Manager:ns,Input:Vt,TouchAction:Ci,TouchInput:St,MouseInput:Ei,PointerEventInput:I,TouchMouseInput:dr,SingleTouchInput:Oe,Recognizer:La,AttrRecognizer:so,Tap:Ea,Pan:Ga,Swipe:Wa,Pinch:Ha,Rotate:sa,Press:Ho,on:mt,off:Ye,each:Zt,merge:yt,extend:Lt,assign:zt,inherit:pt,bindFn:Pr,prefixed:re});var fa=typeof E!="undefined"?E:typeof self!="undefined"?self:{};fa.Hammer=ya,J=function(){return ya}.call(O,x,O,pr),J!==z&&(pr.exports=J)})(window,document,"Hammer")},7375:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var x=Symbol.for("INJECTION");function J(q,Y,ce,ne){function be(){return ne&&!Reflect.hasMetadata(x,this,Y)&&Reflect.defineMetadata(x,ce(),this,Y),Reflect.hasMetadata(x,this,Y)?Reflect.getMetadata(x,this,Y):ce()}function we(Me){Reflect.defineMetadata(x,Me,this,Y)}Object.defineProperty(q,Y,{configurable:!0,enumerable:!0,get:be,set:we})}function E(q,Y){return function(ce){return function(ne,be){var we=function(){return q.get(ce)};J(ne,be,we,Y)}}}O.makePropertyInjectDecorator=E;function p(q,Y){return function(ce,ne){return function(be,we){var Me=function(){return q.getNamed(ce,ne)};J(be,we,Me,Y)}}}O.makePropertyInjectNamedDecorator=p;function w(q,Y){return function(ce,ne,be){return function(we,Me){var Kt=function(){return q.getTagged(ce,ne,be)};J(we,Me,Kt,Y)}}}O.makePropertyInjectTaggedDecorator=w;function z(q,Y){return function(ce){return function(ne,be){var we=function(){return q.getAll(ce)};J(ne,be,we,Y)}}}O.makePropertyMultiInjectDecorator=z},84879:function(pr,O,x){"use strict";var J;J={value:!0};var E=x(7375);function p(w,z){z===void 0&&(z=!0);var q=E.makePropertyInjectDecorator(w,z),Y=E.makePropertyInjectNamedDecorator(w,z),ce=E.makePropertyInjectTaggedDecorator(w,z),ne=E.makePropertyMultiInjectDecorator(w,z);return{lazyInject:q,lazyInjectNamed:Y,lazyInjectTagged:ce,lazyMultiInject:ne}}O.Z=p},99934:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagProperty=O.tagParameter=O.decorate=void 0;var J=x(16674),E=x(6867);function p(ne,be,we,Me){var Kt=E.TAGGED;z(Kt,ne,be,Me,we)}O.tagParameter=p;function w(ne,be,we){var Me=E.TAGGED_PROP;z(Me,ne.constructor,be,we)}O.tagProperty=w;function z(ne,be,we,Me,Kt){var Zt={},Xt=typeof Kt=="number",zt=Kt!==void 0&&Xt?Kt.toString():we;if(Xt&&we!==void 0)throw new Error(J.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,be)&&(Zt=Reflect.getMetadata(ne,be));var Lt=Zt[zt];if(!Array.isArray(Lt))Lt=[];else for(var yt=0,pt=Lt;yt<pt.length;yt++){var Pr=pt[yt];if(Pr.key===Me.key)throw new Error(J.DUPLICATED_METADATA+" "+Pr.key.toString())}Lt.push(Me),Zt[zt]=Lt,Reflect.defineMetadata(ne,Zt,be)}function q(ne,be){Reflect.decorate(ne,be)}function Y(ne,be){return function(we,Me){be(we,Me,ne)}}function ce(ne,be,we){typeof we=="number"?q([Y(we,ne)],be):typeof we=="string"?Reflect.decorate([ne],be,we):q([ne],be)}O.decorate=ce},5744:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.inject=O.LazyServiceIdentifer=void 0;var J=x(16674),E=x(6867),p=x(47738),w=x(99934),z=function(){function Y(ce){this._cb=ce}return Y.prototype.unwrap=function(){return this._cb()},Y}();O.LazyServiceIdentifer=z;function q(Y){return function(ce,ne,be){if(Y===void 0)throw new Error(J.UNDEFINED_INJECT_ANNOTATION(ce.name));var we=new p.Metadata(E.INJECT_TAG,Y);typeof be=="number"?w.tagParameter(ce,ne,be,we):w.tagProperty(ce,ne,we)}}O.inject=q},64315:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.injectable=void 0;var J=x(16674),E=x(6867);function p(){return function(w){if(Reflect.hasOwnMetadata(E.PARAM_TYPES,w))throw new Error(J.DUPLICATED_INJECTABLE_DECORATOR);var z=Reflect.getMetadata(E.DESIGN_PARAM_TYPES,w)||[];return Reflect.defineMetadata(E.PARAM_TYPES,z,w),w}}O.injectable=p},71693:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiInject=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(z){return function(q,Y,ce){var ne=new E.Metadata(J.MULTI_INJECT_TAG,z);typeof ce=="number"?p.tagParameter(q,Y,ce,ne):p.tagProperty(q,Y,ne)}}O.multiInject=w},38085:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.named=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(z){return function(q,Y,ce){var ne=new E.Metadata(J.NAMED_TAG,z);typeof ce=="number"?p.tagParameter(q,Y,ce,ne):p.tagProperty(q,Y,ne)}}O.named=w},6515:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.optional=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(){return function(z,q,Y){var ce=new E.Metadata(J.OPTIONAL_TAG,!0);typeof Y=="number"?p.tagParameter(z,q,Y,ce):p.tagProperty(z,q,ce)}}O.optional=w},7014:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.postConstruct=void 0;var J=x(16674),E=x(6867),p=x(47738);function w(){return function(z,q,Y){var ce=new p.Metadata(E.POST_CONSTRUCT,q);if(Reflect.hasOwnMetadata(E.POST_CONSTRUCT,z.constructor))throw new Error(J.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(E.POST_CONSTRUCT,ce,z.constructor)}}O.postConstruct=w},32052:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagged=void 0;var J=x(47738),E=x(99934);function p(w,z){return function(q,Y,ce){var ne=new J.Metadata(w,z);typeof ce=="number"?E.tagParameter(q,Y,ce,ne):E.tagProperty(q,Y,ne)}}O.tagged=p},55638:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.targetName=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(z){return function(q,Y,ce){var ne=new E.Metadata(J.NAME_TAG,z);p.tagParameter(q,Y,ce,ne)}}O.targetName=w},86757:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.unmanaged=void 0;var J=x(6867),E=x(47738),p=x(99934);function w(){return function(z,q,Y){var ce=new E.Metadata(J.UNMANAGED_TAG,!0);p.tagParameter(z,q,Y,ce)}}O.unmanaged=w},44290:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Binding=void 0;var J=x(28421),E=x(37791),p=function(){function w(z,q){this.id=E.id(),this.activated=!1,this.serviceIdentifier=z,this.scope=q,this.type=J.BindingTypeEnum.Invalid,this.constraint=function(Y){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return w.prototype.clone=function(){var z=new w(this.serviceIdentifier,this.scope);return z.activated=z.scope===J.BindingScopeEnum.Singleton?this.activated:!1,z.implementationType=this.implementationType,z.dynamicValue=this.dynamicValue,z.scope=this.scope,z.type=this.type,z.factory=this.factory,z.provider=this.provider,z.constraint=this.constraint,z.onActivation=this.onActivation,z.cache=this.cache,z},w}();O.Binding=p},23184:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingCount=void 0;var x={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};O.BindingCount=x},16674:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.STACK_OVERFLOW=O.CIRCULAR_DEPENDENCY_IN_FACTORY=O.POST_CONSTRUCT_ERROR=O.MULTIPLE_POST_CONSTRUCT_METHODS=O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=O.ARGUMENTS_LENGTH_MISMATCH=O.INVALID_DECORATOR_OPERATION=O.INVALID_TO_SELF_VALUE=O.INVALID_FUNCTION_BINDING=O.INVALID_MIDDLEWARE_RETURN=O.NO_MORE_SNAPSHOTS_AVAILABLE=O.INVALID_BINDING_TYPE=O.NOT_IMPLEMENTED=O.CIRCULAR_DEPENDENCY=O.UNDEFINED_INJECT_ANNOTATION=O.MISSING_INJECT_ANNOTATION=O.MISSING_INJECTABLE_ANNOTATION=O.NOT_REGISTERED=O.CANNOT_UNBIND=O.AMBIGUOUS_MATCH=O.KEY_NOT_FOUND=O.NULL_ARGUMENT=O.DUPLICATED_METADATA=O.DUPLICATED_INJECTABLE_DECORATOR=void 0,O.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",O.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",O.NULL_ARGUMENT="NULL argument",O.KEY_NOT_FOUND="Key Not Found",O.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",O.CANNOT_UNBIND="Could not unbind serviceIdentifier:",O.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",O.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",O.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var x=function(w){return"@inject called with undefined this could mean that the class "+w+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};O.UNDEFINED_INJECT_ANNOTATION=x,O.CIRCULAR_DEPENDENCY="Circular dependency found:",O.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",O.INVALID_BINDING_TYPE="Invalid binding type:",O.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",O.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",O.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",O.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",O.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var J=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];return"The number of constructor arguments in the derived class "+(w[0]+" must be >= than the number of constructor arguments of its base class.")};O.ARGUMENTS_LENGTH_MISMATCH=J,O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",O.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var E=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];return"@postConstruct error in class "+w[0]+": "+w[1]};O.POST_CONSTRUCT_ERROR=E;var p=function(){for(var w=[],z=0;z<arguments.length;z++)w[z]=arguments[z];return"It looks like there is a circular dependency "+("in one of the '"+w[0]+"' bindings. Please investigate bindings with")+("service identifier '"+w[1]+"'.")};O.CIRCULAR_DEPENDENCY_IN_FACTORY=p,O.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.TargetTypeEnum=O.BindingTypeEnum=O.BindingScopeEnum=void 0;var x={Request:"Request",Singleton:"Singleton",Transient:"Transient"};O.BindingScopeEnum=x;var J={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};O.BindingTypeEnum=J;var E={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};O.TargetTypeEnum=E},6867:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NON_CUSTOM_TAG_KEYS=O.POST_CONSTRUCT=O.DESIGN_PARAM_TYPES=O.PARAM_TYPES=O.TAGGED_PROP=O.TAGGED=O.MULTI_INJECT_TAG=O.INJECT_TAG=O.OPTIONAL_TAG=O.UNMANAGED_TAG=O.NAME_TAG=O.NAMED_TAG=void 0,O.NAMED_TAG="named",O.NAME_TAG="name",O.UNMANAGED_TAG="unmanaged",O.OPTIONAL_TAG="optional",O.INJECT_TAG="inject",O.MULTI_INJECT_TAG="multi_inject",O.TAGGED="inversify:tagged",O.TAGGED_PROP="inversify:tagged_props",O.PARAM_TYPES="inversify:paramtypes",O.DESIGN_PARAM_TYPES="design:paramtypes",O.POST_CONSTRUCT="post_construct";function x(){return[O.INJECT_TAG,O.MULTI_INJECT_TAG,O.NAME_TAG,O.UNMANAGED_TAG,O.NAMED_TAG,O.OPTIONAL_TAG]}O.NON_CUSTOM_TAG_KEYS=x()},51389:function(pr,O,x){"use strict";var J=this&&this.__awaiter||function(Lt,yt,pt,Pr){function Ht(ar){return ar instanceof pt?ar:new pt(function(mt){mt(ar)})}return new(pt||(pt=Promise))(function(ar,mt){function Ye(Ae){try{Fe(Pr.next(Ae))}catch(Ne){mt(Ne)}}function bt(Ae){try{Fe(Pr.throw(Ae))}catch(Ne){mt(Ne)}}function Fe(Ae){Ae.done?ar(Ae.value):Ht(Ae.value).then(Ye,bt)}Fe((Pr=Pr.apply(Lt,yt||[])).next())})},E=this&&this.__generator||function(Lt,yt){var pt={label:0,sent:function(){if(ar[0]&1)throw ar[1];return ar[1]},trys:[],ops:[]},Pr,Ht,ar,mt;return mt={next:Ye(0),throw:Ye(1),return:Ye(2)},typeof Symbol=="function"&&(mt[Symbol.iterator]=function(){return this}),mt;function Ye(Fe){return function(Ae){return bt([Fe,Ae])}}function bt(Fe){if(Pr)throw new TypeError("Generator is already executing.");for(;pt;)try{if(Pr=1,Ht&&(ar=Fe[0]&2?Ht.return:Fe[0]?Ht.throw||((ar=Ht.return)&&ar.call(Ht),0):Ht.next)&&!(ar=ar.call(Ht,Fe[1])).done)return ar;switch(Ht=0,ar&&(Fe=[Fe[0]&2,ar.value]),Fe[0]){case 0:case 1:ar=Fe;break;case 4:return pt.label++,{value:Fe[1],done:!1};case 5:pt.label++,Ht=Fe[1],Fe=[0];continue;case 7:Fe=pt.ops.pop(),pt.trys.pop();continue;default:if(ar=pt.trys,!(ar=ar.length>0&&ar[ar.length-1])&&(Fe[0]===6||Fe[0]===2)){pt=0;continue}if(Fe[0]===3&&(!ar||Fe[1]>ar[0]&&Fe[1]<ar[3])){pt.label=Fe[1];break}if(Fe[0]===6&&pt.label<ar[1]){pt.label=ar[1],ar=Fe;break}if(ar&&pt.label<ar[2]){pt.label=ar[2],pt.ops.push(Fe);break}ar[2]&&pt.ops.pop(),pt.trys.pop();continue}Fe=yt.call(Lt,pt)}catch(Ae){Fe=[6,Ae],Ht=0}finally{Pr=ar=0}if(Fe[0]&5)throw Fe[1];return{value:Fe[0]?Fe[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Lt,yt){for(var pt=0,Pr=yt.length,Ht=Lt.length;pt<Pr;pt++,Ht++)Lt[Ht]=yt[pt];return Lt};Object.defineProperty(O,"__esModule",{value:!0}),O.Container=void 0;var w=x(44290),z=x(16674),q=x(28421),Y=x(6867),ce=x(51377),ne=x(86311),be=x(31927),we=x(15451),Me=x(37791),Kt=x(55800),Zt=x(85700),Xt=x(80175),zt=function(){function Lt(yt){this._appliedMiddleware=[];var pt=yt||{};if(typeof pt!="object")throw new Error(""+z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=q.BindingScopeEnum.Transient;else if(pt.defaultScope!==q.BindingScopeEnum.Singleton&&pt.defaultScope!==q.BindingScopeEnum.Transient&&pt.defaultScope!==q.BindingScopeEnum.Request)throw new Error(""+z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=Me.id(),this._bindingDictionary=new Xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ce.MetadataReader}return Lt.merge=function(yt,pt){for(var Pr=[],Ht=2;Ht<arguments.length;Ht++)Pr[Ht-2]=arguments[Ht];var ar=new Lt,mt=p([yt,pt],Pr).map(function(Fe){return ne.getBindingDictionary(Fe)}),Ye=ne.getBindingDictionary(ar);function bt(Fe,Ae){Fe.traverse(function(Ne,xt){xt.forEach(function(nr){Ae.add(nr.serviceIdentifier,nr.clone())})})}return mt.forEach(function(Fe){bt(Fe,Ye)}),ar},Lt.prototype.load=function(){for(var yt=[],pt=0;pt<arguments.length;pt++)yt[pt]=arguments[pt];for(var Pr=this._getContainerModuleHelpersFactory(),Ht=0,ar=yt;Ht<ar.length;Ht++){var mt=ar[Ht],Ye=Pr(mt.id);mt.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)}},Lt.prototype.loadAsync=function(){for(var yt=[],pt=0;pt<arguments.length;pt++)yt[pt]=arguments[pt];return J(this,void 0,void 0,function(){var Pr,Ht,ar,mt,Ye;return E(this,function(bt){switch(bt.label){case 0:Pr=this._getContainerModuleHelpersFactory(),Ht=0,ar=yt,bt.label=1;case 1:return Ht<ar.length?(mt=ar[Ht],Ye=Pr(mt.id),[4,mt.registry(Ye.bindFunction,Ye.unbindFunction,Ye.isboundFunction,Ye.rebindFunction)]):[3,4];case 2:bt.sent(),bt.label=3;case 3:return Ht++,[3,1];case 4:return[2]}})})},Lt.prototype.unload=function(){for(var yt=this,pt=[],Pr=0;Pr<arguments.length;Pr++)pt[Pr]=arguments[Pr];var Ht=function(ar){return function(mt){return mt.moduleId===ar}};pt.forEach(function(ar){var mt=Ht(ar.id);yt._bindingDictionary.removeByCondition(mt)})},Lt.prototype.bind=function(yt){var pt=this.options.defaultScope||q.BindingScopeEnum.Transient,Pr=new w.Binding(yt,pt);return this._bindingDictionary.add(yt,Pr),new we.BindingToSyntax(Pr)},Lt.prototype.rebind=function(yt){return this.unbind(yt),this.bind(yt)},Lt.prototype.unbind=function(yt){try{this._bindingDictionary.remove(yt)}catch(pt){throw new Error(z.CANNOT_UNBIND+" "+Kt.getServiceIdentifierAsString(yt))}},Lt.prototype.unbindAll=function(){this._bindingDictionary=new Xt.Lookup},Lt.prototype.isBound=function(yt){var pt=this._bindingDictionary.hasKey(yt);return!pt&&this.parent&&(pt=this.parent.isBound(yt)),pt},Lt.prototype.isBoundNamed=function(yt,pt){return this.isBoundTagged(yt,Y.NAMED_TAG,pt)},Lt.prototype.isBoundTagged=function(yt,pt,Pr){var Ht=!1;if(this._bindingDictionary.hasKey(yt)){var ar=this._bindingDictionary.get(yt),mt=ne.createMockRequest(this,yt,pt,Pr);Ht=ar.some(function(Ye){return Ye.constraint(mt)})}return!Ht&&this.parent&&(Ht=this.parent.isBoundTagged(yt,pt,Pr)),Ht},Lt.prototype.snapshot=function(){this._snapshots.push(Zt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Lt.prototype.restore=function(){var yt=this._snapshots.pop();if(yt===void 0)throw new Error(z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=yt.bindings,this._middleware=yt.middleware},Lt.prototype.createChild=function(yt){var pt=new Lt(yt||this.options);return pt.parent=this,pt},Lt.prototype.applyMiddleware=function(){for(var yt=[],pt=0;pt<arguments.length;pt++)yt[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(yt);var Pr=this._middleware?this._middleware:this._planAndResolve();this._middleware=yt.reduce(function(Ht,ar){return ar(Ht)},Pr)},Lt.prototype.applyCustomMetadataReader=function(yt){this._metadataReader=yt},Lt.prototype.get=function(yt){return this._get(!1,!1,q.TargetTypeEnum.Variable,yt)},Lt.prototype.getTagged=function(yt,pt,Pr){return this._get(!1,!1,q.TargetTypeEnum.Variable,yt,pt,Pr)},Lt.prototype.getNamed=function(yt,pt){return this.getTagged(yt,Y.NAMED_TAG,pt)},Lt.prototype.getAll=function(yt){return this._get(!0,!0,q.TargetTypeEnum.Variable,yt)},Lt.prototype.getAllTagged=function(yt,pt,Pr){return this._get(!1,!0,q.TargetTypeEnum.Variable,yt,pt,Pr)},Lt.prototype.getAllNamed=function(yt,pt){return this.getAllTagged(yt,Y.NAMED_TAG,pt)},Lt.prototype.resolve=function(yt){var pt=this.createChild();return pt.bind(yt).toSelf(),this._appliedMiddleware.forEach(function(Pr){pt.applyMiddleware(Pr)}),pt.get(yt)},Lt.prototype._getContainerModuleHelpersFactory=function(){var yt=this,pt=function(Ye,bt){Ye._binding.moduleId=bt},Pr=function(Ye){return function(bt){var Fe=yt.bind.bind(yt),Ae=Fe(bt);return pt(Ae,Ye),Ae}},Ht=function(Ye){return function(bt){var Fe=yt.unbind.bind(yt);Fe(bt)}},ar=function(Ye){return function(bt){var Fe=yt.isBound.bind(yt);return Fe(bt)}},mt=function(Ye){return function(bt){var Fe=yt.rebind.bind(yt),Ae=Fe(bt);return pt(Ae,Ye),Ae}};return function(Ye){return{bindFunction:Pr(Ye),isboundFunction:ar(Ye),rebindFunction:mt(Ye),unbindFunction:Ht(Ye)}}},Lt.prototype._get=function(yt,pt,Pr,Ht,ar,mt){var Ye=null,bt={avoidConstraints:yt,contextInterceptor:function(Fe){return Fe},isMultiInject:pt,key:ar,serviceIdentifier:Ht,targetType:Pr,value:mt};if(this._middleware){if(Ye=this._middleware(bt),Ye==null)throw new Error(z.INVALID_MIDDLEWARE_RETURN)}else Ye=this._planAndResolve()(bt);return Ye},Lt.prototype._planAndResolve=function(){var yt=this;return function(pt){var Pr=ne.plan(yt._metadataReader,yt,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);Pr=pt.contextInterceptor(Pr);var Ht=be.resolve(Pr);return Ht}},Lt}();O.Container=zt},33244:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.AsyncContainerModule=O.ContainerModule=void 0;var J=x(37791),E=function(){function w(z){this.id=J.id(),this.registry=z}return w}();O.ContainerModule=E;var p=function(){function w(z){this.id=J.id(),this.registry=z}return w}();O.AsyncContainerModule=p},85700:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ContainerSnapshot=void 0;var x=function(){function J(){}return J.of=function(E,p){var w=new J;return w.bindings=E,w.middleware=p,w},J}();O.ContainerSnapshot=x},80175:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Lookup=void 0;var J=x(16674),E=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(w,z){if(w==null)throw new Error(J.NULL_ARGUMENT);if(z==null)throw new Error(J.NULL_ARGUMENT);var q=this._map.get(w);q!==void 0?(q.push(z),this._map.set(w,q)):this._map.set(w,[z])},p.prototype.get=function(w){if(w==null)throw new Error(J.NULL_ARGUMENT);var z=this._map.get(w);if(z!==void 0)return z;throw new Error(J.KEY_NOT_FOUND)},p.prototype.remove=function(w){if(w==null)throw new Error(J.NULL_ARGUMENT);if(!this._map.delete(w))throw new Error(J.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(w){var z=this;this._map.forEach(function(q,Y){var ce=q.filter(function(ne){return!w(ne)});ce.length>0?z._map.set(Y,ce):z._map.delete(Y)})},p.prototype.hasKey=function(w){if(w==null)throw new Error(J.NULL_ARGUMENT);return this._map.has(w)},p.prototype.clone=function(){var w=new p;return this._map.forEach(function(z,q){z.forEach(function(Y){return w.add(q,Y.clone())})}),w},p.prototype.traverse=function(w){this._map.forEach(function(z,q){w(q,z)})},p}();O.Lookup=E},86700:function(pr,O,x){"use strict";var J;J={value:!0},J=J=J=J=J=J=O.GW=J=J=O.zY=J=J=J=J=J=O.f3=J=J=O.b2=J=J=J=J=J=O.W2=J=void 0;var E=x(6867);J=E;var p=x(51389);Object.defineProperty(O,"W2",{enumerable:!0,get:function(){return p.Container}});var w=x(28421);J={enumerable:!0,get:function(){return w.BindingScopeEnum}},J={enumerable:!0,get:function(){return w.BindingTypeEnum}},J={enumerable:!0,get:function(){return w.TargetTypeEnum}};var z=x(33244);J={enumerable:!0,get:function(){return z.AsyncContainerModule}},J={enumerable:!0,get:function(){return z.ContainerModule}};var q=x(64315);Object.defineProperty(O,"b2",{enumerable:!0,get:function(){return q.injectable}});var Y=x(32052);J={enumerable:!0,get:function(){return Y.tagged}};var ce=x(38085);J={enumerable:!0,get:function(){return ce.named}};var ne=x(5744);Object.defineProperty(O,"f3",{enumerable:!0,get:function(){return ne.inject}}),J={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var be=x(6515);J={enumerable:!0,get:function(){return be.optional}};var we=x(86757);J={enumerable:!0,get:function(){return we.unmanaged}};var Me=x(71693);J={enumerable:!0,get:function(){return Me.multiInject}};var Kt=x(55638);J={enumerable:!0,get:function(){return Kt.targetName}};var Zt=x(7014);Object.defineProperty(O,"zY",{enumerable:!0,get:function(){return Zt.postConstruct}});var Xt=x(51377);J={enumerable:!0,get:function(){return Xt.MetadataReader}};var zt=x(37791);J={enumerable:!0,get:function(){return zt.id}};var Lt=x(99934);Object.defineProperty(O,"GW",{enumerable:!0,get:function(){return Lt.decorate}});var yt=x(80758);J={enumerable:!0,get:function(){return yt.traverseAncerstors}},J={enumerable:!0,get:function(){return yt.taggedConstraint}},J={enumerable:!0,get:function(){return yt.namedConstraint}},J={enumerable:!0,get:function(){return yt.typeConstraint}};var pt=x(55800);J={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var Pr=x(70600);J={enumerable:!0,get:function(){return Pr.multiBindToService}}},95228:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Context=void 0;var J=x(37791),E=function(){function p(w){this.id=J.id(),this.container=w}return p.prototype.addPlan=function(w){this.plan=w},p.prototype.setCurrentRequest=function(w){this.currentRequest=w},p}();O.Context=E},47738:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Metadata=void 0;var J=x(6867),E=function(){function p(w,z){this.key=w,this.value=z}return p.prototype.toString=function(){return this.key===J.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();O.Metadata=E},51377:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.MetadataReader=void 0;var J=x(6867),E=function(){function p(){}return p.prototype.getConstructorMetadata=function(w){var z=Reflect.getMetadata(J.PARAM_TYPES,w),q=Reflect.getMetadata(J.TAGGED,w);return{compilerGeneratedMetadata:z,userGeneratedMetadata:q||{}}},p.prototype.getPropertiesMetadata=function(w){var z=Reflect.getMetadata(J.TAGGED_PROP,w)||[];return z},p}();O.MetadataReader=E},55314:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Plan=void 0;var x=function(){function J(E,p){this.parentContext=E,this.rootRequest=p}return J}();O.Plan=x},86311:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getBindingDictionary=O.createMockRequest=O.plan=void 0;var J=x(23184),E=x(16674),p=x(28421),w=x(6867),z=x(85265),q=x(55800),Y=x(95228),ce=x(47738),ne=x(55314),be=x(6e3),we=x(6748),Me=x(18924);function Kt(Ht){return Ht._bindingDictionary}O.getBindingDictionary=Kt;function Zt(Ht,ar,mt,Ye,bt,Fe){var Ae=Ht?w.MULTI_INJECT_TAG:w.INJECT_TAG,Ne=new ce.Metadata(Ae,mt),xt=new Me.Target(ar,Ye,mt,Ne);if(bt!==void 0){var nr=new ce.Metadata(bt,Fe);xt.metadata.push(nr)}return xt}function Xt(Ht,ar,mt,Ye,bt){var Fe=yt(mt.container,bt.serviceIdentifier),Ae=[];return Fe.length===J.BindingCount.NoBindingsAvailable&&mt.container.options.autoBindInjectable&&typeof bt.serviceIdentifier=="function"&&Ht.getConstructorMetadata(bt.serviceIdentifier).compilerGeneratedMetadata&&(mt.container.bind(bt.serviceIdentifier).toSelf(),Fe=yt(mt.container,bt.serviceIdentifier)),ar?Ae=Fe:Ae=Fe.filter(function(Ne){var xt=new we.Request(Ne.serviceIdentifier,mt,Ye,Ne,bt);return Ne.constraint(xt)}),zt(bt.serviceIdentifier,Ae,bt,mt.container),Ae}function zt(Ht,ar,mt,Ye){switch(ar.length){case J.BindingCount.NoBindingsAvailable:if(mt.isOptional())return ar;var bt=q.getServiceIdentifierAsString(Ht),Fe=E.NOT_REGISTERED;throw Fe+=q.listMetadataForTarget(bt,mt),Fe+=q.listRegisteredBindingsForServiceIdentifier(Ye,bt,yt),new Error(Fe);case J.BindingCount.OnlyOneBindingAvailable:if(!mt.isArray())return ar;case J.BindingCount.MultipleBindingsAvailable:default:if(mt.isArray())return ar;var bt=q.getServiceIdentifierAsString(Ht),Fe=E.AMBIGUOUS_MATCH+" "+bt;throw Fe+=q.listRegisteredBindingsForServiceIdentifier(Ye,bt,yt),new Error(Fe)}}function Lt(Ht,ar,mt,Ye,bt,Fe){var Ae,Ne;if(bt===null){Ae=Xt(Ht,ar,Ye,null,Fe),Ne=new we.Request(mt,Ye,null,Ae,Fe);var xt=new ne.Plan(Ye,Ne);Ye.addPlan(xt)}else Ae=Xt(Ht,ar,Ye,bt,Fe),Ne=bt.addChildRequest(Fe.serviceIdentifier,Ae,Fe);Ae.forEach(function(nr){var re=null;if(Fe.isArray())re=Ne.addChildRequest(nr.serviceIdentifier,nr,Fe);else{if(nr.cache)return;re=Ne}if(nr.type===p.BindingTypeEnum.Instance&&nr.implementationType!==null){var Ee=be.getDependencies(Ht,nr.implementationType);if(!Ye.container.options.skipBaseClassChecks){var ae=be.getBaseClassDependencyCount(Ht,nr.implementationType);if(Ee.length<ae){var me=E.ARGUMENTS_LENGTH_MISMATCH(be.getFunctionName(nr.implementationType));throw new Error(me)}}Ee.forEach(function(Te){Lt(Ht,!1,Te.serviceIdentifier,Ye,re,Te)})}})}function yt(Ht,ar){var mt=[],Ye=Kt(Ht);return Ye.hasKey(ar)?mt=Ye.get(ar):Ht.parent!==null&&(mt=yt(Ht.parent,ar)),mt}function pt(Ht,ar,mt,Ye,bt,Fe,Ae,Ne){Ne===void 0&&(Ne=!1);var xt=new Y.Context(ar),nr=Zt(mt,Ye,bt,"",Fe,Ae);try{return Lt(Ht,Ne,bt,xt,null,nr),xt}catch(re){throw z.isStackOverflowExeption(re)&&xt.plan&&q.circularDependencyToException(xt.plan.rootRequest),re}}O.plan=pt;function Pr(Ht,ar,mt,Ye){var bt=new Me.Target(p.TargetTypeEnum.Variable,"",ar,new ce.Metadata(mt,Ye)),Fe=new Y.Context(Ht),Ae=new we.Request(ar,Fe,null,[],bt);return Ae}O.createMockRequest=Pr},88460:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.QueryableString=void 0;var x=function(){function J(E){this.str=E}return J.prototype.startsWith=function(E){return this.str.indexOf(E)===0},J.prototype.endsWith=function(E){var p="",w=E.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},w)},J.prototype.contains=function(E){return this.str.indexOf(E)!==-1},J.prototype.equals=function(E){return this.str===E},J.prototype.value=function(){return this.str},J}();O.QueryableString=x},6e3:function(pr,O,x){"use strict";var J=this&&this.__spreadArray||function(Xt,zt){for(var Lt=0,yt=zt.length,pt=Xt.length;Lt<yt;Lt++,pt++)Xt[pt]=zt[Lt];return Xt};Object.defineProperty(O,"__esModule",{value:!0}),O.getFunctionName=O.getBaseClassDependencyCount=O.getDependencies=void 0;var E=x(5744),p=x(16674),w=x(28421),z=x(6867),q=x(55800);Object.defineProperty(O,"getFunctionName",{enumerable:!0,get:function(){return q.getFunctionName}});var Y=x(18924);function ce(Xt,zt){var Lt=q.getFunctionName(zt),yt=ne(Xt,Lt,zt,!1);return yt}O.getDependencies=ce;function ne(Xt,zt,Lt,yt){var pt=Xt.getConstructorMetadata(Lt),Pr=pt.compilerGeneratedMetadata;if(Pr===void 0){var Ht=p.MISSING_INJECTABLE_ANNOTATION+" "+zt+".";throw new Error(Ht)}var ar=pt.userGeneratedMetadata,mt=Object.keys(ar),Ye=Lt.length===0&&mt.length>0,bt=mt.length>Lt.length,Fe=Ye||bt?mt.length:Lt.length,Ae=we(yt,zt,Pr,ar,Fe),Ne=Me(Xt,Lt),xt=J(J([],Ae),Ne);return xt}function be(Xt,zt,Lt,yt,pt){var Pr=pt[Xt.toString()]||[],Ht=Zt(Pr),ar=Ht.unmanaged!==!0,mt=yt[Xt],Ye=Ht.inject||Ht.multiInject;if(mt=Ye||mt,mt instanceof E.LazyServiceIdentifer&&(mt=mt.unwrap()),ar){var bt=mt===Object,Fe=mt===Function,Ae=mt===void 0,Ne=bt||Fe||Ae;if(!zt&&Ne){var xt=p.MISSING_INJECT_ANNOTATION+" argument "+Xt+" in class "+Lt+".";throw new Error(xt)}var nr=new Y.Target(w.TargetTypeEnum.ConstructorArgument,Ht.targetName,mt);return nr.metadata=Pr,nr}return null}function we(Xt,zt,Lt,yt,pt){for(var Pr=[],Ht=0;Ht<pt;Ht++){var ar=Ht,mt=be(ar,Xt,zt,Lt,yt);mt!==null&&Pr.push(mt)}return Pr}function Me(Xt,zt){for(var Lt=Xt.getPropertiesMetadata(zt),yt=[],pt=Object.keys(Lt),Pr=0,Ht=pt;Pr<Ht.length;Pr++){var ar=Ht[Pr],mt=Lt[ar],Ye=Zt(Lt[ar]),bt=Ye.targetName||ar,Fe=Ye.inject||Ye.multiInject,Ae=new Y.Target(w.TargetTypeEnum.ClassProperty,bt,Fe);Ae.metadata=mt,yt.push(Ae)}var Ne=Object.getPrototypeOf(zt.prototype).constructor;if(Ne!==Object){var xt=Me(Xt,Ne);yt=J(J([],yt),xt)}return yt}function Kt(Xt,zt){var Lt=Object.getPrototypeOf(zt.prototype).constructor;if(Lt!==Object){var yt=q.getFunctionName(Lt),pt=ne(Xt,yt,Lt,!0),Pr=pt.map(function(mt){return mt.metadata.filter(function(Ye){return Ye.key===z.UNMANAGED_TAG})}),Ht=[].concat.apply([],Pr).length,ar=pt.length-Ht;return ar>0?ar:Kt(Xt,Lt)}else return 0}O.getBaseClassDependencyCount=Kt;function Zt(Xt){var zt={};return Xt.forEach(function(Lt){zt[Lt.key.toString()]=Lt.value}),{inject:zt[z.INJECT_TAG],multiInject:zt[z.MULTI_INJECT_TAG],targetName:zt[z.NAME_TAG],unmanaged:zt[z.UNMANAGED_TAG]}}},6748:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Request=void 0;var J=x(37791),E=function(){function p(w,z,q,Y,ce){this.id=J.id(),this.serviceIdentifier=w,this.parentContext=z,this.parentRequest=q,this.target=ce,this.childRequests=[],this.bindings=Array.isArray(Y)?Y:[Y],this.requestScope=q===null?new Map:null}return p.prototype.addChildRequest=function(w,z,q){var Y=new p(w,this.parentContext,this,z,q);return this.childRequests.push(Y),Y},p}();O.Request=E},18924:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Target=void 0;var J=x(6867),E=x(37791),p=x(47738),w=x(88460),z=function(){function q(Y,ce,ne,be){this.id=E.id(),this.type=Y,this.serviceIdentifier=ne,this.name=new w.QueryableString(ce||""),this.metadata=new Array;var we=null;typeof be=="string"?we=new p.Metadata(J.NAMED_TAG,be):be instanceof p.Metadata&&(we=be),we!==null&&this.metadata.push(we)}return q.prototype.hasTag=function(Y){for(var ce=0,ne=this.metadata;ce<ne.length;ce++){var be=ne[ce];if(be.key===Y)return!0}return!1},q.prototype.isArray=function(){return this.hasTag(J.MULTI_INJECT_TAG)},q.prototype.matchesArray=function(Y){return this.matchesTag(J.MULTI_INJECT_TAG)(Y)},q.prototype.isNamed=function(){return this.hasTag(J.NAMED_TAG)},q.prototype.isTagged=function(){return this.metadata.some(function(Y){return J.NON_CUSTOM_TAG_KEYS.every(function(ce){return Y.key!==ce})})},q.prototype.isOptional=function(){return this.matchesTag(J.OPTIONAL_TAG)(!0)},q.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(Y){return Y.key===J.NAMED_TAG})[0]:null},q.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(Y){return J.NON_CUSTOM_TAG_KEYS.every(function(ce){return Y.key!==ce})}):null},q.prototype.matchesNamedTag=function(Y){return this.matchesTag(J.NAMED_TAG)(Y)},q.prototype.matchesTag=function(Y){var ce=this;return function(ne){for(var be=0,we=ce.metadata;be<we.length;be++){var Me=we[be];if(Me.key===Y&&Me.value===ne)return!0}return!1}},q}();O.Target=z},52279:function(pr,O,x){"use strict";var J=this&&this.__spreadArray||function(ne,be){for(var we=0,Me=be.length,Kt=ne.length;we<Me;we++,Kt++)ne[Kt]=be[we];return ne};Object.defineProperty(O,"__esModule",{value:!0}),O.resolveInstance=void 0;var E=x(16674),p=x(28421),w=x(6867);function z(ne,be,we){var Me=be.filter(function(Zt){return Zt.target!==null&&Zt.target.type===p.TargetTypeEnum.ClassProperty}),Kt=Me.map(we);return Me.forEach(function(Zt,Xt){var zt="";zt=Zt.target.name.value();var Lt=Kt[Xt];ne[zt]=Lt}),ne}function q(ne,be){return new(ne.bind.apply(ne,J([void 0],be)))}function Y(ne,be){if(Reflect.hasMetadata(w.POST_CONSTRUCT,ne)){var we=Reflect.getMetadata(w.POST_CONSTRUCT,ne);try{be[we.value]()}catch(Me){throw new Error(E.POST_CONSTRUCT_ERROR(ne.name,Me.message))}}}function ce(ne,be,we){var Me=null;if(be.length>0){var Kt=be.filter(function(Xt){return Xt.target!==null&&Xt.target.type===p.TargetTypeEnum.ConstructorArgument}),Zt=Kt.map(we);Me=q(ne,Zt),Me=z(Me,be,we)}else Me=new ne;return Y(ne,Me),Me}O.resolveInstance=ce},31927:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.resolve=void 0;var J=x(16674),E=x(28421),p=x(85265),w=x(55800),z=x(52279),q=function(ne,be,we){try{return we()}catch(Me){throw p.isStackOverflowExeption(Me)?new Error(J.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,be.toString())):Me}},Y=function(ne){return function(be){be.parentContext.setCurrentRequest(be);var we=be.bindings,Me=be.childRequests,Kt=be.target&&be.target.isArray(),Zt=!be.parentRequest||!be.parentRequest.target||!be.target||!be.parentRequest.target.matchesArray(be.target.serviceIdentifier);if(Kt&&Zt)return Me.map(function(Pr){var Ht=Y(ne);return Ht(Pr)});var Xt=null;if(be.target.isOptional()&&we.length===0)return;var zt=we[0],Lt=zt.scope===E.BindingScopeEnum.Singleton,yt=zt.scope===E.BindingScopeEnum.Request;if(Lt&&zt.activated)return zt.cache;if(yt&&ne!==null&&ne.has(zt.id))return ne.get(zt.id);if(zt.type===E.BindingTypeEnum.ConstantValue)Xt=zt.cache,zt.activated=!0;else if(zt.type===E.BindingTypeEnum.Function)Xt=zt.cache,zt.activated=!0;else if(zt.type===E.BindingTypeEnum.Constructor)Xt=zt.implementationType;else if(zt.type===E.BindingTypeEnum.DynamicValue&&zt.dynamicValue!==null)Xt=q("toDynamicValue",zt.serviceIdentifier,function(){return zt.dynamicValue(be.parentContext)});else if(zt.type===E.BindingTypeEnum.Factory&&zt.factory!==null)Xt=q("toFactory",zt.serviceIdentifier,function(){return zt.factory(be.parentContext)});else if(zt.type===E.BindingTypeEnum.Provider&&zt.provider!==null)Xt=q("toProvider",zt.serviceIdentifier,function(){return zt.provider(be.parentContext)});else if(zt.type===E.BindingTypeEnum.Instance&&zt.implementationType!==null)Xt=z.resolveInstance(zt.implementationType,Me,Y(ne));else{var pt=w.getServiceIdentifierAsString(be.serviceIdentifier);throw new Error(J.INVALID_BINDING_TYPE+" "+pt)}return typeof zt.onActivation=="function"&&(Xt=zt.onActivation(be.parentContext,Xt)),Lt&&(zt.cache=Xt,zt.activated=!0),yt&&ne!==null&&!ne.has(zt.id)&&ne.set(zt.id,Xt),Xt}};function ce(ne){var be=Y(ne.plan.rootRequest.requestScope);return be(ne.plan.rootRequest)}O.resolve=ce},83366:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInSyntax=void 0;var J=x(28421),E=x(71325),p=function(){function w(z){this._binding=z}return w.prototype.inRequestScope=function(){return this._binding.scope=J.BindingScopeEnum.Request,new E.BindingWhenOnSyntax(this._binding)},w.prototype.inSingletonScope=function(){return this._binding.scope=J.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},w.prototype.inTransientScope=function(){return this._binding.scope=J.BindingScopeEnum.Transient,new E.BindingWhenOnSyntax(this._binding)},w}();O.BindingInSyntax=p},74889:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInWhenOnSyntax=void 0;var J=x(83366),E=x(51811),p=x(98370),w=function(){function z(q){this._binding=q,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new E.BindingOnSyntax(this._binding),this._bindingInSyntax=new J.BindingInSyntax(q)}return z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},z.prototype.when=function(q){return this._bindingWhenSyntax.when(q)},z.prototype.whenTargetNamed=function(q){return this._bindingWhenSyntax.whenTargetNamed(q)},z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},z.prototype.whenTargetTagged=function(q,Y){return this._bindingWhenSyntax.whenTargetTagged(q,Y)},z.prototype.whenInjectedInto=function(q){return this._bindingWhenSyntax.whenInjectedInto(q)},z.prototype.whenParentNamed=function(q){return this._bindingWhenSyntax.whenParentNamed(q)},z.prototype.whenParentTagged=function(q,Y){return this._bindingWhenSyntax.whenParentTagged(q,Y)},z.prototype.whenAnyAncestorIs=function(q){return this._bindingWhenSyntax.whenAnyAncestorIs(q)},z.prototype.whenNoAncestorIs=function(q){return this._bindingWhenSyntax.whenNoAncestorIs(q)},z.prototype.whenAnyAncestorNamed=function(q){return this._bindingWhenSyntax.whenAnyAncestorNamed(q)},z.prototype.whenAnyAncestorTagged=function(q,Y){return this._bindingWhenSyntax.whenAnyAncestorTagged(q,Y)},z.prototype.whenNoAncestorNamed=function(q){return this._bindingWhenSyntax.whenNoAncestorNamed(q)},z.prototype.whenNoAncestorTagged=function(q,Y){return this._bindingWhenSyntax.whenNoAncestorTagged(q,Y)},z.prototype.whenAnyAncestorMatches=function(q){return this._bindingWhenSyntax.whenAnyAncestorMatches(q)},z.prototype.whenNoAncestorMatches=function(q){return this._bindingWhenSyntax.whenNoAncestorMatches(q)},z.prototype.onActivation=function(q){return this._bindingOnSyntax.onActivation(q)},z}();O.BindingInWhenOnSyntax=w},51811:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingOnSyntax=void 0;var J=x(98370),E=function(){function p(w){this._binding=w}return p.prototype.onActivation=function(w){return this._binding.onActivation=w,new J.BindingWhenSyntax(this._binding)},p}();O.BindingOnSyntax=E},15451:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingToSyntax=void 0;var J=x(16674),E=x(28421),p=x(74889),w=x(71325),z=function(){function q(Y){this._binding=Y}return q.prototype.to=function(Y){return this._binding.type=E.BindingTypeEnum.Instance,this._binding.implementationType=Y,new p.BindingInWhenOnSyntax(this._binding)},q.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+J.INVALID_TO_SELF_VALUE);var Y=this._binding.serviceIdentifier;return this.to(Y)},q.prototype.toConstantValue=function(Y){return this._binding.type=E.BindingTypeEnum.ConstantValue,this._binding.cache=Y,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},q.prototype.toDynamicValue=function(Y){return this._binding.type=E.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=Y,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},q.prototype.toConstructor=function(Y){return this._binding.type=E.BindingTypeEnum.Constructor,this._binding.implementationType=Y,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},q.prototype.toFactory=function(Y){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=Y,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},q.prototype.toFunction=function(Y){if(typeof Y!="function")throw new Error(J.INVALID_FUNCTION_BINDING);var ce=this.toConstantValue(Y);return this._binding.type=E.BindingTypeEnum.Function,this._binding.scope=E.BindingScopeEnum.Singleton,ce},q.prototype.toAutoFactory=function(Y){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=function(ce){var ne=function(){return ce.container.get(Y)};return ne},this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},q.prototype.toProvider=function(Y){return this._binding.type=E.BindingTypeEnum.Provider,this._binding.provider=Y,this._binding.scope=E.BindingScopeEnum.Singleton,new w.BindingWhenOnSyntax(this._binding)},q.prototype.toService=function(Y){this.toDynamicValue(function(ce){return ce.container.get(Y)})},q}();O.BindingToSyntax=z},71325:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenOnSyntax=void 0;var J=x(51811),E=x(98370),p=function(){function w(z){this._binding=z,this._bindingWhenSyntax=new E.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding)}return w.prototype.when=function(z){return this._bindingWhenSyntax.when(z)},w.prototype.whenTargetNamed=function(z){return this._bindingWhenSyntax.whenTargetNamed(z)},w.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},w.prototype.whenTargetTagged=function(z,q){return this._bindingWhenSyntax.whenTargetTagged(z,q)},w.prototype.whenInjectedInto=function(z){return this._bindingWhenSyntax.whenInjectedInto(z)},w.prototype.whenParentNamed=function(z){return this._bindingWhenSyntax.whenParentNamed(z)},w.prototype.whenParentTagged=function(z,q){return this._bindingWhenSyntax.whenParentTagged(z,q)},w.prototype.whenAnyAncestorIs=function(z){return this._bindingWhenSyntax.whenAnyAncestorIs(z)},w.prototype.whenNoAncestorIs=function(z){return this._bindingWhenSyntax.whenNoAncestorIs(z)},w.prototype.whenAnyAncestorNamed=function(z){return this._bindingWhenSyntax.whenAnyAncestorNamed(z)},w.prototype.whenAnyAncestorTagged=function(z,q){return this._bindingWhenSyntax.whenAnyAncestorTagged(z,q)},w.prototype.whenNoAncestorNamed=function(z){return this._bindingWhenSyntax.whenNoAncestorNamed(z)},w.prototype.whenNoAncestorTagged=function(z,q){return this._bindingWhenSyntax.whenNoAncestorTagged(z,q)},w.prototype.whenAnyAncestorMatches=function(z){return this._bindingWhenSyntax.whenAnyAncestorMatches(z)},w.prototype.whenNoAncestorMatches=function(z){return this._bindingWhenSyntax.whenNoAncestorMatches(z)},w.prototype.onActivation=function(z){return this._bindingOnSyntax.onActivation(z)},w}();O.BindingWhenOnSyntax=p},98370:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenSyntax=void 0;var J=x(51811),E=x(80758),p=function(){function w(z){this._binding=z}return w.prototype.when=function(z){return this._binding.constraint=z,new J.BindingOnSyntax(this._binding)},w.prototype.whenTargetNamed=function(z){return this._binding.constraint=E.namedConstraint(z),new J.BindingOnSyntax(this._binding)},w.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(z){var q=z.target!==null&&!z.target.isNamed()&&!z.target.isTagged();return q},new J.BindingOnSyntax(this._binding)},w.prototype.whenTargetTagged=function(z,q){return this._binding.constraint=E.taggedConstraint(z)(q),new J.BindingOnSyntax(this._binding)},w.prototype.whenInjectedInto=function(z){return this._binding.constraint=function(q){return E.typeConstraint(z)(q.parentRequest)},new J.BindingOnSyntax(this._binding)},w.prototype.whenParentNamed=function(z){return this._binding.constraint=function(q){return E.namedConstraint(z)(q.parentRequest)},new J.BindingOnSyntax(this._binding)},w.prototype.whenParentTagged=function(z,q){return this._binding.constraint=function(Y){return E.taggedConstraint(z)(q)(Y.parentRequest)},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorIs=function(z){return this._binding.constraint=function(q){return E.traverseAncerstors(q,E.typeConstraint(z))},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorIs=function(z){return this._binding.constraint=function(q){return!E.traverseAncerstors(q,E.typeConstraint(z))},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorNamed=function(z){return this._binding.constraint=function(q){return E.traverseAncerstors(q,E.namedConstraint(z))},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorNamed=function(z){return this._binding.constraint=function(q){return!E.traverseAncerstors(q,E.namedConstraint(z))},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorTagged=function(z,q){return this._binding.constraint=function(Y){return E.traverseAncerstors(Y,E.taggedConstraint(z)(q))},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorTagged=function(z,q){return this._binding.constraint=function(Y){return!E.traverseAncerstors(Y,E.taggedConstraint(z)(q))},new J.BindingOnSyntax(this._binding)},w.prototype.whenAnyAncestorMatches=function(z){return this._binding.constraint=function(q){return E.traverseAncerstors(q,z)},new J.BindingOnSyntax(this._binding)},w.prototype.whenNoAncestorMatches=function(z){return this._binding.constraint=function(q){return!E.traverseAncerstors(q,z)},new J.BindingOnSyntax(this._binding)},w}();O.BindingWhenSyntax=p},80758:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.typeConstraint=O.namedConstraint=O.taggedConstraint=O.traverseAncerstors=void 0;var J=x(6867),E=x(47738),p=function(Y,ce){var ne=Y.parentRequest;return ne!==null?ce(ne)?!0:p(ne,ce):!1};O.traverseAncerstors=p;var w=function(Y){return function(ce){var ne=function(be){return be!==null&&be.target!==null&&be.target.matchesTag(Y)(ce)};return ne.metaData=new E.Metadata(Y,ce),ne}};O.taggedConstraint=w;var z=w(J.NAMED_TAG);O.namedConstraint=z;var q=function(Y){return function(ce){var ne=null;if(ce!==null)if(ne=ce.bindings[0],typeof Y=="string"){var be=ne.serviceIdentifier;return be===Y}else{var we=ce.bindings[0].implementationType;return Y===we}return!1}};O.typeConstraint=q},70600:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiBindToService=void 0;var x=function(J){return function(E){return function(){for(var p=[],w=0;w<arguments.length;w++)p[w]=arguments[w];return p.forEach(function(z){return J.bind(z).toService(E)})}}};O.multiBindToService=x},85265:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.isStackOverflowExeption=void 0;var J=x(16674);function E(p){return p instanceof RangeError||p.message===J.STACK_OVERFLOW}O.isStackOverflowExeption=E},37791:function(pr,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.id=void 0;var x=0;function J(){return x++}O.id=J},55800:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.circularDependencyToException=O.listMetadataForTarget=O.listRegisteredBindingsForServiceIdentifier=O.getServiceIdentifierAsString=O.getFunctionName=void 0;var J=x(16674);function E(ne){if(typeof ne=="function"){var be=ne;return be.name}else{if(typeof ne=="symbol")return ne.toString();var be=ne;return be}}O.getServiceIdentifierAsString=E;function p(ne,be,we){var Me="",Kt=we(ne,be);return Kt.length!==0&&(Me=`
Registered bindings:`,Kt.forEach(function(Zt){var Xt="Object";Zt.implementationType!==null&&(Xt=ce(Zt.implementationType)),Me=Me+`
 `+Xt,Zt.constraint.metaData&&(Me=Me+" - "+Zt.constraint.metaData)})),Me}O.listRegisteredBindingsForServiceIdentifier=p;function w(ne,be){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===be?!0:w(ne.parentRequest,be)}function z(ne){function be(Me,Kt){Kt===void 0&&(Kt=[]);var Zt=E(Me.serviceIdentifier);return Kt.push(Zt),Me.parentRequest!==null?be(Me.parentRequest,Kt):Kt}var we=be(ne);return we.reverse().join(" --> ")}function q(ne){ne.childRequests.forEach(function(be){if(w(be,be.serviceIdentifier)){var we=z(be);throw new Error(J.CIRCULAR_DEPENDENCY+" "+we)}else q(be)})}O.circularDependencyToException=q;function Y(ne,be){if(be.isTagged()||be.isNamed()){var we="",Me=be.getNamedTag(),Kt=be.getCustomTags();return Me!==null&&(we+=Me.toString()+`
`),Kt!==null&&Kt.forEach(function(Zt){we+=Zt.toString()+`
`})," "+ne+`
 `+ne+" - "+we}else return" "+ne}O.listMetadataForTarget=Y;function ce(ne){if(ne.name)return ne.name;var be=ne.toString(),we=be.match(/^function\s*([^\s(]+)/);return we?we[1]:"Anonymous function: "+be}O.getFunctionName=ce},68982:function(pr){pr.exports=O;function O(x,J){J||(J=document);var E=J.head||J.getElementsByTagName("head")[0];if(!E){E=J.createElement("head");var p=J.body||J.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(E,p):J.documentElement.appendChild(E)}var w=J.createElement("style");return w.type="text/css",w.styleSheet?w.styleSheet.cssText=x:w.appendChild(J.createTextNode(x)),E.appendChild(w),w}},53778:function(pr){var O=Array.isArray;pr.exports=O},59722:function(pr){function O(x){return x==null}pr.exports=O},8146:function(pr){var O="[object Object]";function x(we){var Me=!1;if(we!=null&&typeof we.toString!="function")try{Me=!!(we+"")}catch(Kt){}return Me}function J(we,Me){return function(Kt){return we(Me(Kt))}}var E=Function.prototype,p=Object.prototype,w=E.toString,z=p.hasOwnProperty,q=w.call(Object),Y=p.toString,ce=J(Object.getPrototypeOf,Object);function ne(we){return!!we&&typeof we=="object"}function be(we){if(!ne(we)||Y.call(we)!=O||x(we))return!1;var Me=ce(we);if(Me===null)return!0;var Kt=z.call(Me,"constructor")&&Me.constructor;return typeof Kt=="function"&&Kt instanceof Kt&&w.call(Kt)==q}pr.exports=be},38554:function(pr,O,x){pr=x.nmd(pr);var J=200,E="__lodash_hash_undefined__",p=800,w=16,z=9007199254740991,q="[object Arguments]",Y="[object Array]",ce="[object AsyncFunction]",ne="[object Boolean]",be="[object Date]",we="[object Error]",Me="[object Function]",Kt="[object GeneratorFunction]",Zt="[object Map]",Xt="[object Number]",zt="[object Null]",Lt="[object Object]",yt="[object Proxy]",pt="[object RegExp]",Pr="[object Set]",Ht="[object String]",ar="[object Undefined]",mt="[object WeakMap]",Ye="[object ArrayBuffer]",bt="[object DataView]",Fe="[object Float32Array]",Ae="[object Float64Array]",Ne="[object Int8Array]",xt="[object Int16Array]",nr="[object Int32Array]",re="[object Uint8Array]",Ee="[object Uint8ClampedArray]",ae="[object Uint16Array]",me="[object Uint32Array]",Te=/[\\^$.*+?()[\]{}|]/g,Je=/^\[object .+?Constructor\]$/,dt=/^(?:0|[1-9]\d*)$/,$t={};$t[Fe]=$t[Ae]=$t[Ne]=$t[xt]=$t[nr]=$t[re]=$t[Ee]=$t[ae]=$t[me]=!0,$t[q]=$t[Y]=$t[Ye]=$t[ne]=$t[bt]=$t[be]=$t[we]=$t[Me]=$t[Zt]=$t[Xt]=$t[Lt]=$t[pt]=$t[Pr]=$t[Ht]=$t[mt]=!1;var Fr=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,zr=typeof self=="object"&&self&&self.Object===Object&&self,ln=Fr||zr||Function("return this")(),tr=O&&!O.nodeType&&O,oe=tr&&!0&&pr&&!pr.nodeType&&pr,ge=oe&&oe.exports===tr,Re=ge&&Fr.process,qe=function(){try{var je=oe&&oe.require&&oe.require("util").types;return je||Re&&Re.binding&&Re.binding("util")}catch(Tt){}}(),Ct=qe&&qe.isTypedArray;function kt(je,Tt,gr){switch(gr.length){case 0:return je.call(Tt);case 1:return je.call(Tt,gr[0]);case 2:return je.call(Tt,gr[0],gr[1]);case 3:return je.call(Tt,gr[0],gr[1],gr[2])}return je.apply(Tt,gr)}function S(je,Tt){for(var gr=-1,In=Array(je);++gr<je;)In[gr]=Tt(gr);return In}function F(je){return function(Tt){return je(Tt)}}function he(je,Tt){return je==null?void 0:je[Tt]}function Be(je,Tt){return function(gr){return je(Tt(gr))}}var $e=Array.prototype,vt=Function.prototype,wt=Object.prototype,H=ln["__core-js_shared__"],Wt=vt.toString,Vt=wt.hasOwnProperty,yr=function(){var je=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||"");return je?"Symbol(src)_1."+je:""}(),Er=wt.toString,Ar=Wt.call(Object),Mr=RegExp("^"+Wt.call(Vt).replace(Te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ke=ge?ln.Buffer:void 0,gt=ln.Symbol,ct=ln.Uint8Array,sr=Ke?Ke.allocUnsafe:void 0,Qr=Be(Object.getPrototypeOf,Object),st=Object.create,Mt=wt.propertyIsEnumerable,Jt=$e.splice,mr=gt?gt.toStringTag:void 0,gn=function(){try{var je=ya(Object,"defineProperty");return je({},"",{}),je}catch(Tt){}}(),Cn=Ke?Ke.isBuffer:void 0,yi=Math.max,Ei=Date.now,Ii=ya(ln,"Map"),Ji=ya(Object,"create"),li=function(){function je(){}return function(Tt){if(!uo(Tt))return{};if(st)return st(Tt);je.prototype=Tt;var gr=new je;return je.prototype=void 0,gr}}();function G(je){var Tt=-1,gr=je==null?0:je.length;for(this.clear();++Tt<gr;){var In=je[Tt];this.set(In[0],In[1])}}function I(){this.__data__=Ji?Ji(null):{},this.size=0}function j(je){var Tt=this.has(je)&&delete this.__data__[je];return this.size-=Tt?1:0,Tt}function K(je){var Tt=this.__data__;if(Ji){var gr=Tt[je];return gr===E?void 0:gr}return Vt.call(Tt,je)?Tt[je]:void 0}function ie(je){var Tt=this.__data__;return Ji?Tt[je]!==void 0:Vt.call(Tt,je)}function Oe(je,Tt){var gr=this.__data__;return this.size+=this.has(je)?0:1,gr[je]=Ji&&Tt===void 0?E:Tt,this}G.prototype.clear=I,G.prototype.delete=j,G.prototype.get=K,G.prototype.has=ie,G.prototype.set=Oe;function He(je){var Tt=-1,gr=je==null?0:je.length;for(this.clear();++Tt<gr;){var In=je[Tt];this.set(In[0],In[1])}}function ue(){this.__data__=[],this.size=0}function De(je){var Tt=this.__data__,gr=yo(Tt,je);if(gr<0)return!1;var In=Tt.length-1;return gr==In?Tt.pop():Jt.call(Tt,gr,1),--this.size,!0}function St(je){var Tt=this.__data__,gr=yo(Tt,je);return gr<0?void 0:Tt[gr][1]}function Ir(je){return yo(this.__data__,je)>-1}function Br(je,Tt){var gr=this.__data__,In=yo(gr,je);return In<0?(++this.size,gr.push([je,Tt])):gr[In][1]=Tt,this}He.prototype.clear=ue,He.prototype.delete=De,He.prototype.get=St,He.prototype.has=Ir,He.prototype.set=Br;function jt(je){var Tt=-1,gr=je==null?0:je.length;for(this.clear();++Tt<gr;){var In=je[Tt];this.set(In[0],In[1])}}function dr(){this.size=0,this.__data__={hash:new G,map:new(Ii||He),string:new G}}function Wr(je){var Tt=Ea(this,je).delete(je);return this.size-=Tt?1:0,Tt}function yn(je){return Ea(this,je).get(je)}function vr(je){return Ea(this,je).has(je)}function vn(je,Tt){var gr=Ea(this,je),In=gr.size;return gr.set(je,Tt),this.size+=gr.size==In?0:1,this}jt.prototype.clear=dr,jt.prototype.delete=Wr,jt.prototype.get=yn,jt.prototype.has=vr,jt.prototype.set=vn;function $r(je){var Tt=this.__data__=new He(je);this.size=Tt.size}function cn(){this.__data__=new He,this.size=0}function di(je){var Tt=this.__data__,gr=Tt.delete(je);return this.size=Tt.size,gr}function hn(je){return this.__data__.get(je)}function bi(je){return this.__data__.has(je)}function Qi(je,Tt){var gr=this.__data__;if(gr instanceof He){var In=gr.__data__;if(!Ii||In.length<J-1)return In.push([je,Tt]),this.size=++gr.size,this;gr=this.__data__=new jt(In)}return gr.set(je,Tt),this.size=gr.size,this}$r.prototype.clear=cn,$r.prototype.delete=di,$r.prototype.get=hn,$r.prototype.has=bi,$r.prototype.set=Qi;function _i(je,Tt){var gr=Wo(je),In=!gr&&Ya(je),Yi=!gr&&!In&&Ku(je),_a=!gr&&!In&&!Yi&&pi(je),Ba=gr||In||Yi||_a,aa=Ba?S(je.length,String):[],Pa=aa.length;for(var ko in je)(Tt||Vt.call(je,ko))&&!(Ba&&(ko=="length"||Yi&&(ko=="offset"||ko=="parent")||_a&&(ko=="buffer"||ko=="byteLength"||ko=="byteOffset")||ns(ko,Pa)))&&aa.push(ko);return aa}function Oi(je,Tt,gr){(gr!==void 0&&!Xa(je[Tt],gr)||gr===void 0&&!(Tt in je))&&Zi(je,Tt,gr)}function Ci(je,Tt,gr){var In=je[Tt];(!(Vt.call(je,Tt)&&Xa(In,gr))||gr===void 0&&!(Tt in je))&&Zi(je,Tt,gr)}function yo(je,Tt){for(var gr=je.length;gr--;)if(Xa(je[gr][0],Tt))return gr;return-1}function Zi(je,Tt,gr){Tt=="__proto__"&&gn?gn(je,Tt,{configurable:!0,enumerable:!0,value:gr,writable:!0}):je[Tt]=gr}var Rn=Wa();function Dn(je){return je==null?je===void 0?ar:zt:mr&&mr in Object(je)?ia(je):ft(je)}function hi(je){return Ps(je)&&Dn(je)==q}function jn(je){if(!uo(je)||fa(je))return!1;var Tt=Do(je)?Mr:Je;return Tt.test(qi(je))}function Oa(je){return Ps(je)&&Cs(je.length)&&!!$t[Dn(je)]}function hs(je){if(!uo(je))return Pe(je);var Tt=fe(je),gr=[];for(var In in je)In=="constructor"&&(Tt||!Vt.call(je,In))||gr.push(In);return gr}function Li(je,Tt,gr,In,Yi){je!==Tt&&Rn(Tt,function(_a,Ba){if(Yi||(Yi=new $r),uo(_a))La(je,Tt,Ba,gr,Li,In,Yi);else{var aa=In?In(en(je,Ba),_a,Ba+"",je,Tt,Yi):void 0;aa===void 0&&(aa=_a),Oi(je,Ba,aa)}},Ra)}function La(je,Tt,gr,In,Yi,_a,Ba){var aa=en(je,gr),Pa=en(Tt,gr),ko=Ba.get(Pa);if(ko){Oi(je,gr,ko);return}var Mo=_a?_a(aa,Pa,gr+"",je,Tt,Ba):void 0,Ri=Mo===void 0;if(Ri){var wl=Wo(Pa),Us=!wl&&Ku(Pa),ps=!wl&&!Us&&pi(Pa);Mo=Pa,wl||Us||ps?Wo(aa)?Mo=aa:jl(aa)?Mo=Ha(aa):Us?(Ri=!1,Mo=ga(Pa,!0)):ps?(Ri=!1,Mo=Ga(Pa,!0)):Mo=[]:Ca(Pa)||Ya(Pa)?(Mo=aa,Ya(aa)?Mo=sl(aa):(!uo(aa)||Do(aa))&&(Mo=ol(Pa))):Ri=!1}Ri&&(Ba.set(Pa,Mo),Yi(Mo,Pa,In,_a,Ba),Ba.delete(Pa)),Oi(je,gr,Mo)}function gu(je,Tt){return kn(ur(je,Tt,Zl),je+"")}var su=gn?function(je,Tt){return gn(je,"toString",{configurable:!0,enumerable:!1,value:Ks(Tt),writable:!0})}:Zl;function ga(je,Tt){if(Tt)return je.slice();var gr=je.length,In=sr?sr(gr):new je.constructor(gr);return je.copy(In),In}function so(je){var Tt=new je.constructor(je.byteLength);return new ct(Tt).set(new ct(je)),Tt}function Ga(je,Tt){var gr=Tt?so(je.buffer):je.buffer;return new je.constructor(gr,je.byteOffset,je.length)}function Ha(je,Tt){var gr=-1,In=je.length;for(Tt||(Tt=Array(In));++gr<In;)Tt[gr]=je[gr];return Tt}function Ho(je,Tt,gr,In){var Yi=!gr;gr||(gr={});for(var _a=-1,Ba=Tt.length;++_a<Ba;){var aa=Tt[_a],Pa=In?In(gr[aa],je[aa],aa,gr,je):void 0;Pa===void 0&&(Pa=je[aa]),Yi?Zi(gr,aa,Pa):Ci(gr,aa,Pa)}return gr}function sa(je){return gu(function(Tt,gr){var In=-1,Yi=gr.length,_a=Yi>1?gr[Yi-1]:void 0,Ba=Yi>2?gr[2]:void 0;for(_a=je.length>3&&typeof _a=="function"?(Yi--,_a):void 0,Ba&&to(gr[0],gr[1],Ba)&&(_a=Yi<3?void 0:_a,Yi=1),Tt=Object(Tt);++In<Yi;){var aa=gr[In];aa&&je(Tt,aa,In,_a)}return Tt})}function Wa(je){return function(Tt,gr,In){for(var Yi=-1,_a=Object(Tt),Ba=In(Tt),aa=Ba.length;aa--;){var Pa=Ba[je?aa:++Yi];if(gr(_a[Pa],Pa,_a)===!1)break}return Tt}}function Ea(je,Tt){var gr=je.__data__;return Aa(Tt)?gr[typeof Tt=="string"?"string":"hash"]:gr.map}function ya(je,Tt){var gr=he(je,Tt);return jn(gr)?gr:void 0}function ia(je){var Tt=Vt.call(je,mr),gr=je[mr];try{je[mr]=void 0;var In=!0}catch(_a){}var Yi=Er.call(je);return In&&(Tt?je[mr]=gr:delete je[mr]),Yi}function ol(je){return typeof je.constructor=="function"&&!fe(je)?li(Qr(je)):{}}function ns(je,Tt){var gr=typeof je;return Tt=Tt==null?z:Tt,!!Tt&&(gr=="number"||gr!="symbol"&&dt.test(je))&&je>-1&&je%1==0&&je<Tt}function to(je,Tt,gr){if(!uo(gr))return!1;var In=typeof Tt;return(In=="number"?xs(gr)&&ns(Tt,gr.length):In=="string"&&Tt in gr)?Xa(gr[Tt],je):!1}function Aa(je){var Tt=typeof je;return Tt=="string"||Tt=="number"||Tt=="symbol"||Tt=="boolean"?je!=="__proto__":je===null}function fa(je){return!!yr&&yr in je}function fe(je){var Tt=je&&je.constructor,gr=typeof Tt=="function"&&Tt.prototype||wt;return je===gr}function Pe(je){var Tt=[];if(je!=null)for(var gr in Object(je))Tt.push(gr);return Tt}function ft(je){return Er.call(je)}function ur(je,Tt,gr){return Tt=yi(Tt===void 0?je.length-1:Tt,0),function(){for(var In=arguments,Yi=-1,_a=yi(In.length-Tt,0),Ba=Array(_a);++Yi<_a;)Ba[Yi]=In[Tt+Yi];Yi=-1;for(var aa=Array(Tt+1);++Yi<Tt;)aa[Yi]=In[Yi];return aa[Tt]=gr(Ba),kt(je,this,aa)}}function en(je,Tt){if(!(Tt==="constructor"&&typeof je[Tt]=="function")&&Tt!="__proto__")return je[Tt]}var kn=Vi(su);function Vi(je){var Tt=0,gr=0;return function(){var In=Ei(),Yi=w-(In-gr);if(gr=In,Yi>0){if(++Tt>=p)return arguments[0]}else Tt=0;return je.apply(void 0,arguments)}}function qi(je){if(je!=null){try{return Wt.call(je)}catch(Tt){}try{return je+""}catch(Tt){}}return""}function Xa(je,Tt){return je===Tt||je!==je&&Tt!==Tt}var Ya=hi(function(){return arguments}())?hi:function(je){return Ps(je)&&Vt.call(je,"callee")&&!Mt.call(je,"callee")},Wo=Array.isArray;function xs(je){return je!=null&&Cs(je.length)&&!Do(je)}function jl(je){return Ps(je)&&xs(je)}var Ku=Cn||lo;function Do(je){if(!uo(je))return!1;var Tt=Dn(je);return Tt==Me||Tt==Kt||Tt==ce||Tt==yt}function Cs(je){return typeof je=="number"&&je>-1&&je%1==0&&je<=z}function uo(je){var Tt=typeof je;return je!=null&&(Tt=="object"||Tt=="function")}function Ps(je){return je!=null&&typeof je=="object"}function Ca(je){if(!Ps(je)||Dn(je)!=Lt)return!1;var Tt=Qr(je);if(Tt===null)return!0;var gr=Vt.call(Tt,"constructor")&&Tt.constructor;return typeof gr=="function"&&gr instanceof gr&&Wt.call(gr)==Ar}var pi=Ct?F(Ct):Oa;function sl(je){return Ho(je,Ra(je))}function Ra(je){return xs(je)?_i(je,!0):hs(je)}var zn=sa(function(je,Tt,gr,In){Li(je,Tt,gr,In)});function Ks(je){return function(){return je}}function Zl(je){return je}function lo(){return!1}pr.exports=zn},97644:function(pr,O,x){var J=200,E="__lodash_hash_undefined__",p=1/0,w="[object Function]",z="[object GeneratorFunction]",q=/[\\^$.*+?()[\]{}|]/g,Y=/^\[object .+?Constructor\]$/,ce=typeof x.g=="object"&&x.g&&x.g.Object===Object&&x.g,ne=typeof self=="object"&&self&&self.Object===Object&&self,be=ce||ne||Function("return this")();function we(st,Mt){var Jt=st?st.length:0;return!!Jt&&Zt(st,Mt,0)>-1}function Me(st,Mt,Jt){for(var mr=-1,gn=st?st.length:0;++mr<gn;)if(Jt(Mt,st[mr]))return!0;return!1}function Kt(st,Mt,Jt,mr){for(var gn=st.length,Cn=Jt+(mr?1:-1);mr?Cn--:++Cn<gn;)if(Mt(st[Cn],Cn,st))return Cn;return-1}function Zt(st,Mt,Jt){if(Mt!==Mt)return Kt(st,Xt,Jt);for(var mr=Jt-1,gn=st.length;++mr<gn;)if(st[mr]===Mt)return mr;return-1}function Xt(st){return st!==st}function zt(st,Mt){return st.has(Mt)}function Lt(st,Mt){return st==null?void 0:st[Mt]}function yt(st){var Mt=!1;if(st!=null&&typeof st.toString!="function")try{Mt=!!(st+"")}catch(Jt){}return Mt}function pt(st){var Mt=-1,Jt=Array(st.size);return st.forEach(function(mr){Jt[++Mt]=mr}),Jt}var Pr=Array.prototype,Ht=Function.prototype,ar=Object.prototype,mt=be["__core-js_shared__"],Ye=function(){var st=/[^.]+$/.exec(mt&&mt.keys&&mt.keys.IE_PROTO||"");return st?"Symbol(src)_1."+st:""}(),bt=Ht.toString,Fe=ar.hasOwnProperty,Ae=ar.toString,Ne=RegExp("^"+bt.call(Fe).replace(q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xt=Pr.splice,nr=yr(be,"Map"),re=yr(be,"Set"),Ee=yr(Object,"create");function ae(st){var Mt=-1,Jt=st?st.length:0;for(this.clear();++Mt<Jt;){var mr=st[Mt];this.set(mr[0],mr[1])}}function me(){this.__data__=Ee?Ee(null):{}}function Te(st){return this.has(st)&&delete this.__data__[st]}function Je(st){var Mt=this.__data__;if(Ee){var Jt=Mt[st];return Jt===E?void 0:Jt}return Fe.call(Mt,st)?Mt[st]:void 0}function dt(st){var Mt=this.__data__;return Ee?Mt[st]!==void 0:Fe.call(Mt,st)}function $t(st,Mt){var Jt=this.__data__;return Jt[st]=Ee&&Mt===void 0?E:Mt,this}ae.prototype.clear=me,ae.prototype.delete=Te,ae.prototype.get=Je,ae.prototype.has=dt,ae.prototype.set=$t;function Fr(st){var Mt=-1,Jt=st?st.length:0;for(this.clear();++Mt<Jt;){var mr=st[Mt];this.set(mr[0],mr[1])}}function zr(){this.__data__=[]}function ln(st){var Mt=this.__data__,Jt=vt(Mt,st);if(Jt<0)return!1;var mr=Mt.length-1;return Jt==mr?Mt.pop():xt.call(Mt,Jt,1),!0}function tr(st){var Mt=this.__data__,Jt=vt(Mt,st);return Jt<0?void 0:Mt[Jt][1]}function oe(st){return vt(this.__data__,st)>-1}function ge(st,Mt){var Jt=this.__data__,mr=vt(Jt,st);return mr<0?Jt.push([st,Mt]):Jt[mr][1]=Mt,this}Fr.prototype.clear=zr,Fr.prototype.delete=ln,Fr.prototype.get=tr,Fr.prototype.has=oe,Fr.prototype.set=ge;function Re(st){var Mt=-1,Jt=st?st.length:0;for(this.clear();++Mt<Jt;){var mr=st[Mt];this.set(mr[0],mr[1])}}function qe(){this.__data__={hash:new ae,map:new(nr||Fr),string:new ae}}function Ct(st){return Vt(this,st).delete(st)}function kt(st){return Vt(this,st).get(st)}function S(st){return Vt(this,st).has(st)}function F(st,Mt){return Vt(this,st).set(st,Mt),this}Re.prototype.clear=qe,Re.prototype.delete=Ct,Re.prototype.get=kt,Re.prototype.has=S,Re.prototype.set=F;function he(st){var Mt=-1,Jt=st?st.length:0;for(this.__data__=new Re;++Mt<Jt;)this.add(st[Mt])}function Be(st){return this.__data__.set(st,E),this}function $e(st){return this.__data__.has(st)}he.prototype.add=he.prototype.push=Be,he.prototype.has=$e;function vt(st,Mt){for(var Jt=st.length;Jt--;)if(gt(st[Jt][0],Mt))return Jt;return-1}function wt(st){if(!sr(st)||Ar(st))return!1;var Mt=ct(st)||yt(st)?Ne:Y;return Mt.test(Mr(st))}function H(st,Mt,Jt){var mr=-1,gn=we,Cn=st.length,yi=!0,Ei=[],Ii=Ei;if(Jt)yi=!1,gn=Me;else if(Cn>=J){var Ji=Mt?null:Wt(st);if(Ji)return pt(Ji);yi=!1,gn=zt,Ii=new he}else Ii=Mt?[]:Ei;e:for(;++mr<Cn;){var li=st[mr],G=Mt?Mt(li):li;if(li=Jt||li!==0?li:0,yi&&G===G){for(var I=Ii.length;I--;)if(Ii[I]===G)continue e;Mt&&Ii.push(G),Ei.push(li)}else gn(Ii,G,Jt)||(Ii!==Ei&&Ii.push(G),Ei.push(li))}return Ei}var Wt=re&&1/pt(new re([,-0]))[1]==p?function(st){return new re(st)}:Qr;function Vt(st,Mt){var Jt=st.__data__;return Er(Mt)?Jt[typeof Mt=="string"?"string":"hash"]:Jt.map}function yr(st,Mt){var Jt=Lt(st,Mt);return wt(Jt)?Jt:void 0}function Er(st){var Mt=typeof st;return Mt=="string"||Mt=="number"||Mt=="symbol"||Mt=="boolean"?st!=="__proto__":st===null}function Ar(st){return!!Ye&&Ye in st}function Mr(st){if(st!=null){try{return bt.call(st)}catch(Mt){}try{return st+""}catch(Mt){}}return""}function Ke(st){return st&&st.length?H(st):[]}function gt(st,Mt){return st===Mt||st!==st&&Mt!==Mt}function ct(st){var Mt=sr(st)?Ae.call(st):"";return Mt==w||Mt==z}function sr(st){var Mt=typeof st;return!!st&&(Mt=="object"||Mt=="function")}function Qr(){}pr.exports=Ke},49029:function(pr){var O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function x(J){return J.match(O)||[]}pr.exports=x},29750:function(pr){function O(x,J,E){return x===x&&(E!==void 0&&(x=x<=E?x:E),J!==void 0&&(x=x>=J?x:J)),x}pr.exports=O},18674:function(pr){function O(x){return function(J){return x==null?void 0:x[J]}}pr.exports=O},98805:function(pr,O,x){var J=x(40180),E=x(62689),p=x(83140),w=x(79833);function z(q){return function(Y){Y=w(Y);var ce=E(Y)?p(Y):void 0,ne=ce?ce[0]:Y.charAt(0),be=ce?J(ce,1).join(""):Y.slice(1);return ne[q]()+be}}pr.exports=z},35393:function(pr,O,x){var J=x(62663),E=x(53816),p=x(58748),w="['\u2019]",z=RegExp(w,"g");function q(Y){return function(ce){return J(p(E(ce).replace(z,"")),Y,"")}}pr.exports=q},69389:function(pr,O,x){var J=x(18674),E={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=J(E);pr.exports=p},93157:function(pr){var O=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function x(J){return O.test(J)}pr.exports=x},2757:function(pr){var O="\\ud800-\\udfff",x="\\u0300-\\u036f",J="\\ufe20-\\ufe2f",E="\\u20d0-\\u20ff",p=x+J+E,w="\\u2700-\\u27bf",z="a-z\\xdf-\\xf6\\xf8-\\xff",q="\\xac\\xb1\\xd7\\xf7",Y="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ce="\\u2000-\\u206f",ne=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",be="A-Z\\xc0-\\xd6\\xd8-\\xde",we="\\ufe0e\\ufe0f",Me=q+Y+ce+ne,Kt="['\u2019]",Zt="["+Me+"]",Xt="["+p+"]",zt="\\d+",Lt="["+w+"]",yt="["+z+"]",pt="[^"+O+Me+zt+w+z+be+"]",Pr="\\ud83c[\\udffb-\\udfff]",Ht="(?:"+Xt+"|"+Pr+")",ar="[^"+O+"]",mt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ye="[\\ud800-\\udbff][\\udc00-\\udfff]",bt="["+be+"]",Fe="\\u200d",Ae="(?:"+yt+"|"+pt+")",Ne="(?:"+bt+"|"+pt+")",xt="(?:"+Kt+"(?:d|ll|m|re|s|t|ve))?",nr="(?:"+Kt+"(?:D|LL|M|RE|S|T|VE))?",re=Ht+"?",Ee="["+we+"]?",ae="(?:"+Fe+"(?:"+[ar,mt,Ye].join("|")+")"+Ee+re+")*",me="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Te="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Je=Ee+re+ae,dt="(?:"+[Lt,mt,Ye].join("|")+")"+Je,$t=RegExp([bt+"?"+yt+"+"+xt+"(?="+[Zt,bt,"$"].join("|")+")",Ne+"+"+nr+"(?="+[Zt,bt+Ae,"$"].join("|")+")",bt+"?"+Ae+"+"+xt,bt+"+"+nr,Te,me,zt,dt].join("|"),"g");function Fr(zr){return zr.match($t)||[]}pr.exports=Fr},68929:function(pr,O,x){var J=x(48403),E=x(35393),p=E(function(w,z,q){return z=z.toLowerCase(),w+(q?J(z):z)});pr.exports=p},48403:function(pr,O,x){var J=x(79833),E=x(11700);function p(w){return E(J(w).toLowerCase())}pr.exports=p},74691:function(pr,O,x){var J=x(29750),E=x(14841);function p(w,z,q){return q===void 0&&(q=z,z=void 0),q!==void 0&&(q=E(q),q=q===q?q:0),z!==void 0&&(z=E(z),z=z===z?z:0),J(E(w),z,q)}pr.exports=p},53816:function(pr,O,x){var J=x(69389),E=x(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,w="\\u0300-\\u036f",z="\\ufe20-\\ufe2f",q="\\u20d0-\\u20ff",Y=w+z+q,ce="["+Y+"]",ne=RegExp(ce,"g");function be(we){return we=E(we),we&&we.replace(p,J).replace(ne,"")}pr.exports=be},14293:function(pr){function O(x){return x==null}pr.exports=O},81763:function(pr,O,x){var J=x(44239),E=x(37005),p="[object Number]";function w(z){return typeof z=="number"||E(z)&&J(z)==p}pr.exports=w},30236:function(pr,O,x){var J=x(42980),E=x(21463),p=E(function(w,z,q,Y){J(w,z,q,Y)});pr.exports=p},44908:function(pr,O,x){var J=x(45652);function E(p){return p&&p.length?J(p):[]}pr.exports=E},11700:function(pr,O,x){var J=x(98805),E=J("toUpperCase");pr.exports=E},58748:function(pr,O,x){var J=x(49029),E=x(93157),p=x(79833),w=x(2757);function z(q,Y,ce){return q=p(q),Y=ce?void 0:Y,Y===void 0?E(q)?w(q):J(q):q.match(Y)||[]}pr.exports=z},6158:function(pr){(function(O,x){pr.exports=x()})(this,function(){"use strict";var O,x,J;function E(p,w){if(!O)O=w;else if(!x)x=w;else{var z="var sharedChunk = {}; ("+O+")(sharedChunk); ("+x+")(sharedChunk);",q={};O(q),J=w(q),typeof window!="undefined"&&(J.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}return E(["exports"],function(p){"use strict";function w(e,t){return e(t={exports:{}},t.exports),t.exports}var z=q;function q(e,t,r,c){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(c-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=c,this.p2x=r,this.p2y=c}q.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},q.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},q.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},q.prototype.solveCurveX=function(e,t){var r,c,v,m,_;for(t===void 0&&(t=1e-6),v=e,_=0;_<8;_++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var C=this.sampleCurveDerivativeX(v);if(Math.abs(C)<1e-6)break;v-=m/C}if((v=e)<(r=0))return r;if(v>(c=1))return c;for(;r<c;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:c=v,v=.5*(c-r)+r}return v},q.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var Y=ce;function ce(e,t){this.x=e,this.y=t}ce.prototype={clone:function(){return new ce(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),c=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=c,this},_rotateAround:function(e,t){var r=Math.cos(e),c=Math.sin(e),v=t.y+c*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-c*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ce.convert=function(e){return e instanceof ce?e:Array.isArray(e)?new ce(e[0],e[1]):e};var ne=typeof self!="undefined"?self:{},be=Math.pow(2,53)-1;function we(e,t,r,c){var v=new z(e,t,r,c);return function(m){return v.solve(m)}}var Me=we(.25,.1,.25,1);function Kt(e,t,r){return Math.min(r,Math.max(t,e))}function Zt(e,t,r){var c=r-t,v=((e-t)%c+c)%c+t;return v===t?r:v}function Xt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var c=0,v=t;c<v.length;c+=1){var m=v[c];for(var _ in m)e[_]=m[_]}return e}var zt=1;function Lt(){return zt++}function yt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function pt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Pr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function Ht(e,t){return e.indexOf(t,e.length-t.length)!==-1}function ar(e,t,r){var c={};for(var v in e)c[v]=t.call(r||this,e[v],v,e);return c}function mt(e,t,r){var c={};for(var v in e)t.call(r||this,e[v],v,e)&&(c[v]=e[v]);return c}function Ye(e){return Array.isArray(e)?e.map(Ye):typeof e=="object"&&e?ar(e,Ye):e}var bt={};function Fe(e){bt[e]||(typeof console!="undefined"&&console.warn(e),bt[e]=!0)}function Ae(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ne(e){for(var t=0,r=0,c=e.length,v=c-1,m=void 0,_=void 0;r<c;v=r++)t+=((_=e[v]).x-(m=e[r]).x)*(m.y+_.y);return t}function xt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function nr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(c,v,m,_){var C=m||_;return t[v]=!C||C.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var re=null;function Ee(e){if(re==null){var t=e.navigator?e.navigator.userAgent:null;re=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return re}function ae(e){try{var t=ne[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var me,Te,Je,dt,$t=ne.performance&&ne.performance.now?ne.performance.now.bind(ne.performance):Date.now.bind(Date),Fr=ne.requestAnimationFrame||ne.mozRequestAnimationFrame||ne.webkitRequestAnimationFrame||ne.msRequestAnimationFrame,zr=ne.cancelAnimationFrame||ne.mozCancelAnimationFrame||ne.webkitCancelAnimationFrame||ne.msCancelAnimationFrame,ln={now:$t,frame:function(e){var t=Fr(e);return{cancel:function(){return zr(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=ne.document.createElement("canvas"),c=r.getContext("2d");if(!c)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,c.drawImage(e,0,0,e.width,e.height),c.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return me||(me=ne.document.createElement("a")),me.href=e,me.href},hardwareConcurrency:ne.navigator&&ne.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ne.devicePixelRatio},get prefersReducedMotion(){return!!ne.matchMedia&&(Te==null&&(Te=ne.matchMedia("(prefers-reduced-motion: reduce)")),Te.matches)}},tr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},oe={supported:!1,testSupport:function(e){!ge&&dt&&(Re?qe(e):Je=e)}},ge=!1,Re=!1;function qe(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,dt),e.isContextLost())return;oe.supported=!0}catch(r){}e.deleteTexture(t),ge=!0}ne.document&&((dt=ne.document.createElement("img")).onload=function(){Je&&qe(Je),Je=null,Re=!0},dt.onerror=function(){ge=!0,Je=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ct="01",kt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function S(e){return e.indexOf("mapbox:")===0}kt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ct,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},kt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},kt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},kt.prototype.normalizeStyleURL=function(e,t){if(!S(e))return e;var r=$e(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},kt.prototype.normalizeGlyphsURL=function(e,t){if(!S(e))return e;var r=$e(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},kt.prototype.normalizeSourceURL=function(e,t){if(!S(e))return e;var r=$e(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},kt.prototype.normalizeSpriteURL=function(e,t,r,c){var v=$e(e);return S(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||c)):(v.path+=""+t+r,vt(v))},kt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!S(e))return e;var r=$e(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(ln.devicePixelRatio>=2||t===512?"@2x":"")+(oe.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var c=this._customAccessToken||function(v){for(var m=0,_=v;m<_.length;m+=1){var C=_[m].match(/^access_token=(.*)$/);if(C)return C[1]}return null}(r.params)||tr.ACCESS_TOKEN;return tr.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,c)},kt.prototype.canonicalizeTileURL=function(e,t){var r=$e(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var c="mapbox://tiles/";c+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(c+="?"+v.join("&")),c},kt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&S(t),c=[],v=0,m=e.tiles||[];v<m.length;v+=1){var _=m[v];he(_)?c.push(this.canonicalizeTileURL(_,r)):c.push(_)}return c},kt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=$e(tr.API_URL);if(e.protocol=c.protocol,e.authority=c.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(c.path!=="/"&&(e.path=""+c.path+e.path),!tr.REQUIRE_ACCESS_TOKEN)return vt(e);if(!(t=t||tr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),vt(e)};var F=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function he(e){return F.test(e)}var Be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $e(e){var t=e.match(Be);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function vt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function wt(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(ne.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var H=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};H.prototype.getStorageKey=function(e){var t,r=wt(tr.ACCESS_TOKEN);return t=r&&r.u?ne.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(c,v){return String.fromCharCode(Number("0x"+v))})):tr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},H.prototype.fetchEventData=function(){var e=ae("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var c=ne.localStorage.getItem(t);c&&(this.eventData=JSON.parse(c));var v=ne.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){Fe("Unable to read from LocalStorage")}},H.prototype.saveEventData=function(){var e=ae("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{ne.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&ne.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(c){Fe("Unable to write to LocalStorage")}},H.prototype.processRequests=function(e){},H.prototype.postEvent=function(e,t,r,c){var v=this;if(tr.EVENTS_URL){var m=$e(tr.EVENTS_URL);m.params.push("access_token="+(c||tr.ACCESS_TOKEN||""));var _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Ct,userId:this.anonId},C=t?Xt(_,t):_,k={url:vt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=li(k,function(B){v.pendingRequest=null,r(B),v.saveEventData(),v.processRequests(c)})}},H.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Wt,Vt,yr=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,c,v,m){this.skuToken=v,(tr.EVENTS_URL&&m||tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(_){return S(_)||he(_)}))&&this.queueRequest({id:c,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var c=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,_=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=yt()),this.postEvent(_,{skuToken:this.skuToken},function(C){C||m&&(c.success[m]=!0)},r))}},t}(H),Er=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,c){tr.EVENTS_URL&&tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return S(v)||he(v)})&&this.queueRequest(Date.now(),c)},t.prototype.processRequests=function(r){var c=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=wt(tr.ACCESS_TOKEN),m=v?v.u:tr.ACCESS_TOKEN,_=m!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=yt(),_=!0);var C=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),B=new Date(C),W=(C-this.eventData.lastSuccess)/864e5;_=_||W>=1||W<-1||k.getDate()!==B.getDate()}else _=!0;if(!_)return this.processRequests();this.postEvent(C,{"enabled.telemetry":!1},function($){$||(c.eventData.lastSuccess=C,c.eventData.tokenU=m)},r)}},t}(H)),Ar=Er.postTurnstileEvent.bind(Er),Mr=new yr,Ke=Mr.postMapLoadEvent.bind(Mr),gt=500,ct=50;function sr(){ne.caches&&!Wt&&(Wt=ne.caches.open("mapbox-tiles"))}function Qr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var st,Mt=1/0;function Jt(){return st==null&&(st=ne.OffscreenCanvas&&new ne.OffscreenCanvas(1,1).getContext("2d")&&typeof ne.createImageBitmap=="function"),st}var mr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(mr);var gn=function(e){function t(r,c,v){c===401&&he(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=c,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Cn=xt()?function(){return self.worker&&self.worker.referrer}:function(){return(ne.location.protocol==="blob:"?ne.parent:ne).location.href},yi,Ei,Ii=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Cn())&&!/^\w+:/.test(r))){if(ne.fetch&&ne.Request&&ne.AbortController&&ne.Request.prototype.hasOwnProperty("signal"))return function(c,v){var m,_=new ne.AbortController,C=new ne.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Cn(),signal:_.signal}),k=!1,B=!1,W=(m=C.url).indexOf("sku=")>0&&he(m);c.type==="json"&&C.headers.set("Accept","application/json");var $=function(pe,Ze,We){if(!B){if(pe&&pe.message!=="SecurityError"&&Fe(pe),Ze&&We)return se(Ze);var ot=Date.now();ne.fetch(C).then(function(Qe){if(Qe.ok){var At=W?Qe.clone():null;return se(Qe,At,ot)}return v(new gn(Qe.statusText,Qe.status,c.url))}).catch(function(Qe){Qe.code!==20&&v(new Error(Qe.message))})}},se=function(pe,Ze,We){(c.type==="arrayBuffer"?pe.arrayBuffer():c.type==="json"?pe.json():pe.text()).then(function(ot){B||(Ze&&We&&function(Qe,At,Gt){if(sr(),Wt){var ir={status:At.status,statusText:At.statusText,headers:new ne.Headers};At.headers.forEach(function(Cr,tn){return ir.headers.set(tn,Cr)});var hr=nr(At.headers.get("Cache-Control")||"");hr["no-store"]||(hr["max-age"]&&ir.headers.set("Expires",new Date(Gt+1e3*hr["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-Gt<42e4||function(Cr,tn){if(Vt===void 0)try{new Response(new ReadableStream),Vt=!0}catch(pn){Vt=!1}Vt?tn(Cr.body):Cr.blob().then(tn)}(At,function(Cr){var tn=new ne.Response(Cr,ir);sr(),Wt&&Wt.then(function(pn){return pn.put(Qr(Qe.url),tn)}).catch(function(pn){return Fe(pn.message)})}))}}(C,Ze,We),k=!0,v(null,ot,pe.headers.get("Cache-Control"),pe.headers.get("Expires")))}).catch(function(ot){B||v(new Error(ot.message))})};return W?function(pe,Ze){if(sr(),!Wt)return Ze(null);var We=Qr(pe.url);Wt.then(function(ot){ot.match(We).then(function(Qe){var At=function(Gt){if(!Gt)return!1;var ir=new Date(Gt.headers.get("Expires")||0),hr=nr(Gt.headers.get("Cache-Control")||"");return ir>Date.now()&&!hr["no-cache"]}(Qe);ot.delete(We),At&&ot.put(We,Qe.clone()),Ze(null,Qe,At)}).catch(Ze)}).catch(Ze)}(C,$):$(null,null),{cancel:function(){B=!0,k||_.abort()}}}(e,t);if(xt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(c,v){var m=new ne.XMLHttpRequest;for(var _ in m.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(m.responseType="arraybuffer"),c.headers)m.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=c.credentials==="include",m.onerror=function(){v(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var C=m.response;if(c.type==="json")try{C=JSON.parse(m.response)}catch(k){return v(k)}v(null,C,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else v(new gn(m.statusText,m.status,c.url))},m.send(c.body),{cancel:function(){return m.abort()}}}(e,t)},Ji=function(e,t){return Ii(Xt(e,{type:"arrayBuffer"}),t)},li=function(e,t){return Ii(Xt(e,{method:"POST"}),t)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";yi=[],Ei=0;var I=function(e,t){if(oe.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ei>=tr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return yi.push(r),r}Ei++;var c=!1,v=function(){if(!c)for(c=!0,Ei--;yi.length&&Ei<tr.MAX_PARALLEL_IMAGE_REQUESTS;){var _=yi.shift();_.cancelled||(_.cancel=I(_.requestParameters,_.callback).cancel)}},m=Ji(e,function(_,C,k,B){v(),_?t(_):C&&(Jt()?function(W,$){var se=new ne.Blob([new Uint8Array(W)],{type:"image/png"});ne.createImageBitmap(se).then(function(pe){$(null,pe)}).catch(function(pe){$(new Error("Could not load image because of "+pe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(C,t):function(W,$,se,pe){var Ze=new ne.Image,We=ne.URL;Ze.onload=function(){$(null,Ze),We.revokeObjectURL(Ze.src),Ze.onload=null,ne.requestAnimationFrame(function(){Ze.src=G})},Ze.onerror=function(){return $(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ot=new ne.Blob([new Uint8Array(W)],{type:"image/png"});Ze.cacheControl=se,Ze.expires=pe,Ze.src=W.byteLength?We.createObjectURL(ot):G}(C,t,k,B))});return{cancel:function(){m.cancel(),v()}}};function j(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function K(e,t,r){if(r&&r[e]){var c=r[e].indexOf(t);c!==-1&&r[e].splice(c,1)}}var ie=function(e,t){t===void 0&&(t={}),Xt(this,t),this.type=e},Oe=function(e){function t(r,c){c===void 0&&(c={}),e.call(this,"error",Xt({error:r},c))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ie),He=function(){};He.prototype.on=function(e,t){return this._listeners=this._listeners||{},j(e,t,this._listeners),this},He.prototype.off=function(e,t){return K(e,t,this._listeners),K(e,t,this._oneTimeListeners),this},He.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},j(e,t,this._oneTimeListeners),this},He.prototype.fire=function(e,t){typeof e=="string"&&(e=new ie(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var c=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];c<v.length;c+=1)v[c].call(this,e);for(var m=0,_=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<_.length;m+=1){var C=_[m];K(r,C,this._oneTimeListeners),C.call(this,e)}var k=this._eventedParent;k&&(Xt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(e))}else e instanceof Oe&&console.error(e.error);return this},He.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},He.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ue={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},De=function(e,t,r,c){this.message=(e?e+": ":"")+r,c&&(this.identifier=c),t!=null&&t.__line__&&(this.line=t.__line__)};function St(e){var t=e.value;return t?[new De(e.key,t,"constants have been deprecated as of v8")]:[]}function Ir(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var c=0,v=t;c<v.length;c+=1){var m=v[c];for(var _ in m)e[_]=m[_]}return e}function Br(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function jt(e){if(Array.isArray(e))return e.map(jt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=jt(e[r]);return t}return Br(e)}var dr=function(e){function t(r,c){e.call(this,c),this.message=c,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Wr=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,c=t;r<c.length;r+=1){var v=c[r];this.bindings[v[0]]=v[1]}};Wr.prototype.concat=function(e){return new Wr(this,e)},Wr.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Wr.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var yn={kind:"null"},vr={kind:"number"},vn={kind:"string"},$r={kind:"boolean"},cn={kind:"color"},di={kind:"object"},hn={kind:"value"},bi={kind:"collator"},Qi={kind:"formatted"},_i={kind:"resolvedImage"};function Oi(e,t){return{kind:"array",itemType:e,N:t}}function Ci(e){if(e.kind==="array"){var t=Ci(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var yo=[yn,vr,vn,$r,cn,Qi,di,Oi(hn),_i];function Zi(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Zi(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,c=yo;r<c.length;r+=1)if(!Zi(c[r],t))return null}}return"Expected "+Ci(e)+" but found "+Ci(t)+" instead."}function Rn(e,t){return t.some(function(r){return r.kind===e.kind})}function Dn(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var hi=w(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(C){return(C=Math.round(C))<0?0:C>255?255:C}function v(C){return c(C[C.length-1]==="%"?parseFloat(C)/100*255:parseInt(C))}function m(C){return(k=C[C.length-1]==="%"?parseFloat(C)/100:parseFloat(C))<0?0:k>1?1:k;var k}function _(C,k,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?C+(k-C)*B*6:2*B<1?k:3*B<2?C+(k-C)*(2/3-B)*6:C}try{t.parseCSSColor=function(C){var k,B=C.replace(/ /g,"").toLowerCase();if(B in r)return r[B].slice();if(B[0]==="#")return B.length===4?(k=parseInt(B.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:B.length===7&&(k=parseInt(B.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var W=B.indexOf("("),$=B.indexOf(")");if(W!==-1&&$+1===B.length){var se=B.substr(0,W),pe=B.substr(W+1,$-(W+1)).split(","),Ze=1;switch(se){case"rgba":if(pe.length!==4)return null;Ze=m(pe.pop());case"rgb":return pe.length!==3?null:[v(pe[0]),v(pe[1]),v(pe[2]),Ze];case"hsla":if(pe.length!==4)return null;Ze=m(pe.pop());case"hsl":if(pe.length!==3)return null;var We=(parseFloat(pe[0])%360+360)%360/360,ot=m(pe[1]),Qe=m(pe[2]),At=Qe<=.5?Qe*(ot+1):Qe+ot-Qe*ot,Gt=2*Qe-At;return[c(255*_(Gt,At,We+1/3)),c(255*_(Gt,At,We)),c(255*_(Gt,At,We-1/3)),Ze];default:return null}}return null}}catch(C){}}).parseCSSColor,jn=function(e,t,r,c){c===void 0&&(c=1),this.r=e,this.g=t,this.b=r,this.a=c};jn.parse=function(e){if(e){if(e instanceof jn)return e;if(typeof e=="string"){var t=hi(e);if(t)return new jn(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},jn.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],c=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+c+")"},jn.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},jn.black=new jn(0,0,0,1),jn.white=new jn(1,1,1,1),jn.transparent=new jn(0,0,0,0),jn.red=new jn(1,0,0,1);var Oa=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Oa.prototype.compare=function(e,t){return this.collator.compare(e,t)},Oa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var hs=function(e,t,r,c,v){this.text=e,this.image=t,this.scale=r,this.fontStack=c,this.textColor=v},Li=function(e){this.sections=e};Li.fromString=function(e){return new Li([new hs(e,null,null,null,null)])},Li.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},Li.factory=function(e){return e instanceof Li?e:Li.fromString(e)},Li.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},Li.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var c=r[t];if(c.image)e.push(["image",c.image.name]);else{e.push(c.text);var v={};c.fontStack&&(v["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(v["font-scale"]=c.scale),c.textColor&&(v["text-color"]=["rgba"].concat(c.textColor.toArray())),e.push(v)}}return e};var La=function(e){this.name=e.name,this.available=e.available};function gu(e,t,r,c){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:"Invalid rgba value ["+[e,t,r,c].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof c=="number"?[e,t,r,c]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function su(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof jn||e instanceof Oa||e instanceof Li||e instanceof La)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!su(r[t]))return!1;return!0}if(typeof e=="object"){for(var c in e)if(!su(e[c]))return!1;return!0}return!1}function ga(e){if(e===null)return yn;if(typeof e=="string")return vn;if(typeof e=="boolean")return $r;if(typeof e=="number")return vr;if(e instanceof jn)return cn;if(e instanceof Oa)return bi;if(e instanceof Li)return Qi;if(e instanceof La)return _i;if(Array.isArray(e)){for(var t,r=e.length,c=0,v=e;c<v.length;c+=1){var m=ga(v[c]);if(t){if(t===m)continue;t=hn;break}t=m}return Oi(t||hn,r)}return di}function so(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof jn||e instanceof Li||e instanceof La?e.toString():JSON.stringify(e)}La.prototype.toString=function(){return this.name},La.fromString=function(e){return e?new La({name:e,available:!1}):null},La.prototype.serialize=function(){return["image",this.name]};var Ga=function(e,t){this.type=e,this.value=t};Ga.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!su(e[1]))return t.error("invalid value");var r=e[1],c=ga(r),v=t.expectedType;return c.kind!=="array"||c.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(c=v),new Ga(c,r)},Ga.prototype.evaluate=function(){return this.value},Ga.prototype.eachChild=function(){},Ga.prototype.outputDefined=function(){return!0},Ga.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof jn?["rgba"].concat(this.value.toArray()):this.value instanceof Li?this.value.serialize():this.value};var Ha=function(e){this.name="ExpressionEvaluationError",this.message=e};Ha.prototype.toJSON=function(){return this.message};var Ho={string:vn,number:vr,boolean:$r,object:di},sa=function(e,t){this.type=e,this.args=t};sa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,c=1,v=e[0];if(v==="array"){var m,_;if(e.length>2){var C=e[1];if(typeof C!="string"||!(C in Ho)||C==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Ho[C],c++}else m=hn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);_=e[2],c++}r=Oi(m,_)}else r=Ho[v];for(var k=[];c<e.length;c++){var B=t.parse(e[c],c,hn);if(!B)return null;k.push(B)}return new sa(r,k)},sa.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!Zi(this.type,ga(r)))return r;if(t===this.args.length-1)throw new Ha("Expected value to be of type "+Ci(this.type)+", but found "+Ci(ga(r))+" instead.")}return null},sa.prototype.eachChild=function(e){this.args.forEach(e)},sa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},sa.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var c=e.N;(typeof c=="number"||this.args.length>1)&&t.push(c)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Wa=function(e){this.type=Qi,this.sections=e};Wa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var c=[],v=!1,m=1;m<=e.length-1;++m){var _=e[m];if(v&&typeof _=="object"&&!Array.isArray(_)){v=!1;var C=null;if(_["font-scale"]&&!(C=t.parse(_["font-scale"],1,vr)))return null;var k=null;if(_["text-font"]&&!(k=t.parse(_["text-font"],1,Oi(vn))))return null;var B=null;if(_["text-color"]&&!(B=t.parse(_["text-color"],1,cn)))return null;var W=c[c.length-1];W.scale=C,W.font=k,W.textColor=B}else{var $=t.parse(e[m],1,hn);if(!$)return null;var se=$.type.kind;if(se!=="string"&&se!=="value"&&se!=="null"&&se!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,c.push({content:$,scale:null,font:null,textColor:null})}}return new Wa(c)},Wa.prototype.evaluate=function(e){return new Li(this.sections.map(function(t){var r=t.content.evaluate(e);return ga(r)===_i?new hs("",r,null,null,null):new hs(so(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Wa.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var c=r[t];e(c.content),c.scale&&e(c.scale),c.font&&e(c.font),c.textColor&&e(c.textColor)}},Wa.prototype.outputDefined=function(){return!1},Wa.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var c=r[t];e.push(c.content.serialize());var v={};c.scale&&(v["font-scale"]=c.scale.serialize()),c.font&&(v["text-font"]=c.font.serialize()),c.textColor&&(v["text-color"]=c.textColor.serialize()),e.push(v)}return e};var Ea=function(e){this.type=_i,this.input=e};Ea.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vn);return r?new Ea(r):t.error("No image name provided.")},Ea.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=La.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Ea.prototype.eachChild=function(e){e(this.input)},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return["image",this.input.serialize()]};var ya={"to-boolean":$r,"to-color":cn,"to-number":vr,"to-string":vn},ia=function(e,t){this.type=e,this.args=t};ia.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var c=ya[r],v=[],m=1;m<e.length;m++){var _=t.parse(e[m],m,hn);if(!_)return null;v.push(_)}return new ia(c,v)},ia.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,c=0,v=this.args;c<v.length;c+=1){if(r=null,(t=v[c].evaluate(e))instanceof jn)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":gu(t[0],t[1],t[2],t[3])))return new jn(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ha(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var _=null,C=0,k=this.args;C<k.length;C+=1){if((_=k[C].evaluate(e))===null)return 0;var B=Number(_);if(!isNaN(B))return B}throw new Ha("Could not convert "+JSON.stringify(_)+" to number.")}return this.type.kind==="formatted"?Li.fromString(so(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?La.fromString(so(this.args[0].evaluate(e))):so(this.args[0].evaluate(e))},ia.prototype.eachChild=function(e){this.args.forEach(e)},ia.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},ia.prototype.serialize=function(){if(this.type.kind==="formatted")return new Wa([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ea(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var ol=["Unknown","Point","LineString","Polygon"],ns=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ns.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ns.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ol[this.feature.type]:this.feature.type:null},ns.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ns.prototype.canonicalID=function(){return this.canonical},ns.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ns.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=jn.parse(e)),t};var to=function(e,t,r,c){this.name=e,this.type=t,this._evaluate=r,this.args=c};to.prototype.evaluate=function(e){return this._evaluate(e,this.args)},to.prototype.eachChild=function(e){this.args.forEach(e)},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},to.parse=function(e,t){var r,c=e[0],v=to.definitions[c];if(!v)return t.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,_=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,C=_.filter(function(Kn){var En=Kn[0];return!Array.isArray(En)||En.length===e.length-1}),k=null,B=0,W=C;B<W.length;B+=1){var $=W[B],se=$[0],pe=$[1];k=new pi(t.registry,t.path,null,t.scope);for(var Ze=[],We=!1,ot=1;ot<e.length;ot++){var Qe=e[ot],At=Array.isArray(se)?se[ot-1]:se.type,Gt=k.parse(Qe,1+Ze.length,At);if(!Gt){We=!0;break}Ze.push(Gt)}if(!We)if(Array.isArray(se)&&se.length!==Ze.length)k.error("Expected "+se.length+" arguments, but found "+Ze.length+" instead.");else{for(var ir=0;ir<Ze.length;ir++){var hr=Array.isArray(se)?se[ir]:se.type,Cr=Ze[ir];k.concat(ir+1).checkSubtype(hr,Cr.type)}if(k.errors.length===0)return new to(c,m,pe,Ze)}}if(C.length===1)(r=t.errors).push.apply(r,k.errors);else{for(var tn=(C.length?C:_).map(function(Kn){var En;return En=Kn[0],Array.isArray(En)?"("+En.map(Ci).join(", ")+")":"("+Ci(En.type)+"...)"}).join(" | "),pn=[],Wn=1;Wn<e.length;Wn++){var Sn=t.parse(e[Wn],1+pn.length);if(!Sn)return null;pn.push(Ci(Sn.type))}t.error("Expected arguments of type "+tn+", but found ("+pn.join(", ")+") instead.")}return null},to.register=function(e,t){for(var r in to.definitions=t,t)e[r]=to};var Aa=function(e,t,r){this.type=bi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function fa(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function fe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Pe(e,t){var r=(180+e[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(c*v*8192)]}function ft(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function ur(e,t){for(var r,c,v,m,_,C,k,B=!1,W=0,$=t.length;W<$;W++)for(var se=t[W],pe=0,Ze=se.length;pe<Ze-1;pe++){if((m=(r=e)[0]-(c=se[pe])[0])*(k=r[1]-(v=se[pe+1])[1])-(C=r[0]-v[0])*(_=r[1]-c[1])==0&&m*C<=0&&_*k<=0)return!1;ft(e,se[pe],se[pe+1])&&(B=!B)}return B}function en(e,t){for(var r=0;r<t.length;r++)if(ur(e,t[r]))return!0;return!1}function kn(e,t,r,c){var v=c[0]-r[0],m=c[1]-r[1],_=(e[0]-r[0])*m-v*(e[1]-r[1]),C=(t[0]-r[0])*m-v*(t[1]-r[1]);return _>0&&C<0||_<0&&C>0}function Vi(e,t,r){for(var c=0,v=r;c<v.length;c+=1)for(var m=v[c],_=0;_<m.length-1;++_)if(($=[(W=m[_+1])[0]-(B=m[_])[0],W[1]-B[1]])[0]*(se=[(k=t)[0]-(C=e)[0],k[1]-C[1]])[1]-$[1]*se[0]!=0&&kn(C,k,B,W)&&kn(B,W,C,k))return!0;var C,k,B,W,$,se;return!1}function qi(e,t){for(var r=0;r<e.length;++r)if(!ur(e[r],t))return!1;for(var c=0;c<e.length-1;++c)if(Vi(e[c],e[c+1],t))return!1;return!0}function Xa(e,t){for(var r=0;r<t.length;r++)if(qi(e,t[r]))return!0;return!1}function Ya(e,t,r){for(var c=[],v=0;v<e.length;v++){for(var m=[],_=0;_<e[v].length;_++){var C=Pe(e[v][_],r);fa(t,C),m.push(C)}c.push(m)}return c}function Wo(e,t,r){for(var c=[],v=0;v<e.length;v++){var m=Ya(e[v],t,r);c.push(m)}return c}function xs(e,t,r,c){if(e[0]<r[0]||e[0]>r[2]){var v=.5*c,m=e[0]-r[0]>v?-c:r[0]-e[0]>v?c:0;m===0&&(m=e[0]-r[2]>v?-c:r[2]-e[0]>v?c:0),e[0]+=m}fa(t,e)}function jl(e,t,r,c){for(var v=8192*Math.pow(2,c.z),m=[8192*c.x,8192*c.y],_=[],C=0,k=e;C<k.length;C+=1)for(var B=0,W=k[C];B<W.length;B+=1){var $=W[B],se=[$.x+m[0],$.y+m[1]];xs(se,t,r,v),_.push(se)}return _}function Ku(e,t,r,c){for(var v,m=8192*Math.pow(2,c.z),_=[8192*c.x,8192*c.y],C=[],k=0,B=e;k<B.length;k+=1){for(var W=[],$=0,se=B[k];$<se.length;$+=1){var pe=se[$],Ze=[pe.x+_[0],pe.y+_[1]];fa(t,Ze),W.push(Ze)}C.push(W)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,ot=C;We<ot.length;We+=1)for(var Qe=0,At=ot[We];Qe<At.length;Qe+=1)xs(At[Qe],t,r,m)}return C}Aa.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var c=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,$r);if(!c)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,$r);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,vn))?null:new Aa(c,v,m)},Aa.prototype.evaluate=function(e){return new Oa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},Aa.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},Aa.prototype.outputDefined=function(){return!1},Aa.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Do=function(e,t){this.type=$r,this.geojson=e,this.geometries=t};function Cs(e){if(e instanceof to&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Do)return!1;var t=!0;return e.eachChild(function(r){t&&!Cs(r)&&(t=!1)}),t}function uo(e){if(e instanceof to&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!uo(r)&&(t=!1)}),t}function Ps(e,t){if(e instanceof to&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(c){r&&!Ps(c,t)&&(r=!1)}),r}Do.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(su(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var c=0;c<r.features.length;++c){var v=r.features[c].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Do(r,r.features[c].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Do(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Do(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Do.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var c=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=Ya(r.coordinates,v,m),C=jl(t.geometry(),c,v,m);if(!fe(c,v))return!1;for(var k=0,B=C;k<B.length;k+=1)if(!ur(B[k],_))return!1}if(r.type==="MultiPolygon"){var W=Wo(r.coordinates,v,m),$=jl(t.geometry(),c,v,m);if(!fe(c,v))return!1;for(var se=0,pe=$;se<pe.length;se+=1)if(!en(pe[se],W))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var c=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var _=Ya(r.coordinates,v,m),C=Ku(t.geometry(),c,v,m);if(!fe(c,v))return!1;for(var k=0,B=C;k<B.length;k+=1)if(!qi(B[k],_))return!1}if(r.type==="MultiPolygon"){var W=Wo(r.coordinates,v,m),$=Ku(t.geometry(),c,v,m);if(!fe(c,v))return!1;for(var se=0,pe=$;se<pe.length;se+=1)if(!Xa(pe[se],W))return!1}return!0}(e,this.geometries)}return!1},Do.prototype.eachChild=function(){},Do.prototype.outputDefined=function(){return!0},Do.prototype.serialize=function(){return["within",this.geojson]};var Ca=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Ca.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new Ca(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Ca.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Ca.prototype.eachChild=function(){},Ca.prototype.outputDefined=function(){return!1},Ca.prototype.serialize=function(){return["var",this.name]};var pi=function(e,t,r,c,v){t===void 0&&(t=[]),c===void 0&&(c=new Wr),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(m){return"["+m+"]"}).join(""),this.scope=c,this.errors=v,this.expectedType=r};function sl(e,t){for(var r,c=e.length-1,v=0,m=c,_=0;v<=m;)if((r=e[_=Math.floor((v+m)/2)])<=t){if(_===c||t<e[_+1])return _;v=_+1}else{if(!(r>t))throw new Ha("Input is not a number.");m=_-1}return 0}pi.prototype.parse=function(e,t,r,c,v){return v===void 0&&(v={}),t?this.concat(t,r,c)._parse(e,v):this._parse(e,v)},pi.prototype._parse=function(e,t){function r(B,W,$){return $==="assert"?new sa(W,[B]):$==="coerce"?new ia(W,[B]):B}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var c=e[0];if(typeof c!="string")return this.error("Expression name must be a string, but found "+typeof c+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[c];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var _=this.expectedType,C=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||C.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(_,C))return null}else m=r(m,_,t.typeAnnotation||"coerce");else m=r(m,_,t.typeAnnotation||"assert")}if(!(m instanceof Ga)&&m.type.kind!=="resolvedImage"&&function B(W){if(W instanceof Ca)return B(W.boundExpression);if(W instanceof to&&W.name==="error"||W instanceof Aa||W instanceof Do)return!1;var $=W instanceof ia||W instanceof sa,se=!0;return W.eachChild(function(pe){se=$?se&&B(pe):se&&pe instanceof Ga}),!!se&&Cs(W)&&Ps(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var k=new ns;try{m=new Ga(m.type,m.evaluate(k))}catch(B){return this.error(B.message),null}}return m}return this.error('Unknown expression "'+c+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},pi.prototype.concat=function(e,t,r){var c=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new pi(this.registry,c,t||null,v,this.errors)},pi.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var c=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new dr(c,e))},pi.prototype.checkSubtype=function(e,t){var r=Zi(e,t);return r&&this.error(r),r};var Ra=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var c=0,v=r;c<v.length;c+=1){var m=v[c],_=m[1];this.labels.push(m[0]),this.outputs.push(_)}};function zn(e,t,r){return e*(1-r)+t*r}Ra.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,vr);if(!r)return null;var c=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var _=m===1?-1/0:e[m],C=e[m+1],k=m,B=m+1;if(typeof _!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=_)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var W=t.parse(C,B,v);if(!W)return null;v=v||W.type,c.push([_,W])}return new Ra(v,r,c)},Ra.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var c=this.input.evaluate(e);if(c<=t[0])return r[0].evaluate(e);var v=t.length;return c>=t[v-1]?r[v-1].evaluate(e):r[sl(t,c)].evaluate(e)},Ra.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ra.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ra.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Ks=Object.freeze({__proto__:null,number:zn,color:function(e,t,r){return new jn(zn(e.r,t.r,r),zn(e.g,t.g,r),zn(e.b,t.b,r),zn(e.a,t.a,r))},array:function(e,t,r){return e.map(function(c,v){return zn(c,t[v],r)})}}),Zl=6/29*3*(6/29),lo=Math.PI/180,je=180/Math.PI;function Tt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Zl+4/29}function gr(e){return e>6/29?e*e*e:Zl*(e-4/29)}function In(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Yi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function _a(e){var t=Yi(e.r),r=Yi(e.g),c=Yi(e.b),v=Tt((.4124564*t+.3575761*r+.1804375*c)/.95047),m=Tt((.2126729*t+.7151522*r+.072175*c)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Tt((.0193339*t+.119192*r+.9503041*c)/1.08883)),alpha:e.a}}function Ba(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,c=isNaN(e.b)?t:t-e.b/200;return t=1*gr(t),r=.95047*gr(r),c=1.08883*gr(c),new jn(In(3.2404542*r-1.5371385*t-.4985314*c),In(-.969266*r+1.8760108*t+.041556*c),In(.0556434*r-.2040259*t+1.0572252*c),e.alpha)}function aa(e,t,r){var c=t-e;return e+r*(c>180||c<-180?c-360*Math.round(c/360):c)}var Pa={forward:_a,reverse:Ba,interpolate:function(e,t,r){return{l:zn(e.l,t.l,r),a:zn(e.a,t.a,r),b:zn(e.b,t.b,r),alpha:zn(e.alpha,t.alpha,r)}}},ko={forward:function(e){var t=_a(e),r=t.l,c=t.a,v=t.b,m=Math.atan2(v,c)*je;return{h:m<0?m+360:m,c:Math.sqrt(c*c+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*lo,r=e.c;return Ba({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:aa(e.h,t.h,r),c:zn(e.c,t.c,r),l:zn(e.l,t.l,r),alpha:zn(e.alpha,t.alpha,r)}}},Mo=Object.freeze({__proto__:null,lab:Pa,hcl:ko}),Ri=function(e,t,r,c,v){this.type=e,this.operator=t,this.interpolation=r,this.input=c,this.labels=[],this.outputs=[];for(var m=0,_=v;m<_.length;m+=1){var C=_[m],k=C[1];this.labels.push(C[0]),this.outputs.push(k)}};function wl(e,t,r,c){var v=c-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}Ri.interpolationFactor=function(e,t,r,c){var v=0;if(e.name==="exponential")v=wl(t,e.base,r,c);else if(e.name==="linear")v=wl(t,1,r,c);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new z(m[0],m[1],m[2],m[3]).solve(wl(t,1,r,c))}return v},Ri.parse=function(e,t){var r=e[0],c=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(c)||c.length===0)return t.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){var _=c[1];if(typeof _!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:_}}else{if(c[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(c[0]),1,0);var C=c.slice(1);if(C.length!==4||C.some(function(ot){return typeof ot!="number"||ot<0||ot>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,vr)))return null;var k=[],B=null;r==="interpolate-hcl"||r==="interpolate-lab"?B=cn:t.expectedType&&t.expectedType.kind!=="value"&&(B=t.expectedType);for(var W=0;W<m.length;W+=2){var $=m[W],se=m[W+1],pe=W+3,Ze=W+4;if(typeof $!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',pe);if(k.length&&k[k.length-1][0]>=$)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',pe);var We=t.parse(se,Ze,B);if(!We)return null;B=B||We.type,k.push([$,We])}return B.kind==="number"||B.kind==="color"||B.kind==="array"&&B.itemType.kind==="number"&&typeof B.N=="number"?new Ri(B,r,c,v,k):t.error("Type "+Ci(B)+" is not interpolatable.")},Ri.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var c=this.input.evaluate(e);if(c<=t[0])return r[0].evaluate(e);var v=t.length;if(c>=t[v-1])return r[v-1].evaluate(e);var m=sl(t,c),_=Ri.interpolationFactor(this.interpolation,c,t[m],t[m+1]),C=r[m].evaluate(e),k=r[m+1].evaluate(e);return this.operator==="interpolate"?Ks[this.type.kind.toLowerCase()](C,k,_):this.operator==="interpolate-hcl"?ko.reverse(ko.interpolate(ko.forward(C),ko.forward(k),_)):Pa.reverse(Pa.interpolate(Pa.forward(C),Pa.forward(k),_))},Ri.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Ri.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Ri.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Us=function(e,t){this.type=e,this.args=t};Us.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,c=t.expectedType;c&&c.kind!=="value"&&(r=c);for(var v=[],m=0,_=e.slice(1);m<_.length;m+=1){var C=t.parse(_[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!C)return null;r=r||C.type,v.push(C)}var k=c&&v.some(function(B){return Zi(c,B.type)});return new Us(k?hn:r,v)},Us.prototype.evaluate=function(e){for(var t,r=null,c=0,v=0,m=this.args;v<m.length&&(c++,(r=m[v].evaluate(e))&&r instanceof La&&!r.available&&(t||(t=r.name),r=null,c===this.args.length&&(r=t)),r===null);v+=1);return r},Us.prototype.eachChild=function(e){this.args.forEach(e)},Us.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Us.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ps=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};ps.prototype.evaluate=function(e){return this.result.evaluate(e)},ps.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},ps.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],c=1;c<e.length-1;c+=2){var v=e[c];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",c);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",c);var m=t.parse(e[c+1],c+1);if(!m)return null;r.push([v,m])}var _=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return _?new ps(r,_):null},ps.prototype.outputDefined=function(){return this.result.outputDefined()},ps.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var c=r[t];e.push(c[0],c[1].serialize())}return e.push(this.result.serialize()),e};var Vl=function(e,t,r){this.type=e,this.index=t,this.input=r};Vl.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,vr),c=t.parse(e[2],2,Oi(t.expectedType||hn));return r&&c?new Vl(c.type.itemType,r,c):null},Vl.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ha("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Ha("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Ha("Array index must be an integer, but found "+t+" instead.");return r[t]},Vl.prototype.eachChild=function(e){e(this.index),e(this.input)},Vl.prototype.outputDefined=function(){return!1},Vl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var co=function(e,t){this.type=$r,this.needle=e,this.haystack=t};co.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),c=t.parse(e[2],2,hn);return r&&c?Rn(r.type,[$r,vn,vr,yn,hn])?new co(r,c):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ci(r.type)+" instead"):null},co.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Dn(t,["boolean","string","number","null"]))throw new Ha("Expected first argument to be of type boolean, string, number or null, but found "+Ci(ga(t))+" instead.");if(!Dn(r,["string","array"]))throw new Ha("Expected second argument to be of type array or string, but found "+Ci(ga(r))+" instead.");return r.indexOf(t)>=0},co.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},co.prototype.outputDefined=function(){return!0},co.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var is=function(e,t,r){this.type=vr,this.needle=e,this.haystack=t,this.fromIndex=r};is.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),c=t.parse(e[2],2,hn);if(!r||!c)return null;if(!Rn(r.type,[$r,vn,vr,yn,hn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Ci(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,vr);return v?new is(r,c,v):null}return new is(r,c)},is.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Dn(t,["boolean","string","number","null"]))throw new Ha("Expected first argument to be of type boolean, string, number or null, but found "+Ci(ga(t))+" instead.");if(!Dn(r,["string","array"]))throw new Ha("Expected second argument to be of type array or string, but found "+Ci(ga(r))+" instead.");if(this.fromIndex){var c=this.fromIndex.evaluate(e);return r.indexOf(t,c)}return r.indexOf(t)},is.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},is.prototype.outputDefined=function(){return!1},is.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var as=function(e,t,r,c,v,m){this.inputType=e,this.type=t,this.input=r,this.cases=c,this.outputs=v,this.otherwise=m};as.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,c;t.expectedType&&t.expectedType.kind!=="value"&&(c=t.expectedType);for(var v={},m=[],_=2;_<e.length-1;_+=2){var C=e[_],k=e[_+1];Array.isArray(C)||(C=[C]);var B=t.concat(_);if(C.length===0)return B.error("Expected at least one branch label.");for(var W=0,$=C;W<$.length;W+=1){var se=$[W];if(typeof se!="number"&&typeof se!="string")return B.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return B.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof se=="number"&&Math.floor(se)!==se)return B.error("Numeric branch labels must be integer values.");if(r){if(B.checkSubtype(r,ga(se)))return null}else r=ga(se);if(v[String(se)]!==void 0)return B.error("Branch labels must be unique.");v[String(se)]=m.length}var pe=t.parse(k,_,c);if(!pe)return null;c=c||pe.type,m.push(pe)}var Ze=t.parse(e[1],1,hn);if(!Ze)return null;var We=t.parse(e[e.length-1],e.length-1,c);return We?Ze.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ze.type)?null:new as(r,c,Ze,v,m,We):null},as.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(ga(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},as.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},as.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},as.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],c={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var _=m[v];($=c[this.cases[_]])===void 0?(c[this.cases[_]]=r.length,r.push([this.cases[_],[_]])):r[$][1].push(_)}for(var C=function(pe){return e.inputType.kind==="number"?Number(pe):pe},k=0,B=r;k<B.length;k+=1){var W=B[k],$=W[0],se=W[1];t.push(se.length===1?C(se[0]):se.map(C)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var uu=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};uu.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var c=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,$r);if(!m)return null;var _=t.parse(e[v+1],v+1,r);if(!_)return null;c.push([m,_]),r=r||_.type}var C=t.parse(e[e.length-1],e.length-1,r);return C?new uu(r,c,C):null},uu.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var c=r[t],v=c[1];if(c[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},uu.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var c=r[t],v=c[1];e(c[0]),e(v)}e(this.otherwise)},uu.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},uu.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ms=function(e,t,r,c){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=c};function pc(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function vf(e,t,r,c){return c.compare(t,r)===0}function xa(e,t,r){var c=e!=="=="&&e!=="!=";return function(){function v(m,_,C){this.type=$r,this.lhs=m,this.rhs=_,this.collator=C,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}return v.parse=function(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");var C=m[0],k=_.parse(m[1],1,hn);if(!k)return null;if(!pc(C,k.type))return _.concat(1).error('"'+C+`" comparisons are not supported for type '`+Ci(k.type)+"'.");var B=_.parse(m[2],2,hn);if(!B)return null;if(!pc(C,B.type))return _.concat(2).error('"'+C+`" comparisons are not supported for type '`+Ci(B.type)+"'.");if(k.type.kind!==B.type.kind&&k.type.kind!=="value"&&B.type.kind!=="value")return _.error("Cannot compare types '"+Ci(k.type)+"' and '"+Ci(B.type)+"'.");c&&(k.type.kind==="value"&&B.type.kind!=="value"?k=new sa(B.type,[k]):k.type.kind!=="value"&&B.type.kind==="value"&&(B=new sa(k.type,[B])));var W=null;if(m.length===4){if(k.type.kind!=="string"&&B.type.kind!=="string"&&k.type.kind!=="value"&&B.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(!(W=_.parse(m[3],3,bi)))return null}return new v(k,B,W)},v.prototype.evaluate=function(m){var _=this.lhs.evaluate(m),C=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){var k=ga(_),B=ga(C);if(k.kind!==B.kind||k.kind!=="string"&&k.kind!=="number")throw new Ha('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+k.kind+", "+B.kind+") instead.")}if(this.collator&&!c&&this.hasUntypedArgument){var W=ga(_),$=ga(C);if(W.kind!=="string"||$.kind!=="string")return t(m,_,C)}return this.collator?r(m,_,C,this.collator.evaluate(m)):t(m,_,C)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(_){m.push(_.serialize())}),m},v}()}Ms.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,hn),c=t.parse(e[2],2,vr);if(!r||!c)return null;if(!Rn(r.type,[Oi(hn),vn,hn]))return t.error("Expected first argument to be of type array or string, but found "+Ci(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,vr);return v?new Ms(r.type,r,c,v):null}return new Ms(r.type,r,c)},Ms.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Dn(t,["string","array"]))throw new Ha("Expected first argument to be of type array or string, but found "+Ci(ga(t))+" instead.");if(this.endIndex){var c=this.endIndex.evaluate(e);return t.slice(r,c)}return t.slice(r)},Ms.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var mf=xa("==",function(e,t,r){return t===r},vf),lu=xa("!=",function(e,t,r){return t!==r},function(e,t,r,c){return!vf(0,t,r,c)}),Gl=xa("<",function(e,t,r){return t<r},function(e,t,r,c){return c.compare(t,r)<0}),Ic=xa(">",function(e,t,r){return t>r},function(e,t,r,c){return c.compare(t,r)>0}),Oc=xa("<=",function(e,t,r){return t<=r},function(e,t,r,c){return c.compare(t,r)<=0}),ro=xa(">=",function(e,t,r){return t>=r},function(e,t,r,c){return c.compare(t,r)>=0}),yu=function(e,t,r,c,v){this.type=vn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=c,this.maxFractionDigits=v};yu.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vr);if(!r)return null;var c=e[2];if(typeof c!="object"||Array.isArray(c))return t.error("NumberFormat options argument must be an object.");var v=null;if(c.locale&&!(v=t.parse(c.locale,1,vn)))return null;var m=null;if(c.currency&&!(m=t.parse(c.currency,1,vn)))return null;var _=null;if(c["min-fraction-digits"]&&!(_=t.parse(c["min-fraction-digits"],1,vr)))return null;var C=null;return c["max-fraction-digits"]&&!(C=t.parse(c["max-fraction-digits"],1,vr))?null:new yu(r,v,m,_,C)},yu.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},yu.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var $u=function(e){this.type=vr,this.input=e};$u.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Ci(r.type)+" instead."):new $u(r):null},$u.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Ha("Expected value to be of type string or array, but found "+Ci(ga(t))+" instead.")},$u.prototype.eachChild=function(e){e(this.input)},$u.prototype.outputDefined=function(){return!1},$u.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ua={"==":mf,"!=":lu,">":Ic,"<":Gl,">=":ro,"<=":Oc,array:sa,at:Vl,boolean:sa,case:uu,coalesce:Us,collator:Aa,format:Wa,image:Ea,in:co,"index-of":is,interpolate:Ri,"interpolate-hcl":Ri,"interpolate-lab":Ri,length:$u,let:ps,literal:Ga,match:as,number:sa,"number-format":yu,object:sa,slice:Ms,step:Ra,string:sa,"to-boolean":ia,"to-color":ia,"to-number":ia,"to-string":ia,var:Ca,within:Do};function Lc(e,t){var r=t[0],c=t[1],v=t[2],m=t[3];r=r.evaluate(e),c=c.evaluate(e),v=v.evaluate(e);var _=m?m.evaluate(e):1,C=gu(r,c,v,_);if(C)throw new Ha(C);return new jn(r/255*_,c/255*_,v/255*_,_)}function Tl(e,t){return e in t}function Ou(e,t){var r=t[e];return r===void 0?null:r}function ul(e){return{type:e}}function Hl(e){return{result:"success",value:e}}function Ju(e){return{result:"error",value:e}}function Is(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Al(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Cl(e){return!!e.expression&&e.expression.interpolated}function Ui(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function dc(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function gf(e){return e}function Wl(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function Jc(e,t,r,c,v){return Wl(typeof r===v?c[r]:void 0,e.default,t.default)}function Rc(e,t,r){if(Ui(r)!=="number")return Wl(e.default,t.default);var c=e.stops.length;if(c===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[c-1][0])return e.stops[c-1][1];var v=sl(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function Xl(e,t,r){var c=e.base!==void 0?e.base:1;if(Ui(r)!=="number")return Wl(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=sl(e.stops.map(function($){return $[0]}),r),_=function($,se,pe,Ze){var We=Ze-pe,ot=$-pe;return We===0?0:se===1?ot/We:(Math.pow(se,ot)-1)/(Math.pow(se,We)-1)}(r,c,e.stops[m][0],e.stops[m+1][0]),C=e.stops[m][1],k=e.stops[m+1][1],B=Ks[t.type]||gf;if(e.colorSpace&&e.colorSpace!=="rgb"){var W=Mo[e.colorSpace];B=function($,se){return W.reverse(W.interpolate(W.forward($),W.forward(se),_))}}return typeof C.evaluate=="function"?{evaluate:function(){for(var $=[],se=arguments.length;se--;)$[se]=arguments[se];var pe=C.evaluate.apply(void 0,$),Ze=k.evaluate.apply(void 0,$);if(pe!==void 0&&Ze!==void 0)return B(pe,Ze,_)}}:B(C,k,_)}function Yl(e,t,r){return t.type==="color"?r=jn.parse(r):t.type==="formatted"?r=Li.fromString(r.toString()):t.type==="resolvedImage"?r=La.fromString(r.toString()):Ui(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Wl(r,e.default,t.default)}to.register(Ua,{error:[{kind:"error"},[vn],function(e,t){throw new Ha(t[0].evaluate(e))}],typeof:[vn,[hn],function(e,t){return Ci(ga(t[0].evaluate(e)))}],"to-rgba":[Oi(vr,4),[cn],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[cn,[vr,vr,vr],Lc],rgba:[cn,[vr,vr,vr,vr],Lc],has:{type:$r,overloads:[[[vn],function(e,t){return Tl(t[0].evaluate(e),e.properties())}],[[vn,di],function(e,t){var r=t[1];return Tl(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:hn,overloads:[[[vn],function(e,t){return Ou(t[0].evaluate(e),e.properties())}],[[vn,di],function(e,t){var r=t[1];return Ou(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[hn,[vn],function(e,t){return Ou(t[0].evaluate(e),e.featureState||{})}],properties:[di,[],function(e){return e.properties()}],"geometry-type":[vn,[],function(e){return e.geometryType()}],id:[hn,[],function(e){return e.id()}],zoom:[vr,[],function(e){return e.globals.zoom}],"heatmap-density":[vr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[vr,[],function(e){return e.globals.lineProgress||0}],accumulated:[hn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[vr,ul(vr),function(e,t){for(var r=0,c=0,v=t;c<v.length;c+=1)r+=v[c].evaluate(e);return r}],"*":[vr,ul(vr),function(e,t){for(var r=1,c=0,v=t;c<v.length;c+=1)r*=v[c].evaluate(e);return r}],"-":{type:vr,overloads:[[[vr,vr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[vr],function(e,t){return-t[0].evaluate(e)}]]},"/":[vr,[vr,vr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[vr,[vr,vr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[vr,[],function(){return Math.LN2}],pi:[vr,[],function(){return Math.PI}],e:[vr,[],function(){return Math.E}],"^":[vr,[vr,vr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[vr,[vr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[vr,[vr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[vr,[vr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[vr,[vr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[vr,[vr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[vr,[vr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[vr,[vr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[vr,[vr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[vr,[vr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[vr,[vr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[vr,ul(vr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[vr,ul(vr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[vr,[vr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[vr,[vr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[vr,[vr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[vr,[vr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[$r,[vn,hn],function(e,t){var r=t[0],c=t[1];return e.properties()[r.value]===c.value}],"filter-id-==":[$r,[hn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[$r,[vn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[$r,[vn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v<m}],"filter-id-<":[$r,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c<v}],"filter->":[$r,[vn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v>m}],"filter-id->":[$r,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c>v}],"filter-<=":[$r,[vn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[$r,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c<=v}],"filter->=":[$r,[vn,hn],function(e,t){var r=t[0],c=t[1],v=e.properties()[r.value],m=c.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[$r,[hn],function(e,t){var r=t[0],c=e.id(),v=r.value;return typeof c==typeof v&&c>=v}],"filter-has":[$r,[hn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[$r,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[$r,[Oi(vn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[$r,[Oi(hn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[$r,[vn,Oi(hn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[$r,[vn,Oi(hn)],function(e,t){var r=t[0],c=t[1];return function(v,m,_,C){for(;_<=C;){var k=_+C>>1;if(m[k]===v)return!0;m[k]>v?C=k-1:_=k+1}return!1}(e.properties()[r.value],c.value,0,c.value.length-1)}],all:{type:$r,overloads:[[[$r,$r],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[ul($r),function(e,t){for(var r=0,c=t;r<c.length;r+=1)if(!c[r].evaluate(e))return!1;return!0}]]},any:{type:$r,overloads:[[[$r,$r],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[ul($r),function(e,t){for(var r=0,c=t;r<c.length;r+=1)if(c[r].evaluate(e))return!0;return!1}]]},"!":[$r,[$r],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[$r,[vn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[vn,ul(hn),function(e,t){return t.map(function(r){return so(r.evaluate(e))}).join("")}],"resolved-locale":[vn,[bi],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var ll=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new ns,this._defaultValue=t?function(r){return r.type==="color"&&dc(r.default)?new jn(0,0,0,0):r.type==="color"?jn.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Lu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Ua}function Pl(e,t){var r=new pi(Ua,[],t?function(v){var m={color:cn,string:vn,number:vr,enum:vn,boolean:$r,formatted:Qi,resolvedImage:_i};return v.type==="array"?Oi(m[v.value]||hn,v.length):m[v.type]}(t):void 0),c=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Hl(new ll(c,t)):Ju(r.errors)}ll.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=c,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},ll.prototype.evaluate=function(e,t,r,c,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=c,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new Ha("Expected value to be one of "+Object.keys(this._enumValues).map(function(C){return JSON.stringify(C)}).join(", ")+", but found "+JSON.stringify(_)+" instead.");return _}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console!="undefined"&&console.warn(C.message)),this._defaultValue}};var cl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!uo(t.expression)};cl.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,c,v,m)},cl.prototype.evaluate=function(e,t,r,c,v,m){return this._styleExpression.evaluate(e,t,r,c,v,m)};var cu=function(e,t,r,c){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!uo(t.expression),this.interpolationType=c};function Dc(e,t){if((e=Pl(e,t)).result==="error")return e;var r=e.value.expression,c=Cs(r);if(!c&&!Is(t))return Ju([new dr("","data expressions not supported")]);var v=Ps(r,["zoom"]);if(!v&&!Al(t))return Ju([new dr("","zoom expressions not supported")]);var m=function _(C){var k=null;if(C instanceof ps)k=_(C.result);else if(C instanceof Us)for(var B=0,W=C.args;B<W.length&&!(k=_(W[B]));B+=1);else(C instanceof Ra||C instanceof Ri)&&C.input instanceof to&&C.input.name==="zoom"&&(k=C);return k instanceof dr||C.eachChild(function($){var se=_($);se instanceof dr?k=se:!k&&se?k=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&se&&k!==se&&(k=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(r);return m||v?m instanceof dr?Ju([m]):m instanceof Ri&&!Cl(t)?Ju([new dr("",'"interpolate" expressions cannot be used with this property')]):Hl(m?new cu(c?"camera":"composite",e.value,m.labels,m instanceof Ri?m.interpolation:void 0):new cl(c?"constant":"source",e.value)):Ju([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}cu.prototype.evaluateWithoutErrorHandling=function(e,t,r,c,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,c,v,m)},cu.prototype.evaluate=function(e,t,r,c,v,m){return this._styleExpression.evaluate(e,t,r,c,v,m)},cu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Ri.interpolationFactor(this.interpolationType,e,t,r):0};var Ml=function(e,t){this._parameters=e,this._specification=t,Ir(this,function r(c,v){var m,_,C,k=v.type==="color",B=c.stops&&typeof c.stops[0][0]=="object",W=B||!(B||c.property!==void 0),$=c.type||(Cl(v)?"exponential":"interval");if(k&&((c=Ir({},c)).stops&&(c.stops=c.stops.map(function(Sn){return[Sn[0],jn.parse(Sn[1])]})),c.default=jn.parse(c.default?c.default:v.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!Mo[c.colorSpace])throw new Error("Unknown color space: "+c.colorSpace);if($==="exponential")m=Xl;else if($==="interval")m=Rc;else if($==="categorical"){m=Jc,_=Object.create(null);for(var se=0,pe=c.stops;se<pe.length;se+=1){var Ze=pe[se];_[Ze[0]]=Ze[1]}C=typeof c.stops[0][0]}else{if($!=="identity")throw new Error('Unknown function type "'+$+'"');m=Yl}if(B){for(var We={},ot=[],Qe=0;Qe<c.stops.length;Qe++){var At=c.stops[Qe],Gt=At[0].zoom;We[Gt]===void 0&&(We[Gt]={zoom:Gt,type:c.type,property:c.property,default:c.default,stops:[]},ot.push(Gt)),We[Gt].stops.push([At[0].value,At[1]])}for(var ir=[],hr=0,Cr=ot;hr<Cr.length;hr+=1){var tn=Cr[hr];ir.push([We[tn].zoom,r(We[tn],v)])}var pn={name:"linear"};return{kind:"composite",interpolationType:pn,interpolationFactor:Ri.interpolationFactor.bind(void 0,pn),zoomStops:ir.map(function(Sn){return Sn[0]}),evaluate:function(Sn,Kn){var En=Sn.zoom;return Xl({stops:ir,base:c.base},v,En).evaluate(En,Kn)}}}if(W){var Wn=$==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:Wn,interpolationFactor:Ri.interpolationFactor.bind(void 0,Wn),zoomStops:c.stops.map(function(Sn){return Sn[0]}),evaluate:function(Sn){return m(c,v,Sn.zoom,_,C)}}}return{kind:"source",evaluate:function(Sn,Kn){var En=Kn&&Kn.properties?Kn.properties[c.property]:void 0;return En===void 0?Wl(c.default,v.default):m(c,v,En,_,C)}}}(this._parameters,this._specification))};function $s(e){var t=e.key,r=e.value,c=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,_=e.styleSpec,C=[],k=Ui(r);if(k!=="object")return[new De(t,r,"object expected, "+k+" found")];for(var B in r){var W=B.split(".")[0],$=c[W]||c["*"],se=void 0;if(v[W])se=v[W];else if(c[W])se=Fi;else if(v["*"])se=v["*"];else{if(!c["*"]){C.push(new De(t,r[B],'unknown property "'+B+'"'));continue}se=Fi}C=C.concat(se({key:(t&&t+".")+B,value:r[B],valueSpec:$,style:m,styleSpec:_,object:r,objectKey:B},r))}for(var pe in c)v[pe]||c[pe].required&&c[pe].default===void 0&&r[pe]===void 0&&C.push(new De(t,r,'missing required property "'+pe+'"'));return C}function Qc(e){var t=e.value,r=e.valueSpec,c=e.style,v=e.styleSpec,m=e.key,_=e.arrayElementValidator||Fi;if(Ui(t)!=="array")return[new De(m,t,"array expected, "+Ui(t)+" found")];if(r.length&&t.length!==r.length)return[new De(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new De(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var C={type:r.value,values:r.values};v.$version<7&&(C.function=r.function),Ui(r.value)==="object"&&(C=r.value);for(var k=[],B=0;B<t.length;B++)k=k.concat(_({array:t,arrayIndex:B,value:t[B],valueSpec:C,style:c,styleSpec:v,key:m+"["+B+"]"}));return k}function yf(e){var t=e.key,r=e.value,c=e.valueSpec,v=Ui(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new De(t,r,"number expected, "+v+" found")]:"minimum"in c&&r<c.minimum?[new De(t,r,r+" is less than the minimum value "+c.minimum)]:"maximum"in c&&r>c.maximum?[new De(t,r,r+" is greater than the maximum value "+c.maximum)]:[]}function qc(e){var t,r,c,v=e.valueSpec,m=Br(e.value.type),_={},C=m!=="categorical"&&e.value.property===void 0,k=!C,B=Ui(e.value.stops)==="array"&&Ui(e.value.stops[0])==="array"&&Ui(e.value.stops[0][0])==="object",W=$s({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(pe){if(m==="identity")return[new De(pe.key,pe.value,'identity function may not have a "stops" property')];var Ze=[],We=pe.value;return Ze=Ze.concat(Qc({key:pe.key,value:We,valueSpec:pe.valueSpec,style:pe.style,styleSpec:pe.styleSpec,arrayElementValidator:$})),Ui(We)==="array"&&We.length===0&&Ze.push(new De(pe.key,We,"array must have at least one stop")),Ze},default:function(pe){return Fi({key:pe.key,value:pe.value,valueSpec:v,style:pe.style,styleSpec:pe.styleSpec})}}});return m==="identity"&&C&&W.push(new De(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||W.push(new De(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!Cl(e.valueSpec)&&W.push(new De(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(k&&!Is(e.valueSpec)?W.push(new De(e.key,e.value,"property functions not supported")):C&&!Al(e.valueSpec)&&W.push(new De(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!B||e.value.property!==void 0||W.push(new De(e.key,e.value,'"property" property is required')),W;function $(pe){var Ze=[],We=pe.value,ot=pe.key;if(Ui(We)!=="array")return[new De(ot,We,"array expected, "+Ui(We)+" found")];if(We.length!==2)return[new De(ot,We,"array length 2 expected, length "+We.length+" found")];if(B){if(Ui(We[0])!=="object")return[new De(ot,We,"object expected, "+Ui(We[0])+" found")];if(We[0].zoom===void 0)return[new De(ot,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new De(ot,We,"object stop key must have value")];if(c&&c>Br(We[0].zoom))return[new De(ot,We[0].zoom,"stop zoom values must appear in ascending order")];Br(We[0].zoom)!==c&&(c=Br(We[0].zoom),r=void 0,_={}),Ze=Ze.concat($s({key:ot+"[0]",value:We[0],valueSpec:{zoom:{}},style:pe.style,styleSpec:pe.styleSpec,objectElementValidators:{zoom:yf,value:se}}))}else Ze=Ze.concat(se({key:ot+"[0]",value:We[0],valueSpec:{},style:pe.style,styleSpec:pe.styleSpec},We));return Lu(jt(We[1]))?Ze.concat([new De(ot+"[1]",We[1],"expressions are not allowed in function stops.")]):Ze.concat(Fi({key:ot+"[1]",value:We[1],valueSpec:v,style:pe.style,styleSpec:pe.styleSpec}))}function se(pe,Ze){var We=Ui(pe.value),ot=Br(pe.value),Qe=pe.value!==null?pe.value:Ze;if(t){if(We!==t)return[new De(pe.key,Qe,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new De(pe.key,Qe,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&m!=="categorical"){var At="number expected, "+We+" found";return Is(v)&&m===void 0&&(At+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(pe.key,Qe,At)]}return m!=="categorical"||We!=="number"||isFinite(ot)&&Math.floor(ot)===ot?m!=="categorical"&&We==="number"&&r!==void 0&&ot<r?[new De(pe.key,Qe,"stop domain values must appear in ascending order")]:(r=ot,m==="categorical"&&ot in _?[new De(pe.key,Qe,"stop domain values must be unique")]:(_[ot]=!0,[])):[new De(pe.key,Qe,"integer expected, found "+ot)]}}function ba(e){var t=(e.expressionContext==="property"?Dc:Pl)(jt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(c){return new De(""+e.key+c.key,e.value,c.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new De(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!uo(r))return[new De(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!uo(r))return[new De(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Ps(r,["zoom","feature-state"]))return[new De(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Cs(r))return[new De(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Il(e){var t=e.key,r=e.value,c=e.valueSpec,v=[];return Array.isArray(c.values)?c.values.indexOf(Br(r))===-1&&v.push(new De(t,r,"expected one of ["+c.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(c.values).indexOf(Br(r))===-1&&v.push(new De(t,r,"expected one of ["+Object.keys(c.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Ol(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var c=r[t];if(!Ol(c)&&typeof c!="boolean")return!1}return!0;default:return!0}}Ml.deserialize=function(e){return new Ml(e._parameters,e._specification)},Ml.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var Ru={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Ol(e)||(e=Du(e));var t=Pl(e,Ru);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,c,v){return t.value.evaluate(r,c,{},v)},needGeometry:function r(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(var v=1;v<c.length;v++)if(r(c[v]))return!0;return!1}(e)}}function vc(e,t){return e<t?-1:e>t?1:0}function Du(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?kc(e[1],e[2],"=="):r==="!="?Ll(kc(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?kc(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Du))):r==="all"?["all"].concat(e.slice(1).map(Du)):r==="none"?["all"].concat(e.slice(1).map(Du).map(Ll)):r==="in"?ef(e[1],e.slice(2)):r==="!in"?Ll(ef(e[1],e.slice(2))):r==="has"?tf(e[1]):r==="!has"?Ll(tf(e[1])):r!=="within"||e}function kc(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function ef(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(vc)]]:["filter-in-small",e,["literal",t]]}}function tf(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ll(e){return["!",e]}function zc(e){return Ol(jt(e.value))?ba(Ir({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var c=r.value,v=r.key;if(Ui(c)!=="array")return[new De(v,c,"array expected, "+Ui(c)+" found")];var m,_=r.styleSpec,C=[];if(c.length<1)return[new De(v,c,"filter array must have at least 1 element")];switch(C=C.concat(Il({key:v+"[0]",value:c[0],valueSpec:_.filter_operator,style:r.style,styleSpec:r.styleSpec})),Br(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Br(c[1])==="$type"&&C.push(new De(v,c,'"$type" cannot be use with operator "'+c[0]+'"'));case"==":case"!=":c.length!==3&&C.push(new De(v,c,'filter array for operator "'+c[0]+'" must have 3 elements'));case"in":case"!in":c.length>=2&&(m=Ui(c[1]))!=="string"&&C.push(new De(v+"[1]",c[1],"string expected, "+m+" found"));for(var k=2;k<c.length;k++)m=Ui(c[k]),Br(c[1])==="$type"?C=C.concat(Il({key:v+"["+k+"]",value:c[k],valueSpec:_.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&C.push(new De(v+"["+k+"]",c[k],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var B=1;B<c.length;B++)C=C.concat(t({key:v+"["+B+"]",value:c[B],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=Ui(c[1]),c.length!==2?C.push(new De(v,c,'filter array for "'+c[0]+'" operator must have 2 elements')):m!=="string"&&C.push(new De(v+"[1]",c[1],"string expected, "+m+" found"));break;case"within":m=Ui(c[1]),c.length!==2?C.push(new De(v,c,'filter array for "'+c[0]+'" operator must have 2 elements')):m!=="object"&&C.push(new De(v+"[1]",c[1],"object expected, "+m+" found"))}return C}(e)}function Fc(e,t){var r=e.key,c=e.style,v=e.styleSpec,m=e.value,_=e.objectKey,C=v[t+"_"+e.layerType];if(!C)return[];var k=_.match(/^(.*)-transition$/);if(t==="paint"&&k&&C[k[1]]&&C[k[1]].transition)return Fi({key:r,value:m,valueSpec:v.transition,style:c,styleSpec:v});var B,W=e.valueSpec||C[_];if(!W)return[new De(r,m,'unknown property "'+_+'"')];if(Ui(m)==="string"&&Is(W)&&!W.tokens&&(B=/^{([^}]+)}$/.exec(m)))return[new De(r,m,'"'+_+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(B[1])+" }`.")];var $=[];return e.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&$.push(new De(r,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&dc(jt(m))&&Br(m.type)==="identity"&&$.push(new De(r,m,'"text-font" does not support identity functions'))),$.concat(Fi({key:e.key,value:m,valueSpec:W,style:c,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:_}))}function Nc(e){return Fc(e,"paint")}function hl(e){return Fc(e,"layout")}function Bc(e){var t=[],r=e.value,c=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new De(c,r,'either "type" or "ref" is required'));var _,C=Br(r.type),k=Br(r.ref);if(r.id)for(var B=Br(r.id),W=0;W<e.arrayIndex;W++){var $=v.layers[W];Br($.id)===B&&t.push(new De(c,r.id,'duplicate layer id "'+r.id+'", previously used at line '+$.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ze){Ze in r&&t.push(new De(c,r[Ze],'"'+Ze+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ze){Br(Ze.id)===k&&(_=Ze)}),_?_.ref?t.push(new De(c,r.ref,"ref cannot reference another ref layer")):C=Br(_.type):t.push(new De(c,r.ref,'ref layer "'+k+'" not found'));else if(C!=="background")if(r.source){var se=v.sources&&v.sources[r.source],pe=se&&Br(se.type);se?pe==="vector"&&C==="raster"?t.push(new De(c,r.source,'layer "'+r.id+'" requires a raster source')):pe==="raster"&&C!=="raster"?t.push(new De(c,r.source,'layer "'+r.id+'" requires a vector source')):pe!=="vector"||r["source-layer"]?pe==="raster-dem"&&C!=="hillshade"?t.push(new De(c,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!r.paint||!r.paint["line-gradient"]||pe==="geojson"&&se.lineMetrics||t.push(new De(c,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new De(c,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new De(c,r.source,'source "'+r.source+'" not found'))}else t.push(new De(c,r,'missing required property "source"'));return t=t.concat($s({key:c,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Fi({key:c+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:zc,layout:function(Ze){return $s({layer:r,key:Ze.key,value:Ze.value,style:Ze.style,styleSpec:Ze.styleSpec,objectElementValidators:{"*":function(We){return hl(Ir({layerType:C},We))}}})},paint:function(Ze){return $s({layer:r,key:Ze.key,value:Ze.value,style:Ze.style,styleSpec:Ze.styleSpec,objectElementValidators:{"*":function(We){return Nc(Ir({layerType:C},We))}}})}}}))}function ku(e){var t=e.value,r=e.key,c=Ui(t);return c!=="string"?[new De(r,t,"string expected, "+c+" found")]:[]}var Ma={promoteId:function(e){var t=e.key,r=e.value;if(Ui(r)==="string")return ku({key:t,value:r});var c=[];for(var v in r)c.push.apply(c,ku({key:t+"."+v,value:r[v]}));return c}};function Kl(e){var t=e.value,r=e.key,c=e.styleSpec,v=e.style;if(!t.type)return[new De(r,t,'"type" is required')];var m,_=Br(t.type);switch(_){case"vector":case"raster":case"raster-dem":return $s({key:r,value:t,valueSpec:c["source_"+_.replace("-","_")],style:e.style,styleSpec:c,objectElementValidators:Ma});case"geojson":if(m=$s({key:r,value:t,valueSpec:c.source_geojson,style:v,styleSpec:c,objectElementValidators:Ma}),t.cluster)for(var C in t.clusterProperties){var k=t.clusterProperties[C],B=k[0],W=typeof B=="string"?[B,["accumulated"],["get",C]]:B;m.push.apply(m,ba({key:r+"."+C+".map",value:k[1],expressionContext:"cluster-map"})),m.push.apply(m,ba({key:r+"."+C+".reduce",value:W,expressionContext:"cluster-reduce"}))}return m;case"video":return $s({key:r,value:t,valueSpec:c.source_video,style:v,styleSpec:c});case"image":return $s({key:r,value:t,valueSpec:c.source_image,style:v,styleSpec:c});case"canvas":return[new De(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Il({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:c})}}function Ka(e){var t=e.value,r=e.styleSpec,c=r.light,v=e.style,m=[],_=Ui(t);if(t===void 0)return m;if(_!=="object")return m.concat([new De("light",t,"object expected, "+_+" found")]);for(var C in t){var k=C.match(/^(.*)-transition$/);m=m.concat(k&&c[k[1]]&&c[k[1]].transition?Fi({key:C,value:t[C],valueSpec:r.transition,style:v,styleSpec:r}):c[C]?Fi({key:C,value:t[C],valueSpec:c[C],style:v,styleSpec:r}):[new De(C,t[C],'unknown property "'+C+'"')])}return m}var Qu={"*":function(){return[]},array:Qc,boolean:function(e){var t=e.value,r=e.key,c=Ui(t);return c!=="boolean"?[new De(r,t,"boolean expected, "+c+" found")]:[]},number:yf,color:function(e){var t=e.key,r=e.value,c=Ui(r);return c!=="string"?[new De(t,r,"color expected, "+c+" found")]:hi(r)===null?[new De(t,r,'color expected, "'+r+'" found')]:[]},constants:St,enum:Il,filter:zc,function:qc,layer:Bc,object:$s,source:Kl,light:Ka,string:ku,formatted:function(e){return ku(e).length===0?[]:ba(e)},resolvedImage:function(e){return ku(e).length===0?[]:ba(e)}};function Fi(e){var t=e.value,r=e.valueSpec,c=e.styleSpec;return r.expression&&dc(Br(t))?qc(e):r.expression&&Lu(jt(t))?ba(e):r.type&&Qu[r.type]?Qu[r.type](e):$s(Ir({},e,{valueSpec:r.type?c[r.type]:r}))}function Ta(e){var t=e.value,r=e.key,c=ku(e);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new De(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new De(r,t,'"glyphs" url must include a "{range}" token'))),c}function js(e,t){t===void 0&&(t=ue);var r=[];return r=r.concat(Fi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ta,"*":function(){return[]}}})),e.constants&&(r=r.concat(St({key:"constants",value:e.constants,style:e,styleSpec:t}))),$l(r)}function $l(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Rl(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return $l(e.apply(this,t))}}js.source=Rl(Kl),js.light=Rl(Ka),js.layer=Rl(Bc),js.filter=Rl(zc),js.paintProperty=Rl(Nc),js.layoutProperty=Rl(hl);var Jl=js,_f=Jl.light,xf=Jl.paintProperty,Dl=Jl.layoutProperty;function zu(e,t){var r=!1;if(t&&t.length)for(var c=0,v=t;c<v.length;c+=1)e.fire(new Oe(new Error(v[c].message))),r=!0;return r}var Fu=no;function no(e,t,r){var c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var _=v[3+m],C=v[3+m+1];c.push(_===C?null:v.subarray(_,C))}var k=v[3+c.length+1];this.keys=v.subarray(v[3+c.length],k),this.bboxes=v.subarray(k),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var B=0;B<this.d*this.d;B++)c.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var W=r/t*e;this.min=-W,this.max=e+W}no.prototype.insert=function(e,t,r,c,v){this._forEachCell(t,r,c,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(c),this.bboxes.push(v)},no.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},no.prototype._insertCell=function(e,t,r,c,v,m){this.cells[v].push(m)},no.prototype.query=function(e,t,r,c,v){var m=this.min,_=this.max;if(e<=m&&t<=m&&_<=r&&_<=c&&!v)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(e,t,r,c,this._queryCell,C,{},v),C},no.prototype._queryCell=function(e,t,r,c,v,m,_,C){var k=this.cells[v];if(k!==null)for(var B=this.keys,W=this.bboxes,$=0;$<k.length;$++){var se=k[$];if(_[se]===void 0){var pe=4*se;(C?C(W[pe+0],W[pe+1],W[pe+2],W[pe+3]):e<=W[pe+2]&&t<=W[pe+3]&&r>=W[pe+0]&&c>=W[pe+1])?(_[se]=!0,m.push(B[se])):_[se]=!1}}},no.prototype._forEachCell=function(e,t,r,c,v,m,_,C){for(var k=this._convertToCellCoord(e),B=this._convertToCellCoord(t),W=this._convertToCellCoord(r),$=this._convertToCellCoord(c),se=k;se<=W;se++)for(var pe=B;pe<=$;pe++){var Ze=this.d*pe+se;if((!C||C(this._convertFromCellCoord(se),this._convertFromCellCoord(pe),this._convertFromCellCoord(se+1),this._convertFromCellCoord(pe+1)))&&v.call(this,e,t,r,c,Ze,m,_,C))return}},no.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},no.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},no.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,c=0;c<this.cells.length;c++)r+=this.cells[c].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,_=0;_<e.length;_++){var C=e[_];v[3+_]=m,v.set(C,m),m+=C.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var ds=ne.ImageData,pl=ne.ImageBitmap,fo={};function Tn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),fo[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var Zs in Tn("Object",Object),Fu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Fu.deserialize=function(e){return new Fu(e.buffer)},Tn("Grid",Fu),Tn("Color",jn),Tn("Error",Error),Tn("ResolvedImage",La),Tn("StylePropertyFunction",Ml),Tn("StyleExpression",ll,{omit:["_evaluator"]}),Tn("ZoomDependentExpression",cu),Tn("ZoomConstantExpression",cl),Tn("CompoundExpression",to,{omit:["_evaluate"]}),Ua)Ua[Zs]._classRegistryKey||Tn("Expression_"+Zs,Ua[Zs]);function mc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function kl(e){return pl&&e instanceof pl}function fu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(mc(e)||kl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof ds)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var c=[],v=0,m=e;v<m.length;v+=1)c.push(fu(m[v],t));return c}if(typeof e=="object"){var _=e.constructor,C=_._classRegistryKey;if(!C)throw new Error("can't serialize object of unregistered class");var k=_.serialize?_.serialize(e,t):{};if(!_.serialize){for(var B in e)if(e.hasOwnProperty(B)&&!(fo[C].omit.indexOf(B)>=0)){var W=e[B];k[B]=fo[C].shallow.indexOf(B)>=0?W:fu(W,t)}e instanceof Error&&(k.message=e.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(k.$name=C),k}throw new Error("can't serialize object of type "+typeof e)}function Vs(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||mc(e)||kl(e)||ArrayBuffer.isView(e)||e instanceof ds)return e;if(Array.isArray(e))return e.map(Vs);if(typeof e=="object"){var t=e.$name||"Object",r=fo[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var c=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var _=m[v];if(_!=="$name"){var C=e[_];c[_]=fo[t].shallow.indexOf(_)>=0?C:Vs(C)}}return c}throw new Error("can't deserialize object of type "+typeof e)}var dl=function(){this.first=!0};dl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var Jr={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function gc(e){for(var t=0,r=e;t<r.length;t+=1)if(Ql(r[t].charCodeAt(0)))return!0;return!1}function Ql(e){return!(e!==746&&e!==747&&(e<4352||!(Jr["Bopomofo Extended"](e)||Jr.Bopomofo(e)||Jr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Jr["CJK Compatibility Ideographs"](e)||Jr["CJK Compatibility"](e)||Jr["CJK Radicals Supplement"](e)||Jr["CJK Strokes"](e)||!(!Jr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Jr["CJK Unified Ideographs Extension A"](e)||Jr["CJK Unified Ideographs"](e)||Jr["Enclosed CJK Letters and Months"](e)||Jr["Hangul Compatibility Jamo"](e)||Jr["Hangul Jamo Extended-A"](e)||Jr["Hangul Jamo Extended-B"](e)||Jr["Hangul Jamo"](e)||Jr["Hangul Syllables"](e)||Jr.Hiragana(e)||Jr["Ideographic Description Characters"](e)||Jr.Kanbun(e)||Jr["Kangxi Radicals"](e)||Jr["Katakana Phonetic Extensions"](e)||Jr.Katakana(e)&&e!==12540||!(!Jr["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Jr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Jr["Unified Canadian Aboriginal Syllabics"](e)||Jr["Unified Canadian Aboriginal Syllabics Extended"](e)||Jr["Vertical Forms"](e)||Jr["Yijing Hexagram Symbols"](e)||Jr["Yi Syllables"](e)||Jr["Yi Radicals"](e))))}function Nu(e){return!(Ql(e)||function(t){return!!(Jr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Jr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Jr["Letterlike Symbols"](t)||Jr["Number Forms"](t)||Jr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Jr["Control Pictures"](t)&&t!==9251||Jr["Optical Character Recognition"](t)||Jr["Enclosed Alphanumerics"](t)||Jr["Geometric Shapes"](t)||Jr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Jr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Jr["CJK Symbols and Punctuation"](t)||Jr.Katakana(t)||Jr["Private Use Area"](t)||Jr["CJK Compatibility Forms"](t)||Jr["Small Form Variants"](t)||Jr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Gs(e){return e>=1424&&e<=2303||Jr["Arabic Presentation Forms-A"](e)||Jr["Arabic Presentation Forms-B"](e)}function bs(e,t){return!(!t&&Gs(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Jr.Khmer(e))}function vl(e){for(var t=0,r=e;t<r.length;t+=1)if(Gs(r[t].charCodeAt(0)))return!0;return!1}var yc=null,Hs="unavailable",qu=null,Uc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Hs="error"),yc&&yc(e)};function ql(){rf.fire(new ie("pluginStateChange",{pluginStatus:Hs,pluginURL:qu}))}var rf=new He,jc=function(){return Hs},_u=function(){if(Hs!=="deferred"||!qu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Hs="loading",ql(),qu&&Ji({url:qu},function(e){e?Uc(e):(Hs="loaded",ql())})},Js={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Hs==="loaded"||Js.applyArabicShaping!=null},isLoading:function(){return Hs==="loading"},setState:function(e){Hs=e.pluginStatus,qu=e.pluginURL},isParsed:function(){return Js.applyArabicShaping!=null&&Js.processBidirectionalText!=null&&Js.processStyledBidirectionalText!=null},getPluginURL:function(){return qu}},Di=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dl,this.transition={})};Di.prototype.isSupportedScript=function(e){return function(t,r){for(var c=0,v=t;c<v.length;c+=1)if(!bs(v[c].charCodeAt(0),r))return!1;return!0}(e,Js.isLoaded())},Di.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Di.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Bu=function(e,t){this.property=e,this.value=t,this.expression=function(r,c){if(dc(r))return new Ml(r,c);if(Lu(r)){var v=Dc(r,c);if(v.result==="error")throw new Error(v.value.map(function(_){return _.key+": "+_.message}).join(", "));return v.value}var m=r;return typeof r=="string"&&c.type==="color"&&(m=jn.parse(r)),{kind:"constant",evaluate:function(){return m}}}(t===void 0?e.specification.default:t,e.specification)};Bu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Bu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var os=function(e){this.property=e,this.value=new Bu(e,void 0)};os.prototype.transitioned=function(e,t){return new xu(this.property,this.value,t,Xt({},e.transition,this.transition),e.now)},os.prototype.untransitioned=function(){return new xu(this.property,this.value,null,{},0)};var Io=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Io.prototype.getValue=function(e){return Ye(this._values[e].value.value)},Io.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new os(this._values[e].property)),this._values[e].value=new Bu(this._values[e].property,t===null?void 0:Ye(t))},Io.prototype.getTransition=function(e){return Ye(this._values[e].transition)},Io.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new os(this._values[e].property)),this._values[e].transition=Ye(t)||void 0},Io.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t],v=this.getValue(c);v!==void 0&&(e[c]=v);var m=this.getTransition(c);m!==void 0&&(e[c+"-transition"]=m)}return e},Io.prototype.transitioned=function(e,t){for(var r=new Qs(this._properties),c=0,v=Object.keys(this._values);c<v.length;c+=1){var m=v[c];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},Io.prototype.untransitioned=function(){for(var e=new Qs(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t];e._values[c]=this._values[c].untransitioned()}return e};var xu=function(e,t,r,c,v){this.property=e,this.value=t,this.begin=v+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=r)};xu.prototype.possiblyEvaluate=function(e,t,r){var c=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(c>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(c<this.begin)return m.possiblyEvaluate(e,t,r);var _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(C){if(C<=0)return 0;if(C>=1)return 1;var k=C*C,B=k*C;return 4*(C<.5?B:3*(C-k)+B-.75)}(_))}return v};var Qs=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};Qs.prototype.possiblyEvaluate=function(e,t,r){for(var c=new zl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];c._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return c},Qs.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var qs=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};qs.prototype.getValue=function(e){return Ye(this._values[e].value)},qs.prototype.setValue=function(e,t){this._values[e]=new Bu(this._values[e].property,t===null?void 0:Ye(t))},qs.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var c=r[t],v=this.getValue(c);v!==void 0&&(e[c]=v)}return e},qs.prototype.possiblyEvaluate=function(e,t,r){for(var c=new zl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var _=m[v];c._values[_]=this._values[_].possiblyEvaluate(e,t,r)}return c};var ss=function(e,t,r){this.property=e,this.value=t,this.parameters=r};ss.prototype.isConstant=function(){return this.value.kind==="constant"},ss.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},ss.prototype.evaluate=function(e,t,r,c){return this.property.evaluate(this.value,this.parameters,e,t,r,c)};var zl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};zl.prototype.get=function(e){return this._values[e]};var Zn=function(e){this.specification=e};Zn.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Zn.prototype.interpolate=function(e,t,r){var c=Ks[this.specification.type];return c?c(e,t,r):e};var Mn=function(e,t){this.specification=e,this.overrides=t};Mn.prototype.possiblyEvaluate=function(e,t,r,c){return new ss(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,c)}:e.expression,t)},Mn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new ss(this,{kind:"constant",value:void 0},e.parameters);var c=Ks[this.specification.type];return c?new ss(this,{kind:"constant",value:c(e.value.value,t.value.value,r)},e.parameters):e},Mn.prototype.evaluate=function(e,t,r,c,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,c,v,m)};var ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,c,v,m){if(r.value===void 0)return new ss(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){var _=r.expression.evaluate(c,null,{},v,m),C=r.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,k=this._calculate(C,C,C,c);return new ss(this,{kind:"constant",value:k},c)}if(r.expression.kind==="camera"){var B=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new ss(this,{kind:"constant",value:B},c)}return new ss(this,r.expression,c)},t.prototype.evaluate=function(r,c,v,m,_,C){if(r.kind==="source"){var k=r.evaluate(c,v,m,_,C);return this._calculate(k,k,k,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},v,m),r.evaluate({zoom:Math.floor(c.zoom)},v,m),r.evaluate({zoom:Math.floor(c.zoom)+1},v,m),c):r.value},t.prototype._calculate=function(r,c,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:v,to:c}},t.prototype.interpolate=function(r){return r},t}(Mn),zo=function(e){this.specification=e};zo.prototype.possiblyEvaluate=function(e,t,r,c){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,c);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new Di(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Di(Math.floor(t.zoom),t)),e.expression.evaluate(new Di(Math.floor(t.zoom+1),t)),t)}},zo.prototype._calculate=function(e,t,r,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},zo.prototype.interpolate=function(e){return e};var To=function(e){this.specification=e};To.prototype.possiblyEvaluate=function(e,t,r,c){return!!e.expression.evaluate(t,null,{},r,c)},To.prototype.interpolate=function(){return!1};var Fo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var c=this.defaultPropertyValues[t]=new Bu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new os(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=c.possiblyEvaluate({})}};Tn("DataDrivenProperty",Mn),Tn("DataConstantProperty",Zn),Tn("CrossFadedDataDrivenProperty",ec),Tn("CrossFadedProperty",zo),Tn("ColorRampProperty",To);var bu=function(e){function t(r,c){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new qs(c.layout)),c.paint)){for(var v in this._transitionablePaint=new Io(c.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zl(c.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,c,v){v===void 0&&(v={}),c!=null&&this._validate(Dl,"layers."+this.id+".layout."+r,r,c,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)},t.prototype.getPaintProperty=function(r){return Ht(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,c,v){if(v===void 0&&(v={}),c!=null&&this._validate(xf,"layers."+this.id+".paint."+r,r,c,v))return!1;if(Ht(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),c||void 0),!1;var m=this._transitionablePaint._values[r],_=m.property.specification["property-type"]==="cross-faded-data-driven",C=m.value.isDataDriven(),k=m.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);var B=this._transitionablePaint._values[r].value;return B.isDataDriven()||C||_||this._handleOverridablePaintPropertyUpdate(r,k,B)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,c,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),mt(r,function(c,v){return!(c===void 0||v==="layout"&&!Object.keys(c).length||v==="paint"&&!Object.keys(c).length)})},t.prototype._validate=function(r,c,v,m,_){return _===void 0&&(_={}),(!_||_.validate!==!1)&&zu(this,r.call(Jl,{key:c,layerType:this.type,objectKey:v,value:m,styleSpec:ue,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var c=this.paint.get(r);if(c instanceof ss&&Is(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1},t}(He),Su={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},tc=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ea=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function _o(e,t){t===void 0&&(t=1);var r=0,c=0;return{members:e.map(function(v){var m=Su[v.type].BYTES_PER_ELEMENT,_=r=Zc(r,Math.max(t,m)),C=v.components||1;return c=Math.max(c,m),r+=m*C,{name:v.name,type:v.type,components:C,offset:_}}),size:Zc(r,Math.max(c,t)),alignment:t}}function Zc(e,t){return Math.ceil(e/t)*t}ea.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},ea.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},ea.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ea.prototype.clear=function(){this.length=0},ea.prototype.resize=function(e){this.reserve(e),this.length=e},ea.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},ea.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Uu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.int16[m+0]=c,this.int16[m+1]=v,r},t}(ea);Uu.prototype.bytesPerElement=4,Tn("StructArrayLayout2i4",Uu);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var C=4*r;return this.int16[C+0]=c,this.int16[C+1]=v,this.int16[C+2]=m,this.int16[C+3]=_,r},t}(ea);_c.prototype.bytesPerElement=8,Tn("StructArrayLayout4i8",_c);var Eu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C){var k=this.length;return this.resize(k+1),this.emplace(k,r,c,v,m,_,C)},t.prototype.emplace=function(r,c,v,m,_,C,k){var B=6*r;return this.int16[B+0]=c,this.int16[B+1]=v,this.int16[B+2]=m,this.int16[B+3]=_,this.int16[B+4]=C,this.int16[B+5]=k,r},t}(ea);Eu.prototype.bytesPerElement=12,Tn("StructArrayLayout2i4i12",Eu);var Os=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C){var k=this.length;return this.resize(k+1),this.emplace(k,r,c,v,m,_,C)},t.prototype.emplace=function(r,c,v,m,_,C,k){var B=4*r,W=8*r;return this.int16[B+0]=c,this.int16[B+1]=v,this.uint8[W+4]=m,this.uint8[W+5]=_,this.uint8[W+6]=C,this.uint8[W+7]=k,r},t}(ea);Os.prototype.bytesPerElement=8,Tn("StructArrayLayout2i4ub8",Os);var Fl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.float32[m+0]=c,this.float32[m+1]=v,r},t}(ea);Fl.prototype.bytesPerElement=8,Tn("StructArrayLayout2f8",Fl);var wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,$){var se=this.length;return this.resize(se+1),this.emplace(se,r,c,v,m,_,C,k,B,W,$)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,$,se){var pe=10*r;return this.uint16[pe+0]=c,this.uint16[pe+1]=v,this.uint16[pe+2]=m,this.uint16[pe+3]=_,this.uint16[pe+4]=C,this.uint16[pe+5]=k,this.uint16[pe+6]=B,this.uint16[pe+7]=W,this.uint16[pe+8]=$,this.uint16[pe+9]=se,r},t}(ea);wu.prototype.bytesPerElement=20,Tn("StructArrayLayout10ui20",wu);var Vc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,$,se,pe){var Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,r,c,v,m,_,C,k,B,W,$,se,pe)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,$,se,pe,Ze){var We=12*r;return this.int16[We+0]=c,this.int16[We+1]=v,this.int16[We+2]=m,this.int16[We+3]=_,this.uint16[We+4]=C,this.uint16[We+5]=k,this.uint16[We+6]=B,this.uint16[We+7]=W,this.int16[We+8]=$,this.int16[We+9]=se,this.int16[We+10]=pe,this.int16[We+11]=Ze,r},t}(ea);Vc.prototype.bytesPerElement=24,Tn("StructArrayLayout4i4ui4i24",Vc);var Nl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.float32[_+0]=c,this.float32[_+1]=v,this.float32[_+2]=m,r},t}(ea);Nl.prototype.bytesPerElement=12,Tn("StructArrayLayout3f12",Nl);var rc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.uint32[1*r+0]=c,r},t}(ea);rc.prototype.bytesPerElement=4,Tn("StructArrayLayout1ul4",rc);var Gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W){var $=this.length;return this.resize($+1),this.emplace($,r,c,v,m,_,C,k,B,W)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,$){var se=10*r,pe=5*r;return this.int16[se+0]=c,this.int16[se+1]=v,this.int16[se+2]=m,this.int16[se+3]=_,this.int16[se+4]=C,this.int16[se+5]=k,this.uint32[pe+3]=B,this.uint16[se+8]=W,this.uint16[se+9]=$,r},t}(ea);Gc.prototype.bytesPerElement=20,Tn("StructArrayLayout6i1ul2ui20",Gc);var el=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C){var k=this.length;return this.resize(k+1),this.emplace(k,r,c,v,m,_,C)},t.prototype.emplace=function(r,c,v,m,_,C,k){var B=6*r;return this.int16[B+0]=c,this.int16[B+1]=v,this.int16[B+2]=m,this.int16[B+3]=_,this.int16[B+4]=C,this.int16[B+5]=k,r},t}(ea);el.prototype.bytesPerElement=12,Tn("StructArrayLayout2i2i2i12",el);var eu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_){var C=this.length;return this.resize(C+1),this.emplace(C,r,c,v,m,_)},t.prototype.emplace=function(r,c,v,m,_,C){var k=4*r,B=8*r;return this.float32[k+0]=c,this.float32[k+1]=v,this.float32[k+2]=m,this.int16[B+6]=_,this.int16[B+7]=C,r},t}(ea);eu.prototype.bytesPerElement=16,Tn("StructArrayLayout2f1f2i16",eu);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var C=12*r,k=3*r;return this.uint8[C+0]=c,this.uint8[C+1]=v,this.float32[k+1]=m,this.float32[k+2]=_,r},t}(ea);xc.prototype.bytesPerElement=12,Tn("StructArrayLayout2ub2f12",xc);var tl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.uint16[_+0]=c,this.uint16[_+1]=v,this.uint16[_+2]=m,r},t}(ea);tl.prototype.bytesPerElement=6,Tn("StructArrayLayout3ui6",tl);var ju=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We,ot,Qe,At){var Gt=this.length;return this.resize(Gt+1),this.emplace(Gt,r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We,ot,Qe,At)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We,ot,Qe,At,Gt){var ir=24*r,hr=12*r,Cr=48*r;return this.int16[ir+0]=c,this.int16[ir+1]=v,this.uint16[ir+2]=m,this.uint16[ir+3]=_,this.uint32[hr+2]=C,this.uint32[hr+3]=k,this.uint32[hr+4]=B,this.uint16[ir+10]=W,this.uint16[ir+11]=$,this.uint16[ir+12]=se,this.float32[hr+7]=pe,this.float32[hr+8]=Ze,this.uint8[Cr+36]=We,this.uint8[Cr+37]=ot,this.uint8[Cr+38]=Qe,this.uint32[hr+10]=At,this.int16[ir+22]=Gt,r},t}(ea);ju.prototype.bytesPerElement=48,Tn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ju);var nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We,ot,Qe,At,Gt,ir,hr,Cr,tn,pn,Wn,Sn,Kn,En,si){var ui=this.length;return this.resize(ui+1),this.emplace(ui,r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We,ot,Qe,At,Gt,ir,hr,Cr,tn,pn,Wn,Sn,Kn,En,si)},t.prototype.emplace=function(r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We,ot,Qe,At,Gt,ir,hr,Cr,tn,pn,Wn,Sn,Kn,En,si,ui){var Ln=34*r,na=17*r;return this.int16[Ln+0]=c,this.int16[Ln+1]=v,this.int16[Ln+2]=m,this.int16[Ln+3]=_,this.int16[Ln+4]=C,this.int16[Ln+5]=k,this.int16[Ln+6]=B,this.int16[Ln+7]=W,this.uint16[Ln+8]=$,this.uint16[Ln+9]=se,this.uint16[Ln+10]=pe,this.uint16[Ln+11]=Ze,this.uint16[Ln+12]=We,this.uint16[Ln+13]=ot,this.uint16[Ln+14]=Qe,this.uint16[Ln+15]=At,this.uint16[Ln+16]=Gt,this.uint16[Ln+17]=ir,this.uint16[Ln+18]=hr,this.uint16[Ln+19]=Cr,this.uint16[Ln+20]=tn,this.uint16[Ln+21]=pn,this.uint16[Ln+22]=Wn,this.uint32[na+12]=Sn,this.float32[na+13]=Kn,this.float32[na+14]=En,this.float32[na+15]=si,this.float32[na+16]=ui,r},t}(ea);nc.prototype.bytesPerElement=68,Tn("StructArrayLayout8i15ui1ul4f68",nc);var Tu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.float32[1*r+0]=c,r},t}(ea);Tu.prototype.bytesPerElement=4,Tn("StructArrayLayout1f4",Tu);var hu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=3*r;return this.int16[_+0]=c,this.int16[_+1]=v,this.int16[_+2]=m,r},t}(ea);hu.prototype.bytesPerElement=6,Tn("StructArrayLayout3i6",hu);var Au=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,c,v)},t.prototype.emplace=function(r,c,v,m){var _=4*r;return this.uint32[2*r+0]=c,this.uint16[_+2]=v,this.uint16[_+3]=m,r},t}(ea);Au.prototype.bytesPerElement=8,Tn("StructArrayLayout1ul2ui8",Au);var ic=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c){var v=this.length;return this.resize(v+1),this.emplace(v,r,c)},t.prototype.emplace=function(r,c,v){var m=2*r;return this.uint16[m+0]=c,this.uint16[m+1]=v,r},t}(ea);ic.prototype.bytesPerElement=4,Tn("StructArrayLayout2ui4",ic);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var c=this.length;return this.resize(c+1),this.emplace(c,r)},t.prototype.emplace=function(r,c){return this.uint16[1*r+0]=c,r},t}(ea);bc.prototype.bytesPerElement=2,Tn("StructArrayLayout1ui2",bc);var ac=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,c,v,m){var _=this.length;return this.resize(_+1),this.emplace(_,r,c,v,m)},t.prototype.emplace=function(r,c,v,m,_){var C=4*r;return this.float32[C+0]=c,this.float32[C+1]=v,this.float32[C+2]=m,this.float32[C+3]=_,r},t}(ea);ac.prototype.bytesPerElement=16,Tn("StructArrayLayout4f16",ac);var n=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new Y(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(tc);n.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new n(this,r)},t}(Gc);Tn("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(c){this._structArray.uint8[this._pos1+37]=c},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(c){this._structArray.uint8[this._pos1+38]=c},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(c){this._structArray.uint32[this._pos4+10]=c},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(tc);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(ju);Tn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(c){this._structArray.uint32[this._pos4+12]=c},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(tc);g.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(nc);Tn("SymbolInstanceArray",b);var A=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Tu);Tn("GlyphOffsetArray",A);var L=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(hu);Tn("SymbolLineVertexArray",L);var V=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(tc);V.prototype.size=8;var ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new V(this,r)},t}(Au);Tn("FeatureIndexArray",ee);var de=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,_e=function(e){e===void 0&&(e=[]),this.segments=e};function xe(e,t){return 256*(e=Kt(Math.floor(e),0,255))+Kt(Math.floor(t),0,255)}_e.prototype.prepareSegment=function(e,t,r,c){var v=this.segments[this.segments.length-1];return e>_e.MAX_VERTEX_ARRAY_LENGTH&&Fe("Max vertices per segment is "+_e.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>_e.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==c)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},c!==void 0&&(v.sortKey=c),this.segments.push(v)),v},_e.prototype.get=function(){return this.segments},_e.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var c in r.vaos)r.vaos[c].destroy()}},_e.simpleSegment=function(e,t,r,c){return new _e([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:c,vaos:{},sortKey:0}])},_e.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tn("SegmentVector",_e);var Xe=_o([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ge=w(function(e){e.exports=function(t,r){var c,v,m,_,C,k,B,W;for(v=t.length-(c=3&t.length),m=r,C=3432918353,k=461845907,W=0;W<v;)B=255&t.charCodeAt(W)|(255&t.charCodeAt(++W))<<8|(255&t.charCodeAt(++W))<<16|(255&t.charCodeAt(++W))<<24,++W,m=27492+(65535&(_=5*(65535&(m=(m^=B=(65535&(B=(B=(65535&B)*C+(((B>>>16)*C&65535)<<16)&4294967295)<<15|B>>>17))*k+(((B>>>16)*k&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(B=0,c){case 3:B^=(255&t.charCodeAt(W+2))<<16;case 2:B^=(255&t.charCodeAt(W+1))<<8;case 1:m^=B=(65535&(B=(B=(65535&(B^=255&t.charCodeAt(W)))*C+(((B>>>16)*C&65535)<<16)&4294967295)<<15|B>>>17))*k+(((B>>>16)*k&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),nt=w(function(e){e.exports=function(t,r){for(var c,v=t.length,m=r^v,_=0;v>=4;)c=1540483477*(65535&(c=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),v-=4,++_;switch(v){case 3:m^=(255&t.charCodeAt(_+2))<<16;case 2:m^=(255&t.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),ke=Ge,rt=nt;ke.murmur3=Ge,ke.murmur2=rt;var ht=function(){this.ids=[],this.positions=[],this.indexed=!1};ht.prototype.add=function(e,t,r,c){this.ids.push(or(e)),this.positions.push(t,r,c)},ht.prototype.getPositions=function(e){for(var t=or(e),r=0,c=this.ids.length-1;r<c;){var v=r+c>>1;this.ids[v]>=t?c=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},ht.serialize=function(e,t){var r=new Float64Array(e.ids),c=new Uint32Array(e.positions);return function v(m,_,C,k){for(;C<k;){for(var B=m[C+k>>1],W=C-1,$=k+1;;){do W++;while(m[W]<B);do $--;while(m[$]>B);if(W>=$)break;rr(m,W,$),rr(_,3*W,3*$),rr(_,3*W+1,3*$+1),rr(_,3*W+2,3*$+2)}$-C<k-$?(v(m,_,C,$),C=$+1):(v(m,_,$+1,k),k=$)}}(r,c,0,r.length-1),t&&t.push(r.buffer,c.buffer),{ids:r,positions:c}},ht.deserialize=function(e){var t=new ht;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Bt=Math.pow(2,53)-1;function or(e){var t=+e;return!isNaN(t)&&t<=Bt?t:ke(String(e))}function rr(e,t,r){var c=e[t];e[t]=e[r],e[r]=c}Tn("FeaturePositionMap",ht);var lr=function(e,t){this.gl=e.gl,this.location=t},Lr=function(e){function t(r,c){e.call(this,r,c),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(lr),rn=function(e){function t(r,c){e.call(this,r,c),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(lr),Yr=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(lr),_n=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(lr),Bn=function(e){function t(r,c){e.call(this,r,c),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(lr),Xn=function(e){function t(r,c){e.call(this,r,c),this.current=jn.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(lr),Hn=new Float32Array(16),ta=function(e){function t(r,c){e.call(this,r,c),this.current=Hn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var c=1;c<16;c++)if(r[c]!==this.current[c]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(lr);function xn(e){return[xe(255*e.r,255*e.g),xe(255*e.b,255*e.a)]}var ii=function(e,t,r){this.value=e,this.uniformNames=t.map(function(c){return"u_"+c}),this.type=r};ii.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},ii.prototype.getBinding=function(e,t,r){return this.type==="color"?new Xn(e,t):new rn(e,t)};var Si=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Si.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Si.prototype.setUniform=function(e,t,r,c){var v=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Si.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new Bn(e,t):new rn(e,t)};var ri=function(e,t,r,c){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new c};ri.prototype.populatePaintArray=function(e,t,r,c,v){var m=this.paintVertexArray.length,_=this.expression.evaluate(new Di(0),t,{},c,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,_)},ri.prototype.updatePaintArray=function(e,t,r,c){var v=this.expression.evaluate({zoom:0},r,c);this._setPaintValue(e,t,v)},ri.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var c=xn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,c[0],c[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},ri.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ai=function(e,t,r,c,v,m){this.expression=e,this.uniformNames=t.map(function(_){return"u_"+_+"_t"}),this.type=r,this.useIntegerZoom=c,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(_){return{name:"a_"+_,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new m};ai.prototype.populatePaintArray=function(e,t,r,c,v){var m=this.expression.evaluate(new Di(this.zoom),t,{},c,[],v),_=this.expression.evaluate(new Di(this.zoom+1),t,{},c,[],v),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,m,_)},ai.prototype.updatePaintArray=function(e,t,r,c){var v=this.expression.evaluate({zoom:this.zoom},r,c),m=this.expression.evaluate({zoom:this.zoom+1},r,c);this._setPaintValue(e,t,v,m)},ai.prototype._setPaintValue=function(e,t,r,c){if(this.type==="color")for(var v=xn(r),m=xn(c),_=e;_<t;_++)this.paintVertexArray.emplace(_,v[0],v[1],m[0],m[1]);else{for(var C=e;C<t;C++)this.paintVertexArray.emplace(C,r,c);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(c))}},ai.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ai.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ai.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,c=Kt(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(c)},ai.prototype.getBinding=function(e,t,r){return new rn(e,t)};var wi=function(e,t,r,c,v,m){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};wi.prototype.populatePaintArray=function(e,t,r){var c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,t.patterns&&t.patterns[this.layerId],r)},wi.prototype.updatePaintArray=function(e,t,r,c,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},wi.prototype._setPaintValues=function(e,t,r,c){if(c&&r){var v=c[r.min],m=c[r.mid],_=c[r.max];if(v&&m&&_)for(var C=e;C<t;C++)this.zoomInPaintVertexArray.emplace(C,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,m.tl[0],m.tl[1],m.br[0],m.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],m.pixelRatio,_.pixelRatio)}},wi.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Xe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Xe.members,this.expression.isStateDependent))},wi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ni=function(e,t,r){this.binders={},this._buffers=[];var c=[];for(var v in e.paint._values)if(r(v)){var m=e.paint.get(v);if(m instanceof ss&&Is(m.property.specification)){var _=xo(v,e.type),C=m.value,k=m.property.specification.type,B=m.property.useIntegerZoom,W=m.property.specification["property-type"],$=W==="cross-faded"||W==="cross-faded-data-driven";if(C.kind==="constant")this.binders[v]=$?new Si(C.value,_):new ii(C.value,_,k),c.push("/u_"+v);else if(C.kind==="source"||$){var se=ja(v,k,"source");this.binders[v]=$?new wi(C,k,B,t,se,e.id):new ri(C,_,k,se),c.push("/a_"+v)}else{var pe=ja(v,k,"composite");this.binders[v]=new ai(C,_,k,B,t,pe),c.push("/z_"+v)}}}this.cacheKey=c.sort().join("")};ni.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof ri||t instanceof ai?t.maxValue:0},ni.prototype.populatePaintArrays=function(e,t,r,c,v){for(var m in this.binders){var _=this.binders[m];(_ instanceof ri||_ instanceof ai||_ instanceof wi)&&_.populatePaintArray(e,t,r,c,v)}},ni.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var c=this.binders[r];c instanceof Si&&c.setConstantPatternPositions(e,t)}},ni.prototype.updatePaintArrays=function(e,t,r,c,v){var m=!1;for(var _ in e)for(var C=0,k=t.getPositions(_);C<k.length;C+=1){var B=k[C],W=r.feature(B.index);for(var $ in this.binders){var se=this.binders[$];if((se instanceof ri||se instanceof ai||se instanceof wi)&&se.expression.isStateDependent===!0){var pe=c.paint.get($);se.expression=pe.value,se.updatePaintArray(B.start,B.end,W,e[_],v),m=!0}}}return m},ni.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof ii||r instanceof Si)&&e.push.apply(e,r.uniformNames.map(function(c){return"#define HAS_UNIFORM_"+c}))}return e},ni.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ri||r instanceof ai)for(var c=0;c<r.paintVertexAttributes.length;c++)e.push(r.paintVertexAttributes[c].name);else if(r instanceof wi)for(var v=0;v<Xe.members.length;v++)e.push(Xe.members[v].name)}return e},ni.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ii||r instanceof Si||r instanceof ai)for(var c=0,v=r.uniformNames;c<v.length;c+=1)e.push(v[c])}return e},ni.prototype.getPaintVertexBuffers=function(){return this._buffers},ni.prototype.getUniforms=function(e,t){var r=[];for(var c in this.binders){var v=this.binders[c];if(v instanceof ii||v instanceof Si||v instanceof ai)for(var m=0,_=v.uniformNames;m<_.length;m+=1){var C=_[m];if(t[C]){var k=v.getBinding(e,t[C],C);r.push({name:C,property:c,binding:k})}}}return r},ni.prototype.setUniforms=function(e,t,r,c){for(var v=0,m=t;v<m.length;v+=1){var _=m[v],C=_.name,k=_.property;this.binders[k].setUniform(_.binding,c,r.get(k),C)}},ni.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof wi){var c=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(r instanceof ri||r instanceof ai)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ni.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof ri||r instanceof ai||r instanceof wi)&&r.upload(e)}this.updatePaintBuffers()},ni.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof ri||t instanceof ai||t instanceof wi)&&t.destroy()}};var Jn=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var c=0,v=e;c<v.length;c+=1){var m=v[c];this.programConfigurations[m.id]=new ni(m,t,r)}this.needsUpload=!1,this._featureMap=new ht,this._bufferOffset=0};function xo(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function ja(e,t,r){var c={color:{source:Fl,composite:ac},number:{source:Tu,composite:Fl}},v=function(m){return{"line-pattern":{source:wu,composite:wu},"fill-pattern":{source:wu,composite:wu},"fill-extrusion-pattern":{source:wu,composite:wu}}[m]}(e);return v&&v[r]||c[t][r]}Jn.prototype.populatePaintArrays=function(e,t,r,c,v,m){for(var _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,t,c,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Jn.prototype.updatePaintArrays=function(e,t,r,c){for(var v=0,m=r;v<m.length;v+=1){var _=m[v];this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,t,_,c)||this.needsUpload}},Jn.prototype.get=function(e){return this.programConfigurations[e]},Jn.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},Jn.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Tn("ConstantBinder",ii),Tn("CrossFadedConstantBinder",Si),Tn("SourceExpressionBinder",ri),Tn("CrossFadedCompositeBinder",wi),Tn("CompositeExpressionBinder",ai),Tn("ProgramConfiguration",ni,{omit:["_buffers"]}),Tn("ProgramConfigurationSet",Jn);var Xo=Math.pow(2,14)-1,Oo=-Xo-1;function Za(e){for(var t=8192/e.extent,r=e.loadGeometry(),c=0;c<r.length;c++)for(var v=r[c],m=0;m<v.length;m++){var _=v[m],C=Math.round(_.x*t),k=Math.round(_.y*t);_.x=Kt(C,Oo,Xo),_.y=Kt(k,Oo,Xo),(C<_.x||C>_.x+1||k<_.y||k>_.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function ho(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Za(e):[]}}function Ss(e,t,r,c,v){e.emplaceBack(2*t+(c+1)/2,2*r+(v+1)/2)}var Yo=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Uu,this.indexArray=new tl,this.segments=new _e,this.programConfigurations=new Jn(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Zu(e,t){for(var r=0;r<e.length;r++)if(tu(t,e[r]))return!0;for(var c=0;c<t.length;c++)if(tu(e,t[c]))return!0;return!!ml(e,t)}function us(e,t,r){return!!tu(e,t)||!!Ws(t,e,r)}function Ls(e,t){if(e.length===1)return Bl(t,e[0]);for(var r=0;r<t.length;r++)for(var c=t[r],v=0;v<c.length;v++)if(tu(e,c[v]))return!0;for(var m=0;m<e.length;m++)if(Bl(t,e[m]))return!0;for(var _=0;_<t.length;_++)if(ml(e,t[_]))return!0;return!1}function Rs(e,t,r){if(e.length>1){if(ml(e,t))return!0;for(var c=0;c<t.length;c++)if(Ws(t[c],e,r))return!0}for(var v=0;v<e.length;v++)if(Ws(e[v],t,r))return!0;return!1}function ml(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var c=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(gl(c,v,t[m],t[m+1]))return!0;return!1}function gl(e,t,r,c){return Ae(e,r,c)!==Ae(t,r,c)&&Ae(e,t,r)!==Ae(e,t,c)}function Ws(e,t,r){var c=r*r;if(t.length===1)return e.distSqr(t[0])<c;for(var v=1;v<t.length;v++)if(rl(e,t[v-1],t[v])<c)return!0;return!1}function rl(e,t,r){var c=t.distSqr(r);if(c===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/c;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Bl(e,t){for(var r,c,v,m=!1,_=0;_<e.length;_++)for(var C=0,k=(r=e[_]).length-1;C<r.length;k=C++)(c=r[C]).y>t.y!=(v=r[k]).y>t.y&&t.x<(v.x-c.x)*(t.y-c.y)/(v.y-c.y)+c.x&&(m=!m);return m}function tu(e,t){for(var r=!1,c=0,v=e.length-1;c<e.length;v=c++){var m=e[c],_=e[v];m.y>t.y!=_.y>t.y&&t.x<(_.x-m.x)*(t.y-m.y)/(_.y-m.y)+m.x&&(r=!r)}return r}function nl(e,t,r){var c=r[0],v=r[2];if(e.x<c.x&&t.x<c.x||e.x>v.x&&t.x>v.x||e.y<c.y&&t.y<c.y||e.y>v.y&&t.y>v.y)return!1;var m=Ae(e,t,r[0]);return m!==Ae(e,t,r[1])||m!==Ae(e,t,r[2])||m!==Ae(e,t,r[3])}function ru(e,t,r){var c=t.paint.get(e).value;return c.kind==="constant"?c.value:r.programConfigurations.get(t.id).getMaxValue(e)}function io(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Vu(e,t,r,c,v){if(!t[0]&&!t[1])return e;var m=Y.convert(t)._mult(v);r==="viewport"&&m._rotate(-c);for(var _=[],C=0;C<e.length;C++)_.push(e[C].sub(m));return _}Yo.prototype.populate=function(e,t,r){var c=this.layers[0],v=[],m=null;c.type==="circle"&&(m=c.layout.get("circle-sort-key"));for(var _=0,C=e;_<C.length;_+=1){var k=C[_],B=k.feature,W=k.id,$=k.index,se=k.sourceLayerIndex,pe=this.layers[0]._featureFilter.needGeometry,Ze=ho(B,pe);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),Ze,r)){var We=m?m.evaluate(Ze,{},r):void 0,ot={id:W,properties:B.properties,type:B.type,sourceLayerIndex:se,index:$,geometry:pe?Ze.geometry:Za(B),patterns:{},sortKey:We};v.push(ot)}}m&&v.sort(function(pn,Wn){return pn.sortKey-Wn.sortKey});for(var Qe=0,At=v;Qe<At.length;Qe+=1){var Gt=At[Qe],ir=Gt.geometry,hr=Gt.index,Cr=Gt.sourceLayerIndex,tn=e[hr].feature;this.addFeature(Gt,ir,hr,r),t.featureIndex.insert(tn,ir,hr,Cr,this.index)}},Yo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Yo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Yo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Yo.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,de),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Yo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Yo.prototype.addFeature=function(e,t,r,c){for(var v=0,m=t;v<m.length;v+=1)for(var _=0,C=m[v];_<C.length;_+=1){var k=C[_],B=k.x,W=k.y;if(!(B<0||B>=8192||W<0||W>=8192)){var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),se=$.vertexLength;Ss(this.layoutVertexArray,B,W,-1,-1),Ss(this.layoutVertexArray,B,W,1,-1),Ss(this.layoutVertexArray,B,W,1,1),Ss(this.layoutVertexArray,B,W,-1,1),this.indexArray.emplaceBack(se,se+1,se+2),this.indexArray.emplaceBack(se,se+3,se+2),$.vertexLength+=4,$.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},c)},Tn("CircleBucket",Yo,{omit:["layers"]});var Cu=new Fo({"circle-sort-key":new Mn(ue.layout_circle["circle-sort-key"])}),Es={paint:new Fo({"circle-radius":new Mn(ue.paint_circle["circle-radius"]),"circle-color":new Mn(ue.paint_circle["circle-color"]),"circle-blur":new Mn(ue.paint_circle["circle-blur"]),"circle-opacity":new Mn(ue.paint_circle["circle-opacity"]),"circle-translate":new Zn(ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Zn(ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zn(ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zn(ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mn(ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mn(ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mn(ue.paint_circle["circle-stroke-opacity"])}),layout:Cu},Ki=typeof Float32Array!="undefined"?Float32Array:Array;function Lo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function po(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3],C=t[4],k=t[5],B=t[6],W=t[7],$=t[8],se=t[9],pe=t[10],Ze=t[11],We=t[12],ot=t[13],Qe=t[14],At=t[15],Gt=r[0],ir=r[1],hr=r[2],Cr=r[3];return e[0]=Gt*c+ir*C+hr*$+Cr*We,e[1]=Gt*v+ir*k+hr*se+Cr*ot,e[2]=Gt*m+ir*B+hr*pe+Cr*Qe,e[3]=Gt*_+ir*W+hr*Ze+Cr*At,e[4]=(Gt=r[4])*c+(ir=r[5])*C+(hr=r[6])*$+(Cr=r[7])*We,e[5]=Gt*v+ir*k+hr*se+Cr*ot,e[6]=Gt*m+ir*B+hr*pe+Cr*Qe,e[7]=Gt*_+ir*W+hr*Ze+Cr*At,e[8]=(Gt=r[8])*c+(ir=r[9])*C+(hr=r[10])*$+(Cr=r[11])*We,e[9]=Gt*v+ir*k+hr*se+Cr*ot,e[10]=Gt*m+ir*B+hr*pe+Cr*Qe,e[11]=Gt*_+ir*W+hr*Ze+Cr*At,e[12]=(Gt=r[12])*c+(ir=r[13])*C+(hr=r[14])*$+(Cr=r[15])*We,e[13]=Gt*v+ir*k+hr*se+Cr*ot,e[14]=Gt*m+ir*B+hr*pe+Cr*Qe,e[15]=Gt*_+ir*W+hr*Ze+Cr*At,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var pu,vs=po;function du(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3];return e[0]=r[0]*c+r[4]*v+r[8]*m+r[12]*_,e[1]=r[1]*c+r[5]*v+r[9]*m+r[13]*_,e[2]=r[2]*c+r[6]*v+r[10]*m+r[14]*_,e[3]=r[3]*c+r[7]*v+r[11]*m+r[15]*_,e}pu=new Ki(3),Ki!=Float32Array&&(pu[0]=0,pu[1]=0,pu[2]=0),function(){var e=new Ki(4);Ki!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var Gu=(function(){var e=new Ki(2);Ki!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,Es)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Yo(r)},t.prototype.queryRadius=function(r){var c=r;return ru("circle-radius",this,c)+ru("circle-stroke-width",this,c)+io(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k,B){for(var W=Vu(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,k),$=this.paint.get("circle-radius").evaluate(c,v)+this.paint.get("circle-stroke-width").evaluate(c,v),se=this.paint.get("circle-pitch-alignment")==="map",pe=se?W:function(tn,pn){return tn.map(function(Wn){return Hu(Wn,pn)})}(W,B),Ze=se?$*k:$,We=0,ot=m;We<ot.length;We+=1)for(var Qe=0,At=ot[We];Qe<At.length;Qe+=1){var Gt=At[Qe],ir=se?Gt:Hu(Gt,B),hr=Ze,Cr=du([],[Gt.x,Gt.y,0,1],B);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?hr*=Cr[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(hr*=C.cameraToCenterDistance/Cr[3]),us(pe,ir,hr))return!0}return!1},t}(bu));function Hu(e,t){var r=du([],[e.x,e.y,0,1],t);return new Y(r[0]/r[3],r[1]/r[3])}var Wu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Yo);function nu(e,t,r,c){var v=t.width,m=t.height;if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==v*m*r)throw new RangeError("mismatched image size")}else c=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=c,e}function Ul(e,t,r){var c=t.width,v=t.height;if(c!==e.width||v!==e.height){var m=nu({},{width:c,height:v},r);nf(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,c),height:Math.min(e.height,v)},r),e.width=c,e.height=v,e.data=m.data}}function nf(e,t,r,c,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||c.x>t.width-v.width||c.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var _=e.data,C=t.data,k=0;k<v.height;k++)for(var B=((r.y+k)*e.width+r.x)*m,W=((c.y+k)*t.width+c.x)*m,$=0;$<v.width*m;$++)C[W+$]=_[B+$];return t}Tn("HeatmapBucket",Wu,{omit:["layers"]});var Pu=function(e,t){nu(this,e,1,t)};Pu.prototype.resize=function(e){Ul(this,e,1)},Pu.prototype.clone=function(){return new Pu({width:this.width,height:this.height},new Uint8Array(this.data))},Pu.copy=function(e,t,r,c,v){nf(e,t,r,c,v,1)};var va=function(e,t){nu(this,e,4,t)};va.prototype.resize=function(e){Ul(this,e,4)},va.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},va.prototype.clone=function(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))},va.copy=function(e,t,r,c,v){nf(e,t,r,c,v,4)},Tn("AlphaImage",Pu),Tn("RGBAImage",va);var Qf={paint:new Fo({"heatmap-radius":new Mn(ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mn(ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zn(ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new To(ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zn(ue.paint_heatmap["heatmap-opacity"])})};function If(e){var t={},r=e.resolution||256,c=e.clips?e.clips.length:1,v=e.image||new va({width:r,height:c}),m=function(Ze,We,ot){t[e.evaluationKey]=ot;var Qe=e.expression.evaluate(t);v.data[Ze+We+0]=Math.floor(255*Qe.r/Qe.a),v.data[Ze+We+1]=Math.floor(255*Qe.g/Qe.a),v.data[Ze+We+2]=Math.floor(255*Qe.b/Qe.a),v.data[Ze+We+3]=Math.floor(255*Qe.a)};if(e.clips)for(var _=0,C=0;_<c;++_,C+=4*r)for(var k=0,B=0;k<r;k++,B+=4){var W=k/(r-1),$=e.clips[_];m(C,B,$.start*(1-W)+$.end*W)}else for(var se=0,pe=0;se<r;se++,pe+=4)m(0,pe,se/(r-1));return v}var Of=function(e){function t(r){e.call(this,r,Qf),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Wu(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=If({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(bu),il={paint:new Fo({"hillshade-illumination-direction":new Zn(ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zn(ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zn(ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zn(ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zn(ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zn(ue.paint_hillshade["hillshade-accent-color"])})},Lf=function(e){function t(r){e.call(this,r,il)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(bu),vh=_o([{name:"a_pos",components:2,type:"Int16"}],4).members,oc=bf,mh=bf;function bf(e,t,r){r=r||2;var c,v,m,_,C,k,B,W=t&&t.length,$=W?t[0]*r:e.length,se=gh(e,0,$,r,!0),pe=[];if(!se||se.next===se.prev)return pe;if(W&&(se=function(We,ot,Qe,At){var Gt,ir,hr,Cr=[];for(Gt=0,ir=ot.length;Gt<ir;Gt++)(hr=gh(We,ot[Gt]*At,Gt<ir-1?ot[Gt+1]*At:We.length,At,!1))===hr.next&&(hr.steiner=!0),Cr.push(Uh(hr));for(Cr.sort(yh),Gt=0;Gt<Cr.length;Gt++)uc(Cr[Gt],Qe),Qe=sc(Qe,Qe.next);return Qe}(e,t,se,r)),e.length>80*r){c=m=e[0],v=_=e[1];for(var Ze=r;Ze<$;Ze+=r)(C=e[Ze])<c&&(c=C),(k=e[Ze+1])<v&&(v=k),C>m&&(m=C),k>_&&(_=k);B=(B=Math.max(m-c,_-v))!==0?1/B:0}return af(se,pe,r,c,v,B),pe}function gh(e,t,r,c,v){var m,_;if(v===Pt(e,t,r,c)>0)for(m=t;m<r;m+=c)_=ve(m,e[m],e[m+1],_);else for(m=r-c;m>=t;m-=c)_=ve(m,e[m],e[m+1],_);return _&&Hc(_,_.next)&&(ut(_),_=_.next),_}function sc(e,t){if(!e)return e;t||(t=e);var r,c=e;do if(r=!1,c.steiner||!Hc(c,c.next)&&bo(c.prev,c,c.next)!==0)c=c.next;else{if(ut(c),(c=t=c.prev)===c.next)break;r=!0}while(r||c!==t);return t}function af(e,t,r,c,v,m,_){if(e){!_&&m&&function(W,$,se,pe){var Ze=W;do Ze.z===null&&(Ze.z=kf(Ze.x,Ze.y,$,se,pe)),Ze.prevZ=Ze.prev,Ze.nextZ=Ze.next,Ze=Ze.next;while(Ze!==W);Ze.prevZ.nextZ=null,Ze.prevZ=null,function(We){var ot,Qe,At,Gt,ir,hr,Cr,tn,pn=1;do{for(Qe=We,We=null,ir=null,hr=0;Qe;){for(hr++,At=Qe,Cr=0,ot=0;ot<pn&&(Cr++,At=At.nextZ);ot++);for(tn=pn;Cr>0||tn>0&&At;)Cr!==0&&(tn===0||!At||Qe.z<=At.z)?(Gt=Qe,Qe=Qe.nextZ,Cr--):(Gt=At,At=At.nextZ,tn--),ir?ir.nextZ=Gt:We=Gt,Gt.prevZ=ir,ir=Gt;Qe=At}ir.nextZ=null,pn*=2}while(hr>1)}(Ze)}(e,c,v,m);for(var C,k,B=e;e.prev!==e.next;)if(C=e.prev,k=e.next,m?qf(e,c,v,m):Rf(e))t.push(C.i/r),t.push(e.i/r),t.push(k.i/r),ut(e),e=k.next,B=k.next;else if((e=k)===B){_?_===1?af(e=Df(sc(e),t,r),t,r,c,v,m,2):_===2&&eh(e,t,r,c,v,m):af(sc(e),t,r,c,v,m,1);break}}}function Rf(e){var t=e.prev,r=e,c=e.next;if(bo(t,r,c)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Sc(t.x,t.y,r.x,r.y,c.x,c.y,v.x,v.y)&&bo(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function qf(e,t,r,c){var v=e.prev,m=e,_=e.next;if(bo(v,m,_)>=0)return!1;for(var C=v.x>m.x?v.x>_.x?v.x:_.x:m.x>_.x?m.x:_.x,k=v.y>m.y?v.y>_.y?v.y:_.y:m.y>_.y?m.y:_.y,B=kf(v.x<m.x?v.x<_.x?v.x:_.x:m.x<_.x?m.x:_.x,v.y<m.y?v.y<_.y?v.y:_.y:m.y<_.y?m.y:_.y,t,r,c),W=kf(C,k,t,r,c),$=e.prevZ,se=e.nextZ;$&&$.z>=B&&se&&se.z<=W;){if($!==e.prev&&$!==e.next&&Sc(v.x,v.y,m.x,m.y,_.x,_.y,$.x,$.y)&&bo($.prev,$,$.next)>=0||($=$.prevZ,se!==e.prev&&se!==e.next&&Sc(v.x,v.y,m.x,m.y,_.x,_.y,se.x,se.y)&&bo(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;$&&$.z>=B;){if($!==e.prev&&$!==e.next&&Sc(v.x,v.y,m.x,m.y,_.x,_.y,$.x,$.y)&&bo($.prev,$,$.next)>=0)return!1;$=$.prevZ}for(;se&&se.z<=W;){if(se!==e.prev&&se!==e.next&&Sc(v.x,v.y,m.x,m.y,_.x,_.y,se.x,se.y)&&bo(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function Df(e,t,r){var c=e;do{var v=c.prev,m=c.next.next;!Hc(v,m)&&Z(v,c,c.next,m)&&R(v,m)&&R(m,v)&&(t.push(v.i/r),t.push(c.i/r),t.push(m.i/r),ut(c),ut(c.next),c=e=m),c=c.next}while(c!==e);return sc(c)}function eh(e,t,r,c,v,m){var _=e;do{for(var C=_.next.next;C!==_.prev;){if(_.i!==C.i&&zf(_,C)){var k=te(_,C);return _=sc(_,_.next),k=sc(k,k.next),af(_,t,r,c,v,m),void af(k,t,r,c,v,m)}C=C.next}_=_.next}while(_!==e)}function yh(e,t){return e.x-t.x}function uc(e,t){if(t=function(c,v){var m,_=v,C=c.x,k=c.y,B=-1/0;do{if(k<=_.y&&k>=_.next.y&&_.next.y!==_.y){var W=_.x+(k-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(W<=C&&W>B){if(B=W,W===C){if(k===_.y)return _;if(k===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==v);if(!m)return null;if(C===B)return m;var $,se=m,pe=m.x,Ze=m.y,We=1/0;_=m;do C>=_.x&&_.x>=pe&&C!==_.x&&Sc(k<Ze?C:B,k,pe,Ze,k<Ze?B:C,k,_.x,_.y)&&($=Math.abs(k-_.y)/(C-_.x),R(_,c)&&($<We||$===We&&(_.x>m.x||_.x===m.x&&_h(m,_)))&&(m=_,We=$)),_=_.next;while(_!==se);return m}(e,t)){var r=te(t,e);sc(t,t.next),sc(r,r.next)}}function _h(e,t){return bo(e.prev,e,t.prev)<0&&bo(t.next,e,e.next)<0}function kf(e,t,r,c,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-c)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Uh(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Sc(e,t,r,c,v,m,_,C){return(v-_)*(t-C)-(e-_)*(m-C)>=0&&(e-_)*(c-C)-(r-_)*(t-C)>=0&&(r-_)*(m-C)-(v-_)*(c-C)>=0}function zf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,c){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==c.i&&v.next.i!==c.i&&Z(v,v.next,r,c))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(R(e,t)&&R(t,e)&&function(r,c){var v=r,m=!1,_=(r.x+c.x)/2,C=(r.y+c.y)/2;do v.y>C!=v.next.y>C&&v.next.y!==v.y&&_<(v.next.x-v.x)*(C-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(bo(e.prev,e,t.prev)||bo(e,t.prev,t))||Hc(e,t)&&bo(e.prev,e,e.next)>0&&bo(t.prev,t,t.next)>0)}function bo(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Hc(e,t){return e.x===t.x&&e.y===t.y}function Z(e,t,r,c){var v=M(bo(e,t,r)),m=M(bo(e,t,c)),_=M(bo(r,c,e)),C=M(bo(r,c,t));return v!==m&&_!==C||!(v!==0||!N(e,r,t))||!(m!==0||!N(e,c,t))||!(_!==0||!N(r,e,c))||!(C!==0||!N(r,t,c))}function N(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function M(e){return e>0?1:e<0?-1:0}function R(e,t){return bo(e.prev,e,e.next)<0?bo(e,t,e.next)>=0&&bo(e,e.prev,t)>=0:bo(e,t,e.prev)<0||bo(e,e.next,t)<0}function te(e,t){var r=new Nt(e.i,e.x,e.y),c=new Nt(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,c.next=r,r.prev=c,m.next=c,c.prev=m,c}function ve(e,t,r,c){var v=new Nt(e,t,r);return c?(v.next=c.next,v.prev=c,c.next.prev=v,c.next=v):(v.prev=v,v.next=v),v}function ut(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nt(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pt(e,t,r,c){for(var v=0,m=t,_=r-c;m<r;m+=c)v+=(e[_]-e[m])*(e[m+1]+e[_+1]),_=m;return v}function Sr(e,t,r,c,v){(function m(_,C,k,B,W){for(;B>k;){if(B-k>600){var $=B-k+1,se=C-k+1,pe=Math.log($),Ze=.5*Math.exp(2*pe/3),We=.5*Math.sqrt(pe*Ze*($-Ze)/$)*(se-$/2<0?-1:1);m(_,C,Math.max(k,Math.floor(C-se*Ze/$+We)),Math.min(B,Math.floor(C+($-se)*Ze/$+We)),W)}var ot=_[C],Qe=k,At=B;for(Ur(_,k,C),W(_[B],ot)>0&&Ur(_,k,B);Qe<At;){for(Ur(_,Qe,At),Qe++,At--;W(_[Qe],ot)<0;)Qe++;for(;W(_[At],ot)>0;)At--}W(_[k],ot)===0?Ur(_,k,At):Ur(_,++At,B),At<=C&&(k=At+1),C<=At&&(B=At-1)}})(e,t,r||0,c||e.length-1,v||Fn)}function Ur(e,t,r){var c=e[t];e[t]=e[r],e[r]=c}function Fn(e,t){return e<t?-1:e>t?1:0}function Gn(e,t){var r=e.length;if(r<=1)return[e];for(var c,v,m=[],_=0;_<r;_++){var C=Ne(e[_]);C!==0&&(e[_].area=Math.abs(C),v===void 0&&(v=C<0),v===C<0?(c&&m.push(c),c=[e[_]]):c.push(e[_]))}if(c&&m.push(c),t>1)for(var k=0;k<m.length;k++)m[k].length<=t||(Sr(m[k],t,1,m[k].length-1,vi),m[k]=m[k].slice(0,t));return m}function vi(e,t){return t.area-e.area}function mi(e,t,r){for(var c=r.patternDependencies,v=!1,m=0,_=t;m<_.length;m+=1){var C=_[m].paint.get(e+"-pattern");C.isConstant()||(v=!0);var k=C.constantOr(null);k&&(v=!0,c[k.to]=!0,c[k.from]=!0)}return v}function ci(e,t,r,c,v){for(var m=v.patternDependencies,_=0,C=t;_<C.length;_+=1){var k=C[_],B=k.paint.get(e+"-pattern").value;if(B.kind!=="constant"){var W=B.evaluate({zoom:c-1},r,{},v.availableImages),$=B.evaluate({zoom:c},r,{},v.availableImages),se=B.evaluate({zoom:c+1},r,{},v.availableImages);$=$&&$.name?$.name:$,se=se&&se.name?se.name:se,m[W=W&&W.name?W.name:W]=!0,m[$]=!0,m[se]=!0,r.patterns[k.id]={min:W,mid:$,max:se}}}return r}bf.deviation=function(e,t,r,c){var v=t&&t.length,m=Math.abs(Pt(e,0,v?t[0]*r:e.length,r));if(v)for(var _=0,C=t.length;_<C;_++)m-=Math.abs(Pt(e,t[_]*r,_<C-1?t[_+1]*r:e.length,r));var k=0;for(_=0;_<c.length;_+=3){var B=c[_]*r,W=c[_+1]*r,$=c[_+2]*r;k+=Math.abs((e[B]-e[$])*(e[W+1]-e[B+1])-(e[B]-e[W])*(e[$+1]-e[B+1]))}return m===0&&k===0?0:Math.abs((k-m)/m)},bf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},c=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var _=0;_<t;_++)r.vertices.push(e[v][m][_]);v>0&&r.holes.push(c+=e[v-1].length)}return r},oc.default=mh;var ji=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Uu,this.indexArray=new tl,this.indexArray2=new ic,this.programConfigurations=new Jn(e.layers,e.zoom),this.segments=new _e,this.segments2=new _e,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};ji.prototype.populate=function(e,t,r){this.hasPattern=mi("fill",this.layers,t);for(var c=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var C=_[m],k=C.feature,B=C.id,W=C.index,$=C.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,pe=ho(k,se);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),pe,r)){var Ze=c?c.evaluate(pe,{},r,t.availableImages):void 0,We={id:B,properties:k.properties,type:k.type,sourceLayerIndex:$,index:W,geometry:se?pe.geometry:Za(k),patterns:{},sortKey:Ze};v.push(We)}}c&&v.sort(function(tn,pn){return tn.sortKey-pn.sortKey});for(var ot=0,Qe=v;ot<Qe.length;ot+=1){var At=Qe[ot],Gt=At.geometry,ir=At.index,hr=At.sourceLayerIndex;if(this.hasPattern){var Cr=ci("fill",this.layers,At,this.zoom,t);this.patternFeatures.push(Cr)}else this.addFeature(At,Gt,ir,r,{});t.featureIndex.insert(e[ir].feature,Gt,ir,hr,this.index)}},ji.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},ji.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.patternFeatures;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},ji.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ji.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ji.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},ji.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ji.prototype.addFeature=function(e,t,r,c,v){for(var m=0,_=Gn(t,500);m<_.length;m+=1){for(var C=_[m],k=0,B=0,W=C;B<W.length;B+=1)k+=W[B].length;for(var $=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),se=$.vertexLength,pe=[],Ze=[],We=0,ot=C;We<ot.length;We+=1){var Qe=ot[We];if(Qe.length!==0){Qe!==C[0]&&Ze.push(pe.length/2);var At=this.segments2.prepareSegment(Qe.length,this.layoutVertexArray,this.indexArray2),Gt=At.vertexLength;this.layoutVertexArray.emplaceBack(Qe[0].x,Qe[0].y),this.indexArray2.emplaceBack(Gt+Qe.length-1,Gt),pe.push(Qe[0].x),pe.push(Qe[0].y);for(var ir=1;ir<Qe.length;ir++)this.layoutVertexArray.emplaceBack(Qe[ir].x,Qe[ir].y),this.indexArray2.emplaceBack(Gt+ir-1,Gt+ir),pe.push(Qe[ir].x),pe.push(Qe[ir].y);At.vertexLength+=Qe.length,At.primitiveLength+=Qe.length}}for(var hr=oc(pe,Ze),Cr=0;Cr<hr.length;Cr+=3)this.indexArray.emplaceBack(se+hr[Cr],se+hr[Cr+1],se+hr[Cr+2]);$.vertexLength+=k,$.primitiveLength+=hr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},Tn("FillBucket",ji,{omit:["layers","patternFeatures"]});var Gi=new Fo({"fill-sort-key":new Mn(ue.layout_fill["fill-sort-key"])}),Ao={paint:new Fo({"fill-antialias":new Zn(ue.paint_fill["fill-antialias"]),"fill-opacity":new Mn(ue.paint_fill["fill-opacity"]),"fill-color":new Mn(ue.paint_fill["fill-color"]),"fill-outline-color":new Mn(ue.paint_fill["fill-outline-color"]),"fill-translate":new Zn(ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Zn(ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new ec(ue.paint_fill["fill-pattern"])}),layout:Gi},No=function(e){function t(r){e.call(this,r,Ao)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,c){e.prototype.recalculate.call(this,r,c);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new ji(r)},t.prototype.queryRadius=function(){return io(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k){return Ls(Vu(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,k),m)},t.prototype.isTileClipped=function(){return!0},t}(bu),Ko=_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,$a=Da;function Da(e,t,r,c,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=v,e.readFields(ma,this,t)}function ma(e,t,r){e==1?t.id=r.readVarint():e==2?function(c,v){for(var m=c.readVarint()+c.pos;c.pos<m;){var _=v._keys[c.readVarint()],C=v._values[c.readVarint()];v.properties[_]=C}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function ao(e){for(var t,r,c=0,v=0,m=e.length,_=m-1;v<m;_=v++)c+=((r=e[_]).x-(t=e[v]).x)*(t.y+r.y);return c}Da.types=["Unknown","Point","LineString","Polygon"],Da.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,c=1,v=0,m=0,_=0,C=[];e.pos<r;){if(v<=0){var k=e.readVarint();c=7&k,v=k>>3}if(v--,c===1||c===2)m+=e.readSVarint(),_+=e.readSVarint(),c===1&&(t&&C.push(t),t=[]),t.push(new Y(m,_));else{if(c!==7)throw new Error("unknown command "+c);t&&t.push(t[0].clone())}}return t&&C.push(t),C},Da.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,c=0,v=0,m=0,_=1/0,C=-1/0,k=1/0,B=-1/0;e.pos<t;){if(c<=0){var W=e.readVarint();r=7&W,c=W>>3}if(c--,r===1||r===2)(v+=e.readSVarint())<_&&(_=v),v>C&&(C=v),(m+=e.readSVarint())<k&&(k=m),m>B&&(B=m);else if(r!==7)throw new Error("unknown command "+r)}return[_,k,C,B]},Da.prototype.toGeoJSON=function(e,t,r){var c,v,m=this.extent*Math.pow(2,r),_=this.extent*e,C=this.extent*t,k=this.loadGeometry(),B=Da.types[this.type];function W(pe){for(var Ze=0;Ze<pe.length;Ze++){var We=pe[Ze];pe[Ze]=[360*(We.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+C)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(c=0;c<k.length;c++)$[c]=k[c][0];W(k=$);break;case 2:for(c=0;c<k.length;c++)W(k[c]);break;case 3:for(k=function(pe){var Ze=pe.length;if(Ze<=1)return[pe];for(var We,ot,Qe=[],At=0;At<Ze;At++){var Gt=ao(pe[At]);Gt!==0&&(ot===void 0&&(ot=Gt<0),ot===Gt<0?(We&&Qe.push(We),We=[pe[At]]):We.push(pe[At]))}return We&&Qe.push(We),Qe}(k),c=0;c<k.length;c++)for(v=0;v<k[c].length;v++)W(k[c][v])}k.length===1?k=k[0]:B="Multi"+B;var se={type:"Feature",geometry:{type:B,coordinates:k},properties:this.properties};return"id"in this&&(se.id=this.id),se};var ms=Bo;function Bo(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields($o,this,t),this.length=this._features.length}function $o(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(c){for(var v=null,m=c.readVarint()+c.pos;c.pos<m;){var _=c.readVarint()>>3;v=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return v}(r))}function vo(e,t,r){if(e===3){var c=new ms(r,r.readVarint()+r.pos);c.length&&(t[c.name]=c)}}Bo.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new $a(this._pbf,t,this.extent,this._keys,this._values)};var Xs={VectorTile:function(e,t){this.layers=e.readFields(vo,{},t)},VectorTileFeature:$a,VectorTileLayer:ms},yl=Xs.VectorTileFeature.types,Ds=Math.pow(2,13);function _l(e,t,r,c,v,m,_,C){e.emplaceBack(t,r,2*Math.floor(c*Ds)+_,v*Ds*2,m*Ds*2,Math.round(C))}var Ys=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Eu,this.indexArray=new tl,this.programConfigurations=new Jn(e.layers,e.zoom),this.segments=new _e,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Ff(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Ys.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=mi("fill-extrusion",this.layers,t);for(var c=0,v=e;c<v.length;c+=1){var m=v[c],_=m.feature,C=m.id,k=m.index,B=m.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,$=ho(_,W);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),$,r)){var se={id:C,sourceLayerIndex:B,index:k,geometry:W?$.geometry:Za(_),properties:_.properties,type:_.type,patterns:{}};this.hasPattern?this.features.push(ci("fill-extrusion",this.layers,se,this.zoom,t)):this.addFeature(se,se.geometry,k,r,{}),t.featureIndex.insert(_,se.geometry,k,B,this.index,!0)}}},Ys.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.features;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},Ys.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Ys.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ys.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ys.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ko),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Ys.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ys.prototype.addFeature=function(e,t,r,c,v){for(var m=0,_=Gn(t,500);m<_.length;m+=1){for(var C=_[m],k=0,B=0,W=C;B<W.length;B+=1)k+=W[B].length;for(var $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),se=0,pe=C;se<pe.length;se+=1){var Ze=pe[se];if(Ze.length!==0&&!((na=Ze).every(function(Pi){return Pi.x<0})||na.every(function(Pi){return Pi.x>8192})||na.every(function(Pi){return Pi.y<0})||na.every(function(Pi){return Pi.y>8192})))for(var We=0,ot=0;ot<Ze.length;ot++){var Qe=Ze[ot];if(ot>=1){var At=Ze[ot-1];if(!Ff(Qe,At)){$.vertexLength+4>_e.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Gt=Qe.sub(At)._perp()._unit(),ir=At.dist(Qe);We+ir>32768&&(We=0),_l(this.layoutVertexArray,Qe.x,Qe.y,Gt.x,Gt.y,0,0,We),_l(this.layoutVertexArray,Qe.x,Qe.y,Gt.x,Gt.y,0,1,We),_l(this.layoutVertexArray,At.x,At.y,Gt.x,Gt.y,0,0,We+=ir),_l(this.layoutVertexArray,At.x,At.y,Gt.x,Gt.y,0,1,We);var hr=$.vertexLength;this.indexArray.emplaceBack(hr,hr+2,hr+1),this.indexArray.emplaceBack(hr+1,hr+2,hr+3),$.vertexLength+=4,$.primitiveLength+=2}}}}if($.vertexLength+k>_e.MAX_VERTEX_ARRAY_LENGTH&&($=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),yl[e.type]==="Polygon"){for(var Cr=[],tn=[],pn=$.vertexLength,Wn=0,Sn=C;Wn<Sn.length;Wn+=1){var Kn=Sn[Wn];if(Kn.length!==0){Kn!==C[0]&&tn.push(Cr.length/2);for(var En=0;En<Kn.length;En++){var si=Kn[En];_l(this.layoutVertexArray,si.x,si.y,0,0,1,1,0),Cr.push(si.x),Cr.push(si.y)}}}for(var ui=oc(Cr,tn),Ln=0;Ln<ui.length;Ln+=3)this.indexArray.emplaceBack(pn+ui[Ln],pn+ui[Ln+2],pn+ui[Ln+1]);$.primitiveLength+=ui.length/3,$.vertexLength+=k}}var na;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},Tn("FillExtrusionBucket",Ys,{omit:["layers","features"]});var jh={paint:new Fo({"fill-extrusion-opacity":new Zn(ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mn(ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zn(ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zn(ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ec(ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mn(ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mn(ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Zn(ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Mu=function(e){function t(r){e.call(this,r,jh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ys(r)},t.prototype.queryRadius=function(){return io(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k,B){var W=Vu(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,k),$=this.paint.get("fill-extrusion-height").evaluate(c,v),se=this.paint.get("fill-extrusion-base").evaluate(c,v),pe=function(We,ot,Qe,At){for(var Gt=[],ir=0,hr=We;ir<hr.length;ir+=1){var Cr=hr[ir],tn=[Cr.x,Cr.y,0,1];du(tn,tn,ot),Gt.push(new Y(tn[0]/tn[3],tn[1]/tn[3]))}return Gt}(W,B),Ze=function(We,ot,Qe,At){for(var Gt=[],ir=[],hr=At[8]*ot,Cr=At[9]*ot,tn=At[10]*ot,pn=At[11]*ot,Wn=At[8]*Qe,Sn=At[9]*Qe,Kn=At[10]*Qe,En=At[11]*Qe,si=0,ui=We;si<ui.length;si+=1){for(var Ln=[],na=[],Pi=0,ua=ui[si];Pi<ua.length;Pi+=1){var ei=ua[Pi],la=ei.x,Va=ei.y,Ro=At[0]*la+At[4]*Va+At[12],Po=At[1]*la+At[5]*Va+At[13],mo=At[2]*la+At[6]*Va+At[14],qa=At[3]*la+At[7]*Va+At[15],cs=mo+tn,es=qa+pn,vu=Ro+Wn,Fs=Po+Sn,_s=mo+Kn,ts=qa+En,Ns=new Y((Ro+hr)/es,(Po+Cr)/es);Ns.z=cs/es,Ln.push(Ns);var oa=new Y(vu/ts,Fs/ts);oa.z=_s/ts,na.push(oa)}Gt.push(Ln),ir.push(na)}return[Gt,ir]}(m,se,$,B);return function(We,ot,Qe){var At=1/0;Ls(Qe,ot)&&(At=Uo(Qe,ot[0]));for(var Gt=0;Gt<ot.length;Gt++)for(var ir=ot[Gt],hr=We[Gt],Cr=0;Cr<ir.length-1;Cr++){var tn=ir[Cr],pn=[tn,ir[Cr+1],hr[Cr+1],hr[Cr],tn];Zu(Qe,pn)&&(At=Math.min(At,Uo(Qe,pn)))}return At!==1/0&&At}(Ze[0],Ze[1],pe)},t}(bu);function xl(e,t){return e.x*t.x+e.y*t.y}function Uo(e,t){if(e.length===1){for(var r,c=0,v=t[c++];!r||v.equals(r);)if(!(r=t[c++]))return 1/0;for(;c<t.length;c++){var m=t[c],_=e[0],C=r.sub(v),k=m.sub(v),B=_.sub(v),W=xl(C,C),$=xl(C,k),se=xl(k,k),pe=xl(B,C),Ze=xl(B,k),We=W*se-$*$,ot=(se*pe-$*Ze)/We,Qe=(W*Ze-$*pe)/We,At=v.z*(1-ot-Qe)+r.z*ot+m.z*Qe;if(isFinite(At))return At}return 1/0}for(var Gt=1/0,ir=0,hr=t;ir<hr.length;ir+=1)Gt=Math.min(Gt,hr[ir].z);return Gt}var Iu=_o([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Zh=_o([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,hp=Xs.VectorTileFeature.types,pp=Math.cos(Math.PI/180*37.5),Vh=Math.pow(2,14)/.5,iu=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Os,this.layoutVertexArray2=new Fl,this.indexArray=new tl,this.programConfigurations=new Jn(e.layers,e.zoom),this.segments=new _e,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};iu.prototype.populate=function(e,t,r){this.hasPattern=mi("line",this.layers,t);for(var c=this.layers[0].layout.get("line-sort-key"),v=[],m=0,_=e;m<_.length;m+=1){var C=_[m],k=C.feature,B=C.id,W=C.index,$=C.sourceLayerIndex,se=this.layers[0]._featureFilter.needGeometry,pe=ho(k,se);if(this.layers[0]._featureFilter.filter(new Di(this.zoom),pe,r)){var Ze=c?c.evaluate(pe,{},r):void 0,We={id:B,properties:k.properties,type:k.type,sourceLayerIndex:$,index:W,geometry:se?pe.geometry:Za(k),patterns:{},sortKey:Ze};v.push(We)}}c&&v.sort(function(tn,pn){return tn.sortKey-pn.sortKey});for(var ot=0,Qe=v;ot<Qe.length;ot+=1){var At=Qe[ot],Gt=At.geometry,ir=At.index,hr=At.sourceLayerIndex;if(this.hasPattern){var Cr=ci("line",this.layers,At,this.zoom,t);this.patternFeatures.push(Cr)}else this.addFeature(At,Gt,ir,r,{});t.featureIndex.insert(e[ir].feature,Gt,ir,hr,this.index)}},iu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},iu.prototype.addFeatures=function(e,t,r){for(var c=0,v=this.patternFeatures;c<v.length;c+=1){var m=v[c];this.addFeature(m,m.geometry,m.index,t,r)}},iu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},iu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},iu.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Zh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Iu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},iu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},iu.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},iu.prototype.addFeature=function(e,t,r,c,v){var m=this.layers[0].layout,_=m.get("line-join").evaluate(e,{}),C=m.get("line-cap"),k=m.get("line-miter-limit"),B=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var W=0,$=t;W<$.length;W+=1)this.addLine($[W],e,_,C,k,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,c)},iu.prototype.addLine=function(e,t,r,c,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var _=0;_<e.length-1;_++)this.totalDistance+=e[_].dist(e[_+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var C=hp[t.type]==="Polygon",k=e.length;k>=2&&e[k-1].equals(e[k-2]);)k--;for(var B=0;B<k-1&&e[B].equals(e[B+1]);)B++;if(!(k<(C?3:2))){r==="bevel"&&(v=1.05);var W,$=this.overscaling<=16?122880/(512*this.overscaling):0,se=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),pe=void 0,Ze=void 0,We=void 0,ot=void 0;this.e1=this.e2=-1,C&&(ot=e[B].sub(W=e[k-2])._unit()._perp());for(var Qe=B;Qe<k;Qe++)if(!(Ze=Qe===k-1?C?e[B+1]:void 0:e[Qe+1])||!e[Qe].equals(Ze)){ot&&(We=ot),W&&(pe=W),W=e[Qe],ot=Ze?Ze.sub(W)._unit()._perp():We;var At=(We=We||ot).add(ot);At.x===0&&At.y===0||At._unit();var Gt=We.x*ot.x+We.y*ot.y,ir=At.x*ot.x+At.y*ot.y,hr=ir!==0?1/ir:1/0,Cr=2*Math.sqrt(2-2*ir),tn=ir<pp&&pe&&Ze,pn=We.x*ot.y-We.y*ot.x>0;if(tn&&Qe>B){var Wn=W.dist(pe);if(Wn>2*$){var Sn=W.sub(W.sub(pe)._mult($/Wn)._round());this.updateDistance(pe,Sn),this.addCurrentVertex(Sn,We,0,0,se),pe=Sn}}var Kn=pe&&Ze,En=Kn?r:C?"butt":c;if(Kn&&En==="round"&&(hr<m?En="miter":hr<=2&&(En="fakeround")),En==="miter"&&hr>v&&(En="bevel"),En==="bevel"&&(hr>2&&(En="flipbevel"),hr<v&&(En="miter")),pe&&this.updateDistance(pe,W),En==="miter")At._mult(hr),this.addCurrentVertex(W,At,0,0,se);else if(En==="flipbevel"){if(hr>100)At=ot.mult(-1);else{var si=hr*We.add(ot).mag()/We.sub(ot).mag();At._perp()._mult(si*(pn?-1:1))}this.addCurrentVertex(W,At,0,0,se),this.addCurrentVertex(W,At.mult(-1),0,0,se)}else if(En==="bevel"||En==="fakeround"){var ui=-Math.sqrt(hr*hr-1),Ln=pn?ui:0,na=pn?0:ui;if(pe&&this.addCurrentVertex(W,We,Ln,na,se),En==="fakeround")for(var Pi=Math.round(180*Cr/Math.PI/20),ua=1;ua<Pi;ua++){var ei=ua/Pi;if(ei!==.5){var la=ei-.5;ei+=ei*la*(ei-1)*((1.0904+Gt*(Gt*(3.55645-1.43519*Gt)-3.2452))*la*la+(.848013+Gt*(.215638*Gt-1.06021)))}var Va=ot.sub(We)._mult(ei)._add(We)._unit()._mult(pn?-1:1);this.addHalfVertex(W,Va.x,Va.y,!1,pn,0,se)}Ze&&this.addCurrentVertex(W,ot,-Ln,-na,se)}else if(En==="butt")this.addCurrentVertex(W,At,0,0,se);else if(En==="square"){var Ro=pe?1:-1;this.addCurrentVertex(W,At,Ro,Ro,se)}else En==="round"&&(pe&&(this.addCurrentVertex(W,We,0,0,se),this.addCurrentVertex(W,We,1,1,se,!0)),Ze&&(this.addCurrentVertex(W,ot,-1,-1,se,!0),this.addCurrentVertex(W,ot,0,0,se)));if(tn&&Qe<k-1){var Po=W.dist(Ze);if(Po>2*$){var mo=W.add(Ze.sub(W)._mult($/Po)._round());this.updateDistance(W,mo),this.addCurrentVertex(mo,ot,0,0,se),W=mo}}}}},iu.prototype.addCurrentVertex=function(e,t,r,c,v,m){m===void 0&&(m=!1);var _=t.y*c-t.x,C=-t.y-t.x*c;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,_,C,m,!0,-c,v),this.distance>Vh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,c,v,m))},iu.prototype.addHalfVertex=function(e,t,r,c,v,m,_){var C=.5*(this.lineClips?this.scaledDistance*(Vh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(c?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=_.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),_.primitiveLength++),v?this.e2=k:this.e1=k},iu.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},iu.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Tn("LineBucket",iu,{omit:["layers","patternFeatures"]});var xh=new Fo({"line-cap":new Zn(ue.layout_line["line-cap"]),"line-join":new Mn(ue.layout_line["line-join"]),"line-miter-limit":new Zn(ue.layout_line["line-miter-limit"]),"line-round-limit":new Zn(ue.layout_line["line-round-limit"]),"line-sort-key":new Mn(ue.layout_line["line-sort-key"])}),Gh={paint:new Fo({"line-opacity":new Mn(ue.paint_line["line-opacity"]),"line-color":new Mn(ue.paint_line["line-color"]),"line-translate":new Zn(ue.paint_line["line-translate"]),"line-translate-anchor":new Zn(ue.paint_line["line-translate-anchor"]),"line-width":new Mn(ue.paint_line["line-width"]),"line-gap-width":new Mn(ue.paint_line["line-gap-width"]),"line-offset":new Mn(ue.paint_line["line-offset"]),"line-blur":new Mn(ue.paint_line["line-blur"]),"line-dasharray":new zo(ue.paint_line["line-dasharray"]),"line-pattern":new ec(ue.paint_line["line-pattern"]),"line-gradient":new To(ue.paint_line["line-gradient"])}),layout:xh},bh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,c){return c=new Di(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),e.prototype.possiblyEvaluate.call(this,r,c)},t.prototype.evaluate=function(r,c,v,m){return c=Xt({},c,{zoom:Math.floor(c.zoom)}),e.prototype.evaluate.call(this,r,c,v,m)},t}(Mn))(Gh.paint.properties["line-width"].specification);bh.useIntegerZoom=!0;var Sh=function(e){function t(r){e.call(this,r,Gh),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ra,this.gradientVersion=(this.gradientVersion+1)%be)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,c){e.prototype.recalculate.call(this,r,c),this.paint._values["line-floorwidth"]=bh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new iu(r)},t.prototype.queryRadius=function(r){var c=r,v=Hh(ru("line-width",this,c),ru("line-gap-width",this,c)),m=ru("line-offset",this,c);return v/2+Math.abs(m)+io(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,c,v,m,_,C,k){var B=Vu(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,k),W=k/2*Hh(this.paint.get("line-width").evaluate(c,v),this.paint.get("line-gap-width").evaluate(c,v)),$=this.paint.get("line-offset").evaluate(c,v);return $&&(m=function(se,pe){for(var Ze=[],We=new Y(0,0),ot=0;ot<se.length;ot++){for(var Qe=se[ot],At=[],Gt=0;Gt<Qe.length;Gt++){var ir=Qe[Gt],hr=Qe[Gt+1],Cr=Gt===0?We:ir.sub(Qe[Gt-1])._unit()._perp(),tn=Gt===Qe.length-1?We:hr.sub(ir)._unit()._perp(),pn=Cr._add(tn)._unit();pn._mult(1/(pn.x*tn.x+pn.y*tn.y)),At.push(pn._mult(pe)._add(ir))}Ze.push(At)}return Ze}(m,$*k)),function(se,pe,Ze){for(var We=0;We<pe.length;We++){var ot=pe[We];if(se.length>=3){for(var Qe=0;Qe<ot.length;Qe++)if(tu(se,ot[Qe]))return!0}if(Rs(se,ot,Ze))return!0}return!1}(B,m,W)},t.prototype.isTileClipped=function(){return!0},t}(bu);function Hh(e,t){return t>0?t+2*e:e}var dp=_o([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wh=_o([{name:"a_projected_pos",components:3,type:"Float32"}],4),Xh=(_o([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),_o([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Eh=(_o([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),_o([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),vp=_o([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Sf(e,t,r){return e.sections.forEach(function(c){c.text=function(v,m,_){var C=m.layout.get("text-transform").evaluate(_,{});return C==="uppercase"?v=v.toLocaleUpperCase():C==="lowercase"&&(v=v.toLocaleLowerCase()),Js.applyArabicShaping&&(v=Js.applyArabicShaping(v)),v}(c.text,t,r)}),e}_o([{name:"triangle",components:3,type:"Uint16"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),_o([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_o([{type:"Float32",name:"offsetX"}]),_o([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Yh=function(e,t,r,c,v){var m,_,C=8*v-c-1,k=(1<<C)-1,B=k>>1,W=-7,$=r?v-1:0,se=r?-1:1,pe=e[t+$];for($+=se,m=pe&(1<<-W)-1,pe>>=-W,W+=C;W>0;m=256*m+e[t+$],$+=se,W-=8);for(_=m&(1<<-W)-1,m>>=-W,W+=c;W>0;_=256*_+e[t+$],$+=se,W-=8);if(m===0)m=1-B;else{if(m===k)return _?NaN:1/0*(pe?-1:1);_+=Math.pow(2,c),m-=B}return(pe?-1:1)*_*Math.pow(2,m-c)},U=function(e,t,r,c,v,m){var _,C,k,B=8*m-v-1,W=(1<<B)-1,$=W>>1,se=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,pe=c?0:m-1,Ze=c?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(C=isNaN(t)?1:0,_=W):(_=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-_))<1&&(_--,k*=2),(t+=_+$>=1?se/k:se*Math.pow(2,1-$))*k>=2&&(_++,k/=2),_+$>=W?(C=0,_=W):_+$>=1?(C=(t*k-1)*Math.pow(2,v),_+=$):(C=t*Math.pow(2,$-1)*Math.pow(2,v),_=0));v>=8;e[r+pe]=255&C,pe+=Ze,C/=256,v-=8);for(_=_<<v|C,B+=v;B>0;e[r+pe]=255&_,pe+=Ze,_/=256,B-=8);e[r+pe-Ze]|=128*We},Se=ze;function ze(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ze.Varint=0,ze.Fixed64=1,ze.Bytes=2,ze.Fixed32=5;var Qt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wr(e){return e.type===ze.Bytes?e.readVarint()+e.pos:e.pos+1}function Yt(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function fr(e,t,r){var c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(c);for(var v=r.pos-1;v>=e;v--)r.buf[v+c]=r.buf[v]}function Zr(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Xr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function qr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Kr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function nn(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function fn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Vr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function an(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Ft(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function cr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Hr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Dr(e,t,r){e===1&&r.readMessage(wn,t)}function wn(e,t,r){if(e===3){var c=r.readMessage(Nr,{}),v=c.width,m=c.height,_=c.left,C=c.top,k=c.advance;t.push({id:c.id,bitmap:new Pu({width:v+6,height:m+6},c.bitmap),metrics:{width:v,height:m,left:_,top:C,advance:k}})}}function Nr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function sn(e){for(var t=0,r=0,c=0,v=e;c<v.length;c+=1){var m=v[c];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(We,ot){return ot.h-We.h});for(var _=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],C=0,k=0,B=0,W=e;B<W.length;B+=1)for(var $=W[B],se=_.length-1;se>=0;se--){var pe=_[se];if(!($.w>pe.w||$.h>pe.h)){if($.x=pe.x,$.y=pe.y,k=Math.max(k,$.y+$.h),C=Math.max(C,$.x+$.w),$.w===pe.w&&$.h===pe.h){var Ze=_.pop();se<_.length&&(_[se]=Ze)}else $.h===pe.h?(pe.x+=$.w,pe.w-=$.w):$.w===pe.w?(pe.y+=$.h,pe.h-=$.h):(_.push({x:pe.x+$.w,y:pe.y,w:pe.w-$.w,h:$.h}),pe.y+=$.h,pe.h-=$.h);break}}return{w:C,h:k,fill:t/(C*k)||0}}ze.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var c=this.readVarint(),v=c>>3,m=this.pos;this.type=7&c,e(v,t,this),this.pos===m&&this.skip(c)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=cr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=cr(this.buf,this.pos)+4294967296*cr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=cr(this.buf,this.pos)+4294967296*mn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Yh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Yh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,c=this.buf;return t=127&(r=c[this.pos++]),r<128?t:(t|=(127&(r=c[this.pos++]))<<7,r<128?t:(t|=(127&(r=c[this.pos++]))<<14,r<128?t:(t|=(127&(r=c[this.pos++]))<<21,r<128?t:function(v,m,_){var C,k,B=_.buf;if(C=(112&(k=B[_.pos++]))>>4,k<128||(C|=(127&(k=B[_.pos++]))<<3,k<128)||(C|=(127&(k=B[_.pos++]))<<10,k<128)||(C|=(127&(k=B[_.pos++]))<<17,k<128)||(C|=(127&(k=B[_.pos++]))<<24,k<128)||(C|=(1&(k=B[_.pos++]))<<31,k<128))return Yt(v,C,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=c[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Qt?function(r,c,v){return Qt.decode(r.subarray(c,v))}(this.buf,t,e):function(r,c,v){for(var m="",_=c;_<v;){var C,k,B,W=r[_],$=null,se=W>239?4:W>223?3:W>191?2:1;if(_+se>v)break;se===1?W<128&&($=W):se===2?(192&(C=r[_+1]))==128&&($=(31&W)<<6|63&C)<=127&&($=null):se===3?(k=r[_+2],(192&(C=r[_+1]))==128&&(192&k)==128&&(($=(15&W)<<12|(63&C)<<6|63&k)<=2047||$>=55296&&$<=57343)&&($=null)):se===4&&(k=r[_+2],B=r[_+3],(192&(C=r[_+1]))==128&&(192&k)==128&&(192&B)==128&&(($=(15&W)<<18|(63&C)<<12|(63&k)<<6|63&B)<=65535||$>=1114112)&&($=null)),$===null?($=65533,se=1):$>65535&&($-=65536,m+=String.fromCharCode($>>>10&1023|55296),$=56320|1023&$),m+=String.fromCharCode($),_+=se}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ze.Bytes)return e.push(this.readVarint(t));var r=wr(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ze.Bytes)return e.push(this.readSVarint());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ze.Bytes)return e.push(this.readBoolean());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ze.Bytes)return e.push(this.readFloat());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ze.Bytes)return e.push(this.readDouble());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ze.Bytes)return e.push(this.readSFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ze.Varint)for(;this.buf[this.pos++]>127;);else if(t===ze.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ze.Fixed32)this.pos+=4;else{if(t!==ze.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Hr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Hr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Hr(this.buf,-1&e,this.pos),Hr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Hr(this.buf,-1&e,this.pos),Hr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var c,v;if(t>=0?(c=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(c=~(-t%4294967296))?c=c+1|0:(c=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,_,C){C.buf[C.pos++]=127&m|128,m>>>=7,C.buf[C.pos++]=127&m|128,m>>>=7,C.buf[C.pos++]=127&m|128,m>>>=7,C.buf[C.pos++]=127&m|128,C.buf[C.pos]=127&(m>>>=7)}(c,0,r),function(m,_){var C=(7&m)<<4;_.buf[_.pos++]|=C|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(c,v,m){for(var _,C,k=0;k<v.length;k++){if((_=v.charCodeAt(k))>55295&&_<57344){if(!C){_>56319||k+1===v.length?(c[m++]=239,c[m++]=191,c[m++]=189):C=_;continue}if(_<56320){c[m++]=239,c[m++]=191,c[m++]=189,C=_;continue}_=C-55296<<10|_-56320|65536,C=null}else C&&(c[m++]=239,c[m++]=191,c[m++]=189,C=null);_<128?c[m++]=_:(_<2048?c[m++]=_>>6|192:(_<65536?c[m++]=_>>12|224:(c[m++]=_>>18|240,c[m++]=_>>12&63|128),c[m++]=_>>6&63|128),c[m++]=63&_|128)}return m}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&fr(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),U(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),U(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var c=this.pos-r;c>=128&&fr(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeMessage:function(e,t,r){this.writeTag(e,ze.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Zr,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Xr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,nn,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,qr,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Kr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,fn,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Vr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,an,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Ft,t)},writeBytesField:function(e,t){this.writeTag(e,ze.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ze.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ze.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ze.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ze.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ze.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ze.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var Rr=function(e,t){var r=t.pixelRatio,c=t.version,v=t.stretchX,m=t.stretchY,_=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=m,this.content=_,this.version=c},on={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};on.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},on.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},on.tlbr.get=function(){return this.tl.concat(this.br)},on.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Rr.prototype,on);var Yn=function(e,t){var r={},c={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,c,v);var m=sn(v),_=new va({width:m.w||1,height:m.h||1});for(var C in e){var k=e[C],B=r[C].paddedRect;va.copy(k.data,_,{x:0,y:0},{x:B.x+1,y:B.y+1},k.data)}for(var W in t){var $=t[W],se=c[W].paddedRect,pe=se.x+1,Ze=se.y+1,We=$.data.width,ot=$.data.height;va.copy($.data,_,{x:0,y:0},{x:pe,y:Ze},$.data),va.copy($.data,_,{x:0,y:ot-1},{x:pe,y:Ze-1},{width:We,height:1}),va.copy($.data,_,{x:0,y:0},{x:pe,y:Ze+ot},{width:We,height:1}),va.copy($.data,_,{x:We-1,y:0},{x:pe-1,y:Ze},{width:1,height:ot}),va.copy($.data,_,{x:0,y:0},{x:pe+We,y:Ze},{width:1,height:ot})}this.image=_,this.iconPositions=r,this.patternPositions=c};Yn.prototype.addImages=function(e,t,r){for(var c in e){var v=e[c],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[c]=new Rr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(c)}},Yn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Yn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var c=e.tl;r.update(t.data,void 0,{x:c[0],y:c[1]})}},Tn("ImagePosition",Rr),Tn("ImageAtlas",Yn);var $n={horizontal:1,vertical:2,horizontalOnly:3},un=function(){this.scale=1,this.fontStack="",this.imageName=null};un.forText=function(e,t){var r=new un;return r.scale=e||1,r.fontStack=t,r},un.forImage=function(e){var t=new un;return t.imageName=e,t};var kr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Or(e,t,r,c,v,m,_,C,k,B,W,$,se,pe,Ze,We){var ot,Qe=kr.fromFeature(e,v);$===$n.vertical&&Qe.verticalizePunctuation();var At=Js.processBidirectionalText,Gt=Js.processStyledBidirectionalText;if(At&&Qe.sections.length===1){ot=[];for(var ir=0,hr=At(Qe.toString(),ca(Qe,B,m,t,c,pe,Ze));ir<hr.length;ir+=1){var Cr=hr[ir],tn=new kr;tn.text=Cr,tn.sections=Qe.sections;for(var pn=0;pn<Cr.length;pn++)tn.sectionIndex.push(0);ot.push(tn)}}else if(Gt){ot=[];for(var Wn=0,Sn=Gt(Qe.text,Qe.sectionIndex,ca(Qe,B,m,t,c,pe,Ze));Wn<Sn.length;Wn+=1){var Kn=Sn[Wn],En=new kr;En.text=Kn[0],En.sectionIndex=Kn[1],En.sections=Qe.sections,ot.push(En)}}else ot=function(Ln,na){for(var Pi=[],ua=Ln.text,ei=0,la=0,Va=na;la<Va.length;la+=1){var Ro=Va[la];Pi.push(Ln.substring(ei,Ro)),ei=Ro}return ei<ua.length&&Pi.push(Ln.substring(ei,ua.length)),Pi}(Qe,ca(Qe,B,m,t,c,pe,Ze));var si=[],ui={positionedLines:si,text:Qe.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(Ln,na,Pi,ua,ei,la,Va,Ro,Po,mo,qa,cs){for(var es=0,vu=-17,Fs=0,_s=0,ts=Ro==="right"?1:Ro==="left"?0:.5,Ns=0,oa=0,eo=ei;oa<eo.length;oa+=1){var ka=eo[oa];ka.trim();var da=ka.getMaxScale(),Xu=24*(da-1),mu={positionedGlyphs:[],lineOffset:0};Ln.positionedLines[Ns]=mu;var Eo=mu.positionedGlyphs,rs=0;if(ka.length()){for(var Bs=0;Bs<ka.length();Bs++){var Sa=ka.getSection(Bs),wc=ka.getSectionIndex(Bs),Sl=ka.getCharCode(Bs),of=0,Go=null,Xc=null,Tc=null,Hf=24,Wf=!(Po===$n.horizontal||!qa&&!Ql(Sl)||qa&&(fi[Sl]||(sf=Sl,Jr.Arabic(sf)||Jr["Arabic Supplement"](sf)||Jr["Arabic Extended-A"](sf)||Jr["Arabic Presentation Forms-A"](sf)||Jr["Arabic Presentation Forms-B"](sf))));if(Sa.imageName){var Ch=ua[Sa.imageName];if(!Ch)continue;Tc=Sa.imageName,Ln.iconsInText=Ln.iconsInText||!0,Xc=Ch.paddedRect;var cc=Ch.displaySize;Sa.scale=24*Sa.scale/cs,of=Xu+(24-cc[1]*Sa.scale),Hf=(Go={width:cc[0],height:cc[1],left:1,top:-3,advance:Wf?cc[1]:cc[0]}).advance;var ih=Wf?cc[0]*Sa.scale-24*da:cc[1]*Sa.scale-24*da;ih>0&&ih>rs&&(rs=ih)}else{var xp=Pi[Sa.fontStack],fc=xp&&xp[Sl];if(fc&&fc.rect)Xc=fc.rect,Go=fc.metrics;else{var ah=na[Sa.fontStack],Xf=ah&&ah[Sl];if(!Xf)continue;Go=Xf.metrics}of=24*(da-Sa.scale)}Wf?(Ln.verticalizable=!0,Eo.push({glyph:Sl,imageName:Tc,x:es,y:vu+of,vertical:Wf,scale:Sa.scale,fontStack:Sa.fontStack,sectionIndex:wc,metrics:Go,rect:Xc}),es+=Hf*Sa.scale+mo):(Eo.push({glyph:Sl,imageName:Tc,x:es,y:vu+of,vertical:Wf,scale:Sa.scale,fontStack:Sa.fontStack,sectionIndex:wc,metrics:Go,rect:Xc}),es+=Go.advance*Sa.scale+mo)}Eo.length!==0&&(Fs=Math.max(es-mo,Fs),ks(Eo,0,Eo.length-1,ts,rs)),es=0;var Qh=la*da+rs;mu.lineOffset=Math.max(rs,Xu),vu+=Qh,_s=Math.max(Qh,_s),++Ns}else vu+=la,++Ns}var sf,Yc=vu- -17,oh=Jo(Va),Af=oh.horizontalAlign,Ph=oh.verticalAlign;(function(bp,Sp,qh,ep,Ep,tp,sh,uh,wp){var Cf,Pf=(Sp-qh)*Ep;Cf=tp!==sh?-uh*ep- -17:(-ep*wp+.5)*sh;for(var Mh=0,Yf=bp;Mh<Yf.length;Mh+=1)for(var uf=0,lf=Yf[Mh].positionedGlyphs;uf<lf.length;uf+=1){var lh=lf[uf];lh.x+=Pf,lh.y+=Cf}})(Ln.positionedLines,ts,Af,Ph,Fs,_s,la,Yc,ei.length),Ln.top+=-Ph*Yc,Ln.bottom=Ln.top+Yc,Ln.left+=-Af*Fs,Ln.right=Ln.left+Fs}(ui,t,r,c,ot,_,C,k,$,B,se,We),!function(Ln){for(var na=0,Pi=Ln;na<Pi.length;na+=1)if(Pi[na].positionedGlyphs.length!==0)return!1;return!0}(si)&&ui}kr.fromFeature=function(e,t){for(var r=new kr,c=0;c<e.sections.length;c++){var v=e.sections[c];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},kr.prototype.length=function(){return this.text.length},kr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},kr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},kr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},kr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var c=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=c&&Nu(c)&&!Ef[e[r+1]]||v&&Nu(v)&&!Ef[e[r-1]]||!Ef[e[r]]?e[r]:Ef[e[r]]}return t}(this.text)},kr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&fi[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,c=this.text.length-1;c>=0&&c>=e&&fi[this.text.charCodeAt(c)];c--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},kr.prototype.substring=function(e,t){var r=new kr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},kr.prototype.toString=function(){return this.text},kr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},kr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(un.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,c=0;c<e.text.length;++c)this.sectionIndex.push(r)},kr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(un.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}else Fe("Can't add FormattedSection with an empty image.")},kr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var fi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qn={};function On(e,t,r,c,v,m){if(t.imageName){var _=c[t.imageName];return _?_.displaySize[0]*t.scale*24/m+v:0}var C=r[t.fontStack],k=C&&C[e];return k?k.metrics.advance*t.scale+v:0}function Ni(e,t,r,c){var v=Math.pow(e-t,2);return c?e<t?v/2:2*v:v+Math.abs(r)*r}function Ti(e,t,r){var c=0;return e===10&&(c-=1e4),r&&(c+=150),e!==40&&e!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Bi(e,t,r,c,v,m){for(var _=null,C=Ni(t,r,v,m),k=0,B=c;k<B.length;k+=1){var W=B[k],$=Ni(t-W.x,r,v,m)+W.badness;$<=C&&(_=W,C=$)}return{index:e,x:t,priorBreak:_,badness:C}}function ca(e,t,r,c,v,m,_){if(m!=="point")return[];if(!e)return[];for(var C,k=[],B=function(ot,Qe,At,Gt,ir,hr){for(var Cr=0,tn=0;tn<ot.length();tn++){var pn=ot.getSection(tn);Cr+=On(ot.getCharCode(tn),pn,Gt,ir,Qe,hr)}return Cr/Math.max(1,Math.ceil(Cr/At))}(e,t,r,c,v,_),W=e.text.indexOf("\u200B")>=0,$=0,se=0;se<e.length();se++){var pe=e.getSection(se),Ze=e.getCharCode(se);if(fi[Ze]||($+=On(Ze,pe,c,v,t,_)),se<e.length()-1){var We=!((C=Ze)<11904||!(Jr["Bopomofo Extended"](C)||Jr.Bopomofo(C)||Jr["CJK Compatibility Forms"](C)||Jr["CJK Compatibility Ideographs"](C)||Jr["CJK Compatibility"](C)||Jr["CJK Radicals Supplement"](C)||Jr["CJK Strokes"](C)||Jr["CJK Symbols and Punctuation"](C)||Jr["CJK Unified Ideographs Extension A"](C)||Jr["CJK Unified Ideographs"](C)||Jr["Enclosed CJK Letters and Months"](C)||Jr["Halfwidth and Fullwidth Forms"](C)||Jr.Hiragana(C)||Jr["Ideographic Description Characters"](C)||Jr["Kangxi Radicals"](C)||Jr["Katakana Phonetic Extensions"](C)||Jr.Katakana(C)||Jr["Vertical Forms"](C)||Jr["Yi Radicals"](C)||Jr["Yi Syllables"](C)));(Qn[Ze]||We||pe.imageName)&&k.push(Bi(se+1,$,B,k,Ti(Ze,e.getCharCode(se+1),We&&W),!1))}}return function ot(Qe){return Qe?ot(Qe.priorBreak).concat(Qe.index):[]}(Bi(e.length(),$,B,k,0,!0))}function Jo(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ks(e,t,r,c,v){if(c||v)for(var m=e[r],_=(e[r].x+m.metrics.advance*m.scale)*c,C=t;C<=r;C++)e[C].x-=_,e[C].y+=v}function Hi(e,t,r,c,v,m){var _,C=e.image;if(C.content){var k=C.content,B=C.pixelRatio||1;_=[k[0]/B,k[1]/B,C.displaySize[0]-k[2]/B,C.displaySize[1]-k[3]/B]}var W,$,se,pe,Ze=t.left*m,We=t.right*m;r==="width"||r==="both"?(pe=v[0]+Ze-c[3],$=v[0]+We+c[1]):$=(pe=v[0]+(Ze+We-C.displaySize[0])/2)+C.displaySize[0];var ot=t.top*m,Qe=t.bottom*m;return r==="height"||r==="both"?(W=v[1]+ot-c[0],se=v[1]+Qe+c[2]):se=(W=v[1]+(ot+Qe-C.displaySize[1])/2)+C.displaySize[1],{image:C,top:W,right:$,bottom:se,left:pe,collisionPadding:_}}Qn[10]=!0,Qn[32]=!0,Qn[38]=!0,Qn[40]=!0,Qn[41]=!0,Qn[43]=!0,Qn[45]=!0,Qn[47]=!0,Qn[173]=!0,Qn[183]=!0,Qn[8203]=!0,Qn[8208]=!0,Qn[8211]=!0,Qn[8231]=!0;var So=function(e){function t(r,c,v,m){e.call(this,r,c),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(Y);function Ja(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Di(e+1))};if(r.kind==="source")return{kind:"source"};for(var c=r.zoomStops,v=r.interpolationType,m=0;m<c.length&&c[m]<=e;)m++;for(var _=m=Math.max(0,m-1);_<c.length&&c[_]<e+1;)_++;_=Math.min(c.length-1,_);var C=c[m],k=c[_];return r.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:k,interpolationType:v}:{kind:"camera",minZoom:C,maxZoom:k,minSize:r.evaluate(new Di(C)),maxSize:r.evaluate(new Di(k)),interpolationType:v}}function jo(e,t,r){var c=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?zn(v/128,r.upperSize/128,t.uSizeT):c}function ls(e,t){var r=0,c=0;if(e.kind==="constant")c=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?Kt(Ri.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?c=zn(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:c}}Tn("Anchor",So);var ws=Object.freeze({__proto__:null,getSizeData:Ja,evaluateSizeForFeature:jo,evaluateSizeForZoom:ls,SIZE_PACK_FACTOR:128});function Qo(e,t,r,c,v){if(t.segment===void 0)return!0;for(var m=t,_=t.segment+1,C=0;C>-r/2;){if(--_<0)return!1;C-=e[_].dist(m),m=e[_]}C+=e[_].dist(e[_+1]),_++;for(var k=[],B=0;C<r/2;){var W=e[_],$=e[_+1];if(!$)return!1;var se=e[_-1].angleTo(W)-W.angleTo($);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:C,angleDelta:se}),B+=se;C-k[0].distance>c;)B-=k.shift().angleDelta;if(B>v)return!1;_++,C+=W.dist($)}return!0}function Ts(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function qo(e,t,r){return e?.6*t*r:0}function zi(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function As(e,t,r,c,v,m){for(var _=qo(r,v,m),C=zi(r,c)*m,k=0,B=Ts(e)/2,W=0;W<e.length-1;W++){var $=e[W],se=e[W+1],pe=$.dist(se);if(k+pe>B){var Ze=(B-k)/pe,We=zn($.x,se.x,Ze),ot=zn($.y,se.y,Ze),Qe=new So(We,ot,se.angleTo($),W);return Qe._round(),!_||Qo(e,Qe,C,_,t)?Qe:void 0}k+=pe}}function ha(e,t,r,c,v,m,_,C,k){var B=qo(c,m,_),W=zi(c,v),$=W*_,se=e[0].x===0||e[0].x===k||e[0].y===0||e[0].y===k;return t-$<t/4&&(t=$+t/4),function pe(Ze,We,ot,Qe,At,Gt,ir,hr,Cr){for(var tn=Gt/2,pn=Ts(Ze),Wn=0,Sn=We-ot,Kn=[],En=0;En<Ze.length-1;En++){for(var si=Ze[En],ui=Ze[En+1],Ln=si.dist(ui),na=ui.angleTo(si);Sn+ot<Wn+Ln;){var Pi=((Sn+=ot)-Wn)/Ln,ua=zn(si.x,ui.x,Pi),ei=zn(si.y,ui.y,Pi);if(ua>=0&&ua<Cr&&ei>=0&&ei<Cr&&Sn-tn>=0&&Sn+tn<=pn){var la=new So(ua,ei,na,En);la._round(),Qe&&!Qo(Ze,la,Gt,Qe,At)||Kn.push(la)}}Wn+=Ln}return hr||Kn.length||ir||(Kn=pe(Ze,Wn/2,ot,Qe,At,Gt,ir,!0,Cr)),Kn}(e,se?t/2*C%t:(W/2+2*m)*_*C%t,t,B,r,$,se,!1,k)}function qn(e,t,r,c,v){for(var m=[],_=0;_<e.length;_++)for(var C=e[_],k=void 0,B=0;B<C.length-1;B++){var W=C[B],$=C[B+1];W.x<t&&$.x<t||(W.x<t?W=new Y(t,W.y+(t-W.x)/($.x-W.x)*($.y-W.y))._round():$.x<t&&($=new Y(t,W.y+(t-W.x)/($.x-W.x)*($.y-W.y))._round()),W.y<r&&$.y<r||(W.y<r?W=new Y(W.x+(r-W.y)/($.y-W.y)*($.x-W.x),r)._round():$.y<r&&($=new Y(W.x+(r-W.y)/($.y-W.y)*($.x-W.x),r)._round()),W.x>=c&&$.x>=c||(W.x>=c?W=new Y(c,W.y+(c-W.x)/($.x-W.x)*($.y-W.y))._round():$.x>=c&&($=new Y(c,W.y+(c-W.x)/($.x-W.x)*($.y-W.y))._round()),W.y>=v&&$.y>=v||(W.y>=v?W=new Y(W.x+(v-W.y)/($.y-W.y)*($.x-W.x),v)._round():$.y>=v&&($=new Y(W.x+(v-W.y)/($.y-W.y)*($.x-W.x),v)._round()),k&&W.equals(k[k.length-1])||m.push(k=[W]),k.push($)))))}return m}function Wi(e,t,r,c){var v=[],m=e.image,_=m.pixelRatio,C=m.paddedRect.w-2,k=m.paddedRect.h-2,B=e.right-e.left,W=e.bottom-e.top,$=m.stretchX||[[0,C]],se=m.stretchY||[[0,k]],pe=function(ua,ei){return ua+ei[1]-ei[0]},Ze=$.reduce(pe,0),We=se.reduce(pe,0),ot=C-Ze,Qe=k-We,At=0,Gt=Ze,ir=0,hr=We,Cr=0,tn=ot,pn=0,Wn=Qe;if(m.content&&c){var Sn=m.content;At=$i($,0,Sn[0]),ir=$i(se,0,Sn[1]),Gt=$i($,Sn[0],Sn[2]),hr=$i(se,Sn[1],Sn[3]),Cr=Sn[0]-At,pn=Sn[1]-ir,tn=Sn[2]-Sn[0]-Gt,Wn=Sn[3]-Sn[1]-hr}var Kn=function(ua,ei,la,Va){var Ro=bl(ua.stretch-At,Gt,B,e.left),Po=Ec(ua.fixed-Cr,tn,ua.stretch,Ze),mo=bl(ei.stretch-ir,hr,W,e.top),qa=Ec(ei.fixed-pn,Wn,ei.stretch,We),cs=bl(la.stretch-At,Gt,B,e.left),es=Ec(la.fixed-Cr,tn,la.stretch,Ze),vu=bl(Va.stretch-ir,hr,W,e.top),Fs=Ec(Va.fixed-pn,Wn,Va.stretch,We),_s=new Y(Ro,mo),ts=new Y(cs,mo),Ns=new Y(cs,vu),oa=new Y(Ro,vu),eo=new Y(Po/_,qa/_),ka=new Y(es/_,Fs/_),da=t*Math.PI/180;if(da){var Xu=Math.sin(da),mu=Math.cos(da),Eo=[mu,-Xu,Xu,mu];_s._matMult(Eo),ts._matMult(Eo),oa._matMult(Eo),Ns._matMult(Eo)}var rs=ua.stretch+ua.fixed,Bs=ei.stretch+ei.fixed;return{tl:_s,tr:ts,bl:oa,br:Ns,tex:{x:m.paddedRect.x+1+rs,y:m.paddedRect.y+1+Bs,w:la.stretch+la.fixed-rs,h:Va.stretch+Va.fixed-Bs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:eo,pixelOffsetBR:ka,minFontScaleX:tn/_/B,minFontScaleY:Wn/_/W,isSDF:r}};if(c&&(m.stretchX||m.stretchY))for(var En=Co($,ot,Ze),si=Co(se,Qe,We),ui=0;ui<En.length-1;ui++)for(var Ln=En[ui],na=En[ui+1],Pi=0;Pi<si.length-1;Pi++)v.push(Kn(Ln,si[Pi],na,si[Pi+1]));else v.push(Kn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:k+1}));return v}function $i(e,t,r){for(var c=0,v=0,m=e;v<m.length;v+=1){var _=m[v];c+=Math.max(t,Math.min(r,_[1]))-Math.max(t,Math.min(r,_[0]))}return c}function Co(e,t,r){for(var c=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var _=m[v],C=_[0],k=_[1],B=c[c.length-1];c.push({fixed:C-B.stretch,stretch:B.stretch}),c.push({fixed:C-B.stretch,stretch:B.stretch+(k-C)})}return c.push({fixed:t+1,stretch:r}),c}function bl(e,t,r,c){return e/t*r+c}function Ec(e,t,r,c){return e-t*r/c}var Ve=function(e,t,r,c,v,m,_,C,k,B){if(this.boxStartIndex=e.length,k){var W=m.top,$=m.bottom,se=m.collisionPadding;se&&(W-=se[1],$+=se[3]);var pe=$-W;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{var Ze=m.top*_-C,We=m.bottom*_+C,ot=m.left*_-C,Qe=m.right*_+C,At=m.collisionPadding;if(At&&(ot-=At[0]*_,Ze-=At[1]*_,Qe+=At[2]*_,We+=At[3]*_),B){var Gt=new Y(ot,Ze),ir=new Y(Qe,Ze),hr=new Y(ot,We),Cr=new Y(Qe,We),tn=B*Math.PI/180;Gt._rotate(tn),ir._rotate(tn),hr._rotate(tn),Cr._rotate(tn),ot=Math.min(Gt.x,ir.x,hr.x,Cr.x),Qe=Math.max(Gt.x,ir.x,hr.x,Cr.x),Ze=Math.min(Gt.y,ir.y,hr.y,Cr.y),We=Math.max(Gt.y,ir.y,hr.y,Cr.y)}e.emplaceBack(t.x,t.y,ot,Ze,Qe,We,r,c,v)}this.boxEndIndex=e.length},qt=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Ut),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Ut(e,t){return e<t?-1:e>t?1:0}function An(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var c=1/0,v=1/0,m=-1/0,_=-1/0,C=e[0],k=0;k<C.length;k++){var B=C[k];(!k||B.x<c)&&(c=B.x),(!k||B.y<v)&&(v=B.y),(!k||B.x>m)&&(m=B.x),(!k||B.y>_)&&(_=B.y)}var W=Math.min(m-c,_-v),$=W/2,se=new qt([],Xi);if(W===0)return new Y(c,v);for(var pe=c;pe<m;pe+=W)for(var Ze=v;Ze<_;Ze+=W)se.push(new Ie(pe+$,Ze+$,$,e));for(var We=function(At){for(var Gt=0,ir=0,hr=0,Cr=At[0],tn=0,pn=Cr.length,Wn=pn-1;tn<pn;Wn=tn++){var Sn=Cr[tn],Kn=Cr[Wn],En=Sn.x*Kn.y-Kn.x*Sn.y;ir+=(Sn.x+Kn.x)*En,hr+=(Sn.y+Kn.y)*En,Gt+=3*En}return new Ie(ir/Gt,hr/Gt,0,At)}(e),ot=se.length;se.length;){var Qe=se.pop();(Qe.d>We.d||!We.d)&&(We=Qe,r&&console.log("found best %d after %d probes",Math.round(1e4*Qe.d)/1e4,ot)),Qe.max-We.d<=t||(se.push(new Ie(Qe.p.x-($=Qe.h/2),Qe.p.y-$,$,e)),se.push(new Ie(Qe.p.x+$,Qe.p.y-$,$,e)),se.push(new Ie(Qe.p.x-$,Qe.p.y+$,$,e)),se.push(new Ie(Qe.p.x+$,Qe.p.y+$,$,e)),ot+=4)}return r&&(console.log("num probes: "+ot),console.log("best distance: "+We.d)),We.p}function Xi(e,t){return t.max-e.max}function Ie(e,t,r,c){this.p=new Y(e,t),this.h=r,this.d=function(v,m){for(var _=!1,C=1/0,k=0;k<m.length;k++)for(var B=m[k],W=0,$=B.length,se=$-1;W<$;se=W++){var pe=B[W],Ze=B[se];pe.y>v.y!=Ze.y>v.y&&v.x<(Ze.x-pe.x)*(v.y-pe.y)/(Ze.y-pe.y)+pe.x&&(_=!_),C=Math.min(C,rl(v,pe,Ze))}return(_?1:-1)*Math.sqrt(C)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}qt.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},qt.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},qt.prototype.peek=function(){return this.data[0]},qt.prototype._up=function(e){for(var t=this.data,r=this.compare,c=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(c,m)>=0)break;t[e]=m,e=v}t[e]=c},qt.prototype._down=function(e){for(var t=this.data,r=this.compare,c=this.length>>1,v=t[e];e<c;){var m=1+(e<<1),_=t[m],C=m+1;if(C<this.length&&r(t[C],_)<0&&(m=C,_=t[C]),r(_,v)>=0)break;t[e]=_,e=m}t[e]=v};var ye=Number.POSITIVE_INFINITY;function it(e,t){return t[1]!==ye?function(r,c,v){var m=0,_=0;switch(c=Math.abs(c),v=Math.abs(v),r){case"top-right":case"top-left":case"top":_=v-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-c;break;case"top-left":case"bottom-left":case"left":m=c}return[m,_]}(e,t[0],t[1]):function(r,c){var v=0,m=0;c<0&&(c=0);var _=c/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-c;break;case"top":m=c-7}switch(r){case"top-right":case"bottom-right":v=-_;break;case"top-left":case"bottom-left":v=_;break;case"left":v=c;break;case"right":v=-c}return[v,m]}(e,t[0])}function It(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(e,t,r,c,v,m,_,C,k,B,W,$,se,pe,Ze){var We=function(ir,hr,Cr,tn,pn,Wn,Sn,Kn){for(var En=tn.layout.get("text-rotate").evaluate(Wn,{})*Math.PI/180,si=[],ui=0,Ln=hr.positionedLines;ui<Ln.length;ui+=1)for(var na=Ln[ui],Pi=0,ua=na.positionedGlyphs;Pi<ua.length;Pi+=1){var ei=ua[Pi];if(ei.rect){var la=ei.rect||{},Va=4,Ro=!0,Po=1,mo=0,qa=(pn||Kn)&&ei.vertical,cs=ei.metrics.advance*ei.scale/2;if(Kn&&hr.verticalizable&&(mo=na.lineOffset/2-(ei.imageName?-(24-ei.metrics.width*ei.scale)/2:24*(ei.scale-1))),ei.imageName){var es=Sn[ei.imageName];Ro=es.sdf,Va=1/(Po=es.pixelRatio)}var vu=pn?[ei.x+cs,ei.y]:[0,0],Fs=pn?[0,0]:[ei.x+cs+Cr[0],ei.y+Cr[1]-mo],_s=[0,0];qa&&(_s=Fs,Fs=[0,0]);var ts=(ei.metrics.left-Va)*ei.scale-cs+Fs[0],Ns=(-ei.metrics.top-Va)*ei.scale+Fs[1],oa=ts+la.w*ei.scale/Po,eo=Ns+la.h*ei.scale/Po,ka=new Y(ts,Ns),da=new Y(oa,Ns),Xu=new Y(ts,eo),mu=new Y(oa,eo);if(qa){var Eo=new Y(-cs,cs- -17),rs=-Math.PI/2,Bs=12-cs,Sa=new Y(22-Bs,-(ei.imageName?Bs:0)),wc=new(Function.prototype.bind.apply(Y,[null].concat(_s)));ka._rotateAround(rs,Eo)._add(Sa)._add(wc),da._rotateAround(rs,Eo)._add(Sa)._add(wc),Xu._rotateAround(rs,Eo)._add(Sa)._add(wc),mu._rotateAround(rs,Eo)._add(Sa)._add(wc)}if(En){var Sl=Math.sin(En),of=Math.cos(En),Go=[of,-Sl,Sl,of];ka._matMult(Go),da._matMult(Go),Xu._matMult(Go),mu._matMult(Go)}var Xc=new Y(0,0),Tc=new Y(0,0);si.push({tl:ka,tr:da,bl:Xu,br:mu,tex:la,writingMode:hr.writingMode,glyphOffset:vu,sectionIndex:ei.sectionIndex,isSDF:Ro,pixelOffsetTL:Xc,pixelOffsetBR:Tc,minFontScaleX:0,minFontScaleY:0})}}return si}(0,r,C,v,m,_,c,e.allowVerticalPlacement),ot=e.textSizeData,Qe=null;ot.kind==="source"?(Qe=[128*v.layout.get("text-size").evaluate(_,{})])[0]>32640&&Fe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ot.kind==="composite"&&((Qe=[128*pe.compositeTextSizes[0].evaluate(_,{},Ze),128*pe.compositeTextSizes[1].evaluate(_,{},Ze)])[0]>32640||Qe[1]>32640)&&Fe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,Qe,C,m,_,B,t,k.lineStartIndex,k.lineLength,se,Ze);for(var At=0,Gt=W;At<Gt.length;At+=1)$[Gt[At]]=e.text.placedSymbolArray.length-1;return 4*We.length}function lt(e){for(var t in e)return e[t];return null}function at(e,t,r,c){var v=e.compareText;if(t in v){for(var m=v[t],_=m.length-1;_>=0;_--)if(c.dist(m[_])<r)return!0}else v[t]=[];return v[t].push(c),!1}var _t=Xs.VectorTileFeature.types,Le=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function et(e,t,r,c,v,m,_,C,k,B,W,$,se){var pe=C?Math.min(32640,Math.round(C[0])):0,Ze=C?Math.min(32640,Math.round(C[1])):0;e.emplaceBack(t,r,Math.round(32*c),Math.round(32*v),m,_,(pe<<1)+(k?1:0),Ze,16*B,16*W,256*$,256*se)}function Ce(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function Et(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(vl(r[t].text))return!0;return!1}var Rt=function(e){this.layoutVertexArray=new Vc,this.indexArray=new tl,this.programConfigurations=e,this.segments=new _e,this.dynamicLayoutVertexArray=new Nl,this.opacityVertexArray=new rc,this.placedSymbolArray=new h};Rt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Rt.prototype.upload=function(e,t,r,c){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Wh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Le,!0),this.opacityVertexBuffer.itemSize=1),(r||c)&&this.programConfigurations.upload(e))},Rt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Tn("SymbolBuffers",Rt);var _r=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new _e,this.collisionVertexArray=new xc};_r.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xh.members,!0)},_r.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Tn("CollisionBuffers",_r);var er=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Lo([]),this.placementViewportMatrix=Lo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ja(this.zoom,t["text-size"]),this.iconSizeData=Ja(this.zoom,t["icon-size"]);var r=this.layers[0].layout,c=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(m){return $n[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=e.sourceID};er.prototype.createArrays=function(){this.text=new Rt(new Jn(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Rt(new Jn(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new A,this.lineVertexArray=new L,this.symbolInstances=new b},er.prototype.calculateGlyphDependencies=function(e,t,r,c,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||c)&&v){var _=Ef[e.charAt(m)];_&&(t[_.charCodeAt(0)]=!0)}},er.prototype.populate=function(e,t,r){var c=this.layers[0],v=c.layout,m=v.get("text-font"),_=v.get("text-field"),C=v.get("icon-image"),k=(_.value.kind!=="constant"||_.value.value instanceof Li&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),B=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],k||B){for(var $=t.iconDependencies,se=t.glyphDependencies,pe=t.availableImages,Ze=new Di(this.zoom),We=0,ot=e;We<ot.length;We+=1){var Qe=ot[We],At=Qe.feature,Gt=Qe.id,ir=Qe.index,hr=Qe.sourceLayerIndex,Cr=c._featureFilter.needGeometry,tn=ho(At,Cr);if(c._featureFilter.filter(Ze,tn,r)){Cr||(tn.geometry=Za(At));var pn=void 0;if(k){var Wn=c.getValueAndResolveTokens("text-field",tn,r,pe),Sn=Li.factory(Wn);Et(Sn)&&(this.hasRTLText=!0),(!this.hasRTLText||jc()==="unavailable"||this.hasRTLText&&Js.isParsed())&&(pn=Sf(Sn,c,tn))}var Kn=void 0;if(B){var En=c.getValueAndResolveTokens("icon-image",tn,r,pe);Kn=En instanceof La?En:La.fromString(En)}if(pn||Kn){var si=this.sortFeaturesByKey?W.evaluate(tn,{},r):void 0;if(this.features.push({id:Gt,text:pn,icon:Kn,index:ir,sourceLayerIndex:hr,geometry:tn.geometry,properties:At.properties,type:_t[At.type],sortKey:si}),Kn&&($[Kn.name]=!0),pn){var ui=m.evaluate(tn,{},r).join(","),Ln=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($n.vertical)>=0;for(var na=0,Pi=pn.sections;na<Pi.length;na+=1){var ua=Pi[na];if(ua.image)$[ua.image.name]=!0;else{var ei=gc(pn.toString()),la=ua.fontStack||ui,Va=se[la]=se[la]||{};this.calculateGlyphDependencies(ua.text,Va,Ln,this.allowVerticalPlacement,ei)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Ro){var Po={},mo={},qa=[],cs=0;function es(Eo){qa.push(Ro[Eo]),cs++}function vu(Eo,rs,Bs){var Sa=mo[Eo];return delete mo[Eo],mo[rs]=Sa,qa[Sa].geometry[0].pop(),qa[Sa].geometry[0]=qa[Sa].geometry[0].concat(Bs[0]),Sa}function Fs(Eo,rs,Bs){var Sa=Po[rs];return delete Po[rs],Po[Eo]=Sa,qa[Sa].geometry[0].shift(),qa[Sa].geometry[0]=Bs[0].concat(qa[Sa].geometry[0]),Sa}function _s(Eo,rs,Bs){var Sa=Bs?rs[0][rs[0].length-1]:rs[0][0];return Eo+":"+Sa.x+":"+Sa.y}for(var ts=0;ts<Ro.length;ts++){var Ns=Ro[ts],oa=Ns.geometry,eo=Ns.text?Ns.text.toString():null;if(eo){var ka=_s(eo,oa),da=_s(eo,oa,!0);if(ka in mo&&da in Po&&mo[ka]!==Po[da]){var Xu=Fs(ka,da,oa),mu=vu(ka,da,qa[Xu].geometry);delete Po[ka],delete mo[da],mo[_s(eo,qa[mu].geometry,!0)]=mu,qa[Xu].geometry=null}else ka in mo?vu(ka,da,oa):da in Po?Fs(ka,da,oa):(es(ts),Po[ka]=cs-1,mo[da]=cs-1)}else es(ts)}return qa.filter(function(Eo){return Eo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Ro,Po){return Ro.sortKey-Po.sortKey})}},er.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},er.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},er.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},er.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},er.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},er.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},er.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var c=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},_=e.segment+1;_<t.length;_++)m[_]={x:t[_].x,y:t[_].y,tileUnitDistanceFromAnchor:c},_<t.length-1&&(c+=t[_+1].dist(t[_]));for(var C=e.segment||0;C>=0;C--)m[C]={x:t[C].x,y:t[C].y,tileUnitDistanceFromAnchor:v},C>0&&(v+=t[C-1].dist(t[C]));for(var k=0;k<t.length;k++){var B=m[k];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},er.prototype.addSymbols=function(e,t,r,c,v,m,_,C,k,B,W,$){for(var se=e.indexArray,pe=e.layoutVertexArray,Ze=e.segments.prepareSegment(4*t.length,pe,se,this.canOverlap?m.sortKey:void 0),We=this.glyphOffsetArray.length,ot=Ze.vertexLength,Qe=this.allowVerticalPlacement&&_===$n.vertical?Math.PI/2:0,At=m.text&&m.text.sections,Gt=0;Gt<t.length;Gt++){var ir=t[Gt],hr=ir.tl,Cr=ir.tr,tn=ir.bl,pn=ir.br,Wn=ir.tex,Sn=ir.pixelOffsetTL,Kn=ir.pixelOffsetBR,En=ir.minFontScaleX,si=ir.minFontScaleY,ui=ir.glyphOffset,Ln=ir.isSDF,na=ir.sectionIndex,Pi=Ze.vertexLength,ua=ui[1];et(pe,C.x,C.y,hr.x,ua+hr.y,Wn.x,Wn.y,r,Ln,Sn.x,Sn.y,En,si),et(pe,C.x,C.y,Cr.x,ua+Cr.y,Wn.x+Wn.w,Wn.y,r,Ln,Kn.x,Sn.y,En,si),et(pe,C.x,C.y,tn.x,ua+tn.y,Wn.x,Wn.y+Wn.h,r,Ln,Sn.x,Kn.y,En,si),et(pe,C.x,C.y,pn.x,ua+pn.y,Wn.x+Wn.w,Wn.y+Wn.h,r,Ln,Kn.x,Kn.y,En,si),Ce(e.dynamicLayoutVertexArray,C,Qe),se.emplaceBack(Pi,Pi+1,Pi+2),se.emplaceBack(Pi+1,Pi+2,Pi+3),Ze.vertexLength+=4,Ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ui[0]),Gt!==t.length-1&&na===t[Gt+1].sectionIndex||e.programConfigurations.populatePaintArrays(pe.length,m,m.index,{},$,At&&At[na])}e.placedSymbolArray.emplaceBack(C.x,C.y,We,this.glyphOffsetArray.length-We,ot,k,B,C.segment,r?r[0]:0,r?r[1]:0,c[0],c[1],_,0,!1,0,W)},er.prototype._addCollisionDebugVertex=function(e,t,r,c,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,c,v,Math.round(m.x),Math.round(m.y))},er.prototype.addCollisionDebugVertices=function(e,t,r,c,v,m,_){var C=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),k=C.vertexLength,B=v.layoutVertexArray,W=v.collisionVertexArray,$=_.anchorX,se=_.anchorY;this._addCollisionDebugVertex(B,W,m,$,se,new Y(e,t)),this._addCollisionDebugVertex(B,W,m,$,se,new Y(r,t)),this._addCollisionDebugVertex(B,W,m,$,se,new Y(r,c)),this._addCollisionDebugVertex(B,W,m,$,se,new Y(e,c)),C.vertexLength+=4;var pe=v.indexArray;pe.emplaceBack(k,k+1),pe.emplaceBack(k+1,k+2),pe.emplaceBack(k+2,k+3),pe.emplaceBack(k+3,k),C.primitiveLength+=4},er.prototype.addDebugCollisionBoxes=function(e,t,r,c){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},er.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _r(el,Eh.members,ic),this.iconCollisionBox=new _r(el,Eh.members,ic);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},er.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,c,v,m,_,C,k){for(var B={},W=t;W<r;W++){var $=e.get(W);B.textBox={x1:$.x1,y1:$.y1,x2:$.x2,y2:$.y2,anchorPointX:$.anchorPointX,anchorPointY:$.anchorPointY},B.textFeatureIndex=$.featureIndex;break}for(var se=c;se<v;se++){var pe=e.get(se);B.verticalTextBox={x1:pe.x1,y1:pe.y1,x2:pe.x2,y2:pe.y2,anchorPointX:pe.anchorPointX,anchorPointY:pe.anchorPointY},B.verticalTextFeatureIndex=pe.featureIndex;break}for(var Ze=m;Ze<_;Ze++){var We=e.get(Ze);B.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},B.iconFeatureIndex=We.featureIndex;break}for(var ot=C;ot<k;ot++){var Qe=e.get(ot);B.verticalIconBox={x1:Qe.x1,y1:Qe.y1,x2:Qe.x2,y2:Qe.y2,anchorPointX:Qe.anchorPointX,anchorPointY:Qe.anchorPointY},B.verticalIconFeatureIndex=Qe.featureIndex;break}return B},er.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},er.prototype.hasTextData=function(){return this.text.segments.get().length>0},er.prototype.hasIconData=function(){return this.icon.segments.get().length>0},er.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},er.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},er.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},er.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),c=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<c;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},er.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),c=[],v=[],m=[],_=0;_<this.symbolInstances.length;++_){m.push(_);var C=this.symbolInstances.get(_);c.push(0|Math.round(t*C.anchorX+r*C.anchorY)),v.push(C.featureIndex)}return m.sort(function(k,B){return c[k]-c[B]||v[B]-v[k]}),m},er.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},er.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,c=this.symbolInstanceIndexes;r<c.length;r+=1){var v=this.symbolInstances.get(c[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,_,C){m>=0&&C.indexOf(m)===_&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Tn("SymbolBucket",er,{omit:["layers","collisionBoxArray","features","compareText"]}),er.MAX_GLYPHS=65535,er.addDynamicAttributes=Ce;var br=new Fo({"symbol-placement":new Zn(ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Zn(ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zn(ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mn(ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zn(ue.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Zn(ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Zn(ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zn(ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zn(ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mn(ue.layout_symbol["icon-size"]),"icon-text-fit":new Zn(ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Zn(ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mn(ue.layout_symbol["icon-image"]),"icon-rotate":new Mn(ue.layout_symbol["icon-rotate"]),"icon-padding":new Zn(ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Zn(ue.layout_symbol["icon-keep-upright"]),"icon-offset":new Mn(ue.layout_symbol["icon-offset"]),"icon-anchor":new Mn(ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zn(ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zn(ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zn(ue.layout_symbol["text-rotation-alignment"]),"text-field":new Mn(ue.layout_symbol["text-field"]),"text-font":new Mn(ue.layout_symbol["text-font"]),"text-size":new Mn(ue.layout_symbol["text-size"]),"text-max-width":new Mn(ue.layout_symbol["text-max-width"]),"text-line-height":new Zn(ue.layout_symbol["text-line-height"]),"text-letter-spacing":new Mn(ue.layout_symbol["text-letter-spacing"]),"text-justify":new Mn(ue.layout_symbol["text-justify"]),"text-radial-offset":new Mn(ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zn(ue.layout_symbol["text-variable-anchor"]),"text-anchor":new Mn(ue.layout_symbol["text-anchor"]),"text-max-angle":new Zn(ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Zn(ue.layout_symbol["text-writing-mode"]),"text-rotate":new Mn(ue.layout_symbol["text-rotate"]),"text-padding":new Zn(ue.layout_symbol["text-padding"]),"text-keep-upright":new Zn(ue.layout_symbol["text-keep-upright"]),"text-transform":new Mn(ue.layout_symbol["text-transform"]),"text-offset":new Mn(ue.layout_symbol["text-offset"]),"text-allow-overlap":new Zn(ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Zn(ue.layout_symbol["text-ignore-placement"]),"text-optional":new Zn(ue.layout_symbol["text-optional"])}),Gr={paint:new Fo({"icon-opacity":new Mn(ue.paint_symbol["icon-opacity"]),"icon-color":new Mn(ue.paint_symbol["icon-color"]),"icon-halo-color":new Mn(ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mn(ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mn(ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Zn(ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zn(ue.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mn(ue.paint_symbol["text-opacity"]),"text-color":new Mn(ue.paint_symbol["text-color"],{runtimeType:cn,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Mn(ue.paint_symbol["text-halo-color"]),"text-halo-width":new Mn(ue.paint_symbol["text-halo-width"]),"text-halo-blur":new Mn(ue.paint_symbol["text-halo-blur"]),"text-translate":new Zn(ue.paint_symbol["text-translate"]),"text-translate-anchor":new Zn(ue.paint_symbol["text-translate-anchor"])}),layout:br},Un=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:yn,this.defaultValue=e};Un.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Un.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Un.prototype.outputDefined=function(){return!1},Un.prototype.serialize=function(){return null},Tn("FormatSectionOverride",Un,{omit:["defaultValue"]});var ki=function(e){function t(r){e.call(this,r,Gr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,c){if(e.prototype.recalculate.call(this,r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],_=0,C=v;_<C.length;_+=1){var k=C[_];m.indexOf(k)<0&&m.push(k)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,c,v,m){var _=this.layout.get(r).evaluate(c,{},v,m),C=this._unevaluatedLayout._values[r];return C.isDataDriven()||Lu(C.value)||!_?_:function(k,B){return B.replace(/{([^{}]+)}/g,function(W,$){return $ in k?String(k[$]):""})}(c.properties,_)},t.prototype.createBucket=function(r){return new er(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,c=Gr.paint.overridableProperties;r<c.length;r+=1){var v=c[r];if(t.hasPaintOverride(this.layout,v)){var m,_=this.paint.get(v),C=new Un(_),k=new ll(C,_.property.specification);m=_.value.kind==="constant"||_.value.kind==="source"?new cl("source",k):new cu("composite",k,_.value.zoomStops,_.value._interpolationType),this.paint._values[v]=new ss(_.property,m,_.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,c,v){return!(!this.layout||c.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,c){var v=r.get("text-field"),m=Gr.paint.properties[c],_=!1,C=function(W){for(var $=0,se=W;$<se.length;$+=1)if(m.overrides&&m.overrides.hasOverride(se[$]))return void(_=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Li)C(v.value.value.sections);else if(v.value.kind==="source"){var k=function(W){_||(W instanceof Ga&&ga(W.value)===Qi?C(W.value.sections):W instanceof Wa?C(W.sections):W.eachChild(k))},B=v.value;B._styleExpression&&k(B._styleExpression.expression)}return _},t}(bu),Nn={paint:new Fo({"background-color":new Zn(ue.paint_background["background-color"]),"background-pattern":new zo(ue.paint_background["background-pattern"]),"background-opacity":new Zn(ue.paint_background["background-opacity"])})},oi=function(e){function t(r){e.call(this,r,Nn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(bu),Ai={paint:new Fo({"raster-opacity":new Zn(ue.paint_raster["raster-opacity"]),"raster-hue-rotate":new Zn(ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zn(ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zn(ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Zn(ue.paint_raster["raster-saturation"]),"raster-contrast":new Zn(ue.paint_raster["raster-contrast"]),"raster-resampling":new Zn(ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Zn(ue.paint_raster["raster-fade-duration"])})},pa=function(e){function t(r){e.call(this,r,Ai)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(bu),Zo=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(bu),au={circle:Gu,heatmap:Of,hillshade:Lf,fill:No,"fill-extrusion":Mu,line:Sh,symbol:ki,background:oi,raster:pa},Nf=ne.HTMLImageElement,Vo=ne.HTMLCanvasElement,Bf=ne.HTMLVideoElement,al=ne.ImageData,Uf=ne.ImageBitmap,jf=function(e,t,r,c){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,c)};jf.prototype.update=function(e,t,r){var c=e.width,v=e.height,m=!(this.size&&this.size[0]===c&&this.size[1]===v||r),_=this.context,C=_.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[c,v],e instanceof Nf||e instanceof Vo||e instanceof Bf||e instanceof al||Uf&&e instanceof Uf?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,e):C.texImage2D(C.TEXTURE_2D,0,this.format,c,v,0,this.format,C.UNSIGNED_BYTE,e.data);else{var k=r||{x:0,y:0},B=k.x,W=k.y;e instanceof Nf||e instanceof Vo||e instanceof Bf||e instanceof al||Uf&&e instanceof Uf?C.texSubImage2D(C.TEXTURE_2D,0,B,W,C.RGBA,C.UNSIGNED_BYTE,e):C.texSubImage2D(C.TEXTURE_2D,0,B,W,c,v,C.RGBA,C.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)},jf.prototype.bind=function(e,t,r){var c=this.context.gl;c.bindTexture(c.TEXTURE_2D,this.texture),r!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=c.LINEAR),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,t),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,t),this.wrap=t)},jf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},jf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var th=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};th.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},th.prototype.remove=function(){delete this._channel,this._callback=function(){}};var wf=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Pr(["receive","process"],this),this.invoker=new th(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=xt()?e:ne};function mp(e,t,r){var c=2*Math.PI*6378137/256/Math.pow(2,r);return[e*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}wf.prototype.send=function(e,t,r,c,v){var m=this;v===void 0&&(v=!1);var _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);var C=Ee(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:e,hasCallback:!!r,targetMapId:c,mustQueue:v,sourceMapId:this.mapId,data:fu(t,C)},C),{cancel:function(){r&&delete m.callbacks[_],m.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:m.mapId})}}},wf.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var c=this.cancelCallbacks[r];delete this.cancelCallbacks[r],c&&c()}else xt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},wf.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},wf.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var c=this.callbacks[e];delete this.callbacks[e],c&&(t.error?c(Vs(t.error)):c(null,Vs(t.data)))}else{var v=!1,m=Ee(this.globalScope)?void 0:[],_=t.hasCallback?function(W,$){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:W?fu(W):null,data:fu($,m)},m)}:function(W){v=!0},C=null,k=Vs(t.data);if(this.parent[t.type])C=this.parent[t.type](t.sourceMapId,k,_);else if(this.parent.getWorkerSource){var B=t.type.split(".");C=this.parent.getWorkerSource(t.sourceMapId,B[0],k.source)[B[1]](k,_)}else _(new Error("Could not find function "+t.type));!v&&C&&C.cancel&&(this.cancelCallbacks[e]=C.cancel)}},wf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var gs=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};gs.prototype.setNorthEast=function(e){return this._ne=e instanceof Qa?new Qa(e.lng,e.lat):Qa.convert(e),this},gs.prototype.setSouthWest=function(e){return this._sw=e instanceof Qa?new Qa(e.lng,e.lat):Qa.convert(e),this},gs.prototype.extend=function(e){var t,r,c=this._sw,v=this._ne;if(e instanceof Qa)t=e,r=e;else{if(!(e instanceof gs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(gs.convert(e)):this.extend(Qa.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return c||v?(c.lng=Math.min(t.lng,c.lng),c.lat=Math.min(t.lat,c.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new Qa(t.lng,t.lat),this._ne=new Qa(r.lng,r.lat)),this},gs.prototype.getCenter=function(){return new Qa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},gs.prototype.getSouthWest=function(){return this._sw},gs.prototype.getNorthEast=function(){return this._ne},gs.prototype.getNorthWest=function(){return new Qa(this.getWest(),this.getNorth())},gs.prototype.getSouthEast=function(){return new Qa(this.getEast(),this.getSouth())},gs.prototype.getWest=function(){return this._sw.lng},gs.prototype.getSouth=function(){return this._sw.lat},gs.prototype.getEast=function(){return this._ne.lng},gs.prototype.getNorth=function(){return this._ne.lat},gs.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},gs.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},gs.prototype.isEmpty=function(){return!(this._sw&&this._ne)},gs.prototype.contains=function(e){var t=Qa.convert(e),r=t.lng,c=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&v},gs.convert=function(e){return!e||e instanceof gs?e:new gs(e)};var Qa=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Qa.prototype.wrap=function(){return new Qa(Zt(this.lng,-180,180),this.lat)},Qa.prototype.toArray=function(){return[this.lng,this.lat]},Qa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Qa.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,c=e.lat*t,v=Math.sin(r)*Math.sin(c)+Math.cos(r)*Math.cos(c)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},Qa.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new gs(new Qa(this.lng-r,this.lat-t),new Qa(this.lng+r,this.lat+t))},Qa.convert=function(e){if(e instanceof Qa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Kh=2*Math.PI*63710088e-1;function Hp(e){return Kh*Math.cos(e*Math.PI/180)}function wh(e){return(180+e)/360}function Zf(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Wp(e,t){return e/Hp(t)}function gp(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Vf=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Vf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Qa.convert(e);return new Vf(wh(r.lng),Zf(r.lat),Wp(t,r.lat))},Vf.prototype.toLngLat=function(){return new Qa(360*this.x-180,gp(this.y))},Vf.prototype.toAltitude=function(){return this.z*Hp(gp(this.y))},Vf.prototype.meterInMercatorCoordinateUnits=function(){return 1/Kh*(e=gp(this.y),1/Math.cos(e*Math.PI/180));var e};var Gf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=rh(0,e,e,t,r)};Gf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Gf.prototype.url=function(e,t){var r,c,v,m,_,C=(c=this.y,v=this.z,m=mp(256*(r=this.x),256*(c=Math.pow(2,v)-c-1),v),_=mp(256*(r+1),256*(c+1),v),m[0]+","+m[1]+","+_[0]+","+_[1]),k=function(B,W,$){for(var se,pe="",Ze=B;Ze>0;Ze--)pe+=(W&(se=1<<Ze-1)?1:0)+($&se?2:0);return pe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",C)},Gf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new Y(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Gf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var yp=function(e,t){this.wrap=e,this.canonical=t,this.key=rh(e,t.z,t.z,t.x,t.y)},ys=function(e,t,r,c,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Gf(r,+c,+v),this.key=rh(t,e,r,c,v)};function rh(e,t,r,c,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+c).toString(36)+r.toString(36)+t.toString(36)}ys.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ys.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ys(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ys(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ys.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?rh(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):rh(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ys.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ys.prototype.children=function(e){if(this.overscaledZ>=e)return[new ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,c=2*this.canonical.y;return[new ys(t,this.wrap,t,r,c),new ys(t,this.wrap,t,r+1,c),new ys(t,this.wrap,t,r,c+1),new ys(t,this.wrap,t,r+1,c+1)]},ys.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ys.prototype.wrapped=function(){return new ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ys.prototype.unwrapTo=function(e){return new ys(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ys.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ys.prototype.toUnwrapped=function(){return new yp(this.wrap,this.canonical)},ys.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ys.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Vf(e.x-this.wrap,e.y))},Tn("CanonicalTileID",Gf),Tn("OverscaledTileID",ys,{omit:["posMatrix"]});var Wc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Fe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var c=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<c;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(c,v)]=this.data[this._idx(c-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,c)]=this.data[this._idx(v,c-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(c,-1)]=this.data[this._idx(c-1,0)],this.data[this._idx(-1,c)]=this.data[this._idx(0,c-1)],this.data[this._idx(c,c)]=this.data[this._idx(c-1,c-1)]};Wc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),c=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[c],r[c+1],r[c+2])},Wc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Wc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Wc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Wc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Wc.prototype.getPixels=function(){return new va({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Wc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var c=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,_=r*this.dim+this.dim;switch(t){case-1:c=v-1;break;case 1:v=c+1}switch(r){case-1:m=_-1;break;case 1:_=m+1}for(var C=-t*this.dim,k=-r*this.dim,B=m;B<_;B++)for(var W=c;W<v;W++)this.data[this._idx(W,B)]=e.data[this._idx(W+C,B+k)]},Tn("DEMData",Wc);var Th=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Th.prototype.encode=function(e){return this._stringToNumber[e]},Th.prototype.decode=function(e){return this._numberToString[e]};var Ah=function(e,t,r,c,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=c,this.properties=e.properties,this.id=v},$h={geometry:{configurable:!0}};$h.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},$h.geometry.set=function(e){this._geometry=e},Ah.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Ah.prototype,$h);var nh=function(){this.state={},this.stateChanges={},this.deletedStates={}};nh.prototype.updateState=function(e,t,r){var c=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Xt(this.stateChanges[e][c],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==c&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][c]===null)for(var m in this.deletedStates[e][c]={},this.state[e][c])r[m]||(this.deletedStates[e][c][m]=null);else for(var _ in r)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][_]===null&&delete this.deletedStates[e][c][_]},nh.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var c=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(r in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][r]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}},nh.prototype.getState=function(e,t){var r=String(t),c=Xt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete c[m]}return c},nh.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},nh.prototype.coalesceChanges=function(e,t){var r={};for(var c in this.stateChanges){this.state[c]=this.state[c]||{};var v={};for(var m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),Xt(this.state[c][m],this.stateChanges[c][m]),v[m]=this.state[c][m];r[c]=v}for(var _ in this.deletedStates){this.state[_]=this.state[_]||{};var C={};if(this.deletedStates[_]===null)for(var k in this.state[_])C[k]={},this.state[_][k]={};else for(var B in this.deletedStates[_]){if(this.deletedStates[_][B]===null)this.state[_][B]={};else for(var W=0,$=Object.keys(this.deletedStates[_][B]);W<$.length;W+=1)delete this.state[_][B][$[W]];C[B]=this.state[_][B]}r[_]=r[_]||{},Xt(r[_],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var se in e)e[se].setFeatureState(r,t)};var lc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Fu(8192,16,0),this.grid3D=new Fu(8192,16,0),this.featureIndexArray=new ee,this.promoteId=t};function Jh(e,t,r,c,v){return ar(e,function(m,_){var C=t instanceof zl?t.get(_):null;return C&&C.evaluate?C.evaluate(r,c,v):C})}function _p(e){for(var t=1/0,r=1/0,c=-1/0,v=-1/0,m=0,_=e;m<_.length;m+=1){var C=_[m];t=Math.min(t,C.x),r=Math.min(r,C.y),c=Math.max(c,C.x),v=Math.max(v,C.y)}return{minX:t,minY:r,maxX:c,maxY:v}}function Ad(e,t){return t-e}lc.prototype.insert=function(e,t,r,c,v,m){var _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,c,v);for(var C=m?this.grid3D:this.grid,k=0;k<t.length;k++){for(var B=t[k],W=[1/0,1/0,-1/0,-1/0],$=0;$<B.length;$++){var se=B[$];W[0]=Math.min(W[0],se.x),W[1]=Math.min(W[1],se.y),W[2]=Math.max(W[2],se.x),W[3]=Math.max(W[3],se.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&C.insert(_,W[0],W[1],W[2],W[3])}},lc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Xs.VectorTile(new Se(this.rawTileData)).layers,this.sourceLayerCoder=new Th(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},lc.prototype.query=function(e,t,r,c){var v=this;this.loadVTLayers();for(var m=e.params||{},_=8192/e.tileSize/e.scale,C=fl(m.filter),k=e.queryGeometry,B=e.queryPadding*_,W=_p(k),$=this.grid.query(W.minX-B,W.minY-B,W.maxX+B,W.maxY+B),se=_p(e.cameraQueryGeometry),pe=this.grid3D.query(se.minX-B,se.minY-B,se.maxX+B,se.maxY+B,function(ir,hr,Cr,tn){return function(pn,Wn,Sn,Kn,En){for(var si=0,ui=pn;si<ui.length;si+=1){var Ln=ui[si];if(Wn<=Ln.x&&Sn<=Ln.y&&Kn>=Ln.x&&En>=Ln.y)return!0}var na=[new Y(Wn,Sn),new Y(Wn,En),new Y(Kn,En),new Y(Kn,Sn)];if(pn.length>2){for(var Pi=0,ua=na;Pi<ua.length;Pi+=1)if(tu(pn,ua[Pi]))return!0}for(var ei=0;ei<pn.length-1;ei++)if(nl(pn[ei],pn[ei+1],na))return!0;return!1}(e.cameraQueryGeometry,ir-B,hr-B,Cr+B,tn+B)}),Ze=0,We=pe;Ze<We.length;Ze+=1)$.push(We[Ze]);$.sort(Ad);for(var ot,Qe={},At=function(ir){var hr=$[ir];if(hr!==ot){ot=hr;var Cr=v.featureIndexArray.get(hr),tn=null;v.loadMatchingFeature(Qe,Cr.bucketIndex,Cr.sourceLayerIndex,Cr.featureIndex,C,m.layers,m.availableImages,t,r,c,function(pn,Wn,Sn){return tn||(tn=Za(pn)),Wn.queryIntersectsFeature(k,pn,Sn,tn,v.z,e.transform,_,e.pixelPosMatrix)})}},Gt=0;Gt<$.length;Gt++)At(Gt);return Qe},lc.prototype.loadMatchingFeature=function(e,t,r,c,v,m,_,C,k,B,W){var $=this.bucketLayerIDs[t];if(!m||function(pn,Wn){for(var Sn=0;Sn<pn.length;Sn++)if(Wn.indexOf(pn[Sn])>=0)return!0;return!1}(m,$)){var se=this.sourceLayerCoder.decode(r),pe=this.vtLayers[se].feature(c);if(v.needGeometry){var Ze=ho(pe,!0);if(!v.filter(new Di(this.tileID.overscaledZ),Ze,this.tileID.canonical))return}else if(!v.filter(new Di(this.tileID.overscaledZ),pe))return;for(var We=this.getId(pe,se),ot=0;ot<$.length;ot++){var Qe=$[ot];if(!(m&&m.indexOf(Qe)<0)){var At=C[Qe];if(At){var Gt={};We!==void 0&&B&&(Gt=B.getState(At.sourceLayer||"_geojsonTileLayer",We));var ir=Xt({},k[Qe]);ir.paint=Jh(ir.paint,At.paint,pe,Gt,_),ir.layout=Jh(ir.layout,At.layout,pe,Gt,_);var hr=!W||W(pe,At,Gt);if(hr){var Cr=new Ah(pe,this.z,this.x,this.y,We);Cr.layer=ir;var tn=e[Qe];tn===void 0&&(tn=e[Qe]=[]),tn.push({featureIndex:c,feature:Cr,intersectionZ:hr})}}}}}},lc.prototype.lookupSymbolFeatures=function(e,t,r,c,v,m,_,C){var k={};this.loadVTLayers();for(var B=fl(v),W=0,$=e;W<$.length;W+=1)this.loadMatchingFeature(k,r,c,$[W],B,m,_,C,t);return k},lc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var c=0,v=r[t];c<v.length;c+=1)if(e===v[c])return!0;return!1},lc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Tn("FeatureIndex",lc,{omit:["rawTileData","sourceLayerCoder"]});var zs=function(e,t){this.tileID=e,this.uid=Lt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};zs.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<ln.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},zs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},zs.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var c in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(B,W){var $={};if(!W)return $;for(var se=function(){var We=Ze[pe],ot=We.layerIds.map(function(Gt){return W.getLayer(Gt)}).filter(Boolean);if(ot.length!==0){We.layers=ot,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Gt){return ot.filter(function(ir){return ir.id===Gt})[0]}));for(var Qe=0,At=ot;Qe<At.length;Qe+=1)$[At[Qe].id]=We}},pe=0,Ze=B;pe<Ze.length;pe+=1)se();return $}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[c];if(v instanceof er){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var _=this.buckets[m];if(_ instanceof er&&_.hasRTLText){this.hasRTLText=!0,Js.isLoading()||Js.isLoaded()||jc()!=="deferred"||_u();break}}for(var C in this.queryPadding=0,this.buckets){var k=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(C).queryRadius(k))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},zs.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},zs.prototype.getBucket=function(e){return this.buckets[e.id]},zs.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var c=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new jf(e,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new jf(e,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)},zs.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},zs.prototype.queryRenderedFeatures=function(e,t,r,c,v,m,_,C,k,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:B,transform:C,params:_,queryPadding:this.queryPadding*k},e,t,r):{}},zs.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var c=r.loadVTLayers(),v=t?t.sourceLayer:"",m=c._geojsonTileLayer||c[v];if(m)for(var _=fl(t&&t.filter),C=this.tileID.canonical,k=C.z,B=C.x,W=C.y,$={z:k,x:B,y:W},se=0;se<m.length;se++){var pe=m.feature(se);if(_.needGeometry){var Ze=ho(pe,!0);if(!_.filter(new Di(this.tileID.overscaledZ),Ze,this.tileID.canonical))continue}else if(!_.filter(new Di(this.tileID.overscaledZ),pe))continue;var We=r.getId(pe,v),ot=new Ah(pe,k,B,W,We);ot.tile=$,e.push(ot)}}},zs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},zs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},zs.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=nr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var c=Date.now(),v=!1;if(this.expirationTime>c)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=c+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},zs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},zs.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var c in this.buckets)if(t.style.hasLayer(c)){var v=this.buckets[c],m=v.layers[0].sourceLayer||"_geojsonTileLayer",_=r[m],C=e[m];if(_&&C&&Object.keys(C).length!==0){v.update(C,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=t&&t.style&&t.style.getLayer(c);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(v)))}}}},zs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},zs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ln.now()},zs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},zs.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=ln.now()+e},zs.prototype.setDependencies=function(e,t){for(var r={},c=0,v=t;c<v.length;c+=1)r[v[c]]=!0;this.dependencies[e]=r},zs.prototype.hasDependency=function(e,t){for(var r=0,c=e;r<c.length;r+=1){var v=this.dependencies[c[r]];if(v){for(var m=0,_=t;m<_.length;m+=1)if(v[_[m]])return!0}}return!1};var Tf=ne.performance,Xp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},Tf.mark(this._marks.start)};Xp.prototype.finish=function(){Tf.mark(this._marks.end);var e=Tf.getEntriesByName(this._marks.measure);return e.length===0&&(Tf.measure(this._marks.measure,this._marks.start,this._marks.end),e=Tf.getEntriesByName(this._marks.measure),Tf.clearMarks(this._marks.start),Tf.clearMarks(this._marks.end),Tf.clearMeasures(this._marks.measure)),e},p.Actor=wf,p.AlphaImage=Pu,p.CanonicalTileID=Gf,p.CollisionBoxArray=u,p.Color=jn,p.DEMData=Wc,p.DataConstantProperty=Zn,p.DictionaryCoder=Th,p.EXTENT=8192,p.ErrorEvent=Oe,p.EvaluationParameters=Di,p.Event=ie,p.Evented=He,p.FeatureIndex=lc,p.FillBucket=ji,p.FillExtrusionBucket=Ys,p.ImageAtlas=Yn,p.ImagePosition=Rr,p.LineBucket=iu,p.LngLat=Qa,p.LngLatBounds=gs,p.MercatorCoordinate=Vf,p.ONE_EM=24,p.OverscaledTileID=ys,p.Point=Y,p.Point$1=Y,p.Properties=Fo,p.Protobuf=Se,p.RGBAImage=va,p.RequestManager=kt,p.RequestPerformance=Xp,p.ResourceType=mr,p.SegmentVector=_e,p.SourceFeatureState=nh,p.StructArrayLayout1ui2=bc,p.StructArrayLayout2f1f2i16=eu,p.StructArrayLayout2i4=Uu,p.StructArrayLayout3ui6=tl,p.StructArrayLayout4i8=_c,p.SymbolBucket=er,p.Texture=jf,p.Tile=zs,p.Transitionable=Io,p.Uniform1f=rn,p.Uniform1i=Lr,p.Uniform2f=Yr,p.Uniform3f=_n,p.Uniform4f=Bn,p.UniformColor=Xn,p.UniformMatrix4f=ta,p.UnwrappedTileID=yp,p.ValidationError=De,p.WritingMode=$n,p.ZoomHistory=dl,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Ce,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var c=e.length,v=new Array(e.length),m=null;e.forEach(function(_,C){t(_,function(k,B){k&&(m=k),v[C]=B,--c==0&&r(m,v)})})},p.bezier=we,p.bindAll=Pr,p.browser=ln,p.cacheEntryPossiblyAdded=function(e){++Mt>ct&&(e.getActor().send("enforceCacheSizeLimit",gt),Mt=0)},p.clamp=Kt,p.clearTileCache=function(e){var t=ne.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=qn,p.clone=function(e){var t=new Ki(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ye,p.clone$2=function(e){var t=new Ki(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=vp,p.config=tr,p.create=function(){var e=new Ki(16);return Ki!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new Ki(9);return Ki!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new Ki(4);return Ki!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=w,p.createExpression=Pl,p.createLayout=_o,p.createStyleLayer=function(e){return e.type==="custom"?new Zo(e):new au[e.type](e)},p.cross=function(e,t,r){var c=t[0],v=t[1],m=t[2],_=r[0],C=r[1],k=r[2];return e[0]=v*k-m*C,e[1]=m*_-c*k,e[2]=c*C-v*_,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var c=0;c<t.length;c++)if(!e(t[c],r[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=Me,p.emitValidationErrors=zu,p.endsWith=Ht,p.enforceCacheSizeLimit=function(e){sr(),Wt&&Wt.then(function(t){t.keys().then(function(r){for(var c=0;c<r.length-e;c++)t.delete(r[c])})})},p.evaluateSizeForFeature=jo,p.evaluateSizeForZoom=ls,p.evaluateVariableOffset=it,p.evented=rf,p.extend=Xt,p.featureFilter=fl,p.filterObject=mt,p.fromRotation=function(e,t){var r=Math.sin(t),c=Math.cos(t);return e[0]=c,e[1]=r,e[2]=0,e[3]=-r,e[4]=c,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Jo,p.getAnchorJustification=It,p.getArrayBuffer=Ji,p.getImage=I,p.getJSON=function(e,t){return Ii(Xt(e,{type:"json"}),t)},p.getRTLTextPluginStatus=jc,p.getReferrer=Cn,p.getVideo=function(e,t){var r,c,v=ne.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var _=ne.document.createElement("source");r=e[m],c=void 0,(c=ne.document.createElement("a")).href=r,(c.protocol!==ne.document.location.protocol||c.host!==ne.document.location.host)&&(v.crossOrigin="Anonymous"),_.src=e[m],v.appendChild(_)}return{cancel:function(){}}},p.identity=Lo,p.invert=function(e,t){var r=t[0],c=t[1],v=t[2],m=t[3],_=t[4],C=t[5],k=t[6],B=t[7],W=t[8],$=t[9],se=t[10],pe=t[11],Ze=t[12],We=t[13],ot=t[14],Qe=t[15],At=r*C-c*_,Gt=r*k-v*_,ir=r*B-m*_,hr=c*k-v*C,Cr=c*B-m*C,tn=v*B-m*k,pn=W*We-$*Ze,Wn=W*ot-se*Ze,Sn=W*Qe-pe*Ze,Kn=$*ot-se*We,En=$*Qe-pe*We,si=se*Qe-pe*ot,ui=At*si-Gt*En+ir*Kn+hr*Sn-Cr*Wn+tn*pn;return ui?(e[0]=(C*si-k*En+B*Kn)*(ui=1/ui),e[1]=(v*En-c*si-m*Kn)*ui,e[2]=(We*tn-ot*Cr+Qe*hr)*ui,e[3]=(se*Cr-$*tn-pe*hr)*ui,e[4]=(k*Sn-_*si-B*Wn)*ui,e[5]=(r*si-v*Sn+m*Wn)*ui,e[6]=(ot*ir-Ze*tn-Qe*Gt)*ui,e[7]=(W*tn-se*ir+pe*Gt)*ui,e[8]=(_*En-C*Sn+B*pn)*ui,e[9]=(c*Sn-r*En-m*pn)*ui,e[10]=(Ze*Cr-We*ir+Qe*At)*ui,e[11]=($*ir-W*Cr-pe*At)*ui,e[12]=(C*Wn-_*Kn-k*pn)*ui,e[13]=(r*Kn-c*Wn+v*pn)*ui,e[14]=(We*Gt-Ze*hr-ot*At)*ui,e[15]=(W*hr-$*Gt+se*At)*ui,e):null},p.isChar=Jr,p.isMapboxURL=S,p.keysDifference=function(e,t){var r=[];for(var c in e)c in t||r.push(c);return r},p.makeRequest=Ii,p.mapObject=ar,p.mercatorXfromLng=wh,p.mercatorYfromLat=Zf,p.mercatorZfromAltitude=Wp,p.mul=vs,p.multiply=po,p.mvt=Xs,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],c=t[1],v=t[2],m=r*r+c*c+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},p.number=zn,p.offscreenCanvasSupported=Jt,p.ortho=function(e,t,r,c,v,m,_){var C=1/(t-r),k=1/(c-v),B=1/(m-_);return e[0]=-2*C,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*k,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*B,e[11]=0,e[12]=(t+r)*C,e[13]=(v+c)*k,e[14]=(_+m)*B,e[15]=1,e},p.parseGlyphPBF=function(e){return new Se(e).readFields(Dr,[])},p.pbf=Se,p.performSymbolLayout=function(e,t,r,c,v,m,_){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var C=e.layers[0].layout,k=e.layers[0]._unevaluatedLayout._values,B={};if(e.textSizeData.kind==="composite"){var W=e.textSizeData,$=W.maxZoom;B.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Di(W.minZoom),_),k["text-size"].possiblyEvaluate(new Di($),_)]}if(e.iconSizeData.kind==="composite"){var se=e.iconSizeData,pe=se.maxZoom;B.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Di(se.minZoom),_),k["icon-size"].possiblyEvaluate(new Di(pe),_)]}B.layoutTextSize=k["text-size"].possiblyEvaluate(new Di(e.zoom+1),_),B.layoutIconSize=k["icon-size"].possiblyEvaluate(new Di(e.zoom+1),_),B.textMaxSize=k["text-size"].possiblyEvaluate(new Di(18));for(var Ze=24*C.get("text-line-height"),We=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",ot=C.get("text-keep-upright"),Qe=C.get("text-size"),At=function(){var hr=ir[Gt],Cr=C.get("text-font").evaluate(hr,{},_).join(","),tn=Qe.evaluate(hr,{},_),pn=B.layoutTextSize.evaluate(hr,{},_),Wn=B.layoutIconSize.evaluate(hr,{},_),Sn={horizontal:{},vertical:void 0},Kn=hr.text,En=[0,0];if(Kn){var si=Kn.toString(),ui=24*C.get("text-letter-spacing").evaluate(hr,{},_),Ln=function(oa){for(var eo=0,ka=oa;eo<ka.length;eo+=1)if(da=ka[eo].charCodeAt(0),Jr.Arabic(da)||Jr["Arabic Supplement"](da)||Jr["Arabic Extended-A"](da)||Jr["Arabic Presentation Forms-A"](da)||Jr["Arabic Presentation Forms-B"](da))return!1;var da;return!0}(si)?ui:0,na=C.get("text-anchor").evaluate(hr,{},_),Pi=C.get("text-variable-anchor");if(!Pi){var ua=C.get("text-radial-offset").evaluate(hr,{},_);En=ua?it(na,[24*ua,ye]):C.get("text-offset").evaluate(hr,{},_).map(function(oa){return 24*oa})}var ei=We?"center":C.get("text-justify").evaluate(hr,{},_),la=C.get("symbol-placement"),Va=la==="point"?24*C.get("text-max-width").evaluate(hr,{},_):0,Ro=function(){e.allowVerticalPlacement&&gc(si)&&(Sn.vertical=Or(Kn,t,r,v,Cr,Va,Ze,na,"left",Ln,En,$n.vertical,!0,la,pn,tn))};if(!We&&Pi){for(var Po=ei==="auto"?Pi.map(function(oa){return It(oa)}):[ei],mo=!1,qa=0;qa<Po.length;qa++){var cs=Po[qa];if(!Sn.horizontal[cs])if(mo)Sn.horizontal[cs]=Sn.horizontal[0];else{var es=Or(Kn,t,r,v,Cr,Va,Ze,"center",cs,Ln,En,$n.horizontal,!1,la,pn,tn);es&&(Sn.horizontal[cs]=es,mo=es.positionedLines.length===1)}}Ro()}else{ei==="auto"&&(ei=It(na));var vu=Or(Kn,t,r,v,Cr,Va,Ze,na,ei,Ln,En,$n.horizontal,!1,la,pn,tn);vu&&(Sn.horizontal[ei]=vu),Ro(),gc(si)&&We&&ot&&(Sn.vertical=Or(Kn,t,r,v,Cr,Va,Ze,na,ei,Ln,En,$n.vertical,!1,la,pn,tn))}}var Fs=void 0,_s=!1;if(hr.icon&&hr.icon.name){var ts=c[hr.icon.name];ts&&(Fs=function(oa,eo,ka){var da=Jo(ka),Xu=eo[0]-oa.displaySize[0]*da.horizontalAlign,mu=eo[1]-oa.displaySize[1]*da.verticalAlign;return{image:oa,top:mu,bottom:mu+oa.displaySize[1],left:Xu,right:Xu+oa.displaySize[0]}}(v[hr.icon.name],C.get("icon-offset").evaluate(hr,{},_),C.get("icon-anchor").evaluate(hr,{},_)),_s=ts.sdf,e.sdfIcons===void 0?e.sdfIcons=ts.sdf:e.sdfIcons!==ts.sdf&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ts.pixelRatio!==e.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Ns=lt(Sn.horizontal)||Sn.vertical;e.iconsInText=!!Ns&&Ns.iconsInText,(Ns||Fs)&&function(oa,eo,ka,da,Xu,mu,Eo,rs,Bs,Sa,wc){var Sl=mu.textMaxSize.evaluate(eo,{});Sl===void 0&&(Sl=Eo);var of,Go=oa.layers[0].layout,Xc=Go.get("icon-offset").evaluate(eo,{},wc),Tc=lt(ka.horizontal),Hf=Eo/24,Wf=oa.tilePixelRatio*Hf,Ch=oa.tilePixelRatio*Sl/24,cc=oa.tilePixelRatio*rs,ih=oa.tilePixelRatio*Go.get("symbol-spacing"),xp=Go.get("text-padding")*oa.tilePixelRatio,fc=Go.get("icon-padding")*oa.tilePixelRatio,ah=Go.get("text-max-angle")/180*Math.PI,Xf=Go.get("text-rotation-alignment")==="map"&&Go.get("symbol-placement")!=="point",Qh=Go.get("icon-rotation-alignment")==="map"&&Go.get("symbol-placement")!=="point",sf=Go.get("symbol-placement"),Yc=ih/2,oh=Go.get("icon-text-fit");da&&oh!=="none"&&(oa.allowVerticalPlacement&&ka.vertical&&(of=Hi(da,ka.vertical,oh,Go.get("icon-text-fit-padding"),Xc,Hf)),Tc&&(da=Hi(da,Tc,oh,Go.get("icon-text-fit-padding"),Xc,Hf)));var Af=function(Cd,cf){cf.x<0||cf.x>=8192||cf.y<0||cf.y>=8192||function(wo,Ac,Pd,Mf,Ap,Kp,Ih,Cc,np,Oh,ip,Lh,Cp,Pp,Rh,$p,Jp,Qp,qp,ed,El,Dh,td,Kc,Md){var Mp,Kf,ch,fh,hh,ph=wo.addToLineVertexArray(Ac,Pd),rd=0,Ip=0,nd=0,id=0,Op=-1,Lp=-1,ff={},ad=ke(""),Rp=0,Dp=0;if(Cc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Rp=(Mp=Cc.layout.get("text-offset").evaluate(El,{},Kc).map(function(dh){return 24*dh}))[0],Dp=Mp[1]):(Rp=24*Cc.layout.get("text-radial-offset").evaluate(El,{},Kc),Dp=ye),wo.allowVerticalPlacement&&Mf.vertical){var kp=Cc.layout.get("text-rotate").evaluate(El,{},Kc)+90;fh=new Ve(np,Ac,Oh,ip,Lh,Mf.vertical,Cp,Pp,Rh,kp),Ih&&(hh=new Ve(np,Ac,Oh,ip,Lh,Ih,Jp,Qp,Rh,kp))}if(Ap){var zp=Cc.layout.get("icon-rotate").evaluate(El,{}),od=Cc.layout.get("icon-text-fit")!=="none",sd=Wi(Ap,zp,td,od),ap=Ih?Wi(Ih,zp,td,od):void 0;ch=new Ve(np,Ac,Oh,ip,Lh,Ap,Jp,Qp,!1,zp),rd=4*sd.length;var ud=wo.iconSizeData,kh=null;ud.kind==="source"?(kh=[128*Cc.layout.get("icon-size").evaluate(El,{})])[0]>32640&&Fe(wo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ud.kind==="composite"&&((kh=[128*Dh.compositeIconSizes[0].evaluate(El,{},Kc),128*Dh.compositeIconSizes[1].evaluate(El,{},Kc)])[0]>32640||kh[1]>32640)&&Fe(wo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),wo.addSymbols(wo.icon,sd,kh,ed,qp,El,!1,Ac,ph.lineStartIndex,ph.lineLength,-1,Kc),Op=wo.icon.placedSymbolArray.length-1,ap&&(Ip=4*ap.length,wo.addSymbols(wo.icon,ap,kh,ed,qp,El,$n.vertical,Ac,ph.lineStartIndex,ph.lineLength,-1,Kc),Lp=wo.icon.placedSymbolArray.length-1)}for(var ld in Mf.horizontal){var op=Mf.horizontal[ld];if(!Kf){ad=ke(op.text);var Id=Cc.layout.get("text-rotate").evaluate(El,{},Kc);Kf=new Ve(np,Ac,Oh,ip,Lh,op,Cp,Pp,Rh,Id)}var cd=op.positionedLines.length===1;if(nd+=Dt(wo,Ac,op,Kp,Cc,Rh,El,$p,ph,Mf.vertical?$n.horizontal:$n.horizontalOnly,cd?Object.keys(Mf.horizontal):[ld],ff,Op,Dh,Kc),cd)break}Mf.vertical&&(id+=Dt(wo,Ac,Mf.vertical,Kp,Cc,Rh,El,$p,ph,$n.vertical,["vertical"],ff,Lp,Dh,Kc));var fd=Kf?Kf.boxStartIndex:wo.collisionBoxArray.length,Od=Kf?Kf.boxEndIndex:wo.collisionBoxArray.length,Ld=fh?fh.boxStartIndex:wo.collisionBoxArray.length,Rd=fh?fh.boxEndIndex:wo.collisionBoxArray.length,Dd=ch?ch.boxStartIndex:wo.collisionBoxArray.length,kd=ch?ch.boxEndIndex:wo.collisionBoxArray.length,zd=hh?hh.boxStartIndex:wo.collisionBoxArray.length,Fd=hh?hh.boxEndIndex:wo.collisionBoxArray.length,$c=-1,zh=function(dh,$f){return dh&&dh.circleDiameter?Math.max(dh.circleDiameter,$f):$f};$c=zh(Kf,$c),$c=zh(fh,$c),$c=zh(ch,$c);var Fp=($c=zh(hh,$c))>-1?1:0;Fp&&($c*=Md/24),wo.glyphOffsetArray.length>=er.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),El.sortKey!==void 0&&wo.addToSortKeyRanges(wo.symbolInstances.length,El.sortKey),wo.symbolInstances.emplaceBack(Ac.x,Ac.y,ff.right>=0?ff.right:-1,ff.center>=0?ff.center:-1,ff.left>=0?ff.left:-1,ff.vertical||-1,Op,Lp,ad,fd,Od,Ld,Rd,Dd,kd,zd,Fd,Oh,nd,id,rd,Ip,Fp,0,Cp,Rp,Dp,$c)}(oa,cf,Cd,ka,da,Xu,of,oa.layers[0],oa.collisionBoxArray,eo.index,eo.sourceLayerIndex,oa.index,Wf,xp,Xf,Bs,cc,fc,Qh,Xc,eo,mu,Sa,wc,Eo)};if(sf==="line")for(var Ph=0,bp=qn(eo.geometry,0,0,8192,8192);Ph<bp.length;Ph+=1)for(var Sp=bp[Ph],qh=0,ep=ha(Sp,ih,ah,ka.vertical||Tc,da,24,Ch,oa.overscaling,8192);qh<ep.length;qh+=1){var Ep=ep[qh];Tc&&at(oa,Tc.text,Yc,Ep)||Af(Sp,Ep)}else if(sf==="line-center")for(var tp=0,sh=eo.geometry;tp<sh.length;tp+=1){var uh=sh[tp];if(uh.length>1){var wp=As(uh,ah,ka.vertical||Tc,da,24,Ch);wp&&Af(uh,wp)}}else if(eo.type==="Polygon")for(var Cf=0,Pf=Gn(eo.geometry,0);Cf<Pf.length;Cf+=1){var Mh=Pf[Cf],Yf=An(Mh,16);Af(Mh[0],new So(Yf.x,Yf.y,0))}else if(eo.type==="LineString")for(var uf=0,lf=eo.geometry;uf<lf.length;uf+=1){var lh=lf[uf];Af(lh,new So(lh[0].x,lh[0].y,0))}else if(eo.type==="Point")for(var rp=0,ou=eo.geometry;rp<ou.length;rp+=1)for(var Tp=0,Yp=ou[rp];Tp<Yp.length;Tp+=1){var za=Yp[Tp];Af([za],new So(za.x,za.y,0))}}(e,hr,Sn,Fs,c,B,pn,Wn,En,_s,_)},Gt=0,ir=e.features;Gt<ir.length;Gt+=1)At();m&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,c,v){var m,_=1/Math.tan(t/2);return e[0]=_/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+c)*(m=1/(c-v)),e[14]=2*v*c*m):(e[10]=-1,e[14]=-2*c),e},p.pick=function(e,t){for(var r={},c=0;c<t.length;c++){var v=t[c];v in e&&(r[v]=e[v])}return r},p.plugin=Js,p.polygonIntersectsPolygon=Zu,p.postMapLoadEvent=Ke,p.postTurnstileEvent=Ar,p.potpack=sn,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=Tn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Hs,pluginURL:qu}),rf.on("pluginStateChange",e),e},p.renderColorRamp=If,p.rotate=function(e,t,r){var c=t[0],v=t[1],m=t[2],_=t[3],C=Math.sin(r),k=Math.cos(r);return e[0]=c*k+m*C,e[1]=v*k+_*C,e[2]=c*-C+m*k,e[3]=v*-C+_*k,e},p.rotateX=function(e,t,r){var c=Math.sin(r),v=Math.cos(r),m=t[4],_=t[5],C=t[6],k=t[7],B=t[8],W=t[9],$=t[10],se=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+B*c,e[5]=_*v+W*c,e[6]=C*v+$*c,e[7]=k*v+se*c,e[8]=B*v-m*c,e[9]=W*v-_*c,e[10]=$*v-C*c,e[11]=se*v-k*c,e},p.rotateZ=function(e,t,r){var c=Math.sin(r),v=Math.cos(r),m=t[0],_=t[1],C=t[2],k=t[3],B=t[4],W=t[5],$=t[6],se=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+B*c,e[1]=_*v+W*c,e[2]=C*v+$*c,e[3]=k*v+se*c,e[4]=B*v-m*c,e[5]=W*v-_*c,e[6]=$*v-C*c,e[7]=se*v-k*c,e},p.scale=function(e,t,r){var c=r[0],v=r[1],m=r[2];return e[0]=t[0]*c,e[1]=t[1]*c,e[2]=t[2]*c,e[3]=t[3]*c,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){gt=e,ct=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Hs==="deferred"||Hs==="loading"||Hs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");qu=ln.resolveURL(e),Hs="deferred",yc=t,ql(),r||_u()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],c=e[2];return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(c),y:t*Math.sin(r)*Math.sin(c),z:t*Math.cos(c)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=ue,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=ws,p.transformMat3=function(e,t,r){var c=t[0],v=t[1],m=t[2];return e[0]=c*r[0]+v*r[3]+m*r[6],e[1]=c*r[1]+v*r[4]+m*r[7],e[2]=c*r[2]+v*r[5]+m*r[8],e},p.transformMat4=du,p.translate=function(e,t,r){var c,v,m,_,C,k,B,W,$,se,pe,Ze,We=r[0],ot=r[1],Qe=r[2];return t===e?(e[12]=t[0]*We+t[4]*ot+t[8]*Qe+t[12],e[13]=t[1]*We+t[5]*ot+t[9]*Qe+t[13],e[14]=t[2]*We+t[6]*ot+t[10]*Qe+t[14],e[15]=t[3]*We+t[7]*ot+t[11]*Qe+t[15]):(v=t[1],m=t[2],_=t[3],C=t[4],k=t[5],B=t[6],W=t[7],$=t[8],se=t[9],pe=t[10],Ze=t[11],e[0]=c=t[0],e[1]=v,e[2]=m,e[3]=_,e[4]=C,e[5]=k,e[6]=B,e[7]=W,e[8]=$,e[9]=se,e[10]=pe,e[11]=Ze,e[12]=c*We+C*ot+$*Qe+t[12],e[13]=v*We+k*ot+se*Qe+t[13],e[14]=m*We+B*ot+pe*Qe+t[14],e[15]=_*We+W*ot+Ze*Qe+t[15]),e},p.triggerPluginCompletionEvent=Uc,p.uniqueId=Lt,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=_f,p.validateStyle=Jl,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Xs,p.version="1.13.1",p.warnOnce=Fe,p.webpSupported=oe,p.window=ne,p.wrap=Zt}),E(["./shared"],function(p){"use strict";function w(G){var I=typeof G;if(I==="number"||I==="boolean"||I==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var j="[",K=0,ie=G;K<ie.length;K+=1)j+=w(ie[K])+",";return j+"]"}for(var Oe=Object.keys(G).sort(),He="{",ue=0;ue<Oe.length;ue++)He+=JSON.stringify(Oe[ue])+":"+w(G[Oe[ue]])+",";return He+"}"}function z(G){for(var I="",j=0,K=p.refProperties;j<K.length;j+=1)I+="/"+w(G[K[j]]);return I}var q=function(G){this.keyCache={},G&&this.replace(G)};q.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},q.prototype.update=function(G,I){for(var j=this,K=0,ie=G;K<ie.length;K+=1){var Oe=ie[K];this._layerConfigs[Oe.id]=Oe;var He=this._layers[Oe.id]=p.createStyleLayer(Oe);He._featureFilter=p.featureFilter(He.filter),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id]}for(var ue=0,De=I;ue<De.length;ue+=1){var St=De[ue];delete this.keyCache[St],delete this._layerConfigs[St],delete this._layers[St]}this.familiesBySource={};for(var Ir=0,Br=function($r,cn){for(var di={},hn=0;hn<$r.length;hn++){var bi=cn&&cn[$r[hn].id]||z($r[hn]);cn&&(cn[$r[hn].id]=bi);var Qi=di[bi];Qi||(Qi=di[bi]=[]),Qi.push($r[hn])}var _i=[];for(var Oi in di)_i.push(di[Oi]);return _i}(p.values(this._layerConfigs),this.keyCache);Ir<Br.length;Ir+=1){var jt=Br[Ir].map(function($r){return j._layers[$r.id]}),dr=jt[0];if(dr.visibility!=="none"){var Wr=dr.source||"",yn=this.familiesBySource[Wr];yn||(yn=this.familiesBySource[Wr]={});var vr=dr.sourceLayer||"_geojsonTileLayer",vn=yn[vr];vn||(vn=yn[vr]=[]),vn.push(jt)}}};var Y=function(G){var I={},j=[];for(var K in G){var ie=G[K],Oe=I[K]={};for(var He in ie){var ue=ie[+He];if(ue&&ue.bitmap.width!==0&&ue.bitmap.height!==0){var De={x:0,y:0,w:ue.bitmap.width+2,h:ue.bitmap.height+2};j.push(De),Oe[He]={rect:De,metrics:ue.metrics}}}}var St=p.potpack(j),Ir=new p.AlphaImage({width:St.w||1,height:St.h||1});for(var Br in G){var jt=G[Br];for(var dr in jt){var Wr=jt[+dr];if(Wr&&Wr.bitmap.width!==0&&Wr.bitmap.height!==0){var yn=I[Br][dr].rect;p.AlphaImage.copy(Wr.bitmap,Ir,{x:0,y:0},{x:yn.x+1,y:yn.y+1},Wr.bitmap)}}}this.image=Ir,this.positions=I};p.register("GlyphAtlas",Y);var ce=function(G){this.tileID=new p.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function ne(G,I,j){for(var K=new p.EvaluationParameters(I),ie=0,Oe=G;ie<Oe.length;ie+=1)Oe[ie].recalculate(K,j)}function be(G,I){var j=p.getArrayBuffer(G.request,function(K,ie,Oe,He){K?I(K):ie&&I(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(ie)),rawData:ie,cacheControl:Oe,expires:He})});return function(){j.cancel(),I()}}ce.prototype.parse=function(G,I,j,K,ie){var Oe=this;this.status="parsing",this.data=G,this.collisionBoxArray=new p.CollisionBoxArray;var He=new p.DictionaryCoder(Object.keys(G.layers).sort()),ue=new p.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];var De,St,Ir,Br,jt={},dr={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Wr=I.familiesBySource[this.source];for(var yn in Wr){var vr=G.layers[yn];if(vr){vr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+yn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var vn=He.encode(yn),$r=[],cn=0;cn<vr.length;cn++){var di=vr.feature(cn),hn=ue.getId(di,yn);$r.push({feature:di,id:hn,index:cn,sourceLayerIndex:vn})}for(var bi=0,Qi=Wr[yn];bi<Qi.length;bi+=1){var _i=Qi[bi],Oi=_i[0];Oi.minzoom&&this.zoom<Math.floor(Oi.minzoom)||Oi.maxzoom&&this.zoom>=Oi.maxzoom||Oi.visibility!=="none"&&(ne(_i,this.zoom,j),(jt[Oi.id]=Oi.createBucket({index:ue.bucketLayerIDs.length,layers:_i,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vn,sourceID:this.source})).populate($r,dr,this.tileID.canonical),ue.bucketLayerIDs.push(_i.map(function(Dn){return Dn.id})))}}}var Ci=p.mapObject(dr.glyphDependencies,function(Dn){return Object.keys(Dn).map(Number)});Object.keys(Ci).length?K.send("getGlyphs",{uid:this.uid,stacks:Ci},function(Dn,hi){De||(De=Dn,St=hi,Rn.call(Oe))}):St={};var yo=Object.keys(dr.iconDependencies);yo.length?K.send("getImages",{icons:yo,source:this.source,tileID:this.tileID,type:"icons"},function(Dn,hi){De||(De=Dn,Ir=hi,Rn.call(Oe))}):Ir={};var Zi=Object.keys(dr.patternDependencies);function Rn(){if(De)return ie(De);if(St&&Ir&&Br){var Dn=new Y(St),hi=new p.ImageAtlas(Ir,Br);for(var jn in jt){var Oa=jt[jn];Oa instanceof p.SymbolBucket?(ne(Oa.layers,this.zoom,j),p.performSymbolLayout(Oa,St,Dn.positions,Ir,hi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Oa.hasPattern&&(Oa instanceof p.LineBucket||Oa instanceof p.FillBucket||Oa instanceof p.FillExtrusionBucket)&&(ne(Oa.layers,this.zoom,j),Oa.addFeatures(dr,this.tileID.canonical,hi.patternPositions))}this.status="done",ie(null,{buckets:p.values(jt).filter(function(hs){return!hs.isEmpty()}),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dn.image,imageAtlas:hi,glyphMap:this.returnDependencies?St:null,iconMap:this.returnDependencies?Ir:null,glyphPositions:this.returnDependencies?Dn.positions:null})}}Zi.length?K.send("getImages",{icons:Zi,source:this.source,tileID:this.tileID,type:"patterns"},function(Dn,hi){De||(De=Dn,Br=hi,Rn.call(Oe))}):Br={},Rn.call(this)};var we=function(G,I,j,K){this.actor=G,this.layerIndex=I,this.availableImages=j,this.loadVectorData=K||be,this.loading={},this.loaded={}};we.prototype.loadTile=function(G,I){var j=this,K=G.uid;this.loading||(this.loading={});var ie=!!(G&&G.request&&G.request.collectResourceTiming)&&new p.RequestPerformance(G.request),Oe=this.loading[K]=new ce(G);Oe.abort=this.loadVectorData(G,function(He,ue){if(delete j.loading[K],He||!ue)return Oe.status="done",j.loaded[K]=Oe,I(He);var De=ue.rawData,St={};ue.expires&&(St.expires=ue.expires),ue.cacheControl&&(St.cacheControl=ue.cacheControl);var Ir={};if(ie){var Br=ie.finish();Br&&(Ir.resourceTiming=JSON.parse(JSON.stringify(Br)))}Oe.vectorTile=ue.vectorTile,Oe.parse(ue.vectorTile,j.layerIndex,j.availableImages,j.actor,function(jt,dr){if(jt||!dr)return I(jt);I(null,p.extend({rawTileData:De.slice(0)},dr,St,Ir))}),j.loaded=j.loaded||{},j.loaded[K]=Oe})},we.prototype.reloadTile=function(G,I){var j=this,K=this.loaded,ie=G.uid,Oe=this;if(K&&K[ie]){var He=K[ie];He.showCollisionBoxes=G.showCollisionBoxes;var ue=function(De,St){var Ir=He.reloadCallback;Ir&&(delete He.reloadCallback,He.parse(He.vectorTile,Oe.layerIndex,j.availableImages,Oe.actor,Ir)),I(De,St)};He.status==="parsing"?He.reloadCallback=ue:He.status==="done"&&(He.vectorTile?He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}},we.prototype.abortTile=function(G,I){var j=this.loading,K=G.uid;j&&j[K]&&j[K].abort&&(j[K].abort(),delete j[K]),I()},we.prototype.removeTile=function(G,I){var j=this.loaded,K=G.uid;j&&j[K]&&delete j[K],I()};var Me=p.window.ImageBitmap,Kt=function(){this.loaded={}};function Zt(G,I){if(G.length!==0){Xt(G[0],I);for(var j=1;j<G.length;j++)Xt(G[j],!I)}}function Xt(G,I){for(var j=0,K=0,ie=G.length,Oe=ie-1;K<ie;Oe=K++)j+=(G[K][0]-G[Oe][0])*(G[Oe][1]+G[K][1]);j>=0!=!!I&&G.reverse()}Kt.prototype.loadTile=function(G,I){var j=G.uid,K=G.encoding,ie=G.rawImageData,Oe=Me&&ie instanceof Me?this.getImageData(ie):ie,He=new p.DEMData(j,Oe,K);this.loaded=this.loaded||{},this.loaded[j]=He,I(null,He)},Kt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var I=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:I.width,height:I.height},I.data)},Kt.prototype.removeTile=function(G){var I=this.loaded,j=G.uid;I&&I[j]&&delete I[j]};var zt=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Lt=function(G){this._feature=G,this.extent=p.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};Lt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],I=0,j=this._feature.geometry;I<j.length;I+=1){var K=j[I];G.push([new p.Point$1(K[0],K[1])])}return G}for(var ie=[],Oe=0,He=this._feature.geometry;Oe<He.length;Oe+=1){for(var ue=[],De=0,St=He[Oe];De<St.length;De+=1){var Ir=St[De];ue.push(new p.Point$1(Ir[0],Ir[1]))}ie.push(ue)}return ie},Lt.prototype.toGeoJSON=function(G,I,j){return zt.call(this,G,I,j)};var yt=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=G.length,this._features=G};yt.prototype.feature=function(G){return new Lt(this._features[G])};var pt=p.vectorTile.VectorTileFeature,Pr=Ht;function Ht(G,I){this.options=I||{},this.features=G,this.length=G.length}function ar(G,I){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=I||4096}Ht.prototype.feature=function(G){return new ar(this.features[G],this.options.extent)},ar.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var I=0;I<G.length;I++){for(var j=G[I],K=[],ie=0;ie<j.length;ie++)K.push(new p.Point$1(j[ie][0],j[ie][1]));this.geometry.push(K)}return this.geometry},ar.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,I=1/0,j=-1/0,K=1/0,ie=-1/0,Oe=0;Oe<G.length;Oe++)for(var He=G[Oe],ue=0;ue<He.length;ue++){var De=He[ue];I=Math.min(I,De.x),j=Math.max(j,De.x),K=Math.min(K,De.y),ie=Math.max(ie,De.y)}return[I,K,j,ie]},ar.prototype.toGeoJSON=pt.prototype.toGeoJSON;var mt=bt,Ye=Pr;function bt(G){var I=new p.pbf;return function(j,K){for(var ie in j.layers)K.writeMessage(3,Fe,j.layers[ie])}(G,I),I.finish()}function Fe(G,I){var j;I.writeVarintField(15,G.version||1),I.writeStringField(1,G.name||""),I.writeVarintField(5,G.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<G.length;j++)K.feature=G.feature(j),I.writeMessage(2,Ae,K);var ie=K.keys;for(j=0;j<ie.length;j++)I.writeStringField(3,ie[j]);var Oe=K.values;for(j=0;j<Oe.length;j++)I.writeMessage(4,Ee,Oe[j])}function Ae(G,I){var j=G.feature;j.id!==void 0&&I.writeVarintField(1,j.id),I.writeMessage(2,Ne,G),I.writeVarintField(3,j.type),I.writeMessage(4,re,j)}function Ne(G,I){var j=G.feature,K=G.keys,ie=G.values,Oe=G.keycache,He=G.valuecache;for(var ue in j.properties){var De=Oe[ue];De===void 0&&(K.push(ue),Oe[ue]=De=K.length-1),I.writeVarint(De);var St=j.properties[ue],Ir=typeof St;Ir!=="string"&&Ir!=="boolean"&&Ir!=="number"&&(St=JSON.stringify(St));var Br=Ir+":"+St,jt=He[Br];jt===void 0&&(ie.push(St),He[Br]=jt=ie.length-1),I.writeVarint(jt)}}function xt(G,I){return(I<<3)+(7&G)}function nr(G){return G<<1^G>>31}function re(G,I){for(var j=G.loadGeometry(),K=G.type,ie=0,Oe=0,He=j.length,ue=0;ue<He;ue++){var De=j[ue],St=1;K===1&&(St=De.length),I.writeVarint(xt(1,St));for(var Ir=K===3?De.length-1:De.length,Br=0;Br<Ir;Br++){Br===1&&K!==1&&I.writeVarint(xt(2,Ir-1));var jt=De[Br].x-ie,dr=De[Br].y-Oe;I.writeVarint(nr(jt)),I.writeVarint(nr(dr)),ie+=jt,Oe+=dr}K===3&&I.writeVarint(xt(7,1))}}function Ee(G,I){var j=typeof G;j==="string"?I.writeStringField(1,G):j==="boolean"?I.writeBooleanField(7,G):j==="number"&&(G%1!=0?I.writeDoubleField(3,G):G<0?I.writeSVarintField(6,G):I.writeVarintField(5,G))}function ae(G,I,j,K){me(G,j,K),me(I,2*j,2*K),me(I,2*j+1,2*K+1)}function me(G,I,j){var K=G[I];G[I]=G[j],G[j]=K}function Te(G,I,j,K){var ie=G-j,Oe=I-K;return ie*ie+Oe*Oe}mt.fromVectorTileJs=bt,mt.fromGeojsonVt=function(G,I){I=I||{};var j={};for(var K in G)j[K]=new Pr(G[K].features,I),j[K].name=K,j[K].version=I.version,j[K].extent=I.extent;return bt({layers:j})},mt.GeoJSONWrapper=Ye;var Je=function(G){return G[0]},dt=function(G){return G[1]},$t=function(G,I,j,K,ie){I===void 0&&(I=Je),j===void 0&&(j=dt),K===void 0&&(K=64),ie===void 0&&(ie=Float64Array),this.nodeSize=K,this.points=G;for(var Oe=G.length<65536?Uint16Array:Uint32Array,He=this.ids=new Oe(G.length),ue=this.coords=new ie(2*G.length),De=0;De<G.length;De++)He[De]=De,ue[2*De]=I(G[De]),ue[2*De+1]=j(G[De]);(function St(Ir,Br,jt,dr,Wr,yn){if(!(Wr-dr<=jt)){var vr=dr+Wr>>1;(function vn($r,cn,di,hn,bi,Qi){for(;bi>hn;){if(bi-hn>600){var _i=bi-hn+1,Oi=di-hn+1,Ci=Math.log(_i),yo=.5*Math.exp(2*Ci/3),Zi=.5*Math.sqrt(Ci*yo*(_i-yo)/_i)*(Oi-_i/2<0?-1:1);vn($r,cn,di,Math.max(hn,Math.floor(di-Oi*yo/_i+Zi)),Math.min(bi,Math.floor(di+(_i-Oi)*yo/_i+Zi)),Qi)}var Rn=cn[2*di+Qi],Dn=hn,hi=bi;for(ae($r,cn,hn,di),cn[2*bi+Qi]>Rn&&ae($r,cn,hn,bi);Dn<hi;){for(ae($r,cn,Dn,hi),Dn++,hi--;cn[2*Dn+Qi]<Rn;)Dn++;for(;cn[2*hi+Qi]>Rn;)hi--}cn[2*hn+Qi]===Rn?ae($r,cn,hn,hi):ae($r,cn,++hi,bi),hi<=di&&(hn=hi+1),di<=hi&&(bi=hi-1)}})(Ir,Br,vr,dr,Wr,yn%2),St(Ir,Br,jt,dr,vr-1,yn+1),St(Ir,Br,jt,vr+1,Wr,yn+1)}})(He,ue,K,0,He.length-1,0)};$t.prototype.range=function(G,I,j,K){return function(ie,Oe,He,ue,De,St,Ir){for(var Br,jt,dr=[0,ie.length-1,0],Wr=[];dr.length;){var yn=dr.pop(),vr=dr.pop(),vn=dr.pop();if(vr-vn<=Ir)for(var $r=vn;$r<=vr;$r++)jt=Oe[2*$r+1],(Br=Oe[2*$r])>=He&&Br<=De&&jt>=ue&&jt<=St&&Wr.push(ie[$r]);else{var cn=Math.floor((vn+vr)/2);jt=Oe[2*cn+1],(Br=Oe[2*cn])>=He&&Br<=De&&jt>=ue&&jt<=St&&Wr.push(ie[cn]);var di=(yn+1)%2;(yn===0?He<=Br:ue<=jt)&&(dr.push(vn),dr.push(cn-1),dr.push(di)),(yn===0?De>=Br:St>=jt)&&(dr.push(cn+1),dr.push(vr),dr.push(di))}}return Wr}(this.ids,this.coords,G,I,j,K,this.nodeSize)},$t.prototype.within=function(G,I,j){return function(K,ie,Oe,He,ue,De){for(var St=[0,K.length-1,0],Ir=[],Br=ue*ue;St.length;){var jt=St.pop(),dr=St.pop(),Wr=St.pop();if(dr-Wr<=De)for(var yn=Wr;yn<=dr;yn++)Te(ie[2*yn],ie[2*yn+1],Oe,He)<=Br&&Ir.push(K[yn]);else{var vr=Math.floor((Wr+dr)/2),vn=ie[2*vr],$r=ie[2*vr+1];Te(vn,$r,Oe,He)<=Br&&Ir.push(K[vr]);var cn=(jt+1)%2;(jt===0?Oe-ue<=vn:He-ue<=$r)&&(St.push(Wr),St.push(vr-1),St.push(cn)),(jt===0?Oe+ue>=vn:He+ue>=$r)&&(St.push(vr+1),St.push(dr),St.push(cn))}}return Ir}(this.ids,this.coords,G,I,j,this.nodeSize)};var Fr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},zr=function(G){this.options=Ct(Object.create(Fr),G),this.trees=new Array(this.options.maxZoom+1)};function ln(G,I,j,K,ie){return{x:G,y:I,zoom:1/0,id:j,parentId:-1,numPoints:K,properties:ie}}function tr(G,I){var j=G.geometry.coordinates,K=j[1];return{x:Re(j[0]),y:qe(K),zoom:1/0,index:I,parentId:-1}}function oe(G){return{type:"Feature",id:G.id,properties:ge(G),geometry:{type:"Point",coordinates:[(K=G.x,360*(K-.5)),(I=G.y,j=(180-360*I)*Math.PI/180,360*Math.atan(Math.exp(j))/Math.PI-90)]}};var I,j,K}function ge(G){var I=G.numPoints,j=I>=1e4?Math.round(I/1e3)+"k":I>=1e3?Math.round(I/100)/10+"k":I;return Ct(Ct({},G.properties),{cluster:!0,cluster_id:G.id,point_count:I,point_count_abbreviated:j})}function Re(G){return G/360+.5}function qe(G){var I=Math.sin(G*Math.PI/180),j=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return j<0?0:j>1?1:j}function Ct(G,I){for(var j in I)G[j]=I[j];return G}function kt(G){return G.x}function S(G){return G.y}function F(G,I,j,K,ie,Oe){var He=ie-j,ue=Oe-K;if(He!==0||ue!==0){var De=((G-j)*He+(I-K)*ue)/(He*He+ue*ue);De>1?(j=ie,K=Oe):De>0&&(j+=He*De,K+=ue*De)}return(He=G-j)*He+(ue=I-K)*ue}function he(G,I,j,K){var ie={id:G===void 0?null:G,type:I,geometry:j,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var He=Oe.geometry,ue=Oe.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Be(Oe,He);else if(ue==="Polygon"||ue==="MultiLineString")for(var De=0;De<He.length;De++)Be(Oe,He[De]);else if(ue==="MultiPolygon")for(De=0;De<He.length;De++)for(var St=0;St<He[De].length;St++)Be(Oe,He[De][St])}(ie),ie}function Be(G,I){for(var j=0;j<I.length;j+=3)G.minX=Math.min(G.minX,I[j]),G.minY=Math.min(G.minY,I[j+1]),G.maxX=Math.max(G.maxX,I[j]),G.maxY=Math.max(G.maxY,I[j+1])}function $e(G,I,j,K){if(I.geometry){var ie=I.geometry.coordinates,Oe=I.geometry.type,He=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),ue=[],De=I.id;if(j.promoteId?De=I.properties[j.promoteId]:j.generateId&&(De=K||0),Oe==="Point")vt(ie,ue);else if(Oe==="MultiPoint")for(var St=0;St<ie.length;St++)vt(ie[St],ue);else if(Oe==="LineString")wt(ie,ue,He,!1);else if(Oe==="MultiLineString"){if(j.lineMetrics){for(St=0;St<ie.length;St++)wt(ie[St],ue=[],He,!1),G.push(he(De,"LineString",ue,I.properties));return}H(ie,ue,He,!1)}else if(Oe==="Polygon")H(ie,ue,He,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(St=0;St<I.geometry.geometries.length;St++)$e(G,{id:De,geometry:I.geometry.geometries[St],properties:I.properties},j,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(St=0;St<ie.length;St++){var Ir=[];H(ie[St],Ir,He,!0),ue.push(Ir)}}G.push(he(De,Oe,ue,I.properties))}}function vt(G,I){I.push(Wt(G[0])),I.push(Vt(G[1])),I.push(0)}function wt(G,I,j,K){for(var ie,Oe,He=0,ue=0;ue<G.length;ue++){var De=Wt(G[ue][0]),St=Vt(G[ue][1]);I.push(De),I.push(St),I.push(0),ue>0&&(He+=K?(ie*St-De*Oe)/2:Math.sqrt(Math.pow(De-ie,2)+Math.pow(St-Oe,2))),ie=De,Oe=St}var Ir=I.length-3;I[2]=1,function Br(jt,dr,Wr,yn){for(var vr,vn=yn,$r=Wr-dr>>1,cn=Wr-dr,di=jt[dr],hn=jt[dr+1],bi=jt[Wr],Qi=jt[Wr+1],_i=dr+3;_i<Wr;_i+=3){var Oi=F(jt[_i],jt[_i+1],di,hn,bi,Qi);if(Oi>vn)vr=_i,vn=Oi;else if(Oi===vn){var Ci=Math.abs(_i-$r);Ci<cn&&(vr=_i,cn=Ci)}}vn>yn&&(vr-dr>3&&Br(jt,dr,vr,yn),jt[vr+2]=vn,Wr-vr>3&&Br(jt,vr,Wr,yn))}(I,0,Ir,j),I[Ir+2]=1,I.size=Math.abs(He),I.start=0,I.end=I.size}function H(G,I,j,K){for(var ie=0;ie<G.length;ie++){var Oe=[];wt(G[ie],Oe,j,K),I.push(Oe)}}function Wt(G){return G/360+.5}function Vt(G){var I=Math.sin(G*Math.PI/180),j=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return j<0?0:j>1?1:j}function yr(G,I,j,K,ie,Oe,He,ue){if(K/=I,Oe>=(j/=I)&&He<K)return G;if(He<j||Oe>=K)return null;for(var De=[],St=0;St<G.length;St++){var Ir=G[St],Br=Ir.geometry,jt=Ir.type,dr=ie===0?Ir.minX:Ir.minY,Wr=ie===0?Ir.maxX:Ir.maxY;if(dr>=j&&Wr<K)De.push(Ir);else if(!(Wr<j||dr>=K)){var yn=[];if(jt==="Point"||jt==="MultiPoint")Er(Br,yn,j,K,ie);else if(jt==="LineString")Ar(Br,yn,j,K,ie,!1,ue.lineMetrics);else if(jt==="MultiLineString")Ke(Br,yn,j,K,ie,!1);else if(jt==="Polygon")Ke(Br,yn,j,K,ie,!0);else if(jt==="MultiPolygon")for(var vr=0;vr<Br.length;vr++){var vn=[];Ke(Br[vr],vn,j,K,ie,!0),vn.length&&yn.push(vn)}if(yn.length){if(ue.lineMetrics&&jt==="LineString"){for(vr=0;vr<yn.length;vr++)De.push(he(Ir.id,jt,yn[vr],Ir.tags));continue}jt!=="LineString"&&jt!=="MultiLineString"||(yn.length===1?(jt="LineString",yn=yn[0]):jt="MultiLineString"),jt!=="Point"&&jt!=="MultiPoint"||(jt=yn.length===3?"Point":"MultiPoint"),De.push(he(Ir.id,jt,yn,Ir.tags))}}}return De.length?De:null}function Er(G,I,j,K,ie){for(var Oe=0;Oe<G.length;Oe+=3){var He=G[Oe+ie];He>=j&&He<=K&&(I.push(G[Oe]),I.push(G[Oe+1]),I.push(G[Oe+2]))}}function Ar(G,I,j,K,ie,Oe,He){for(var ue,De,St=Mr(G),Ir=ie===0?ct:sr,Br=G.start,jt=0;jt<G.length-3;jt+=3){var dr=G[jt],Wr=G[jt+1],yn=G[jt+2],vr=G[jt+3],vn=G[jt+4],$r=ie===0?dr:Wr,cn=ie===0?vr:vn,di=!1;He&&(ue=Math.sqrt(Math.pow(dr-vr,2)+Math.pow(Wr-vn,2))),$r<j?cn>j&&(De=Ir(St,dr,Wr,vr,vn,j),He&&(St.start=Br+ue*De)):$r>K?cn<K&&(De=Ir(St,dr,Wr,vr,vn,K),He&&(St.start=Br+ue*De)):gt(St,dr,Wr,yn),cn<j&&$r>=j&&(De=Ir(St,dr,Wr,vr,vn,j),di=!0),cn>K&&$r<=K&&(De=Ir(St,dr,Wr,vr,vn,K),di=!0),!Oe&&di&&(He&&(St.end=Br+ue*De),I.push(St),St=Mr(G)),He&&(Br+=ue)}var hn=G.length-3;dr=G[hn],Wr=G[hn+1],yn=G[hn+2],($r=ie===0?dr:Wr)>=j&&$r<=K&&gt(St,dr,Wr,yn),hn=St.length-3,Oe&&hn>=3&&(St[hn]!==St[0]||St[hn+1]!==St[1])&&gt(St,St[0],St[1],St[2]),St.length&&I.push(St)}function Mr(G){var I=[];return I.size=G.size,I.start=G.start,I.end=G.end,I}function Ke(G,I,j,K,ie,Oe){for(var He=0;He<G.length;He++)Ar(G[He],I,j,K,ie,Oe,!1)}function gt(G,I,j,K){G.push(I),G.push(j),G.push(K)}function ct(G,I,j,K,ie,Oe){var He=(Oe-I)/(K-I);return G.push(Oe),G.push(j+(ie-j)*He),G.push(1),He}function sr(G,I,j,K,ie,Oe){var He=(Oe-j)/(ie-j);return G.push(I+(K-I)*He),G.push(Oe),G.push(1),He}function Qr(G,I){for(var j=[],K=0;K<G.length;K++){var ie,Oe=G[K],He=Oe.type;if(He==="Point"||He==="MultiPoint"||He==="LineString")ie=st(Oe.geometry,I);else if(He==="MultiLineString"||He==="Polygon"){ie=[];for(var ue=0;ue<Oe.geometry.length;ue++)ie.push(st(Oe.geometry[ue],I))}else if(He==="MultiPolygon")for(ie=[],ue=0;ue<Oe.geometry.length;ue++){for(var De=[],St=0;St<Oe.geometry[ue].length;St++)De.push(st(Oe.geometry[ue][St],I));ie.push(De)}j.push(he(Oe.id,He,ie,Oe.tags))}return j}function st(G,I){var j=[];j.size=G.size,G.start!==void 0&&(j.start=G.start,j.end=G.end);for(var K=0;K<G.length;K+=3)j.push(G[K]+I,G[K+1],G[K+2]);return j}function Mt(G,I){if(G.transformed)return G;var j,K,ie,Oe=1<<G.z,He=G.x,ue=G.y;for(j=0;j<G.features.length;j++){var De=G.features[j],St=De.geometry,Ir=De.type;if(De.geometry=[],Ir===1)for(K=0;K<St.length;K+=2)De.geometry.push(Jt(St[K],St[K+1],I,Oe,He,ue));else for(K=0;K<St.length;K++){var Br=[];for(ie=0;ie<St[K].length;ie+=2)Br.push(Jt(St[K][ie],St[K][ie+1],I,Oe,He,ue));De.geometry.push(Br)}}return G.transformed=!0,G}function Jt(G,I,j,K,ie,Oe){return[Math.round(j*(G*K-ie)),Math.round(j*(I*K-Oe))]}function mr(G,I,j,K,ie){for(var Oe=I===ie.maxZoom?0:ie.tolerance/((1<<I)*ie.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:K,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<G.length;ue++){He.numFeatures++,gn(He,G[ue],Oe,ie);var De=G[ue].minX,St=G[ue].minY,Ir=G[ue].maxX,Br=G[ue].maxY;De<He.minX&&(He.minX=De),St<He.minY&&(He.minY=St),Ir>He.maxX&&(He.maxX=Ir),Br>He.maxY&&(He.maxY=Br)}return He}function gn(G,I,j,K){var ie=I.geometry,Oe=I.type,He=[];if(Oe==="Point"||Oe==="MultiPoint")for(var ue=0;ue<ie.length;ue+=3)He.push(ie[ue]),He.push(ie[ue+1]),G.numPoints++,G.numSimplified++;else if(Oe==="LineString")Cn(He,ie,G,j,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(ue=0;ue<ie.length;ue++)Cn(He,ie[ue],G,j,Oe==="Polygon",ue===0);else if(Oe==="MultiPolygon")for(var De=0;De<ie.length;De++){var St=ie[De];for(ue=0;ue<St.length;ue++)Cn(He,St[ue],G,j,!0,ue===0)}if(He.length){var Ir=I.tags||null;if(Oe==="LineString"&&K.lineMetrics){for(var Br in Ir={},I.tags)Ir[Br]=I.tags[Br];Ir.mapbox_clip_start=ie.start/ie.size,Ir.mapbox_clip_end=ie.end/ie.size}var jt={geometry:He,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:Ir};I.id!==null&&(jt.id=I.id),G.features.push(jt)}}function Cn(G,I,j,K,ie,Oe){var He=K*K;if(K>0&&I.size<(ie?He:K))j.numPoints+=I.length/3;else{for(var ue=[],De=0;De<I.length;De+=3)(K===0||I[De+2]>He)&&(j.numSimplified++,ue.push(I[De]),ue.push(I[De+1])),j.numPoints++;ie&&function(St,Ir){for(var Br=0,jt=0,dr=St.length,Wr=dr-2;jt<dr;Wr=jt,jt+=2)Br+=(St[jt]-St[Wr])*(St[jt+1]+St[Wr+1]);if(Br>0===Ir)for(jt=0,dr=St.length;jt<dr/2;jt+=2){var yn=St[jt],vr=St[jt+1];St[jt]=St[dr-2-jt],St[jt+1]=St[dr-1-jt],St[dr-2-jt]=yn,St[dr-1-jt]=vr}}(ue,Oe),G.push(ue)}}function yi(G,I){var j=(I=this.options=function(ie,Oe){for(var He in Oe)ie[He]=Oe[He];return ie}(Object.create(this.options),I)).debug;if(j&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(ie,Oe){var He=[];if(ie.type==="FeatureCollection")for(var ue=0;ue<ie.features.length;ue++)$e(He,ie.features[ue],Oe,ue);else $e(He,ie.type==="Feature"?ie:{geometry:ie},Oe);return He}(G,I);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(K=function(ie,Oe){var He=Oe.buffer/Oe.extent,ue=ie,De=yr(ie,1,-1-He,He,0,-1,2,Oe),St=yr(ie,1,1-He,2+He,0,-1,2,Oe);return(De||St)&&(ue=yr(ie,1,-He,1+He,0,-1,2,Oe)||[],De&&(ue=Qr(De,1).concat(ue)),St&&(ue=ue.concat(Qr(St,-1)))),ue}(K,I)).length&&this.splitTile(K,0,0,0),j&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ei(G,I,j){return 32*((1<<G)*j+I)+G}function Ii(G,I){var j=G.tileID.canonical;if(!this._geoJSONIndex)return I(null,null);var K=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!K)return I(null,null);var ie=new yt(K.features),Oe=mt(ie);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),I(null,{vectorTile:ie,rawData:Oe.buffer})}zr.prototype.load=function(G){var I=this.options,j=I.log,K=I.minZoom,ie=I.maxZoom,Oe=I.nodeSize;j&&console.time("total time");var He="prepare "+G.length+" points";j&&console.time(He),this.points=G;for(var ue=[],De=0;De<G.length;De++)G[De].geometry&&ue.push(tr(G[De],De));this.trees[ie+1]=new $t(ue,kt,S,Oe,Float32Array),j&&console.timeEnd(He);for(var St=ie;St>=K;St--){var Ir=+Date.now();ue=this._cluster(ue,St),this.trees[St]=new $t(ue,kt,S,Oe,Float32Array),j&&console.log("z%d: %d clusters in %dms",St,ue.length,+Date.now()-Ir)}return j&&console.timeEnd("total time"),this},zr.prototype.getClusters=function(G,I){var j=((G[0]+180)%360+360)%360-180,K=Math.max(-90,Math.min(90,G[1])),ie=G[2]===180?180:((G[2]+180)%360+360)%360-180,Oe=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)j=-180,ie=180;else if(j>ie){var He=this.getClusters([j,K,180,Oe],I),ue=this.getClusters([-180,K,ie,Oe],I);return He.concat(ue)}for(var De=this.trees[this._limitZoom(I)],St=[],Ir=0,Br=De.range(Re(j),qe(Oe),Re(ie),qe(K));Ir<Br.length;Ir+=1){var jt=De.points[Br[Ir]];St.push(jt.numPoints?oe(jt):this.points[jt.index])}return St},zr.prototype.getChildren=function(G){var I=this._getOriginId(G),j=this._getOriginZoom(G),K="No cluster with the specified id.",ie=this.trees[j];if(!ie)throw new Error(K);var Oe=ie.points[I];if(!Oe)throw new Error(K);for(var He=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ue=[],De=0,St=ie.within(Oe.x,Oe.y,He);De<St.length;De+=1){var Ir=ie.points[St[De]];Ir.parentId===G&&ue.push(Ir.numPoints?oe(Ir):this.points[Ir.index])}if(ue.length===0)throw new Error(K);return ue},zr.prototype.getLeaves=function(G,I,j){var K=[];return this._appendLeaves(K,G,I=I||10,j=j||0,0),K},zr.prototype.getTile=function(G,I,j){var K=this.trees[this._limitZoom(G)],ie=Math.pow(2,G),Oe=this.options,He=Oe.radius/Oe.extent,ue=(j-He)/ie,De=(j+1+He)/ie,St={features:[]};return this._addTileFeatures(K.range((I-He)/ie,ue,(I+1+He)/ie,De),K.points,I,j,ie,St),I===0&&this._addTileFeatures(K.range(1-He/ie,ue,1,De),K.points,ie,j,ie,St),I===ie-1&&this._addTileFeatures(K.range(0,ue,He/ie,De),K.points,-1,j,ie,St),St.features.length?St:null},zr.prototype.getClusterExpansionZoom=function(G){for(var I=this._getOriginZoom(G)-1;I<=this.options.maxZoom;){var j=this.getChildren(G);if(I++,j.length!==1)break;G=j[0].properties.cluster_id}return I},zr.prototype._appendLeaves=function(G,I,j,K,ie){for(var Oe=0,He=this.getChildren(I);Oe<He.length;Oe+=1){var ue=He[Oe],De=ue.properties;if(De&&De.cluster?ie+De.point_count<=K?ie+=De.point_count:ie=this._appendLeaves(G,De.cluster_id,j,K,ie):ie<K?ie++:G.push(ue),G.length===j)break}return ie},zr.prototype._addTileFeatures=function(G,I,j,K,ie,Oe){for(var He=0,ue=G;He<ue.length;He+=1){var De=I[ue[He]],St=De.numPoints,Ir={type:1,geometry:[[Math.round(this.options.extent*(De.x*ie-j)),Math.round(this.options.extent*(De.y*ie-K))]],tags:St?ge(De):this.points[De.index].properties},Br=void 0;St?Br=De.id:this.options.generateId?Br=De.index:this.points[De.index].id&&(Br=this.points[De.index].id),Br!==void 0&&(Ir.id=Br),Oe.features.push(Ir)}},zr.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},zr.prototype._cluster=function(G,I){for(var j=[],K=this.options,ie=K.reduce,Oe=K.minPoints,He=K.radius/(K.extent*Math.pow(2,I)),ue=0;ue<G.length;ue++){var De=G[ue];if(!(De.zoom<=I)){De.zoom=I;for(var St=this.trees[I+1],Ir=St.within(De.x,De.y,He),Br=De.numPoints||1,jt=Br,dr=0,Wr=Ir;dr<Wr.length;dr+=1){var yn=St.points[Wr[dr]];yn.zoom>I&&(jt+=yn.numPoints||1)}if(jt>=Oe){for(var vr=De.x*Br,vn=De.y*Br,$r=ie&&Br>1?this._map(De,!0):null,cn=(ue<<5)+(I+1)+this.points.length,di=0,hn=Ir;di<hn.length;di+=1){var bi=St.points[hn[di]];if(!(bi.zoom<=I)){bi.zoom=I;var Qi=bi.numPoints||1;vr+=bi.x*Qi,vn+=bi.y*Qi,bi.parentId=cn,ie&&($r||($r=this._map(De,!0)),ie($r,this._map(bi)))}}De.parentId=cn,j.push(ln(vr/jt,vn/jt,cn,jt,$r))}else if(j.push(De),jt>1)for(var _i=0,Oi=Ir;_i<Oi.length;_i+=1){var Ci=St.points[Oi[_i]];Ci.zoom<=I||(Ci.zoom=I,j.push(Ci))}}}return j},zr.prototype._getOriginId=function(G){return G-this.points.length>>5},zr.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},zr.prototype._map=function(G,I){if(G.numPoints)return I?Ct({},G.properties):G.properties;var j=this.points[G.index].properties,K=this.options.map(j);return I&&K===j?Ct({},K):K},yi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yi.prototype.splitTile=function(G,I,j,K,ie,Oe,He){for(var ue=[G,I,j,K],De=this.options,St=De.debug;ue.length;){K=ue.pop(),j=ue.pop(),I=ue.pop(),G=ue.pop();var Ir=1<<I,Br=Ei(I,j,K),jt=this.tiles[Br];if(!jt&&(St>1&&console.time("creation"),jt=this.tiles[Br]=mr(G,I,j,K,De),this.tileCoords.push({z:I,x:j,y:K}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,j,K,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));var dr="z"+I;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if(jt.source=G,ie){if(I===De.maxZoom||I===ie)continue;var Wr=1<<ie-I;if(j!==Math.floor(Oe/Wr)||K!==Math.floor(He/Wr))continue}else if(I===De.indexMaxZoom||jt.numPoints<=De.indexMaxPoints)continue;if(jt.source=null,G.length!==0){St>1&&console.time("clipping");var yn,vr,vn,$r,cn,di,hn=.5*De.buffer/De.extent,bi=.5-hn,Qi=.5+hn,_i=1+hn;yn=vr=vn=$r=null,cn=yr(G,Ir,j-hn,j+Qi,0,jt.minX,jt.maxX,De),di=yr(G,Ir,j+bi,j+_i,0,jt.minX,jt.maxX,De),G=null,cn&&(yn=yr(cn,Ir,K-hn,K+Qi,1,jt.minY,jt.maxY,De),vr=yr(cn,Ir,K+bi,K+_i,1,jt.minY,jt.maxY,De),cn=null),di&&(vn=yr(di,Ir,K-hn,K+Qi,1,jt.minY,jt.maxY,De),$r=yr(di,Ir,K+bi,K+_i,1,jt.minY,jt.maxY,De),di=null),St>1&&console.timeEnd("clipping"),ue.push(yn||[],I+1,2*j,2*K),ue.push(vr||[],I+1,2*j,2*K+1),ue.push(vn||[],I+1,2*j+1,2*K),ue.push($r||[],I+1,2*j+1,2*K+1)}}},yi.prototype.getTile=function(G,I,j){var K=this.options,ie=K.extent,Oe=K.debug;if(G<0||G>24)return null;var He=1<<G,ue=Ei(G,I=(I%He+He)%He,j);if(this.tiles[ue])return Mt(this.tiles[ue],ie);Oe>1&&console.log("drilling down to z%d-%d-%d",G,I,j);for(var De,St=G,Ir=I,Br=j;!De&&St>0;)St--,Ir=Math.floor(Ir/2),Br=Math.floor(Br/2),De=this.tiles[Ei(St,Ir,Br)];return De&&De.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",St,Ir,Br),Oe>1&&console.time("drilling down"),this.splitTile(De.source,St,Ir,Br,G,I,j),Oe>1&&console.timeEnd("drilling down"),this.tiles[ue]?Mt(this.tiles[ue],ie):null):null};var Ji=function(G){function I(j,K,ie,Oe){G.call(this,j,K,ie,Ii),Oe&&(this.loadGeoJSON=Oe)}return G&&(I.__proto__=G),(I.prototype=Object.create(G&&G.prototype)).constructor=I,I.prototype.loadData=function(j,K){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=K,this._pendingLoadDataParams=j,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},I.prototype._loadData=function(){var j=this;if(this._pendingCallback&&this._pendingLoadDataParams){var K=this._pendingCallback,ie=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Oe=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new p.RequestPerformance(ie.request);this.loadGeoJSON(ie,function(He,ue){if(He||!ue)return K(He);if(typeof ue!="object")return K(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."));(function jt(dr,Wr){var yn,vr=dr&&dr.type;if(vr==="FeatureCollection")for(yn=0;yn<dr.features.length;yn++)jt(dr.features[yn],Wr);else if(vr==="GeometryCollection")for(yn=0;yn<dr.geometries.length;yn++)jt(dr.geometries[yn],Wr);else if(vr==="Feature")jt(dr.geometry,Wr);else if(vr==="Polygon")Zt(dr.coordinates,Wr);else if(vr==="MultiPolygon")for(yn=0;yn<dr.coordinates.length;yn++)Zt(dr.coordinates[yn],Wr);return dr})(ue,!0);try{if(ie.filter){var De=p.createExpression(ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(function(jt){return jt.key+": "+jt.message}).join(", "));var St=ue.features.filter(function(jt){return De.value.evaluate({zoom:0},jt)});ue={type:"FeatureCollection",features:St}}j._geoJSONIndex=ie.cluster?new zr(function(jt){var dr=jt.superclusterOptions,Wr=jt.clusterProperties;if(!Wr||!dr)return dr;for(var yn={},vr={},vn={accumulated:null,zoom:0},$r={properties:null},cn=Object.keys(Wr),di=0,hn=cn;di<hn.length;di+=1){var bi=hn[di],Qi=Wr[bi],_i=Qi[0],Oi=p.createExpression(Qi[1]),Ci=p.createExpression(typeof _i=="string"?[_i,["accumulated"],["get",bi]]:_i);yn[bi]=Oi.value,vr[bi]=Ci.value}return dr.map=function(yo){$r.properties=yo;for(var Zi={},Rn=0,Dn=cn;Rn<Dn.length;Rn+=1){var hi=Dn[Rn];Zi[hi]=yn[hi].evaluate(vn,$r)}return Zi},dr.reduce=function(yo,Zi){$r.properties=Zi;for(var Rn=0,Dn=cn;Rn<Dn.length;Rn+=1){var hi=Dn[Rn];vn.accumulated=yo[hi],yo[hi]=vr[hi].evaluate(vn,$r)}},dr}(ie)).load(ue.features):function(jt,dr){return new yi(jt,dr)}(ue,ie.geojsonVtOptions)}catch(jt){return K(jt)}j.loaded={};var Ir={};if(Oe){var Br=Oe.finish();Br&&(Ir.resourceTiming={},Ir.resourceTiming[ie.source]=JSON.parse(JSON.stringify(Br)))}K(null,Ir)})}},I.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},I.prototype.reloadTile=function(j,K){var ie=this.loaded;return ie&&ie[j.uid]?G.prototype.reloadTile.call(this,j,K):this.loadTile(j,K)},I.prototype.loadGeoJSON=function(j,K){if(j.request)p.getJSON(j.request,K);else{if(typeof j.data!="string")return K(new Error("Input data given to '"+j.source+"' is not a valid GeoJSON object."));try{return K(null,JSON.parse(j.data))}catch(ie){return K(new Error("Input data given to '"+j.source+"' is not a valid GeoJSON object."))}}},I.prototype.removeSource=function(j,K){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),K()},I.prototype.getClusterExpansionZoom=function(j,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(j.clusterId))}catch(ie){K(ie)}},I.prototype.getClusterChildren=function(j,K){try{K(null,this._geoJSONIndex.getChildren(j.clusterId))}catch(ie){K(ie)}},I.prototype.getClusterLeaves=function(j,K){try{K(null,this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset))}catch(ie){K(ie)}},I}(we),li=function(G){var I=this;this.self=G,this.actor=new p.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:Ji},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(j,K){if(I.workerSourceTypes[j])throw new Error('Worker source with name "'+j+'" already registered.');I.workerSourceTypes[j]=K},this.self.registerRTLTextPlugin=function(j){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=j.applyArabicShaping,p.plugin.processBidirectionalText=j.processBidirectionalText,p.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}};return li.prototype.setReferrer=function(G,I){this.referrer=I},li.prototype.setImages=function(G,I,j){for(var K in this.availableImages[G]=I,this.workerSources[G]){var ie=this.workerSources[G][K];for(var Oe in ie)ie[Oe].availableImages=I}j()},li.prototype.setLayers=function(G,I,j){this.getLayerIndex(G).replace(I),j()},li.prototype.updateLayers=function(G,I,j){this.getLayerIndex(G).update(I.layers,I.removedIds),j()},li.prototype.loadTile=function(G,I,j){this.getWorkerSource(G,I.type,I.source).loadTile(I,j)},li.prototype.loadDEMTile=function(G,I,j){this.getDEMWorkerSource(G,I.source).loadTile(I,j)},li.prototype.reloadTile=function(G,I,j){this.getWorkerSource(G,I.type,I.source).reloadTile(I,j)},li.prototype.abortTile=function(G,I,j){this.getWorkerSource(G,I.type,I.source).abortTile(I,j)},li.prototype.removeTile=function(G,I,j){this.getWorkerSource(G,I.type,I.source).removeTile(I,j)},li.prototype.removeDEMTile=function(G,I){this.getDEMWorkerSource(G,I.source).removeTile(I)},li.prototype.removeSource=function(G,I,j){if(this.workerSources[G]&&this.workerSources[G][I.type]&&this.workerSources[G][I.type][I.source]){var K=this.workerSources[G][I.type][I.source];delete this.workerSources[G][I.type][I.source],K.removeSource!==void 0?K.removeSource(I,j):j()}},li.prototype.loadWorkerSource=function(G,I,j){try{this.self.importScripts(I.url),j()}catch(K){j(K.toString())}},li.prototype.syncRTLPluginState=function(G,I,j){try{p.plugin.setState(I);var K=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&K!=null){this.self.importScripts(K);var ie=p.plugin.isParsed();j(ie?void 0:new Error("RTL Text Plugin failed to import scripts from "+K),ie)}}catch(Oe){j(Oe.toString())}},li.prototype.getAvailableImages=function(G){var I=this.availableImages[G];return I||(I=[]),I},li.prototype.getLayerIndex=function(G){var I=this.layerIndexes[G];return I||(I=this.layerIndexes[G]=new q),I},li.prototype.getWorkerSource=function(G,I,j){var K=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][I]||(this.workerSources[G][I]={}),this.workerSources[G][I][j]||(this.workerSources[G][I][j]=new this.workerSourceTypes[I]({send:function(ie,Oe,He){K.actor.send(ie,Oe,He,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][I][j]},li.prototype.getDEMWorkerSource=function(G,I){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][I]||(this.demWorkerSources[G][I]=new Kt),this.demWorkerSources[G][I]},li.prototype.enforceCacheSizeLimit=function(G,I){p.enforceCacheSizeLimit(I)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new li(self)),li}),E(["./shared"],function(p){"use strict";var w=p.createCommonjsModule(function(n){function u(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var A,L,V=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(V);try{L=new Worker(ee),A=!0}catch(de){A=!1}return L&&L.terminate(),URL.revokeObjectURL(ee),A}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var A=document.createElement("canvas");A.width=A.height=1;var L=A.getContext("2d");if(!L)return!1;var V=L.getImageData(0,0,1,1);return V&&V.width===A.width}()?(h[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(A){var L=function(ee){var de=document.createElement("canvas"),_e=Object.create(u.webGLContextAttributes);return _e.failIfMajorPerformanceCaveat=ee,de.probablySupportsContext?de.probablySupportsContext("webgl",_e)||de.probablySupportsContext("experimental-webgl",_e):de.supportsContext?de.supportsContext("webgl",_e)||de.supportsContext("experimental-webgl",_e):de.getContext("webgl",_e)||de.getContext("experimental-webgl",_e)}(A);if(!L)return!1;var V=L.createShader(L.VERTEX_SHADER);return!(!V||L.isContextLost())&&(L.shaderSource(V,"void main() {}"),L.compileShader(V),L.getShaderParameter(V,L.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}n.exports?n.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),z={create:function(n,u,a){var h=p.window.document.createElement(n);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(n,u){return p.window.document.createElementNS(n,u)}},q=p.window.document&&p.window.document.documentElement.style;function Y(n){if(!q)return n[0];for(var u=0;u<n.length;u++)if(n[u]in q)return n[u];return n[0]}var ce,ne=Y(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);z.disableDrag=function(){q&&ne&&(ce=q[ne],q[ne]="none")},z.enableDrag=function(){q&&ne&&(q[ne]=ce)};var be=Y(["transform","WebkitTransform"]);z.setTransform=function(n,u){n.style[be]=u};var we=!1;try{var Me=Object.defineProperty({},"passive",{get:function(){we=!0}});p.window.addEventListener("test",Me,Me),p.window.removeEventListener("test",Me,Me)}catch(n){we=!1}z.addEventListener=function(n,u,a,h){h===void 0&&(h={}),n.addEventListener(u,a,"passive"in h&&we?h:h.capture)},z.removeEventListener=function(n,u,a,h){h===void 0&&(h={}),n.removeEventListener(u,a,"passive"in h&&we?h:h.capture)};var Kt=function(n){n.preventDefault(),n.stopPropagation(),p.window.removeEventListener("click",Kt,!0)};function Zt(n){var u=n.userImage;return!!(u&&u.render&&u.render())&&(n.data.replace(new Uint8Array(u.data.buffer)),!0)}z.suppressClick=function(){p.window.addEventListener("click",Kt,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",Kt,!0)},0)},z.mousePos=function(n,u){var a=n.getBoundingClientRect();return new p.Point(u.clientX-a.left-n.clientLeft,u.clientY-a.top-n.clientTop)},z.touchPos=function(n,u){for(var a=n.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new p.Point(u[g].clientX-a.left-n.clientLeft,u[g].clientY-a.top-n.clientTop));return h},z.mouseButton=function(n){return p.window.InstallTrigger!==void 0&&n.button===2&&n.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:n.button},z.remove=function(n){n.parentNode&&n.parentNode.removeChild(n)};var Xt=function(n){function u(){n.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var b=g[h];this._notify(b.ids,b.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,b=0,A=a;b<A.length;b+=1){var L=A[b];if(L[0]<g||L[1]<L[0]||h<L[1])return!1;g=L[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var b=0,A=a;b<A.length;b+=1)this.images[A[b]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var g={},b=0,A=a;b<A.length;b+=1){var L=A[b];this.images[L]||this.fire(new p.Event("styleimagemissing",{id:L}));var V=this.images[L];V?g[L]={data:V.data.clone(),pixelRatio:V.pixelRatio,sdf:V.sdf,version:V.version,stretchX:V.stretchX,stretchY:V.stretchY,content:V.content,hasRenderCallback:Boolean(V.userImage&&V.userImage.render)}:p.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},A=new p.ImagePosition(b,g);this.patterns[a]={bin:b,position:A}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=p.potpack(a),b=g.w,A=g.h,L=this.atlasImage;for(var V in L.resize({width:b||1,height:A||1}),this.patterns){var ee=this.patterns[V].bin,de=ee.x+1,_e=ee.y+1,xe=this.images[V].data,Xe=xe.width,Ge=xe.height;p.RGBAImage.copy(xe,L,{x:0,y:0},{x:de,y:_e},{width:Xe,height:Ge}),p.RGBAImage.copy(xe,L,{x:0,y:Ge-1},{x:de,y:_e-1},{width:Xe,height:1}),p.RGBAImage.copy(xe,L,{x:0,y:0},{x:de,y:_e+Ge},{width:Xe,height:1}),p.RGBAImage.copy(xe,L,{x:Xe-1,y:0},{x:de-1,y:_e},{width:1,height:Ge}),p.RGBAImage.copy(xe,L,{x:0,y:0},{x:de+Xe,y:_e},{width:1,height:Ge})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var b=g[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var A=this.images[b];Zt(A)&&this.updateImage(b,A)}}},u}(p.Evented),zt=pt,Lt=pt,yt=1e20;function pt(n,u,a,h,g,b){this.fontSize=n||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=b||"normal",this.radius=a||8;var A=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=A,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.d=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Int16Array(A),this.middle=Math.round(A/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pr(n,u,a,h,g,b,A){for(var L=0;L<u;L++){for(var V=0;V<a;V++)h[V]=n[V*u+L];for(Ht(h,g,b,A,a),V=0;V<a;V++)n[V*u+L]=g[V]}for(V=0;V<a;V++){for(L=0;L<u;L++)h[L]=n[V*u+L];for(Ht(h,g,b,A,u),L=0;L<u;L++)n[V*u+L]=Math.sqrt(g[L])}}function Ht(n,u,a,h,g){a[0]=0,h[0]=-yt,h[1]=+yt;for(var b=1,A=0;b<g;b++){for(var L=(n[b]+b*b-(n[a[A]]+a[A]*a[A]))/(2*b-2*a[A]);L<=h[A];)A--,L=(n[b]+b*b-(n[a[A]]+a[A]*a[A]))/(2*b-2*a[A]);a[++A]=b,h[A]=L,h[A+1]=+yt}for(b=0,A=0;b<g;b++){for(;h[A+1]<b;)A++;u[b]=(b-a[A])*(b-a[A])+n[a[A]]}}pt.prototype.draw=function(n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(n,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?yt:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?yt:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(Pr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Pr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},zt.default=Lt;var ar=function(n,u){this.requestManager=n,this.localIdeographFontFamily=u,this.entries={}};ar.prototype.setURL=function(n){this.url=n},ar.prototype.getGlyphs=function(n,u){var a=this,h=[];for(var g in n)for(var b=0,A=n[g];b<A.length;b+=1)h.push({stack:g,id:A[b]});p.asyncAll(h,function(L,V){var ee=L.stack,de=L.id,_e=a.entries[ee];_e||(_e=a.entries[ee]={glyphs:{},requests:{},ranges:{}});var xe=_e.glyphs[de];if(xe===void 0){if(xe=a._tinySDF(_e,ee,de))return _e.glyphs[de]=xe,void V(null,{stack:ee,id:de,glyph:xe});var Xe=Math.floor(de/256);if(256*Xe>65535)V(new Error("glyphs > 65535 not supported"));else if(_e.ranges[Xe])V(null,{stack:ee,id:de,glyph:xe});else{var Ge=_e.requests[Xe];Ge||(Ge=_e.requests[Xe]=[],ar.loadGlyphRange(ee,Xe,a.url,a.requestManager,function(nt,ke){if(ke){for(var rt in ke)a._doesCharSupportLocalGlyph(+rt)||(_e.glyphs[+rt]=ke[+rt]);_e.ranges[Xe]=!0}for(var ht=0,Bt=Ge;ht<Bt.length;ht+=1)(0,Bt[ht])(nt,ke);delete _e.requests[Xe]})),Ge.push(function(nt,ke){nt?V(nt):ke&&V(null,{stack:ee,id:de,glyph:ke[de]||null})})}}else V(null,{stack:ee,id:de,glyph:xe})},function(L,V){if(L)u(L);else if(V){for(var ee={},de=0,_e=V;de<_e.length;de+=1){var xe=_e[de],Xe=xe.stack,Ge=xe.id,nt=xe.glyph;(ee[Xe]||(ee[Xe]={}))[Ge]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}u(null,ee)}})},ar.prototype._doesCharSupportLocalGlyph=function(n){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](n)||p.isChar["Hangul Syllables"](n)||p.isChar.Hiragana(n)||p.isChar.Katakana(n))},ar.prototype._tinySDF=function(n,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=n.tinySDF;if(!g){var b="400";/bold/i.test(u)?b="900":/medium/i.test(u)?b="500":/light/i.test(u)&&(b="200"),g=n.tinySDF=new ar.TinySDF(24,3,8,.25,h,b)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},ar.loadGlyphRange=function(n,u,a,h,g){var b=256*u,A=b+255,L=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",n).replace("{range}",b+"-"+A),p.ResourceType.Glyphs);p.getArrayBuffer(L,function(V,ee){if(V)g(V);else if(ee){for(var de={},_e=0,xe=p.parseGlyphPBF(ee);_e<xe.length;_e+=1){var Xe=xe[_e];de[Xe.id]=Xe}g(null,de)}})},ar.TinySDF=zt;var mt=function(){this.specification=p.styleSpec.light.position};mt.prototype.possiblyEvaluate=function(n,u){return p.sphericalToCartesian(n.expression.evaluate(u))},mt.prototype.interpolate=function(n,u,a){return{x:p.number(n.x,u.x,a),y:p.number(n.y,u.y,a),z:p.number(n.z,u.z,a)}};var Ye=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new mt,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),bt=function(n){function u(a){n.call(this),this._transitionable=new p.Transitionable(Ye),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var g in a){var b=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),b):this._transitionable.setValue(g,b)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Fe=function(n,u){this.width=n,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Fe.prototype.getDash=function(n,u){var a=n.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(n,u)),this.dashEntry[a]},Fe.prototype.getDashRanges=function(n,u,a){var h=[],g=n.length%2==1?-n[n.length-1]*a:0,b=n[0]*a,A=!0;h.push({left:g,right:b,isDash:A,zeroLength:n[0]===0});for(var L=n[0],V=1;V<n.length;V++){var ee=n[V];h.push({left:g=L*a,right:b=(L+=ee)*a,isDash:A=!A,zeroLength:ee===0})}return h},Fe.prototype.addRoundDash=function(n,u,a){for(var h=u/2,g=-a;g<=a;g++)for(var b=this.width*(this.nextRow+a+g),A=0,L=n[A],V=0;V<this.width;V++){V/L.right>1&&(L=n[++A]);var ee=Math.abs(V-L.left),de=Math.abs(V-L.right),_e=Math.min(ee,de),xe=void 0,Xe=g/a*(h+1);if(L.isDash){var Ge=h-Math.abs(Xe);xe=Math.sqrt(_e*_e+Ge*Ge)}else xe=h-Math.sqrt(_e*_e+Xe*Xe);this.data[b+V]=Math.max(0,Math.min(255,xe+128))}},Fe.prototype.addRegularDash=function(n){for(var u=n.length-1;u>=0;--u){var a=n[u],h=n[u+1];a.zeroLength?n.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,n.splice(u,1))}var g=n[0],b=n[n.length-1];g.isDash===b.isDash&&(g.left=b.left-this.width,b.right=g.right+this.width);for(var A=this.width*this.nextRow,L=0,V=n[L],ee=0;ee<this.width;ee++){ee/V.right>1&&(V=n[++L]);var de=Math.abs(ee-V.left),_e=Math.abs(ee-V.right),xe=Math.min(de,_e);this.data[A+ee]=Math.max(0,Math.min(255,(V.isDash?xe:-xe)+128))}},Fe.prototype.addDash=function(n,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,b=0;b<n.length;b++)g+=n[b];if(g!==0){var A=this.width/g,L=this.getDashRanges(n,this.width,A);u?this.addRoundDash(L,A,a):this.addRegularDash(L)}var V={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,V},Fe.prototype.bind=function(n){var u=n.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Ae=function n(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var b=new n.Actor(h[g],a,this.id);b.name="Worker "+g,this.actors.push(b)}};function Ne(n,u,a){var h=function(g,b){if(g)return a(g);if(b){var A=p.pick(p.extend(b,n),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(A.vectorLayers=b.vector_layers,A.vectorLayerIds=A.vectorLayers.map(function(L){return L.id})),A.tiles=u.canonicalizeTileset(A,n.url),a(null,A)}};return n.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(n.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,n)})}Ae.prototype.broadcast=function(n,u,a){p.asyncAll(this.actors,function(h,g){h.send(n,u,g)},a=a||function(){})},Ae.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ae.prototype.remove=function(){this.actors.forEach(function(n){n.remove()}),this.actors=[],this.workerPool.release(this.id)},Ae.Actor=p.Actor;var xt=function(n,u,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=u||0,this.maxzoom=a||24};xt.prototype.validateBounds=function(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]},xt.prototype.contains=function(n){var u=Math.pow(2,n.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return n.x>=a&&n.x<g&&n.y>=h&&n.y<b};var nr=function(n){function u(a,h,g,b){if(n.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ne(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new xt(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function A(L,V){return delete a.request,a.aborted?h(null):L&&L.status!==404?h(L):(V&&V.resourceTiming&&(a.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&a.setExpiryData(V),a.loadVectorData(V,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",b,A.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",b,A.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),re=function(n){function u(a,h,g,b){n.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ne(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new xt(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var g=this,b=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(b,p.ResourceType.Tile),function(A,L){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(A)a.state="errored",h(A);else if(L){g.map._refreshExpiredTiles&&a.setExpiryData(L),delete L.cacheControl,delete L.expires;var V=g.map.painter.context,ee=V.gl;a.texture=g.map.painter.getTileTexture(L.width),a.texture?a.texture.update(L,{useMipmap:!0}):(a.texture=new p.Texture(V,L,ee.RGBA,{useMipmap:!0}),a.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Ee=function(n){function u(a,h,g,b){n.call(this,a,h,g,b),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(A,L){A&&(a.state="errored",h(A)),L&&(a.dem=L,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(A,L){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(A)a.state="errored",h(A);else if(L){this.map._refreshExpiredTiles&&a.setExpiryData(L),delete L.cacheControl,delete L.expires;var V=p.window.ImageBitmap&&L instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?L:p.browser.getImageData(L,1),ee={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:V,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",ee,b.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),b=(h.x-1+g)%g,A=h.x===0?a.wrap-1:a.wrap,L=(h.x+1+g)%g,V=h.x+1===g?a.wrap+1:a.wrap,ee={};return ee[new p.OverscaledTileID(a.overscaledZ,A,h.z,b,h.y).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,V,h.z,L,h.y).key]={backfilled:!1},h.y>0&&(ee[new p.OverscaledTileID(a.overscaledZ,A,h.z,b,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,V,h.z,L,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ee[new p.OverscaledTileID(a.overscaledZ,A,h.z,b,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,V,h.z,L,h.y+1).key]={backfilled:!1}),ee},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(re),ae=function(n){function u(a,h,g,b){n.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var A=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*A,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*A,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*A,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",g))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",b))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},b),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),b=this._data;typeof b=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(b),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(b),this.actor.send(this.type+".loadData",g,function(A,L){h._removed||L&&L.abandoned||(h._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[h.id]&&(h._resourceTiming=L.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(A))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var g=this,b=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(b,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(A,L){return delete a.request,a.unloadVectorData(),a.aborted?h(null):A?h(A):(a.loadVectorData(L,g.map.painter,b==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),me=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Te=function(n){function u(a,h,g,b){n.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(b,A){g._loaded=!0,b?g.fire(new p.ErrorEvent(b)):A&&(g.image=A,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(A){for(var L=1/0,V=1/0,ee=-1/0,de=-1/0,_e=0,xe=A;_e<xe.length;_e+=1){var Xe=xe[_e];L=Math.min(L,Xe.x),V=Math.min(V,Xe.y),ee=Math.max(ee,Xe.x),de=Math.max(de,Xe.y)}var Ge=Math.max(ee-L,de-V),nt=Math.max(0,Math.floor(-Math.log(Ge)/Math.LN2)),ke=Math.pow(2,nt);return new p.CanonicalTileID(nt,Math.floor((L+ee)/2*ke),Math.floor((V+de)/2*ke))}(g),this.minzoom=this.maxzoom=this.tileID.z;var b=g.map(function(A){return h.tileID.getTilePoint(A)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Je=function(n){function u(a,h,g,b){n.call(this,a,h,g,b),this.roundZoom=!0,this.type="video",this.options=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,b=h.urls;g<b.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(b[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(A,L){a._loaded=!0,A?a.fire(new p.ErrorEvent(A)):L&&(a.video=L,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Te),dt=function(n){function u(a,h,g,b){n.call(this,a,h,g,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(A){return!Array.isArray(A)||A.length!==2||A.some(function(L){return typeof L!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var A=this.tiles[b];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},u}(Te),$t={vector:nr,raster:re,"raster-dem":Ee,geojson:ae,video:Je,image:Te,canvas:dt};function Fr(n,u){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*n.width,.5*n.height,1]),p.multiply(a,a,n.calculatePosMatrix(u.toUnwrapped()))}function zr(n,u,a,h,g,b){var A=function(nt,ke,rt){if(nt)for(var ht=0,Bt=nt;ht<Bt.length;ht+=1){var or=ke[Bt[ht]];if(or&&or.source===rt&&or.type==="fill-extrusion")return!0}else for(var rr in ke){var lr=ke[rr];if(lr.source===rt&&lr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,n.id),L=b.maxPitchScaleFactor(),V=n.tilesIn(h,L,A);V.sort(ln);for(var ee=[],de=0,_e=V;de<_e.length;de+=1){var xe=_e[de];ee.push({wrappedTileID:xe.tileID.wrapped().key,queryResults:xe.tile.queryRenderedFeatures(u,a,n._state,xe.queryGeometry,xe.cameraQueryGeometry,xe.scale,g,b,L,Fr(n.transform,xe.tileID))})}var Xe=function(nt){for(var ke={},rt={},ht=0,Bt=nt;ht<Bt.length;ht+=1){var or=Bt[ht],rr=or.queryResults,lr=or.wrappedTileID,Lr=rt[lr]=rt[lr]||{};for(var rn in rr)for(var Yr=rr[rn],_n=Lr[rn]=Lr[rn]||{},Bn=ke[rn]=ke[rn]||[],Xn=0,Hn=Yr;Xn<Hn.length;Xn+=1){var ta=Hn[Xn];_n[ta.featureIndex]||(_n[ta.featureIndex]=!0,Bn.push(ta))}}return ke}(ee);for(var Ge in Xe)Xe[Ge].forEach(function(nt){var ke=nt.feature,rt=n.getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=rt});return Xe}function ln(n,u){var a=n.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var tr=function(n,u){this.max=n,this.onRemove=u,this.reset()};tr.prototype.reset=function(){for(var n in this.data)for(var u=0,a=this.data[n];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},tr.prototype.add=function(n,u,a){var h=this,g=n.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var b={value:u,timeout:void 0};if(a!==void 0&&(b.timeout=setTimeout(function(){h.remove(n,b)},a)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){var A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this},tr.prototype.has=function(n){return n.wrapped().key in this.data},tr.prototype.getAndRemove=function(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null},tr.prototype._getAndRemoveByKey=function(n){var u=this.data[n].shift();return u.timeout&&clearTimeout(u.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),u.value},tr.prototype.getByKey=function(n){var u=this.data[n];return u?u[0].value:null},tr.prototype.get=function(n){return this.has(n)?this.data[n.wrapped().key][0].value:null},tr.prototype.remove=function(n,u){if(!this.has(n))return this;var a=n.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},tr.prototype.setMaxSize=function(n){for(this.max=n;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},tr.prototype.filter=function(n){var u=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var b=g[h];n(b.value)||u.push(b)}for(var A=0,L=u;A<L.length;A+=1){var V=L[A];this.remove(V.value.tileID,V)}};var oe=function(n,u,a){this.context=n;var h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};oe.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},oe.prototype.updateData=function(n){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)},oe.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Re=function(n,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=n;var g=n.gl;this.buffer=g.createBuffer(),n.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Re.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Re.prototype.updateData=function(n){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,n.arrayBuffer)},Re.prototype.enableAttributes=function(n,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&n.enableVertexAttribArray(h)}},Re.prototype.setVertexAttribPointers=function(n,u,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],b=u.attributes[g.name];b!==void 0&&n.vertexAttribPointer(b,g.components,n[ge[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},Re.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var qe=function(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};qe.prototype.get=function(){return this.current},qe.prototype.set=function(n){},qe.prototype.getDefault=function(){return this.default},qe.prototype.setDefault=function(){this.set(this.default)};var Ct=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(qe),kt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(qe),S=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(qe),F=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(qe),he=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(qe),Be=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(qe),$e=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(qe),vt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(qe),wt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(qe),H=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(qe),Wt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(qe),Vt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(qe),yr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(qe),Er=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(qe),Ar=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(qe),Mr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(qe),Ke=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(qe),gt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(qe),ct=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(qe),sr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(qe),Qr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(qe),st=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(qe),Mt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(qe),Jt=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(qe),mr=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(qe),gn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(qe),Cn=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(qe),yi=function(n){function u(a){n.call(this,a),this.vao=a.extVertexArrayObject}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(qe),Ei=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(qe),Ii=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(qe),Ji=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(qe),li=function(n){function u(a,h){n.call(this,a),this.context=a,this.parent=h}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(qe),G=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(li),I=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(li),j=function(n,u,a,h){this.context=n,this.width=u,this.height=a;var g=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new G(n,g),h&&(this.depthAttachment=new I(n,g))};j.prototype.destroy=function(){var n=this.context.gl,u=this.colorAttachment.get();if(u&&n.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}n.deleteFramebuffer(this.framebuffer)};var K=function(n,u,a){this.func=n,this.mask=u,this.range=a};K.ReadOnly=!1,K.ReadWrite=!0,K.disabled=new K(519,K.ReadOnly,[0,1]);var ie=function(n,u,a,h,g,b){this.test=n,this.ref=u,this.mask=a,this.fail=h,this.depthFail=g,this.pass=b};ie.disabled=new ie({func:519,mask:0},0,0,7680,7680,7680);var Oe=function(n,u,a){this.blendFunction=n,this.blendColor=u,this.mask=a};Oe.disabled=new Oe(Oe.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),Oe.unblended=new Oe(Oe.Replace,p.Color.transparent,[!0,!0,!0,!0]),Oe.alphaBlended=new Oe([1,771],p.Color.transparent,[!0,!0,!0,!0]);var He=function(n,u,a){this.enable=n,this.mode=u,this.frontFace=a};He.disabled=new He(!1,1029,2305),He.backCCW=new He(!0,1029,2305);var ue=function(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ct(this),this.clearDepth=new kt(this),this.clearStencil=new S(this),this.colorMask=new F(this),this.depthMask=new he(this),this.stencilMask=new Be(this),this.stencilFunc=new $e(this),this.stencilOp=new vt(this),this.stencilTest=new wt(this),this.depthRange=new H(this),this.depthTest=new Wt(this),this.depthFunc=new Vt(this),this.blend=new yr(this),this.blendFunc=new Er(this),this.blendColor=new Ar(this),this.blendEquation=new Mr(this),this.cullFace=new Ke(this),this.cullFaceSide=new gt(this),this.frontFace=new ct(this),this.program=new sr(this),this.activeTexture=new Qr(this),this.viewport=new st(this),this.bindFramebuffer=new Mt(this),this.bindRenderbuffer=new Jt(this),this.bindTexture=new mr(this),this.bindVertexBuffer=new gn(this),this.bindElementBuffer=new Cn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yi(this),this.pixelStoreUnpack=new Ei(this),this.pixelStoreUnpackPremultiplyAlpha=new Ii(this),this.pixelStoreUnpackFlipY=new Ji(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)};ue.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ue.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ue.prototype.createIndexBuffer=function(n,u){return new oe(this,n,u)},ue.prototype.createVertexBuffer=function(n,u,a){return new Re(this,n,u,a)},ue.prototype.createRenderbuffer=function(n,u,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,n,u,a),this.bindRenderbuffer.set(null),g},ue.prototype.createFramebuffer=function(n,u,a){return new j(this,n,u,a)},ue.prototype.clear=function(n){var u=n.color,a=n.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},ue.prototype.setCullFace=function(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))},ue.prototype.setDepthMode=function(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)},ue.prototype.setStencilMode=function(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)},ue.prototype.setColorMode=function(n){p.deepEqual(n.blendFunction,Oe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)},ue.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var De=function(n){function u(a,h,g){var b=this;n.call(this),this.id=a,this.dispatcher=g,this.on("data",function(A){A.dataType==="source"&&A.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(A,L,V,ee){var de=new $t[L.type](A,L,V,ee);if(de.id!==A)throw new Error("Expected Source id to be "+A+" instead of "+de.id);return p.bindAll(["load","abort","unload","serialize","prepare"],de),de}(a,h,g,this),this._tiles={},this._cache=new tr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(St).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,g=[];for(var b in this._tiles)this._isIdRenderable(b,a)&&g.push(this._tiles[b]);return a?g.sort(function(A,L){var V=A.tileID,ee=L.tileID,de=new p.Point(V.canonical.x,V.canonical.y)._rotate(h.transform.angle),_e=new p.Point(ee.canonical.x,ee.canonical.y)._rotate(h.transform.angle);return V.overscaledZ-ee.overscaledZ||_e.y-de.y||_e.x-de.x}).map(function(A){return A.tileID.key}):g.map(function(A){return A.tileID}).sort(St).map(function(A){return A.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},u.prototype._tileLoaded=function(a,h,g,b){if(b)return a.state="errored",void(b.status!==404?this._source.fire(new p.ErrorEvent(b,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var b=h[g];if(a.neighboringTiles&&a.neighboringTiles[b]){var A=this.getTileByID(b);L(a,A),L(A,a)}}function L(V,ee){V.needsHillshadePrepare=!0;var de=ee.tileID.canonical.x-V.tileID.canonical.x,_e=ee.tileID.canonical.y-V.tileID.canonical.y,xe=Math.pow(2,V.tileID.canonical.z),Xe=ee.tileID.key;de===0&&_e===0||Math.abs(_e)>1||(Math.abs(de)>1&&(Math.abs(de+xe)===1?de+=xe:Math.abs(de-xe)===1&&(de-=xe)),ee.dem&&V.dem&&(V.dem.backfillBorder(ee.dem,de,_e),V.neighboringTiles&&V.neighboringTiles[Xe]&&(V.neighboringTiles[Xe].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,g,b){for(var A in this._tiles){var L=this._tiles[A];if(!(b[A]||!L.hasData()||L.tileID.overscaledZ<=h||L.tileID.overscaledZ>g)){for(var V=L.tileID;L&&L.tileID.overscaledZ>h+1;){var ee=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[ee.key])&&L.hasData()&&(V=ee)}for(var de=V;de.overscaledZ>h;)if(a[(de=de.scaledTo(de.overscaledZ-1)).key]){b[V.key]=V;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var b=a.overscaledZ-1;b>=h;b--){var A=a.scaledTo(b),L=this._getLoadedTile(A);if(L)return L}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,b=Math.floor(h*g*5),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(A)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var b in this._tiles){var A=this._tiles[b];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),g[A.tileID.key]=A}for(var L in this._tiles=g,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Lr){return new p.OverscaledTileID(Lr.canonical.z,Lr.wrap,Lr.canonical.z,Lr.canonical.x,Lr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Lr){return h._source.hasTile(Lr)}))):g=[];var b=a.coveringZoomLevel(this._source),A=Math.max(b-u.maxOverzooming,this._source.minzoom),L=Math.max(b+u.maxUnderzooming,this._source.minzoom),V=this._updateRetainedTiles(g,b);if(Ir(this._source.type)){for(var ee={},de={},_e=0,xe=Object.keys(V);_e<xe.length;_e+=1){var Xe=xe[_e],Ge=V[Xe],nt=this._tiles[Xe];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=p.browser.now())){var ke=this.findLoadedParent(Ge,A);ke&&(this._addTile(ke.tileID),ee[ke.tileID.key]=ke.tileID),de[Xe]=Ge}}for(var rt in this._retainLoadedChildren(de,b,L,V),ee)V[rt]||(this._coveredTiles[rt]=!0,V[rt]=ee[rt])}for(var ht in V)this._tiles[ht].clearFadeHold();for(var Bt=0,or=p.keysDifference(this._tiles,V);Bt<or.length;Bt+=1){var rr=or[Bt],lr=this._tiles[rr];lr.hasSymbolBuckets&&!lr.holdingForFade()?lr.setHoldDuration(this.map._fadeDuration):lr.hasSymbolBuckets&&!lr.symbolFadeFinished()||this._removeTile(rr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var g={},b={},A=Math.max(h-u.maxOverzooming,this._source.minzoom),L=Math.max(h+u.maxUnderzooming,this._source.minzoom),V={},ee=0,de=a;ee<de.length;ee+=1){var _e=de[ee],xe=this._addTile(_e);g[_e.key]=_e,xe.hasData()||h<this._source.maxzoom&&(V[_e.key]=_e)}this._retainLoadedChildren(V,h,L,g);for(var Xe=0,Ge=a;Xe<Ge.length;Xe+=1){var nt=Ge[Xe],ke=this._tiles[nt.key];if(!ke.hasData()){if(h+1>this._source.maxzoom){var rt=nt.children(this._source.maxzoom)[0],ht=this.getTile(rt);if(ht&&ht.hasData()){g[rt.key]=rt;continue}}else{var Bt=nt.children(this._source.maxzoom);if(g[Bt[0].key]&&g[Bt[1].key]&&g[Bt[2].key]&&g[Bt[3].key])continue}for(var or=ke.wasRequested(),rr=nt.overscaledZ-1;rr>=A;--rr){var lr=nt.scaledTo(rr);if(b[lr.key]||(b[lr.key]=!0,!(ke=this.getTile(lr))&&or&&(ke=this._addTile(lr)),ke&&(g[lr.key]=lr,or=ke.wasRequested(),ke.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,b=this._tiles[a].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}h.push(b.key);var A=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(A))break;b=A}for(var L=0,V=h;L<V.length;L+=1)this._loadedParentTiles[V[L]]=g}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var b=h.getExpiryTimeout();b&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},b))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,g){var b=this,A=[],L=this.transform;if(!L)return A;for(var V=g?L.getCameraQueryGeometry(a):a,ee=a.map(function(rr){return L.pointCoordinate(rr)}),de=V.map(function(rr){return L.pointCoordinate(rr)}),_e=this.getIds(),xe=1/0,Xe=1/0,Ge=-1/0,nt=-1/0,ke=0,rt=de;ke<rt.length;ke+=1){var ht=rt[ke];xe=Math.min(xe,ht.x),Xe=Math.min(Xe,ht.y),Ge=Math.max(Ge,ht.x),nt=Math.max(nt,ht.y)}for(var Bt=function(rr){var lr=b._tiles[_e[rr]];if(!lr.holdingForFade()){var Lr=lr.tileID,rn=Math.pow(2,L.zoom-lr.tileID.overscaledZ),Yr=h*lr.queryPadding*p.EXTENT/lr.tileSize/rn,_n=[Lr.getTilePoint(new p.MercatorCoordinate(xe,Xe)),Lr.getTilePoint(new p.MercatorCoordinate(Ge,nt))];if(_n[0].x-Yr<p.EXTENT&&_n[0].y-Yr<p.EXTENT&&_n[1].x+Yr>=0&&_n[1].y+Yr>=0){var Bn=ee.map(function(Hn){return Lr.getTilePoint(Hn)}),Xn=de.map(function(Hn){return Lr.getTilePoint(Hn)});A.push({tile:lr,tileID:Lr,queryGeometry:Bn,cameraQueryGeometry:Xn,scale:rn})}}},or=0;or<_e.length;or++)Bt(or);return A},u.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(V){return h._tiles[V].tileID}),b=0,A=g;b<A.length;b+=1){var L=A[b];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ir(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,g){var b=this._tiles[a];b&&b.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(b){return!b.hasDependency(a,h)})},u}(p.Evented);function St(n,u){var a=Math.abs(2*n.wrap)-+(n.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return n.overscaledZ-u.overscaledZ||h-a||u.canonical.y-n.canonical.y||u.canonical.x-n.canonical.x}function Ir(n){return n==="raster"||n==="image"||n==="video"}function Br(){return new p.window.Worker(ac.workerUrl)}De.maxOverzooming=10,De.maxUnderzooming=3;var jt="mapboxgl_preloaded_worker_pool",dr=function(){this.active={}};dr.prototype.acquire=function(n){if(!this.workers)for(this.workers=[];this.workers.length<dr.workerCount;)this.workers.push(new Br);return this.active[n]=!0,this.workers.slice()},dr.prototype.release=function(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},dr.prototype.isPreloaded=function(){return!!this.active[jt]},dr.prototype.numActive=function(){return Object.keys(this.active).length};var Wr,yn=Math.floor(p.browser.hardwareConcurrency/2);function vr(){return Wr||(Wr=new dr),Wr}function vn(n,u){var a={};for(var h in n)h!=="ref"&&(a[h]=n[h]);return p.refProperties.forEach(function(g){g in u&&(a[g]=u[g])}),a}function $r(n){n=n.slice();for(var u=Object.create(null),a=0;a<n.length;a++)u[n[a].id]=n[a];for(var h=0;h<n.length;h++)"ref"in n[h]&&(n[h]=vn(n[h],u[n[h].ref]));return n}dr.workerCount=Math.max(Math.min(yn,6),1);var cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function di(n,u,a){a.push({command:cn.addSource,args:[n,u[n]]})}function hn(n,u,a){u.push({command:cn.removeSource,args:[n]}),a[n]=!0}function bi(n,u,a,h){hn(n,a,h),di(n,u,a)}function Qi(n,u,a){var h;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(n[a][h],u[a][h]))return!1;return!0}function _i(n,u,a,h,g,b){var A;for(A in u=u||{},n=n||{})n.hasOwnProperty(A)&&(p.deepEqual(n[A],u[A])||a.push({command:b,args:[h,A,u[A],g]}));for(A in u)u.hasOwnProperty(A)&&!n.hasOwnProperty(A)&&(p.deepEqual(n[A],u[A])||a.push({command:b,args:[h,A,u[A],g]}))}function Oi(n){return n.id}function Ci(n,u){return n[u.id]=u,n}var yo=function(n,u){this.reset(n,u)};yo.prototype.reset=function(n,u){this.points=n||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},yo.prototype.lerp=function(n){if(this.points.length===1)return this.points[0];n=p.clamp(n,0,1);for(var u=1,a=this._distances[u],h=n*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var g=u-1,b=this._distances[g],A=a-b,L=A>0?(h-b)/A:0;return this.points[g].mult(1-L).add(this.points[u].mult(L))};var Zi=function(n,u,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(n/a),this.yCellCount=Math.ceil(u/a);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=u,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function Rn(n,u,a,h,g){var b=p.create();return u?(p.scale(b,b,[1/g,1/g,1]),a||p.rotateZ(b,b,h.angle)):p.multiply(b,h.labelPlaneMatrix,n),b}function Dn(n,u,a,h,g){if(u){var b=p.clone(n);return p.scale(b,b,[g,g,1]),a||p.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function hi(n,u){var a=[n.x,n.y,0,1];Ha(a,a,u);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function jn(n,u){return .5+n/u*.5}function Oa(n,u){var a=n[0]/n[3],h=n[1]/n[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function hs(n,u,a,h,g,b,A,L){var V=h?n.textSizeData:n.iconSizeData,ee=p.evaluateSizeForZoom(V,a.transform.zoom),de=[256/a.width*2+1,256/a.height*2+1],_e=h?n.text.dynamicLayoutVertexArray:n.icon.dynamicLayoutVertexArray;_e.clear();for(var xe=n.lineVertexArray,Xe=h?n.text.placedSymbolArray:n.icon.placedSymbolArray,Ge=a.transform.width/a.transform.height,nt=!1,ke=0;ke<Xe.length;ke++){var rt=Xe.get(ke);if(rt.hidden||rt.writingMode===p.WritingMode.vertical&&!nt)Ga(rt.numGlyphs,_e);else{nt=!1;var ht=[rt.anchorX,rt.anchorY,0,1];if(p.transformMat4(ht,ht,u),Oa(ht,de)){var Bt=jn(a.transform.cameraToCenterDistance,ht[3]),or=p.evaluateSizeForFeature(V,ee,rt),rr=A?or/Bt:or*Bt,lr=new p.Point(rt.anchorX,rt.anchorY),Lr=hi(lr,g).point,rn={},Yr=gu(rt,rr,!1,L,u,g,b,n.glyphOffsetArray,xe,_e,Lr,lr,rn,Ge);nt=Yr.useVertical,(Yr.notEnoughRoom||nt||Yr.needsFlipping&&gu(rt,rr,!0,L,u,g,b,n.glyphOffsetArray,xe,_e,Lr,lr,rn,Ge).notEnoughRoom)&&Ga(rt.numGlyphs,_e)}else Ga(rt.numGlyphs,_e)}}h?n.text.dynamicLayoutVertexBuffer.updateData(_e):n.icon.dynamicLayoutVertexBuffer.updateData(_e)}function Li(n,u,a,h,g,b,A,L,V,ee,de){var _e=L.glyphStartIndex+L.numGlyphs,xe=L.lineStartIndex,Xe=L.lineStartIndex+L.lineLength,Ge=u.getoffsetX(L.glyphStartIndex),nt=u.getoffsetX(_e-1),ke=ga(n*Ge,a,h,g,b,A,L.segment,xe,Xe,V,ee,de);if(!ke)return null;var rt=ga(n*nt,a,h,g,b,A,L.segment,xe,Xe,V,ee,de);return rt?{first:ke,last:rt}:null}function La(n,u,a,h){return n===p.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(n===p.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function gu(n,u,a,h,g,b,A,L,V,ee,de,_e,xe,Xe){var Ge,nt=u/24,ke=n.lineOffsetX*nt,rt=n.lineOffsetY*nt;if(n.numGlyphs>1){var ht=n.glyphStartIndex+n.numGlyphs,Bt=n.lineStartIndex,or=n.lineStartIndex+n.lineLength,rr=Li(nt,L,ke,rt,a,de,_e,n,V,b,xe);if(!rr)return{notEnoughRoom:!0};var lr=hi(rr.first.point,A).point,Lr=hi(rr.last.point,A).point;if(h&&!a){var rn=La(n.writingMode,lr,Lr,Xe);if(rn)return rn}Ge=[rr.first];for(var Yr=n.glyphStartIndex+1;Yr<ht-1;Yr++)Ge.push(ga(nt*L.getoffsetX(Yr),ke,rt,a,de,_e,n.segment,Bt,or,V,b,xe));Ge.push(rr.last)}else{if(h&&!a){var _n=hi(_e,g).point,Bn=n.lineStartIndex+n.segment+1,Xn=new p.Point(V.getx(Bn),V.gety(Bn)),Hn=hi(Xn,g),ta=Hn.signedDistanceFromCamera>0?Hn.point:su(_e,Xn,_n,1,g),xn=La(n.writingMode,_n,ta,Xe);if(xn)return xn}var ii=ga(nt*L.getoffsetX(n.glyphStartIndex),ke,rt,a,de,_e,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,V,b,xe);if(!ii)return{notEnoughRoom:!0};Ge=[ii]}for(var Si=0,ri=Ge;Si<ri.length;Si+=1){var ai=ri[Si];p.addDynamicAttributes(ee,ai.point,ai.angle)}return{}}function su(n,u,a,h,g){var b=hi(n.add(n.sub(u)._unit()),g).point,A=a.sub(b);return a.add(A._mult(h/A.mag()))}function ga(n,u,a,h,g,b,A,L,V,ee,de,_e){var xe=h?n-u:n+u,Xe=xe>0?1:-1,Ge=0;h&&(Xe*=-1,Ge=Math.PI),Xe<0&&(Ge+=Math.PI);for(var nt=Xe>0?L+A:L+A+1,ke=g,rt=g,ht=0,Bt=0,or=Math.abs(xe),rr=[];ht+Bt<=or;){if((nt+=Xe)<L||nt>=V)return null;if(rt=ke,rr.push(ke),(ke=_e[nt])===void 0){var lr=new p.Point(ee.getx(nt),ee.gety(nt)),Lr=hi(lr,de);if(Lr.signedDistanceFromCamera>0)ke=_e[nt]=Lr.point;else{var rn=nt-Xe;ke=su(ht===0?b:new p.Point(ee.getx(rn),ee.gety(rn)),lr,rt,or-ht+1,de)}}ht+=Bt,Bt=rt.dist(ke)}var Yr=(or-ht)/Bt,_n=ke.sub(rt),Bn=_n.mult(Yr)._add(rt);Bn._add(_n._unit()._perp()._mult(a*Xe));var Xn=Ge+Math.atan2(ke.y-rt.y,ke.x-rt.x);return rr.push(Bn),{point:Bn,angle:Xn,path:rr}}Zi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Zi.prototype.insert=function(n,u,a,h,g){this._forEachCell(u,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},Zi.prototype.insertCircle=function(n,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(u),this.circles.push(a),this.circles.push(h)},Zi.prototype._insertBoxCell=function(n,u,a,h,g,b){this.boxCells[g].push(b)},Zi.prototype._insertCircleCell=function(n,u,a,h,g,b){this.circleCells[g].push(b)},Zi.prototype._query=function(n,u,a,h,g,b){if(a<0||n>this.width||h<0||u>this.height)return!g&&[];var A=[];if(n<=0&&u<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var L=0;L<this.boxKeys.length;L++)A.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var V=0;V<this.circleKeys.length;V++){var ee=this.circles[3*V],de=this.circles[3*V+1],_e=this.circles[3*V+2];A.push({key:this.circleKeys[V],x1:ee-_e,y1:de-_e,x2:ee+_e,y2:de+_e})}return b?A.filter(b):A}return this._forEachCell(n,u,a,h,this._queryCell,A,{hitTest:g,seenUids:{box:{},circle:{}}},b),g?A.length>0:A},Zi.prototype._queryCircle=function(n,u,a,h,g){var b=n-a,A=n+a,L=u-a,V=u+a;if(A<0||b>this.width||V<0||L>this.height)return!h&&[];var ee=[];return this._forEachCell(b,L,A,V,this._queryCellCircle,ee,{hitTest:h,circle:{x:n,y:u,radius:a},seenUids:{box:{},circle:{}}},g),h?ee.length>0:ee},Zi.prototype.query=function(n,u,a,h,g){return this._query(n,u,a,h,!1,g)},Zi.prototype.hitTest=function(n,u,a,h,g){return this._query(n,u,a,h,!0,g)},Zi.prototype.hitTestCircle=function(n,u,a,h){return this._queryCircle(n,u,a,!0,h)},Zi.prototype._queryCell=function(n,u,a,h,g,b,A,L){var V=A.seenUids,ee=this.boxCells[g];if(ee!==null)for(var de=this.bboxes,_e=0,xe=ee;_e<xe.length;_e+=1){var Xe=xe[_e];if(!V.box[Xe]){V.box[Xe]=!0;var Ge=4*Xe;if(n<=de[Ge+2]&&u<=de[Ge+3]&&a>=de[Ge+0]&&h>=de[Ge+1]&&(!L||L(this.boxKeys[Xe]))){if(A.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[Xe],x1:de[Ge],y1:de[Ge+1],x2:de[Ge+2],y2:de[Ge+3]})}}}var nt=this.circleCells[g];if(nt!==null)for(var ke=this.circles,rt=0,ht=nt;rt<ht.length;rt+=1){var Bt=ht[rt];if(!V.circle[Bt]){V.circle[Bt]=!0;var or=3*Bt;if(this._circleAndRectCollide(ke[or],ke[or+1],ke[or+2],n,u,a,h)&&(!L||L(this.circleKeys[Bt]))){if(A.hitTest)return b.push(!0),!0;var rr=ke[or],lr=ke[or+1],Lr=ke[or+2];b.push({key:this.circleKeys[Bt],x1:rr-Lr,y1:lr-Lr,x2:rr+Lr,y2:lr+Lr})}}}},Zi.prototype._queryCellCircle=function(n,u,a,h,g,b,A,L){var V=A.circle,ee=A.seenUids,de=this.boxCells[g];if(de!==null)for(var _e=this.bboxes,xe=0,Xe=de;xe<Xe.length;xe+=1){var Ge=Xe[xe];if(!ee.box[Ge]){ee.box[Ge]=!0;var nt=4*Ge;if(this._circleAndRectCollide(V.x,V.y,V.radius,_e[nt+0],_e[nt+1],_e[nt+2],_e[nt+3])&&(!L||L(this.boxKeys[Ge])))return b.push(!0),!0}}var ke=this.circleCells[g];if(ke!==null)for(var rt=this.circles,ht=0,Bt=ke;ht<Bt.length;ht+=1){var or=Bt[ht];if(!ee.circle[or]){ee.circle[or]=!0;var rr=3*or;if(this._circlesCollide(rt[rr],rt[rr+1],rt[rr+2],V.x,V.y,V.radius)&&(!L||L(this.circleKeys[or])))return b.push(!0),!0}}},Zi.prototype._forEachCell=function(n,u,a,h,g,b,A,L){for(var V=this._convertToXCellCoord(n),ee=this._convertToYCellCoord(u),de=this._convertToXCellCoord(a),_e=this._convertToYCellCoord(h),xe=V;xe<=de;xe++)for(var Xe=ee;Xe<=_e;Xe++)if(g.call(this,n,u,a,h,this.xCellCount*Xe+xe,b,A,L))return},Zi.prototype._convertToXCellCoord=function(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))},Zi.prototype._convertToYCellCoord=function(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))},Zi.prototype._circlesCollide=function(n,u,a,h,g,b){var A=h-n,L=g-u,V=a+b;return V*V>A*A+L*L},Zi.prototype._circleAndRectCollide=function(n,u,a,h,g,b,A){var L=(b-h)/2,V=Math.abs(n-(h+L));if(V>L+a)return!1;var ee=(A-g)/2,de=Math.abs(u-(g+ee));if(de>ee+a)return!1;if(V<=L||de<=ee)return!0;var _e=V-L,xe=de-ee;return _e*_e+xe*xe<=a*a};var so=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ga(n,u){for(var a=0;a<n;a++){var h=u.length;u.resize(h+4),u.float32.set(so,3*h)}}function Ha(n,u,a){var h=u[0],g=u[1];return n[0]=a[0]*h+a[4]*g+a[12],n[1]=a[1]*h+a[5]*g+a[13],n[3]=a[3]*h+a[7]*g+a[15],n}var Ho=function(n,u,a){u===void 0&&(u=new Zi(n.width+200,n.height+200,25)),a===void 0&&(a=new Zi(n.width+200,n.height+200,25)),this.transform=n,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+100,this.screenBottomBoundary=n.height+100,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200};function sa(n,u,a){return u*(p.EXTENT/(n.tileSize*Math.pow(2,a-n.tileID.overscaledZ)))}Ho.prototype.placeCollisionBox=function(n,u,a,h,g){var b=this.projectAndGetPerspectiveRatio(h,n.anchorPointX,n.anchorPointY),A=a*b.perspectiveRatio,L=n.x1*A+b.point.x,V=n.y1*A+b.point.y,ee=n.x2*A+b.point.x,de=n.y2*A+b.point.y;return!this.isInsideGrid(L,V,ee,de)||!u&&this.grid.hitTest(L,V,ee,de,g)?{box:[],offscreen:!1}:{box:[L,V,ee,de],offscreen:this.isOffscreen(L,V,ee,de)}},Ho.prototype.placeCollisionCircles=function(n,u,a,h,g,b,A,L,V,ee,de,_e,xe){var Xe=[],Ge=new p.Point(u.anchorX,u.anchorY),nt=hi(Ge,b),ke=jn(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),rt=(ee?g/ke:g*ke)/p.ONE_EM,ht=hi(Ge,A).point,Bt=Li(rt,h,u.lineOffsetX*rt,u.lineOffsetY*rt,!1,ht,Ge,u,a,A,{}),or=!1,rr=!1,lr=!0;if(Bt){for(var Lr=.5*_e*ke+xe,rn=new p.Point(-100,-100),Yr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),_n=new yo,Bn=Bt.first,Xn=Bt.last,Hn=[],ta=Bn.path.length-1;ta>=1;ta--)Hn.push(Bn.path[ta]);for(var xn=1;xn<Xn.path.length;xn++)Hn.push(Xn.path[xn]);var ii=2.5*Lr;if(L){var Si=Hn.map(function(Rs){return hi(Rs,L)});Hn=Si.some(function(Rs){return Rs.signedDistanceFromCamera<=0})?[]:Si.map(function(Rs){return Rs.point})}var ri=[];if(Hn.length>0){for(var ai=Hn[0].clone(),wi=Hn[0].clone(),ni=1;ni<Hn.length;ni++)ai.x=Math.min(ai.x,Hn[ni].x),ai.y=Math.min(ai.y,Hn[ni].y),wi.x=Math.max(wi.x,Hn[ni].x),wi.y=Math.max(wi.y,Hn[ni].y);ri=ai.x>=rn.x&&wi.x<=Yr.x&&ai.y>=rn.y&&wi.y<=Yr.y?[Hn]:wi.x<rn.x||ai.x>Yr.x||wi.y<rn.y||ai.y>Yr.y?[]:p.clipLine([Hn],rn.x,rn.y,Yr.x,Yr.y)}for(var Jn=0,xo=ri;Jn<xo.length;Jn+=1){var ja;_n.reset(xo[Jn],.25*Lr),ja=_n.length<=.5*Lr?1:Math.ceil(_n.paddedLength/ii)+1;for(var Xo=0;Xo<ja;Xo++){var Oo=Xo/Math.max(ja-1,1),Za=_n.lerp(Oo),ho=Za.x+100,Ss=Za.y+100;Xe.push(ho,Ss,Lr,0);var Yo=ho-Lr,Zu=Ss-Lr,us=ho+Lr,Ls=Ss+Lr;if(lr=lr&&this.isOffscreen(Yo,Zu,us,Ls),rr=rr||this.isInsideGrid(Yo,Zu,us,Ls),!n&&this.grid.hitTestCircle(ho,Ss,Lr,de)&&(or=!0,!V))return{circles:[],offscreen:!1,collisionDetected:or}}}}return{circles:!V&&or||!rr?[]:Xe,offscreen:lr,collisionDetected:or}},Ho.prototype.queryRenderedSymbols=function(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,g=-1/0,b=-1/0,A=0,L=n;A<L.length;A+=1){var V=L[A],ee=new p.Point(V.x+100,V.y+100);a=Math.min(a,ee.x),h=Math.min(h,ee.y),g=Math.max(g,ee.x),b=Math.max(b,ee.y),u.push(ee)}for(var de={},_e={},xe=0,Xe=this.grid.query(a,h,g,b).concat(this.ignoredGrid.query(a,h,g,b));xe<Xe.length;xe+=1){var Ge=Xe[xe],nt=Ge.key;if(de[nt.bucketInstanceId]===void 0&&(de[nt.bucketInstanceId]={}),!de[nt.bucketInstanceId][nt.featureIndex]){var ke=[new p.Point(Ge.x1,Ge.y1),new p.Point(Ge.x2,Ge.y1),new p.Point(Ge.x2,Ge.y2),new p.Point(Ge.x1,Ge.y2)];p.polygonIntersectsPolygon(u,ke)&&(de[nt.bucketInstanceId][nt.featureIndex]=!0,_e[nt.bucketInstanceId]===void 0&&(_e[nt.bucketInstanceId]=[]),_e[nt.bucketInstanceId].push(nt.featureIndex))}}return _e},Ho.prototype.insertCollisionBox=function(n,u,a,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},n[0],n[1],n[2],n[3])},Ho.prototype.insertCollisionCircles=function(n,u,a,h,g){for(var b=u?this.ignoredGrid:this.grid,A={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},L=0;L<n.length;L+=4)b.insertCircle(A,n[L],n[L+1],n[L+2])},Ho.prototype.projectAndGetPerspectiveRatio=function(n,u,a){var h=[u,a,0,1];return Ha(h,h,n),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Ho.prototype.isOffscreen=function(n,u,a,h){return a<100||n>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Ho.prototype.isInsideGrid=function(n,u,a,h){return a>=0&&n<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Ho.prototype.getViewportMatrix=function(){var n=p.identity([]);return p.translate(n,n,[-100,-100,0]),n};var Wa=function(n,u,a,h){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?u:-u))):h&&a?1:0,this.placed=a};Wa.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ea=function(n,u,a,h,g){this.text=new Wa(n?n.text:null,u,a,g),this.icon=new Wa(n?n.icon:null,u,h,g)};Ea.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ya=function(n,u,a){this.text=n,this.icon=u,this.skipFade=a},ia=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},ol=function(n,u,a,h,g){this.bucketInstanceId=n,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},ns=function(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}};function to(n,u,a,h,g){var b=p.getAnchorAlignment(n),A=-(b.horizontalAlign-.5)*u,L=-(b.verticalAlign-.5)*a,V=p.evaluateVariableOffset(n,h);return new p.Point(A+V[0]*g,L+V[1]*g)}function Aa(n,u,a,h,g,b){var A=n.x1,L=n.x2,V=n.y1,ee=n.y2,de=n.anchorPointX,_e=n.anchorPointY,xe=new p.Point(u,a);return h&&xe._rotate(g?b:-b),{x1:A+xe.x,y1:V+xe.y,x2:L+xe.x,y2:ee+xe.y,anchorPointX:de,anchorPointY:_e}}ns.prototype.get=function(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){var u=++this.maxGroupID;this.collisionGroups[n]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[n]};var fa=function(n,u,a,h){this.transform=n.clone(),this.collisionIndex=new Ho(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new ns(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function fe(n,u,a,h,g){n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0),n.emplaceBack(u?1:0,a?1:0,h||0,g||0)}fa.prototype.getBucketParts=function(n,u,a,h){var g=a.getBucket(u),b=a.latestFeatureIndex;if(g&&b&&u.id===g.layerIds[0]){var A=a.collisionBoxArray,L=g.layers[0].layout,V=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),ee=a.tileSize/p.EXTENT,de=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),_e=L.get("text-pitch-alignment")==="map",xe=L.get("text-rotation-alignment")==="map",Xe=sa(a,1,this.transform.zoom),Ge=Rn(de,_e,xe,this.transform,Xe),nt=null;if(_e){var ke=Dn(de,_e,xe,this.transform,Xe);nt=p.multiply([],this.transform.labelPlaneMatrix,ke)}this.retainedQueryData[g.bucketInstanceId]=new ol(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,a.tileID);var rt={bucket:g,layout:L,posMatrix:de,textLabelPlaneMatrix:Ge,labelToScreenMatrix:nt,scale:V,textPixelRatio:ee,holdingForFade:a.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var ht=0,Bt=g.sortKeyRanges;ht<Bt.length;ht+=1){var or=Bt[ht];n.push({sortKey:or.sortKey,symbolInstanceStart:or.symbolInstanceStart,symbolInstanceEnd:or.symbolInstanceEnd,parameters:rt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:rt})}},fa.prototype.attemptAnchorPlacement=function(n,u,a,h,g,b,A,L,V,ee,de,_e,xe,Xe,Ge){var nt,ke=[_e.textOffset0,_e.textOffset1],rt=to(n,a,h,ke,g),ht=this.collisionIndex.placeCollisionBox(Aa(u,rt.x,rt.y,b,A,this.transform.angle),de,L,V,ee.predicate);if(!Ge||this.collisionIndex.placeCollisionBox(Aa(Ge,rt.x,rt.y,b,A,this.transform.angle),de,L,V,ee.predicate).box.length!==0)return ht.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:ke,width:a,height:h,anchor:n,textBoxScale:g,prevAnchor:nt},this.markUsedJustification(xe,n,_e,Xe),xe.allowVerticalPlacement&&(this.markUsedOrientation(xe,Xe,_e),this.placedOrientations[_e.crossTileID]=Xe),{shift:rt,placedGlyphBoxes:ht}):void 0},fa.prototype.placeLayerBucketPart=function(n,u,a){var h=this,g=n.parameters,b=g.bucket,A=g.layout,L=g.posMatrix,V=g.textLabelPlaneMatrix,ee=g.labelToScreenMatrix,de=g.textPixelRatio,_e=g.holdingForFade,xe=g.collisionBoxArray,Xe=g.partiallyEvaluatedTextSize,Ge=g.collisionGroup,nt=A.get("text-optional"),ke=A.get("icon-optional"),rt=A.get("text-allow-overlap"),ht=A.get("icon-allow-overlap"),Bt=A.get("text-rotation-alignment")==="map",or=A.get("text-pitch-alignment")==="map",rr=A.get("icon-text-fit")!=="none",lr=A.get("symbol-z-order")==="viewport-y",Lr=rt&&(ht||!b.hasIconData()||ke),rn=ht&&(rt||!b.hasTextData()||nt);!b.collisionArrays&&xe&&b.deserializeCollisionBoxes(xe);var Yr=function(xn,ii){if(!u[xn.crossTileID])if(_e)h.placements[xn.crossTileID]=new ya(!1,!1,!1);else{var Si,ri=!1,ai=!1,wi=!0,ni=null,Jn={box:null,offscreen:null},xo={box:null,offscreen:null},ja=null,Xo=null,Oo=0,Za=0,ho=0;ii.textFeatureIndex?Oo=ii.textFeatureIndex:xn.useRuntimeCollisionCircles&&(Oo=xn.featureIndex),ii.verticalTextFeatureIndex&&(Za=ii.verticalTextFeatureIndex);var Ss=ii.textBox;if(Ss){var Yo=function(Ki){var Lo=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Ki&&h.prevPlacement){var po=h.prevPlacement.placedOrientations[xn.crossTileID];po&&(h.placedOrientations[xn.crossTileID]=po,h.markUsedOrientation(b,Lo=po,xn))}return Lo},Zu=function(Ki,Lo){if(b.allowVerticalPlacement&&xn.numVerticalGlyphVertices>0&&ii.verticalTextBox)for(var po=0,pu=b.writingModes;po<pu.length&&(pu[po]===p.WritingMode.vertical?(Jn=Lo(),xo=Jn):Jn=Ki(),!(Jn&&Jn.box&&Jn.box.length));po+=1);else Jn=Ki()};if(A.get("text-variable-anchor")){var us=A.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[xn.crossTileID]){var Ls=h.prevPlacement.variableOffsets[xn.crossTileID];us.indexOf(Ls.anchor)>0&&(us=us.filter(function(Ki){return Ki!==Ls.anchor})).unshift(Ls.anchor)}var Rs=function(Ki,Lo,po){for(var pu=Ki.x2-Ki.x1,vs=Ki.y2-Ki.y1,du=xn.textBoxScale,Gu=rr&&!ht?Lo:null,Hu={box:[],offscreen:!1},Wu=rt?2*us.length:us.length,nu=0;nu<Wu;++nu){var Ul=h.attemptAnchorPlacement(us[nu%us.length],Ki,pu,vs,du,Bt,or,de,L,Ge,nu>=us.length,xn,b,po,Gu);if(Ul&&(Hu=Ul.placedGlyphBoxes)&&Hu.box&&Hu.box.length){ri=!0,ni=Ul.shift;break}}return Hu};Zu(function(){return Rs(Ss,ii.iconBox,p.WritingMode.horizontal)},function(){var Ki=ii.verticalTextBox;return b.allowVerticalPlacement&&!(Jn&&Jn.box&&Jn.box.length)&&xn.numVerticalGlyphVertices>0&&Ki?Rs(Ki,ii.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),Jn&&(ri=Jn.box,wi=Jn.offscreen);var ml=Yo(Jn&&Jn.box);if(!ri&&h.prevPlacement){var gl=h.prevPlacement.variableOffsets[xn.crossTileID];gl&&(h.variableOffsets[xn.crossTileID]=gl,h.markUsedJustification(b,gl.anchor,xn,ml))}}else{var Ws=function(Ki,Lo){var po=h.collisionIndex.placeCollisionBox(Ki,rt,de,L,Ge.predicate);return po&&po.box&&po.box.length&&(h.markUsedOrientation(b,Lo,xn),h.placedOrientations[xn.crossTileID]=Lo),po};Zu(function(){return Ws(Ss,p.WritingMode.horizontal)},function(){var Ki=ii.verticalTextBox;return b.allowVerticalPlacement&&xn.numVerticalGlyphVertices>0&&Ki?Ws(Ki,p.WritingMode.vertical):{box:null,offscreen:null}}),Yo(Jn&&Jn.box&&Jn.box.length)}}if(ri=(Si=Jn)&&Si.box&&Si.box.length>0,wi=Si&&Si.offscreen,xn.useRuntimeCollisionCircles){var rl=b.text.placedSymbolArray.get(xn.centerJustifiedTextSymbolIndex),Bl=p.evaluateSizeForFeature(b.textSizeData,Xe,rl),tu=A.get("text-padding");ja=h.collisionIndex.placeCollisionCircles(rt,rl,b.lineVertexArray,b.glyphOffsetArray,Bl,L,V,ee,a,or,Ge.predicate,xn.collisionCircleDiameter,tu),ri=rt||ja.circles.length>0&&!ja.collisionDetected,wi=wi&&ja.offscreen}if(ii.iconFeatureIndex&&(ho=ii.iconFeatureIndex),ii.iconBox){var nl=function(Ki){var Lo=rr&&ni?Aa(Ki,ni.x,ni.y,Bt,or,h.transform.angle):Ki;return h.collisionIndex.placeCollisionBox(Lo,ht,de,L,Ge.predicate)};ai=xo&&xo.box&&xo.box.length&&ii.verticalIconBox?(Xo=nl(ii.verticalIconBox)).box.length>0:(Xo=nl(ii.iconBox)).box.length>0,wi=wi&&Xo.offscreen}var ru=nt||xn.numHorizontalGlyphVertices===0&&xn.numVerticalGlyphVertices===0,io=ke||xn.numIconVertices===0;if(ru||io?io?ru||(ai=ai&&ri):ri=ai&&ri:ai=ri=ai&&ri,ri&&Si&&Si.box&&h.collisionIndex.insertCollisionBox(Si.box,A.get("text-ignore-placement"),b.bucketInstanceId,xo&&xo.box&&Za?Za:Oo,Ge.ID),ai&&Xo&&h.collisionIndex.insertCollisionBox(Xo.box,A.get("icon-ignore-placement"),b.bucketInstanceId,ho,Ge.ID),ja&&(ri&&h.collisionIndex.insertCollisionCircles(ja.circles,A.get("text-ignore-placement"),b.bucketInstanceId,Oo,Ge.ID),a)){var Vu=b.bucketInstanceId,Cu=h.collisionCircleArrays[Vu];Cu===void 0&&(Cu=h.collisionCircleArrays[Vu]=new ia);for(var Es=0;Es<ja.circles.length;Es+=4)Cu.circles.push(ja.circles[Es+0]),Cu.circles.push(ja.circles[Es+1]),Cu.circles.push(ja.circles[Es+2]),Cu.circles.push(ja.collisionDetected?1:0)}h.placements[xn.crossTileID]=new ya(ri||Lr,ai||rn,wi||b.justReloaded),u[xn.crossTileID]=!0}};if(lr)for(var _n=b.getSortedSymbolIndexes(this.transform.angle),Bn=_n.length-1;Bn>=0;--Bn){var Xn=_n[Bn];Yr(b.symbolInstances.get(Xn),b.collisionArrays[Xn])}else for(var Hn=n.symbolInstanceStart;Hn<n.symbolInstanceEnd;Hn++)Yr(b.symbolInstances.get(Hn),b.collisionArrays[Hn]);if(a&&b.bucketInstanceId in this.collisionCircleArrays){var ta=this.collisionCircleArrays[b.bucketInstanceId];p.invert(ta.invProjMatrix,L),ta.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},fa.prototype.markUsedJustification=function(n,u,a,h){var g;g=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var b=0,A=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];b<A.length;b+=1){var L=A[b];L>=0&&(n.text.placedSymbolArray.get(L).crossTileID=g>=0&&L!==g?0:a.crossTileID)}},fa.prototype.markUsedOrientation=function(n,u,a){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,g=u===p.WritingMode.vertical?u:0,b=0,A=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];b<A.length;b+=1)n.text.placedSymbolArray.get(A[b]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},fa.prototype.commit=function(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(n):1,g=u?u.opacities:{},b=u?u.variableOffsets:{},A=u?u.placedOrientations:{};for(var L in this.placements){var V=this.placements[L],ee=g[L];ee?(this.opacities[L]=new Ea(ee,h,V.text,V.icon),a=a||V.text!==ee.text.placed||V.icon!==ee.icon.placed):(this.opacities[L]=new Ea(null,h,V.text,V.icon,V.skipFade),a=a||V.text||V.icon)}for(var de in g){var _e=g[de];if(!this.opacities[de]){var xe=new Ea(_e,h,!1,!1);xe.isHidden()||(this.opacities[de]=xe,a=a||_e.text.placed||_e.icon.placed)}}for(var Xe in b)this.variableOffsets[Xe]||!this.opacities[Xe]||this.opacities[Xe].isHidden()||(this.variableOffsets[Xe]=b[Xe]);for(var Ge in A)this.placedOrientations[Ge]||!this.opacities[Ge]||this.opacities[Ge].isHidden()||(this.placedOrientations[Ge]=A[Ge]);a?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:n)},fa.prototype.updateLayerOpacities=function(n,u){for(var a={},h=0,g=u;h<g.length;h+=1){var b=g[h],A=b.getBucket(n);A&&b.latestFeatureIndex&&n.id===A.layerIds[0]&&this.updateBucketOpacities(A,a,b.collisionBoxArray)}},fa.prototype.updateBucketOpacities=function(n,u,a){var h=this;n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();var g=n.layers[0].layout,b=new Ea(null,0,!1,!1,!0),A=g.get("text-allow-overlap"),L=g.get("icon-allow-overlap"),V=g.get("text-variable-anchor"),ee=g.get("text-rotation-alignment")==="map",de=g.get("text-pitch-alignment")==="map",_e=g.get("icon-text-fit")!=="none",xe=new Ea(null,0,A&&(L||!n.hasIconData()||g.get("icon-optional")),L&&(A||!n.hasTextData()||g.get("text-optional")),!0);!n.collisionArrays&&a&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(a);for(var Xe=function(rt,ht,Bt){for(var or=0;or<ht/4;or++)rt.opacityVertexArray.emplaceBack(Bt)},Ge=function(rt){var ht=n.symbolInstances.get(rt),Bt=ht.numHorizontalGlyphVertices,or=ht.numVerticalGlyphVertices,rr=ht.crossTileID,lr=h.opacities[rr];u[rr]?lr=b:lr||(h.opacities[rr]=lr=xe),u[rr]=!0;var Lr=ht.numIconVertices>0,rn=h.placedOrientations[ht.crossTileID],Yr=rn===p.WritingMode.vertical,_n=rn===p.WritingMode.horizontal||rn===p.WritingMode.horizontalOnly;if(Bt>0||or>0){var Bn=Xa(lr.text);Xe(n.text,Bt,Yr?Ya:Bn),Xe(n.text,or,_n?Ya:Bn);var Xn=lr.text.isHidden();[ht.rightJustifiedTextSymbolIndex,ht.centerJustifiedTextSymbolIndex,ht.leftJustifiedTextSymbolIndex].forEach(function(Jn){Jn>=0&&(n.text.placedSymbolArray.get(Jn).hidden=Xn||Yr?1:0)}),ht.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ht.verticalPlacedTextSymbolIndex).hidden=Xn||_n?1:0);var Hn=h.variableOffsets[ht.crossTileID];Hn&&h.markUsedJustification(n,Hn.anchor,ht,rn);var ta=h.placedOrientations[ht.crossTileID];ta&&(h.markUsedJustification(n,"left",ht,ta),h.markUsedOrientation(n,ta,ht))}if(Lr){var xn=Xa(lr.icon),ii=!(_e&&ht.verticalPlacedIconSymbolIndex&&Yr);ht.placedIconSymbolIndex>=0&&(Xe(n.icon,ht.numIconVertices,ii?xn:Ya),n.icon.placedSymbolArray.get(ht.placedIconSymbolIndex).hidden=lr.icon.isHidden()),ht.verticalPlacedIconSymbolIndex>=0&&(Xe(n.icon,ht.numVerticalIconVertices,ii?Ya:xn),n.icon.placedSymbolArray.get(ht.verticalPlacedIconSymbolIndex).hidden=lr.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){var Si=n.collisionArrays[rt];if(Si){var ri=new p.Point(0,0);if(Si.textBox||Si.verticalTextBox){var ai=!0;if(V){var wi=h.variableOffsets[rr];wi?(ri=to(wi.anchor,wi.width,wi.height,wi.textOffset,wi.textBoxScale),ee&&ri._rotate(de?h.transform.angle:-h.transform.angle)):ai=!1}Si.textBox&&fe(n.textCollisionBox.collisionVertexArray,lr.text.placed,!ai||Yr,ri.x,ri.y),Si.verticalTextBox&&fe(n.textCollisionBox.collisionVertexArray,lr.text.placed,!ai||_n,ri.x,ri.y)}var ni=Boolean(!_n&&Si.verticalIconBox);Si.iconBox&&fe(n.iconCollisionBox.collisionVertexArray,lr.icon.placed,ni,_e?ri.x:0,_e?ri.y:0),Si.verticalIconBox&&fe(n.iconCollisionBox.collisionVertexArray,lr.icon.placed,!ni,_e?ri.x:0,_e?ri.y:0)}}},nt=0;nt<n.symbolInstances.length;nt++)Ge(nt);if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){var ke=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ke.invProjMatrix,n.placementViewportMatrix=ke.viewportMatrix,n.collisionCircleArray=ke.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}},fa.prototype.symbolFadeChange=function(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},fa.prototype.zoomAdjustment=function(n){return Math.max(0,(this.transform.zoom-n)/1.5)},fa.prototype.hasTransitions=function(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration},fa.prototype.stillRecent=function(n,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>n},fa.prototype.setStale=function(){this.stale=!0};var Pe=Math.pow(2,25),ft=Math.pow(2,24),ur=Math.pow(2,17),en=Math.pow(2,16),kn=Math.pow(2,9),Vi=Math.pow(2,8),qi=Math.pow(2,1);function Xa(n){if(n.opacity===0&&!n.placed)return 0;if(n.opacity===1&&n.placed)return 4294967295;var u=n.placed?1:0,a=Math.floor(127*n.opacity);return a*Pe+u*ft+a*ur+u*en+a*kn+u*Vi+a*qi+u}var Ya=0,Wo=function(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Wo.prototype.continuePlacement=function(n,u,a,h,g){for(var b=this._bucketParts;this._currentTileIndex<n.length;)if(u.getBucketParts(b,h,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(A,L){return A.sortKey-L.sortKey}));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var xs=function(n,u,a,h,g,b,A){this.placement=new fa(n,g,b,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};xs.prototype.isDone=function(){return this._done},xs.prototype.continuePlacement=function(n,u,a){for(var h=this,g=p.browser.now(),b=function(){var V=p.browser.now()-g;return!h._forceFullPlacement&&V>2};this._currentPlacementIndex>=0;){var A=u[n[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Wo(A)),this._inProgressLayer.continuePlacement(a[A.source],this.placement,this._showCollisionBoxes,A,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},xs.prototype.commit=function(n){return this.placement.commit(n),this.placement};var jl=512/p.EXTENT/2,Ku=function(n,u,a){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var g=u.get(h),b=g.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,n)})}};Ku.prototype.getScaledCoordinates=function(n,u){var a=jl/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+n.anchorX)*a),y:Math.floor((u.canonical.y*p.EXTENT+n.anchorY)*a)}},Ku.prototype.findMatches=function(n,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<n.length;g++){var b=n.get(g);if(!b.crossTileID){var A=this.indexedSymbolInstances[b.key];if(A)for(var L=this.getScaledCoordinates(b,u),V=0,ee=A;V<ee.length;V+=1){var de=ee[V];if(Math.abs(de.coord.x-L.x)<=h&&Math.abs(de.coord.y-L.y)<=h&&!a[de.crossTileID]){a[de.crossTileID]=!0,b.crossTileID=de.crossTileID;break}}}}};var Do=function(){this.maxCrossTileID=0};Do.prototype.generate=function(){return++this.maxCrossTileID};var Cs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Cs.prototype.handleWrapJump=function(n){var u=Math.round((n-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var b in h){var A=h[b];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+u),g[A.tileID.key]=A}this.indexes[a]=g}this.lng=n},Cs.prototype.addBucket=function(n,u,a){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});var g=this.usedCrossTileIDs[n.overscaledZ];for(var b in this.indexes){var A=this.indexes[b];if(Number(b)>n.overscaledZ)for(var L in A){var V=A[L];V.tileID.isChildOf(n)&&V.findMatches(u.symbolInstances,n,g)}else{var ee=A[n.scaledTo(Number(b)).key];ee&&ee.findMatches(u.symbolInstances,n,g)}}for(var de=0;de<u.symbolInstances.length;de++){var _e=u.symbolInstances.get(de);_e.crossTileID||(_e.crossTileID=a.generate(),g[_e.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Ku(n,u.symbolInstances,u.bucketInstanceId),!0},Cs.prototype.removeBucketCrossTileIDs=function(n,u){for(var a in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[n][g[h].crossTileID]},Cs.prototype.removeStaleBuckets=function(n){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)n[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],u=!0)}return u};var uo=function(){this.layerIndexes={},this.crossTileIDs=new Do,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};uo.prototype.addLayer=function(n,u,a){var h=this.layerIndexes[n.id];h===void 0&&(h=this.layerIndexes[n.id]=new Cs);var g=!1,b={};h.handleWrapJump(a);for(var A=0,L=u;A<L.length;A+=1){var V=L[A],ee=V.getBucket(n);ee&&n.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(V.tileID,ee,this.crossTileIDs)&&(g=!0),b[ee.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(g=!0),g},uo.prototype.pruneUnusedLayers=function(n){var u={};for(var a in n.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var Ps=function(n,u){return p.emitValidationErrors(n,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},Ca=p.pick(cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),pi=p.pick(cn,["setCenter","setZoom","setBearing","setPitch"]),sl=function(){var n={},u=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,g=p.styleSpec.$root[a];g.required&&(h=a==="version"?u:g.type==="array"?[]:{})!=null&&(n[a]=h)}return n}(),Ra=function(n){function u(a,h){var g=this;h===void 0&&(h={}),n.call(this),this.map=a,this.dispatcher=new Ae(vr(),this),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new ar(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Fe(256,512),this.crossTileSymbolIndex=new uo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var b=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(A){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},function(L,V){if(p.triggerPluginCompletionEvent(L),V&&V.every(function(de){return de}))for(var ee in b.sourceCaches)b.sourceCaches[ee].reload()})}),this.on("data",function(A){if(A.dataType==="source"&&A.sourceDataType==="metadata"){var L=g.sourceCaches[A.sourceId];if(L){var V=L.getSource();if(V&&V.vectorLayerIds)for(var ee in g._layers){var de=g._layers[ee];de.source===V.id&&g._validateLayer(de)}}}})}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var A=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(A,function(L,V){g._request=null,L?g.fire(new p.ErrorEvent(L)):V&&g._load(V,b)})},u.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(sl,!1)},u.prototype._load=function(a,h){if(!h||!Ps(this,p.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var b=$r(this.stylesheet.layers);this._order=b.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var A=0,L=b;A<L.length;A+=1){var V=L[A];(V=p.createStyleLayer(V)).setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new bt(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,b,A){var L,V,ee,de=p.browser.devicePixelRatio>1?"@2x":"",_e=p.getJSON(b.transformRequest(b.normalizeSpriteURL(g,de,".json"),p.ResourceType.SpriteJSON),function(Ge,nt){_e=null,ee||(ee=Ge,L=nt,Xe())}),xe=p.getImage(b.transformRequest(b.normalizeSpriteURL(g,de,".png"),p.ResourceType.SpriteImage),function(Ge,nt){xe=null,ee||(ee=Ge,V=nt,Xe())});function Xe(){if(ee)A(ee);else if(L&&V){var Ge=p.browser.getImageData(V),nt={};for(var ke in L){var rt=L[ke],ht=rt.width,Bt=rt.height,or=rt.x,rr=rt.y,lr=rt.sdf,Lr=rt.pixelRatio,rn=rt.stretchX,Yr=rt.stretchY,_n=rt.content,Bn=new p.RGBAImage({width:ht,height:Bt});p.RGBAImage.copy(Ge,Bn,{x:or,y:rr},{x:0,y:0},{width:ht,height:Bt}),nt[ke]={data:Bn,pixelRatio:Lr,sdf:lr,stretchX:rn,stretchY:Yr,content:_n}}A(null,nt)}}return{cancel:function(){_e&&(_e.cancel(),_e=null),xe&&(xe.cancel(),xe=null)}}}(a,this.map._requestManager,function(g,b){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(b)for(var A in b)h.imageManager.addImage(A,b[A]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+b.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],g=0,b=a;g<b.length;g+=1){var A=this._layers[b[g]];A.type!=="custom"&&h.push(A.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var A in(g.length||b.length)&&this._updateWorkerLayers(g,b),this._updatedSources){var L=this._updatedSources[A];L==="reload"?this._reloadSource(A):L==="clear"&&this._clearSource(A)}for(var V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var ee={};for(var de in this.sourceCaches){var _e=this.sourceCaches[de];ee[de]=_e.used,_e.used=!1}for(var xe=0,Xe=this._order;xe<Xe.length;xe+=1){var Ge=this._layers[Xe[xe]];Ge.recalculate(a,this._availableImages),!Ge.isHidden(a.zoom)&&Ge.source&&(this.sourceCaches[Ge.source].used=!0)}for(var nt in ee){var ke=this.sourceCaches[nt];ee[nt]!==ke.used&&ke.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),Ps(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=$r(a.layers);var g=function(A,L){if(!A)return[{command:cn.setStyle,args:[L]}];var V=[];try{if(!p.deepEqual(A.version,L.version))return[{command:cn.setStyle,args:[L]}];p.deepEqual(A.center,L.center)||V.push({command:cn.setCenter,args:[L.center]}),p.deepEqual(A.zoom,L.zoom)||V.push({command:cn.setZoom,args:[L.zoom]}),p.deepEqual(A.bearing,L.bearing)||V.push({command:cn.setBearing,args:[L.bearing]}),p.deepEqual(A.pitch,L.pitch)||V.push({command:cn.setPitch,args:[L.pitch]}),p.deepEqual(A.sprite,L.sprite)||V.push({command:cn.setSprite,args:[L.sprite]}),p.deepEqual(A.glyphs,L.glyphs)||V.push({command:cn.setGlyphs,args:[L.glyphs]}),p.deepEqual(A.transition,L.transition)||V.push({command:cn.setTransition,args:[L.transition]}),p.deepEqual(A.light,L.light)||V.push({command:cn.setLight,args:[L.light]});var ee={},de=[];(function(xe,Xe,Ge,nt){var ke;for(ke in Xe=Xe||{},xe=xe||{})xe.hasOwnProperty(ke)&&(Xe.hasOwnProperty(ke)||hn(ke,Ge,nt));for(ke in Xe)Xe.hasOwnProperty(ke)&&(xe.hasOwnProperty(ke)?p.deepEqual(xe[ke],Xe[ke])||(xe[ke].type==="geojson"&&Xe[ke].type==="geojson"&&Qi(xe,Xe,ke)?Ge.push({command:cn.setGeoJSONSourceData,args:[ke,Xe[ke].data]}):bi(ke,Xe,Ge,nt)):di(ke,Xe,Ge))})(A.sources,L.sources,de,ee);var _e=[];A.layers&&A.layers.forEach(function(xe){ee[xe.source]?V.push({command:cn.removeLayer,args:[xe.id]}):_e.push(xe)}),V=V.concat(de),function(xe,Xe,Ge){Xe=Xe||[];var nt,ke,rt,ht,Bt,or,rr,lr=(xe=xe||[]).map(Oi),Lr=Xe.map(Oi),rn=xe.reduce(Ci,{}),Yr=Xe.reduce(Ci,{}),_n=lr.slice(),Bn=Object.create(null);for(nt=0,ke=0;nt<lr.length;nt++)Yr.hasOwnProperty(rt=lr[nt])?ke++:(Ge.push({command:cn.removeLayer,args:[rt]}),_n.splice(_n.indexOf(rt,ke),1));for(nt=0,ke=0;nt<Lr.length;nt++)_n[_n.length-1-nt]!==(rt=Lr[Lr.length-1-nt])&&(rn.hasOwnProperty(rt)?(Ge.push({command:cn.removeLayer,args:[rt]}),_n.splice(_n.lastIndexOf(rt,_n.length-ke),1)):ke++,Ge.push({command:cn.addLayer,args:[Yr[rt],or=_n[_n.length-nt]]}),_n.splice(_n.length-nt,0,rt),Bn[rt]=!0);for(nt=0;nt<Lr.length;nt++)if(ht=rn[rt=Lr[nt]],Bt=Yr[rt],!Bn[rt]&&!p.deepEqual(ht,Bt))if(p.deepEqual(ht.source,Bt.source)&&p.deepEqual(ht["source-layer"],Bt["source-layer"])&&p.deepEqual(ht.type,Bt.type)){for(rr in _i(ht.layout,Bt.layout,Ge,rt,null,cn.setLayoutProperty),_i(ht.paint,Bt.paint,Ge,rt,null,cn.setPaintProperty),p.deepEqual(ht.filter,Bt.filter)||Ge.push({command:cn.setFilter,args:[rt,Bt.filter]}),p.deepEqual(ht.minzoom,Bt.minzoom)&&p.deepEqual(ht.maxzoom,Bt.maxzoom)||Ge.push({command:cn.setLayerZoomRange,args:[rt,Bt.minzoom,Bt.maxzoom]}),ht)ht.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?_i(ht[rr],Bt[rr],Ge,rt,rr.slice(6),cn.setPaintProperty):p.deepEqual(ht[rr],Bt[rr])||Ge.push({command:cn.setLayerProperty,args:[rt,rr,Bt[rr]]}));for(rr in Bt)Bt.hasOwnProperty(rr)&&!ht.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?_i(ht[rr],Bt[rr],Ge,rt,rr.slice(6),cn.setPaintProperty):p.deepEqual(ht[rr],Bt[rr])||Ge.push({command:cn.setLayerProperty,args:[rt,rr,Bt[rr]]}))}else Ge.push({command:cn.removeLayer,args:[rt]}),or=_n[_n.lastIndexOf(rt)+1],Ge.push({command:cn.addLayer,args:[Bt,or]})}(_e,L.layers,V)}catch(xe){console.warn("Unable to compute style diff:",xe),V=[{command:cn.setStyle,args:[L]}]}return V}(this.serialize(),a).filter(function(A){return!(A.command in pi)});if(g.length===0)return!1;var b=g.filter(function(A){return!(A.command in Ca)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(A){return A.command}).join(", ")+".");return g.forEach(function(A){A.command!=="setTransition"&&h[A.command].apply(h,A.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,g){var b=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var A=this.sourceCaches[a]=new De(a,h,this.dispatcher);A.style=this,A.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:A.serialize(),sourceId:a}}),A.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var b=a.id;if(this.getLayer(b))this.fire(new p.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var A;if(a.type==="custom"){if(Ps(this,p.validateCustomStyleLayer(a)))return;A=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(b,a.source),a=p.clone$1(a),a=p.extend(a,{source:b})),this._validate(p.validateStyle.layer,"layers."+b,a,{arrayIndex:-1},g))return;A=p.createStyleLayer(a),this._validateLayer(A),A.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[A.id]=A.serialize()}var L=h?this._order.indexOf(h):this._order.length;if(h&&L===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(L,0,b),this._layerOrderChanged=!0,this._layers[b]=A,this._removedLayers[b]&&A.source&&A.type!=="custom"){var V=this._removedLayers[b];delete this._removedLayers[b],V.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var b=this.getLayer(a);b?b.minzoom===h&&b.maxzoom===g||(h!=null&&(b.minzoom=h),g!=null&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var b=this.getLayer(a);if(b){if(!p.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(p.validateStyle.filter,"layers."+b.id+".filter",h,null,g)||(b.filter=p.clone$1(h),this._updateLayer(b)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,g,b){b===void 0&&(b={}),this._checkLoaded();var A=this.getLayer(a);A?p.deepEqual(A.getLayoutProperty(h),g)||(A.setLayoutProperty(h,g,b),this._updateLayer(A)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,g,b){b===void 0&&(b={}),this._checkLoaded();var A=this.getLayer(a);A?p.deepEqual(A.getPaintProperty(h),g)||(A.setPaintProperty(h,g,b)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,b=a.sourceLayer,A=this.sourceCaches[g];if(A!==void 0){var L=A.getSource().type;L==="geojson"&&b?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||b?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),A.setFeatureState(b,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,b=this.sourceCaches[g];if(b!==void 0){var A=b.getSource().type,L=A==="vector"?a.sourceLayer:void 0;A!=="vector"||L?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(L,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(rn){return h._layers[rn].type==="fill-extrusion"},b={},A=[],L=this._order.length-1;L>=0;L--){var V=this._order[L];if(g(V)){b[V]=L;for(var ee=0,de=a;ee<de.length;ee+=1){var _e=de[ee][V];if(_e)for(var xe=0,Xe=_e;xe<Xe.length;xe+=1)A.push(Xe[xe])}}}A.sort(function(rn,Yr){return Yr.intersectionZ-rn.intersectionZ});for(var Ge=[],nt=this._order.length-1;nt>=0;nt--){var ke=this._order[nt];if(g(ke))for(var rt=A.length-1;rt>=0;rt--){var ht=A[rt].feature;if(b[ht.layer.id]<nt)break;Ge.push(ht),A.pop()}else for(var Bt=0,or=a;Bt<or.length;Bt+=1){var rr=or[Bt][ke];if(rr)for(var lr=0,Lr=rr;lr<Lr.length;lr+=1)Ge.push(Lr[lr].feature)}}return Ge},u.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var A=0,L=h.layers;A<L.length;A+=1){var V=L[A],ee=this._layers[V];if(!ee)return this.fire(new p.ErrorEvent(new Error("The layer '"+V+"' does not exist in the map's style and cannot be queried for features."))),[];b[ee.source]=!0}}var de=[];for(var _e in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[_e]||de.push(zr(this.sourceCaches[_e],this._layers,this._serializedLayers,a,h,g));return this.placement&&de.push(function(xe,Xe,Ge,nt,ke,rt,ht){for(var Bt={},or=rt.queryRenderedSymbols(nt),rr=[],lr=0,Lr=Object.keys(or).map(Number);lr<Lr.length;lr+=1)rr.push(ht[Lr[lr]]);rr.sort(ln);for(var rn=function(){var Hn=_n[Yr],ta=Hn.featureIndex.lookupSymbolFeatures(or[Hn.bucketInstanceId],Xe,Hn.bucketIndex,Hn.sourceLayerIndex,ke.filter,ke.layers,ke.availableImages,xe);for(var xn in ta){var ii=Bt[xn]=Bt[xn]||[],Si=ta[xn];Si.sort(function(wi,ni){var Jn=Hn.featureSortOrder;if(Jn){var xo=Jn.indexOf(wi.featureIndex);return Jn.indexOf(ni.featureIndex)-xo}return ni.featureIndex-wi.featureIndex});for(var ri=0,ai=Si;ri<ai.length;ri+=1)ii.push(ai[ri])}},Yr=0,_n=rr;Yr<_n.length;Yr+=1)rn();var Bn=function(Hn){Bt[Hn].forEach(function(ta){var xn=ta.feature,ii=Ge[xe[Hn].source].getFeatureState(xn.layer["source-layer"],xn.id);xn.source=xn.layer.source,xn.layer["source-layer"]&&(xn.sourceLayer=xn.layer["source-layer"]),xn.state=ii})};for(var Xn in Bt)Bn(Xn);return Bt}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(de)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(b,A){for(var L=b.getRenderableIds().map(function(Xe){return b.getTileByID(Xe)}),V=[],ee={},de=0;de<L.length;de++){var _e=L[de],xe=_e.tileID.canonical.key;ee[xe]||(ee[xe]=!0,_e.querySourceFeatures(V,A))}return V}(g,h):[]},u.prototype.addSourceType=function(a,h,g){return u.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),b=!1;for(var A in a)if(!p.deepEqual(a[A],g[A])){b=!0;break}if(b){var L={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(L)}},u.prototype._validate=function(a,h,g,b,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&Ps(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},b)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,g,b,A){A===void 0&&(A=!1);for(var L=!1,V=!1,ee={},de=0,_e=this._order;de<_e.length;de+=1){var xe=this._layers[_e[de]];if(xe.type==="symbol"){if(!ee[xe.source]){var Xe=this.sourceCaches[xe.source];ee[xe.source]=Xe.getRenderableIds(!0).map(function(ht){return Xe.getTileByID(ht)}).sort(function(ht,Bt){return Bt.tileID.overscaledZ-ht.tileID.overscaledZ||(ht.tileID.isLessThan(Bt.tileID)?-1:1)})}var Ge=this.crossTileSymbolIndex.addLayer(xe,ee[xe.source],a.center.lng);L=L||Ge}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new xs(a,this._order,A,h,g,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),V=!0),L&&this.pauseablePlacement.placement.setStale()),V||L)for(var nt=0,ke=this._order;nt<ke.length;nt+=1){var rt=this._layers[ke[nt]];rt.type==="symbol"&&this.placement.updateLayerOpacities(rt,ee[rt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(a,h,g){return p.makeRequest(h,g)},u}(p.Evented);Ra.getSourceType=function(n){return $t[n]},Ra.setSourceType=function(n,u){$t[n]=u},Ra.registerForPluginStateChange=p.registerForPluginStateChange;var zn=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ks=xa(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Zl=xa(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),lo=xa(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),je=xa(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Tt=xa("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gr=xa(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),In=xa(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Yi=xa("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),_a=xa("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Ba=xa("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),aa=xa(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Pa=xa(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ko=xa(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Mo=xa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ri=xa(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),wl=xa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Us=xa(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ps=xa(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Vl=xa(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),co=xa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),is=xa(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),as=xa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),uu=xa(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ms=xa(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),pc=xa(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),vf=xa(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function xa(n,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=b?b.concat(g):g,L={};return{fragmentSource:n=n.replace(a,function(V,ee,de,_e,xe){return L[xe]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
varying `+de+" "+_e+" "+xe+`;
#else
uniform `+de+" "+_e+" u_"+xe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+xe+`
    `+de+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`}),vertexSource:u=u.replace(a,function(V,ee,de,_e,xe){var Xe=_e==="float"?"vec2":"vec4",Ge=xe.match(/color/)?"color":Xe;return L[xe]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+de+" "+Xe+" a_"+xe+`;
varying `+de+" "+_e+" "+xe+`;
#else
uniform `+de+" "+_e+" u_"+xe+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = a_"+xe+`;
#else
    `+de+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+xe+" = unpack_mix_"+Ge+"(a_"+xe+", u_"+xe+`_t);
#else
    `+de+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+xe+`
uniform lowp float u_`+xe+`_t;
attribute `+de+" "+Xe+" a_"+xe+`;
#else
uniform `+de+" "+_e+" u_"+xe+`;
#endif
`:Ge==="vec4"?`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+de+" "+_e+" "+xe+" = a_"+xe+`;
#else
    `+de+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+xe+`
    `+de+" "+_e+" "+xe+" = unpack_mix_"+Ge+"(a_"+xe+", u_"+xe+`_t);
#else
    `+de+" "+_e+" "+xe+" = u_"+xe+`;
#endif
`}),staticAttributes:h,staticUniforms:A}}var mf=Object.freeze({__proto__:null,prelude:Ks,background:Zl,backgroundPattern:lo,circle:je,clippingMask:Tt,heatmap:gr,heatmapTexture:In,collisionBox:Yi,collisionCircle:_a,debug:Ba,fill:aa,fillOutline:Pa,fillOutlinePattern:ko,fillPattern:Mo,fillExtrusion:Ri,fillExtrusionPattern:wl,hillshadePrepare:Us,hillshade:ps,line:Vl,lineGradient:co,linePattern:is,lineSDF:as,raster:uu,symbolIcon:Ms,symbolSDF:pc,symbolTextAndIcon:vf}),lu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Gl(n){for(var u=[],a=0;a<n.length;a++)if(n[a]!==null){var h=n[a].split(" ");u.push(h.pop())}return u}lu.prototype.bind=function(n,u,a,h,g,b,A,L){this.context=n;for(var V=this.boundPaintVertexBuffers.length!==h.length,ee=0;!V&&ee<h.length;ee++)this.boundPaintVertexBuffers[ee]!==h[ee]&&(V=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!V&&this.boundIndexBuffer===g&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===L?(n.bindVertexArrayOES.set(this.vao),A&&A.bind(),g&&g.dynamicDraw&&g.bind(),L&&L.bind()):this.freshBind(u,a,h,g,b,A,L)},lu.prototype.freshBind=function(n,u,a,h,g,b,A){var L,V=n.numAttributes,ee=this.context,de=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=n,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=A;else{L=ee.currentNumAttributes||0;for(var _e=V;_e<L;_e++)de.disableVertexAttribArray(_e)}u.enableAttributes(de,n);for(var xe=0,Xe=a;xe<Xe.length;xe+=1)Xe[xe].enableAttributes(de,n);b&&b.enableAttributes(de,n),A&&A.enableAttributes(de,n),u.bind(),u.setVertexAttribPointers(de,n,g);for(var Ge=0,nt=a;Ge<nt.length;Ge+=1){var ke=nt[Ge];ke.bind(),ke.setVertexAttribPointers(de,n,g)}b&&(b.bind(),b.setVertexAttribPointers(de,n,g)),h&&h.bind(),A&&(A.bind(),A.setVertexAttribPointers(de,n,g)),ee.currentNumAttributes=V},lu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ic=function(n,u,a,h,g,b){var A=n.gl;this.program=A.createProgram();for(var L=Gl(a.staticAttributes),V=h?h.getBinderAttributes():[],ee=L.concat(V),de=a.staticUniforms?Gl(a.staticUniforms):[],_e=h?h.getBinderUniforms():[],xe=[],Xe=0,Ge=de.concat(_e);Xe<Ge.length;Xe+=1){var nt=Ge[Xe];xe.indexOf(nt)<0&&xe.push(nt)}var ke=h?h.defines():[];b&&ke.push("#define OVERDRAW_INSPECTOR;");var rt=ke.concat(Ks.fragmentSource,a.fragmentSource).join(`
`),ht=ke.concat(Ks.vertexSource,a.vertexSource).join(`
`),Bt=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(Bt,rt),A.compileShader(Bt),A.attachShader(this.program,Bt);var or=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(or,ht),A.compileShader(or),A.attachShader(this.program,or),this.attributes={};var rr={};this.numAttributes=ee.length;for(var lr=0;lr<this.numAttributes;lr++)ee[lr]&&(A.bindAttribLocation(this.program,lr,ee[lr]),this.attributes[ee[lr]]=lr);A.linkProgram(this.program),A.deleteShader(or),A.deleteShader(Bt);for(var Lr=0;Lr<xe.length;Lr++){var rn=xe[Lr];if(rn&&!rr[rn]){var Yr=A.getUniformLocation(this.program,rn);Yr&&(rr[rn]=Yr)}}this.fixedUniforms=g(n,rr),this.binderUniforms=h?h.getUniforms(n,rr):[]}}};function Oc(n,u,a){var h=1/sa(a,1,u.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,u.transform.tileZoom)/g,A=b*(a.tileID.canonical.x+a.tileID.wrap*g),L=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,n.fromScale,n.toScale],u_fade:n.t,u_pixel_coord_upper:[A>>16,L>>16],u_pixel_coord_lower:[65535&A,65535&L]}}Ic.prototype.draw=function(n,u,a,h,g,b,A,L,V,ee,de,_e,xe,Xe,Ge,nt){var ke,rt=n.gl;if(!this.failedToCreate){for(var ht in n.program.set(this.program),n.setDepthMode(a),n.setStencilMode(h),n.setColorMode(g),n.setCullFace(b),this.fixedUniforms)this.fixedUniforms[ht].set(A[ht]);Xe&&Xe.setUniforms(n,this.binderUniforms,_e,{zoom:xe});for(var Bt=(ke={},ke[rt.LINES]=2,ke[rt.TRIANGLES]=3,ke[rt.LINE_STRIP]=1,ke)[u],or=0,rr=de.get();or<rr.length;or+=1){var lr=rr[or],Lr=lr.vaos||(lr.vaos={});(Lr[L]||(Lr[L]=new lu)).bind(n,this,V,Xe?Xe.getPaintVertexBuffers():[],ee,lr.vertexOffset,Ge,nt),rt.drawElements(u,lr.primitiveLength*Bt,rt.UNSIGNED_SHORT,lr.primitiveOffset*Bt*2)}}};var ro=function(n,u,a,h){var g=u.style.light,b=g.properties.get("position"),A=[b.x,b.y,b.z],L=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(L,-u.transform.angle),p.transformMat3(A,A,L);var V=g.properties.get("color");return{u_matrix:n,u_lightpos:A,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+a,u_opacity:h}},yu=function(n,u,a,h,g,b,A){return p.extend(ro(n,u,a,h),Oc(b,u,A),{u_height_factor:-Math.pow(2,g.overscaledZ)/A.tileSize/8})},$u=function(n){return{u_matrix:n}},Ua=function(n,u,a,h){return p.extend($u(n),Oc(a,u,h))},Lc=function(n,u){return{u_matrix:n,u_world:u}},Tl=function(n,u,a,h,g){return p.extend(Ua(n,u,a,h),{u_world:g})},Ou=function(n,u,a,h){var g,b,A=n.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var L=sa(a,1,A.zoom);g=!0,b=[L,L]}else g=!1,b=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:n.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:b}},ul=function(n,u,a){var h=sa(a,1,u.zoom),g=Math.pow(2,u.zoom-a.tileID.overscaledZ),b=a.tileID.overscaleFactor();return{u_matrix:n,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:b}},Hl=function(n,u,a){return{u_matrix:n,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},Ju=function(n,u,a){return a===void 0&&(a=1),{u_matrix:n,u_color:u,u_overlay:0,u_overlay_scale:a}},Is=function(n){return{u_matrix:n}},Al=function(n,u,a,h){return{u_matrix:n,u_extrude_scale:sa(u,1,a),u_intensity:h}},Cl=function(n,u,a){var h=n.transform;return{u_matrix:Jc(n,u,a),u_ratio:1/sa(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ui=function(n,u,a,h){return p.extend(Cl(n,u,a),{u_image:0,u_image_height:h})},dc=function(n,u,a,h){var g=n.transform,b=Wl(u,g);return{u_matrix:Jc(n,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/sa(u,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},gf=function(n,u,a,h,g){var b=n.lineAtlas,A=Wl(u,n.transform),L=a.layout.get("line-cap")==="round",V=b.getDash(h.from,L),ee=b.getDash(h.to,L),de=V.width*g.fromScale,_e=ee.width*g.toScale;return p.extend(Cl(n,u,a),{u_patternscale_a:[A/de,-V.height/2],u_patternscale_b:[A/_e,-ee.height/2],u_sdfgamma:b.width/(256*Math.min(de,_e)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:V.y,u_tex_y_b:ee.y,u_mix:g.t})};function Wl(n,u){return 1/sa(n,1,u.tileZoom)}function Jc(n,u,a){return n.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var Rc=function(n,u,a,h,g){return{u_matrix:n,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(A=g.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Xl(g.paint.get("raster-hue-rotate"))};var b,A};function Xl(n){n*=Math.PI/180;var u=Math.sin(n),a=Math.cos(n);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var Yl,ll=function(n,u,a,h,g,b,A,L,V,ee){var de=g.transform;return{u_is_size_zoom_constant:+(n==="constant"||n==="source"),u_is_size_feature_constant:+(n==="constant"||n==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_pitch:de.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:de.width/de.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:A,u_coord_matrix:L,u_is_text:+V,u_pitch_with_map:+h,u_texsize:ee,u_texture:0}},Lu=function(n,u,a,h,g,b,A,L,V,ee,de){var _e=g.transform;return p.extend(ll(n,u,a,h,g,b,A,L,V,ee),{u_gamma_scale:h?Math.cos(_e._pitch)*_e.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+de})},Pl=function(n,u,a,h,g,b,A,L,V,ee){return p.extend(Lu(n,u,a,h,g,b,A,L,!0,V,!0),{u_texsize_icon:ee,u_texture_icon:1})},cl=function(n,u,a){return{u_matrix:n,u_opacity:u,u_color:a}},cu=function(n,u,a,h,g,b){return p.extend(function(A,L,V,ee){var de=V.imageManager.getPattern(A.from.toString()),_e=V.imageManager.getPattern(A.to.toString()),xe=V.imageManager.getPixelSize(),Xe=xe.width,Ge=xe.height,nt=Math.pow(2,ee.tileID.overscaledZ),ke=ee.tileSize*Math.pow(2,V.transform.tileZoom)/nt,rt=ke*(ee.tileID.canonical.x+ee.tileID.wrap*nt),ht=ke*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:de.tl,u_pattern_br_a:de.br,u_pattern_tl_b:_e.tl,u_pattern_br_b:_e.br,u_texsize:[Xe,Ge],u_mix:L.t,u_pattern_size_a:de.displaySize,u_pattern_size_b:_e.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/sa(ee,1,V.transform.tileZoom),u_pixel_coord_upper:[rt>>16,ht>>16],u_pixel_coord_lower:[65535&rt,65535&ht]}}(h,b,a,g),{u_matrix:n,u_opacity:u})},Dc={fillExtrusion:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fillExtrusionPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_lightpos:new p.Uniform3f(n,u.u_lightpos),u_lightintensity:new p.Uniform1f(n,u.u_lightintensity),u_lightcolor:new p.Uniform3f(n,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(n,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(n,u.u_height_factor),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade),u_opacity:new p.Uniform1f(n,u.u_opacity)}},fill:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},fillPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},fillOutline:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world)}},fillOutlinePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_texsize:new p.Uniform2f(n,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},circle:function(n,u){return{u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(n,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},collisionBox:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(n,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(n,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(n,u.u_overscale_factor)}},collisionCircle:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(n,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(n,u.u_viewport_size)}},debug:function(n,u){return{u_color:new p.UniformColor(n,u.u_color),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_overlay:new p.Uniform1i(n,u.u_overlay),u_overlay_scale:new p.Uniform1f(n,u.u_overlay_scale)}},clippingMask:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmap:function(n,u){return{u_extrude_scale:new p.Uniform1f(n,u.u_extrude_scale),u_intensity:new p.Uniform1f(n,u.u_intensity),u_matrix:new p.UniformMatrix4f(n,u.u_matrix)}},heatmapTexture:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_world:new p.Uniform2f(n,u.u_world),u_image:new p.Uniform1i(n,u.u_image),u_color_ramp:new p.Uniform1i(n,u.u_color_ramp),u_opacity:new p.Uniform1f(n,u.u_opacity)}},hillshade:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_latrange:new p.Uniform2f(n,u.u_latrange),u_light:new p.Uniform2f(n,u.u_light),u_shadow:new p.UniformColor(n,u.u_shadow),u_highlight:new p.UniformColor(n,u.u_highlight),u_accent:new p.UniformColor(n,u.u_accent)}},hillshadePrepare:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_image:new p.Uniform1i(n,u.u_image),u_dimension:new p.Uniform2f(n,u.u_dimension),u_zoom:new p.Uniform1f(n,u.u_zoom),u_unpack:new p.Uniform4f(n,u.u_unpack)}},line:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels)}},lineGradient:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_image:new p.Uniform1i(n,u.u_image),u_image_height:new p.Uniform1f(n,u.u_image_height)}},linePattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_texsize:new p.Uniform2f(n,u.u_texsize),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_image:new p.Uniform1i(n,u.u_image),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_scale:new p.Uniform3f(n,u.u_scale),u_fade:new p.Uniform1f(n,u.u_fade)}},lineSDF:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_ratio:new p.Uniform1f(n,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(n,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(n,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(n,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(n,u.u_sdfgamma),u_image:new p.Uniform1i(n,u.u_image),u_tex_y_a:new p.Uniform1f(n,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(n,u.u_tex_y_b),u_mix:new p.Uniform1f(n,u.u_mix)}},raster:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_tl_parent:new p.Uniform2f(n,u.u_tl_parent),u_scale_parent:new p.Uniform1f(n,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(n,u.u_buffer_scale),u_fade_t:new p.Uniform1f(n,u.u_fade_t),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image0:new p.Uniform1i(n,u.u_image0),u_image1:new p.Uniform1i(n,u.u_image1),u_brightness_low:new p.Uniform1f(n,u.u_brightness_low),u_brightness_high:new p.Uniform1f(n,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(n,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(n,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(n,u.u_spin_weights)}},symbolIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture)}},symbolSDF:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texture:new p.Uniform1i(n,u.u_texture),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},symbolTextAndIcon:function(n,u){return{u_is_size_zoom_constant:new p.Uniform1i(n,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(n,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(n,u.u_size_t),u_size:new p.Uniform1f(n,u.u_size),u_camera_to_center_distance:new p.Uniform1f(n,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(n,u.u_pitch),u_rotate_symbol:new p.Uniform1i(n,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(n,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(n,u.u_fade_change),u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(n,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(n,u.u_coord_matrix),u_is_text:new p.Uniform1i(n,u.u_is_text),u_pitch_with_map:new p.Uniform1i(n,u.u_pitch_with_map),u_texsize:new p.Uniform2f(n,u.u_texsize),u_texsize_icon:new p.Uniform2f(n,u.u_texsize_icon),u_texture:new p.Uniform1i(n,u.u_texture),u_texture_icon:new p.Uniform1i(n,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(n,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(n,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(n,u.u_is_halo)}},background:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_color:new p.UniformColor(n,u.u_color)}},backgroundPattern:function(n,u){return{u_matrix:new p.UniformMatrix4f(n,u.u_matrix),u_opacity:new p.Uniform1f(n,u.u_opacity),u_image:new p.Uniform1i(n,u.u_image),u_pattern_tl_a:new p.Uniform2f(n,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(n,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(n,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(n,u.u_pattern_br_b),u_texsize:new p.Uniform2f(n,u.u_texsize),u_mix:new p.Uniform1f(n,u.u_mix),u_pattern_size_a:new p.Uniform2f(n,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(n,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(n,u.u_scale_a),u_scale_b:new p.Uniform1f(n,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(n,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(n,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(n,u.u_tile_units_to_pixels)}}};function Ml(n,u,a,h,g,b,A){for(var L=n.context,V=L.gl,ee=n.useProgram("collisionBox"),de=[],_e=0,xe=0,Xe=0;Xe<h.length;Xe++){var Ge=h[Xe],nt=u.getTile(Ge),ke=nt.getBucket(a);if(ke){var rt=Ge.posMatrix;g[0]===0&&g[1]===0||(rt=n.translatePosMatrix(Ge.posMatrix,nt,g,b));var ht=A?ke.textCollisionBox:ke.iconCollisionBox,Bt=ke.collisionCircleArray;if(Bt.length>0){var or=p.create(),rr=rt;p.mul(or,ke.placementInvProjMatrix,n.transform.glCoordMatrix),p.mul(or,or,ke.placementViewportMatrix),de.push({circleArray:Bt,circleOffset:xe,transform:rr,invTransform:or}),xe=_e+=Bt.length/4}ht&&ee.draw(L,V.LINES,K.disabled,ie.disabled,n.colorModeForRenderPass(),He.disabled,ul(rt,n.transform,nt),a.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,null,n.transform.zoom,null,null,ht.collisionVertexBuffer)}}if(A&&de.length){var lr=n.useProgram("collisionCircle"),Lr=new p.StructArrayLayout2f1f2i16;Lr.resize(4*_e),Lr._trim();for(var rn=0,Yr=0,_n=de;Yr<_n.length;Yr+=1)for(var Bn=_n[Yr],Xn=0;Xn<Bn.circleArray.length/4;Xn++){var Hn=4*Xn,ta=Bn.circleArray[Hn+0],xn=Bn.circleArray[Hn+1],ii=Bn.circleArray[Hn+2],Si=Bn.circleArray[Hn+3];Lr.emplace(rn++,ta,xn,ii,Si,0),Lr.emplace(rn++,ta,xn,ii,Si,1),Lr.emplace(rn++,ta,xn,ii,Si,2),Lr.emplace(rn++,ta,xn,ii,Si,3)}(!Yl||Yl.length<2*_e)&&(Yl=function(ja){var Xo=2*ja,Oo=new p.StructArrayLayout3ui6;Oo.resize(Xo),Oo._trim();for(var Za=0;Za<Xo;Za++){var ho=6*Za;Oo.uint16[ho+0]=4*Za+0,Oo.uint16[ho+1]=4*Za+1,Oo.uint16[ho+2]=4*Za+2,Oo.uint16[ho+3]=4*Za+2,Oo.uint16[ho+4]=4*Za+3,Oo.uint16[ho+5]=4*Za+0}return Oo}(_e));for(var ri=L.createIndexBuffer(Yl,!0),ai=L.createVertexBuffer(Lr,p.collisionCircleLayout.members,!0),wi=0,ni=de;wi<ni.length;wi+=1){var Jn=ni[wi],xo=Hl(Jn.transform,Jn.invTransform,n.transform);lr.draw(L,V.TRIANGLES,K.disabled,ie.disabled,n.colorModeForRenderPass(),He.disabled,xo,a.id,ai,ri,p.SegmentVector.simpleSegment(0,2*Jn.circleOffset,Jn.circleArray.length,Jn.circleArray.length/2),null,n.transform.zoom,null,null,null)}ai.destroy(),ri.destroy()}}var $s=p.identity(new Float32Array(16));function Qc(n,u,a,h,g,b){var A=p.getAnchorAlignment(n),L=-(A.horizontalAlign-.5)*u,V=-(A.verticalAlign-.5)*a,ee=p.evaluateVariableOffset(n,h);return new p.Point((L/g+ee[0])*b,(V/g+ee[1])*b)}function yf(n,u,a,h,g,b,A,L,V,ee,de){var _e=n.text.placedSymbolArray,xe=n.text.dynamicLayoutVertexArray,Xe=n.icon.dynamicLayoutVertexArray,Ge={};xe.clear();for(var nt=0;nt<_e.length;nt++){var ke=_e.get(nt),rt=ke.hidden||!ke.crossTileID||n.allowVerticalPlacement&&!ke.placedOrientation?null:h[ke.crossTileID];if(rt){var ht=new p.Point(ke.anchorX,ke.anchorY),Bt=hi(ht,a?L:A),or=jn(b.cameraToCenterDistance,Bt.signedDistanceFromCamera),rr=g.evaluateSizeForFeature(n.textSizeData,ee,ke)*or/p.ONE_EM;a&&(rr*=n.tilePixelRatio/V);for(var lr=Qc(rt.anchor,rt.width,rt.height,rt.textOffset,rt.textBoxScale,rr),Lr=a?hi(ht.add(lr),A).point:Bt.point.add(u?lr.rotate(-b.angle):lr),rn=n.allowVerticalPlacement&&ke.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Yr=0;Yr<ke.numGlyphs;Yr++)p.addDynamicAttributes(xe,Lr,rn);de&&ke.associatedIconIndex>=0&&(Ge[ke.associatedIconIndex]={shiftedAnchor:Lr,angle:rn})}else Ga(ke.numGlyphs,xe)}if(de){Xe.clear();for(var _n=n.icon.placedSymbolArray,Bn=0;Bn<_n.length;Bn++){var Xn=_n.get(Bn);if(Xn.hidden)Ga(Xn.numGlyphs,Xe);else{var Hn=Ge[Bn];if(Hn)for(var ta=0;ta<Xn.numGlyphs;ta++)p.addDynamicAttributes(Xe,Hn.shiftedAnchor,Hn.angle);else Ga(Xn.numGlyphs,Xe)}}n.icon.dynamicLayoutVertexBuffer.updateData(Xe)}n.text.dynamicLayoutVertexBuffer.updateData(xe)}function qc(n,u,a){return a.iconsInText&&u?"symbolTextAndIcon":n?"symbolSDF":"symbolIcon"}function ba(n,u,a,h,g,b,A,L,V,ee,de,_e){for(var xe=n.context,Xe=xe.gl,Ge=n.transform,nt=L==="map",ke=V==="map",rt=nt&&a.layout.get("symbol-placement")!=="point",ht=nt&&!ke&&!rt,Bt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,or=!1,rr=n.depthModeForSublayer(0,K.ReadOnly),lr=a.layout.get("text-variable-anchor"),Lr=[],rn=0,Yr=h;rn<Yr.length;rn+=1){var _n=Yr[rn],Bn=u.getTile(_n),Xn=Bn.getBucket(a);if(Xn){var Hn=g?Xn.text:Xn.icon;if(Hn&&Hn.segments.get().length){var ta=Hn.programConfigurations.get(a.id),xn=g||Xn.sdfIcons,ii=g?Xn.textSizeData:Xn.iconSizeData,Si=ke||Ge.pitch!==0,ri=n.useProgram(qc(xn,g,Xn),ta),ai=p.evaluateSizeForZoom(ii,Ge.zoom),wi=void 0,ni=[0,0],Jn=void 0,xo=void 0,ja=null,Xo=void 0;if(g)Jn=Bn.glyphAtlasTexture,xo=Xe.LINEAR,wi=Bn.glyphAtlasTexture.size,Xn.iconsInText&&(ni=Bn.imageAtlasTexture.size,ja=Bn.imageAtlasTexture,Xo=Si||n.options.rotating||n.options.zooming||ii.kind==="composite"||ii.kind==="camera"?Xe.LINEAR:Xe.NEAREST);else{var Oo=a.layout.get("icon-size").constantOr(0)!==1||Xn.iconsNeedLinear;Jn=Bn.imageAtlasTexture,xo=xn||n.options.rotating||n.options.zooming||Oo||Si?Xe.LINEAR:Xe.NEAREST,wi=Bn.imageAtlasTexture.size}var Za=sa(Bn,1,n.transform.zoom),ho=Rn(_n.posMatrix,ke,nt,n.transform,Za),Ss=Dn(_n.posMatrix,ke,nt,n.transform,Za),Yo=lr&&Xn.hasTextData(),Zu=a.layout.get("icon-text-fit")!=="none"&&Yo&&Xn.hasIconData();rt&&hs(Xn,_n.posMatrix,n,g,ho,Ss,ke,ee);var us=n.translatePosMatrix(_n.posMatrix,Bn,b,A),Ls=rt||g&&lr||Zu?$s:ho,Rs=n.translatePosMatrix(Ss,Bn,b,A,!0),ml=xn&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,gl={program:ri,buffers:Hn,uniformValues:xn?Xn.iconsInText?Pl(ii.kind,ai,ht,ke,n,us,Ls,Rs,wi,ni):Lu(ii.kind,ai,ht,ke,n,us,Ls,Rs,g,wi,!0):ll(ii.kind,ai,ht,ke,n,us,Ls,Rs,g,wi),atlasTexture:Jn,atlasTextureIcon:ja,atlasInterpolation:xo,atlasInterpolationIcon:Xo,isSDF:xn,hasHalo:ml};if(Bt&&Xn.canOverlap){or=!0;for(var Ws=0,rl=Hn.segments.get();Ws<rl.length;Ws+=1){var Bl=rl[Ws];Lr.push({segments:new p.SegmentVector([Bl]),sortKey:Bl.sortKey,state:gl})}}else Lr.push({segments:Hn.segments,sortKey:0,state:gl})}}}or&&Lr.sort(function(Cu,Es){return Cu.sortKey-Es.sortKey});for(var tu=0,nl=Lr;tu<nl.length;tu+=1){var ru=nl[tu],io=ru.state;if(xe.activeTexture.set(Xe.TEXTURE0),io.atlasTexture.bind(io.atlasInterpolation,Xe.CLAMP_TO_EDGE),io.atlasTextureIcon&&(xe.activeTexture.set(Xe.TEXTURE1),io.atlasTextureIcon&&io.atlasTextureIcon.bind(io.atlasInterpolationIcon,Xe.CLAMP_TO_EDGE)),io.isSDF){var Vu=io.uniformValues;io.hasHalo&&(Vu.u_is_halo=1,Il(io.buffers,ru.segments,a,n,io.program,rr,de,_e,Vu)),Vu.u_is_halo=0}Il(io.buffers,ru.segments,a,n,io.program,rr,de,_e,io.uniformValues)}}function Il(n,u,a,h,g,b,A,L,V){var ee=h.context;g.draw(ee,ee.gl.TRIANGLES,b,A,L,He.disabled,V,a.id,n.layoutVertexBuffer,n.indexBuffer,u,a.paint,h.transform.zoom,n.programConfigurations.get(a.id),n.dynamicLayoutVertexBuffer,n.opacityVertexBuffer)}function Ol(n,u,a,h,g,b,A){var L,V,ee,de,_e,xe=n.context.gl,Xe=a.paint.get("fill-pattern"),Ge=Xe&&Xe.constantOr(1),nt=a.getCrossfadeParameters();A?(V=Ge&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=xe.LINES):(V=Ge?"fillPattern":"fill",L=xe.TRIANGLES);for(var ke=0,rt=h;ke<rt.length;ke+=1){var ht=rt[ke],Bt=u.getTile(ht);if(!Ge||Bt.patternsLoaded()){var or=Bt.getBucket(a);if(or){var rr=or.programConfigurations.get(a.id),lr=n.useProgram(V,rr);Ge&&(n.context.activeTexture.set(xe.TEXTURE0),Bt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),rr.updatePaintBuffers(nt));var Lr=Xe.constantOr(null);if(Lr&&Bt.imageAtlas){var rn=Bt.imageAtlas,Yr=rn.patternPositions[Lr.to.toString()],_n=rn.patternPositions[Lr.from.toString()];Yr&&_n&&rr.setConstantPatternPositions(Yr,_n)}var Bn=n.translatePosMatrix(ht.posMatrix,Bt,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(A){de=or.indexBuffer2,_e=or.segments2;var Xn=[xe.drawingBufferWidth,xe.drawingBufferHeight];ee=V==="fillOutlinePattern"&&Ge?Tl(Bn,n,nt,Bt,Xn):Lc(Bn,Xn)}else de=or.indexBuffer,_e=or.segments,ee=Ge?Ua(Bn,n,nt,Bt):$u(Bn);lr.draw(n.context,L,g,n.stencilModeForClipping(ht),b,He.disabled,ee,a.id,or.layoutVertexBuffer,de,_e,a.paint,n.transform.zoom,rr)}}}}function Ru(n,u,a,h,g,b,A){for(var L=n.context,V=L.gl,ee=a.paint.get("fill-extrusion-pattern"),de=ee.constantOr(1),_e=a.getCrossfadeParameters(),xe=a.paint.get("fill-extrusion-opacity"),Xe=0,Ge=h;Xe<Ge.length;Xe+=1){var nt=Ge[Xe],ke=u.getTile(nt),rt=ke.getBucket(a);if(rt){var ht=rt.programConfigurations.get(a.id),Bt=n.useProgram(de?"fillExtrusionPattern":"fillExtrusion",ht);de&&(n.context.activeTexture.set(V.TEXTURE0),ke.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ht.updatePaintBuffers(_e));var or=ee.constantOr(null);if(or&&ke.imageAtlas){var rr=ke.imageAtlas,lr=rr.patternPositions[or.to.toString()],Lr=rr.patternPositions[or.from.toString()];lr&&Lr&&ht.setConstantPatternPositions(lr,Lr)}var rn=n.translatePosMatrix(nt.posMatrix,ke,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Yr=a.paint.get("fill-extrusion-vertical-gradient"),_n=de?yu(rn,n,Yr,xe,nt,_e,ke):ro(rn,n,Yr,xe);Bt.draw(L,L.gl.TRIANGLES,g,b,A,He.backCCW,_n,a.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,a.paint,n.transform.zoom,ht)}}}function fl(n,u,a,h,g,b){var A=n.context,L=A.gl,V=u.fbo;if(V){var ee=n.useProgram("hillshade");A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,V.colorAttachment.get());var de=function(_e,xe,Xe){var Ge=Xe.paint.get("hillshade-shadow-color"),nt=Xe.paint.get("hillshade-highlight-color"),ke=Xe.paint.get("hillshade-accent-color"),rt=Xe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Xe.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=_e.transform.angle);var ht,Bt,or,rr=!_e.options.moving;return{u_matrix:_e.transform.calculatePosMatrix(xe.tileID.toUnwrapped(),rr),u_image:0,u_latrange:(ht=xe.tileID,Bt=Math.pow(2,ht.canonical.z),or=ht.canonical.y,[new p.MercatorCoordinate(0,or/Bt).toLngLat().lat,new p.MercatorCoordinate(0,(or+1)/Bt).toLngLat().lat]),u_light:[Xe.paint.get("hillshade-exaggeration"),rt],u_shadow:Ge,u_highlight:nt,u_accent:ke}}(n,u,a);ee.draw(A,L.TRIANGLES,h,g,b,He.disabled,de,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}}function vc(n,u,a,h,g,b){var A=n.context,L=A.gl,V=u.dem;if(V&&V.data){var ee=V.dim,de=V.stride,_e=V.getPixels();if(A.activeTexture.set(L.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||n.getTileTexture(de),u.demTexture){var xe=u.demTexture;xe.update(_e,{premultiply:!1}),xe.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(A,_e,L.RGBA,{premultiply:!1}),u.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);A.activeTexture.set(L.TEXTURE0);var Xe=u.fbo;if(!Xe){var Ge=new p.Texture(A,{width:ee,height:ee,data:null},L.RGBA);Ge.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Xe=u.fbo=A.createFramebuffer(ee,ee,!0)).colorAttachment.set(Ge.texture)}A.bindFramebuffer.set(Xe.framebuffer),A.viewport.set([0,0,ee,ee]),n.useProgram("hillshadePrepare").draw(A,L.TRIANGLES,h,g,b,He.disabled,function(nt,ke){var rt=ke.stride,ht=p.create();return p.ortho(ht,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(ht,ht,[0,-p.EXTENT,0]),{u_matrix:ht,u_image:1,u_dimension:[rt,rt],u_zoom:nt.overscaledZ,u_unpack:ke.getUnpackVector()}}(u.tileID,V),a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Du(n,u,a,h,g){var b=h.paint.get("raster-fade-duration");if(b>0){var A=p.browser.now(),L=(A-n.timeAdded)/b,V=u?(A-u.timeAdded)/b:-1,ee=a.getSource(),de=g.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),_e=!u||Math.abs(u.tileID.overscaledZ-de)>Math.abs(n.tileID.overscaledZ-de),xe=_e&&n.refreshedUponExpiration?1:p.clamp(_e?L:1-V,0,1);return n.refreshedUponExpiration&&L>=1&&(n.refreshedUponExpiration=!1),u?{opacity:1,mix:1-xe}:{opacity:xe,mix:0}}return{opacity:1,mix:0}}var kc=new p.Color(1,0,0,1),ef=new p.Color(0,1,0,1),tf=new p.Color(0,0,1,1),Ll=new p.Color(1,0,1,1),zc=new p.Color(0,1,1,1);function Fc(n,u,a,h){hl(n,0,u+a/2,n.transform.width,a,h)}function Nc(n,u,a,h){hl(n,u-a/2,0,a,n.transform.height,h)}function hl(n,u,a,h,g,b){var A=n.context,L=A.gl;L.enable(L.SCISSOR_TEST),L.scissor(u*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),A.clear({color:b}),L.disable(L.SCISSOR_TEST)}function Bc(n,u,a){var h=n.context,g=h.gl,b=a.posMatrix,A=n.useProgram("debug"),L=K.disabled,V=ie.disabled,ee=n.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),n.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),A.draw(h,g.LINE_STRIP,L,V,ee,He.disabled,Ju(b,p.Color.red),"$debug",n.debugBuffer,n.tileBorderIndexBuffer,n.debugSegments);var de=u.getTileByID(a.key).latestRawTileData,_e=Math.floor((de&&de.byteLength||0)/1024),xe=u.getTile(a).tileSize,Xe=512/Math.min(xe,512)*(a.overscaledZ/n.transform.zoom)*.5,Ge=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ge+=" => "+a.overscaledZ),function(nt,ke){nt.initDebugOverlayCanvas();var rt=nt.debugOverlayCanvas,ht=nt.context.gl,Bt=nt.debugOverlayCanvas.getContext("2d");Bt.clearRect(0,0,rt.width,rt.height),Bt.shadowColor="white",Bt.shadowBlur=2,Bt.lineWidth=1.5,Bt.strokeStyle="white",Bt.textBaseline="top",Bt.font="bold 36px Open Sans, sans-serif",Bt.fillText(ke,5,5),Bt.strokeText(ke,5,5),nt.debugOverlayTexture.update(rt),nt.debugOverlayTexture.bind(ht.LINEAR,ht.CLAMP_TO_EDGE)}(n,Ge+" "+_e+"kb"),A.draw(h,g.TRIANGLES,L,V,Oe.alphaBlended,He.disabled,Ju(b,p.Color.transparent,Xe),"$debug",n.debugBuffer,n.quadTriangleIndexBuffer,n.debugSegments)}var ku={symbol:function(n,u,a,h,g){if(n.renderPass==="translucent"){var b=ie.disabled,A=n.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(L,V,ee,de,_e,xe,Xe){for(var Ge=V.transform,nt=_e==="map",ke=xe==="map",rt=0,ht=L;rt<ht.length;rt+=1){var Bt=ht[rt],or=de.getTile(Bt),rr=or.getBucket(ee);if(rr&&rr.text&&rr.text.segments.get().length){var lr=p.evaluateSizeForZoom(rr.textSizeData,Ge.zoom),Lr=sa(or,1,V.transform.zoom),rn=Rn(Bt.posMatrix,ke,nt,V.transform,Lr),Yr=ee.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if(lr){var _n=Math.pow(2,Ge.zoom-or.tileID.overscaledZ);yf(rr,nt,ke,Xe,p.symbolSize,Ge,rn,Bt.posMatrix,_n,lr,Yr)}}}}(h,n,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&ba(n,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),b,A),a.paint.get("text-opacity").constantOr(1)!==0&&ba(n,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),b,A),u.map.showCollisionBoxes&&(Ml(n,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Ml(n,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),A=a.paint.get("circle-stroke-opacity"),L=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||b.constantOr(1)!==0&&A.constantOr(1)!==0){for(var V=n.context,ee=V.gl,de=n.depthModeForSublayer(0,K.ReadOnly),_e=ie.disabled,xe=n.colorModeForRenderPass(),Xe=[],Ge=0;Ge<h.length;Ge++){var nt=h[Ge],ke=u.getTile(nt),rt=ke.getBucket(a);if(rt){var ht=rt.programConfigurations.get(a.id),Bt={programConfiguration:ht,program:n.useProgram("circle",ht),layoutVertexBuffer:rt.layoutVertexBuffer,indexBuffer:rt.indexBuffer,uniformValues:Ou(n,nt,ke,a)};if(L)for(var or=0,rr=rt.segments.get();or<rr.length;or+=1){var lr=rr[or];Xe.push({segments:new p.SegmentVector([lr]),sortKey:lr.sortKey,state:Bt})}else Xe.push({segments:rt.segments,sortKey:0,state:Bt})}}L&&Xe.sort(function(Bn,Xn){return Bn.sortKey-Xn.sortKey});for(var Lr=0,rn=Xe;Lr<rn.length;Lr+=1){var Yr=rn[Lr],_n=Yr.state;_n.program.draw(V,ee.TRIANGLES,de,_e,xe,He.disabled,_n.uniformValues,a.id,_n.layoutVertexBuffer,_n.indexBuffer,Yr.segments,a.paint,n.transform.zoom,_n.programConfiguration)}}}},heatmap:function(n,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(n.renderPass==="offscreen"){var g=n.context,b=g.gl,A=ie.disabled,L=new Oe([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Xe,Ge,nt){var ke=Xe.gl;Xe.activeTexture.set(ke.TEXTURE1),Xe.viewport.set([0,0,Ge.width/4,Ge.height/4]);var rt=nt.heatmapFbo;if(rt)ke.bindTexture(ke.TEXTURE_2D,rt.colorAttachment.get()),Xe.bindFramebuffer.set(rt.framebuffer);else{var ht=ke.createTexture();ke.bindTexture(ke.TEXTURE_2D,ht),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_S,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_WRAP_T,ke.CLAMP_TO_EDGE),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MIN_FILTER,ke.LINEAR),ke.texParameteri(ke.TEXTURE_2D,ke.TEXTURE_MAG_FILTER,ke.LINEAR),rt=nt.heatmapFbo=Xe.createFramebuffer(Ge.width/4,Ge.height/4,!1),function(Bt,or,rr,lr){var Lr=Bt.gl;Lr.texImage2D(Lr.TEXTURE_2D,0,Lr.RGBA,or.width/4,or.height/4,0,Lr.RGBA,Bt.extRenderToTextureHalfFloat?Bt.extTextureHalfFloat.HALF_FLOAT_OES:Lr.UNSIGNED_BYTE,null),lr.colorAttachment.set(rr)}(Xe,Ge,ht,rt)}})(g,n,a),g.clear({color:p.Color.transparent});for(var V=0;V<h.length;V++){var ee=h[V];if(!u.hasRenderableParent(ee)){var de=u.getTile(ee),_e=de.getBucket(a);if(_e){var xe=_e.programConfigurations.get(a.id);n.useProgram("heatmap",xe).draw(g,b.TRIANGLES,K.disabled,A,L,He.disabled,Al(ee.posMatrix,de,n.transform.zoom,a.paint.get("heatmap-intensity")),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,n.transform.zoom,xe)}}}g.viewport.set([0,0,n.width,n.height])}else n.renderPass==="translucent"&&(n.context.setColorMode(n.colorModeForRenderPass()),function(Xe,Ge){var nt=Xe.context,ke=nt.gl,rt=Ge.heatmapFbo;if(rt){nt.activeTexture.set(ke.TEXTURE0),ke.bindTexture(ke.TEXTURE_2D,rt.colorAttachment.get()),nt.activeTexture.set(ke.TEXTURE1);var ht=Ge.colorRampTexture;ht||(ht=Ge.colorRampTexture=new p.Texture(nt,Ge.colorRamp,ke.RGBA)),ht.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),Xe.useProgram("heatmapTexture").draw(nt,ke.TRIANGLES,K.disabled,ie.disabled,Xe.colorModeForRenderPass(),He.disabled,function(Bt,or,rr,lr){var Lr=p.create();p.ortho(Lr,0,Bt.width,Bt.height,0,0,1);var rn=Bt.context.gl;return{u_matrix:Lr,u_world:[rn.drawingBufferWidth,rn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:or.paint.get("heatmap-opacity")}}(Xe,Ge),Ge.id,Xe.viewportBuffer,Xe.quadTriangleIndexBuffer,Xe.viewportSegments,Ge.paint,Xe.transform.zoom)}}(n,a))},line:function(n,u,a,h){if(n.renderPass==="translucent"){var g=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(g.constantOr(1)!==0&&b.constantOr(1)!==0)for(var A=n.depthModeForSublayer(0,K.ReadOnly),L=n.colorModeForRenderPass(),V=a.paint.get("line-dasharray"),ee=a.paint.get("line-pattern"),de=ee.constantOr(1),_e=a.paint.get("line-gradient"),xe=a.getCrossfadeParameters(),Xe=de?"linePattern":V?"lineSDF":_e?"lineGradient":"line",Ge=n.context,nt=Ge.gl,ke=!0,rt=0,ht=h;rt<ht.length;rt+=1){var Bt=ht[rt],or=u.getTile(Bt);if(!de||or.patternsLoaded()){var rr=or.getBucket(a);if(rr){var lr=rr.programConfigurations.get(a.id),Lr=n.context.program.get(),rn=n.useProgram(Xe,lr),Yr=ke||rn.program!==Lr,_n=ee.constantOr(null);if(_n&&or.imageAtlas){var Bn=or.imageAtlas,Xn=Bn.patternPositions[_n.to.toString()],Hn=Bn.patternPositions[_n.from.toString()];Xn&&Hn&&lr.setConstantPatternPositions(Xn,Hn)}var ta=de?dc(n,or,a,xe):V?gf(n,or,a,V,xe):_e?Ui(n,or,a,rr.lineClipsArray.length):Cl(n,or,a);if(de)Ge.activeTexture.set(nt.TEXTURE0),or.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),lr.updatePaintBuffers(xe);else if(V&&(Yr||n.lineAtlas.dirty))Ge.activeTexture.set(nt.TEXTURE0),n.lineAtlas.bind(Ge);else if(_e){var xn=rr.gradients[a.id],ii=xn.texture;if(a.gradientVersion!==xn.version){var Si=256;if(a.stepInterpolant){var ri=u.getSource().maxzoom,ai=Bt.canonical.z===ri?Math.ceil(1<<n.transform.maxZoom-Bt.canonical.z):1;Si=p.clamp(p.nextPowerOfTwo(rr.maxLineLength/p.EXTENT*1024*ai),256,Ge.maxTextureSize)}xn.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:xn.gradient||void 0,clips:rr.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new p.Texture(Ge,xn.gradient,nt.RGBA),xn.version=a.gradientVersion,ii=xn.texture}Ge.activeTexture.set(nt.TEXTURE0),ii.bind(a.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}rn.draw(Ge,nt.TRIANGLES,A,n.stencilModeForClipping(Bt),L,He.disabled,ta,a.id,rr.layoutVertexBuffer,rr.indexBuffer,rr.segments,a.paint,n.transform.zoom,lr,rr.layoutVertexBuffer2),ke=!1}}}}},fill:function(n,u,a,h){var g=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)!==0){var A=n.colorModeForRenderPass(),L=a.paint.get("fill-pattern"),V=n.opaquePassEnabledForLayer()&&!L.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(n.renderPass===V){var ee=n.depthModeForSublayer(1,n.renderPass==="opaque"?K.ReadWrite:K.ReadOnly);Ol(n,u,a,h,ee,A,!1)}if(n.renderPass==="translucent"&&a.paint.get("fill-antialias")){var de=n.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,K.ReadOnly);Ol(n,u,a,h,de,A,!0)}}},"fill-extrusion":function(n,u,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&n.renderPass==="translucent"){var b=new K(n.context.gl.LEQUAL,K.ReadWrite,n.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Ru(n,u,a,h,b,ie.disabled,Oe.disabled),Ru(n,u,a,h,b,n.stencilModeFor3D(),n.colorModeForRenderPass());else{var A=n.colorModeForRenderPass();Ru(n,u,a,h,b,ie.disabled,A)}}},hillshade:function(n,u,a,h){if(n.renderPass==="offscreen"||n.renderPass==="translucent"){for(var g=n.context,b=n.depthModeForSublayer(0,K.ReadOnly),A=n.colorModeForRenderPass(),L=n.renderPass==="translucent"?n.stencilConfigForOverlap(h):[{},h],V=L[0],ee=0,de=L[1];ee<de.length;ee+=1){var _e=de[ee],xe=u.getTile(_e);xe.needsHillshadePrepare&&n.renderPass==="offscreen"?vc(n,xe,a,b,ie.disabled,A):n.renderPass==="translucent"&&fl(n,xe,a,b,V[_e.overscaledZ],A)}g.viewport.set([0,0,n.width,n.height])}},raster:function(n,u,a,h){if(n.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=n.context,b=g.gl,A=u.getSource(),L=n.useProgram("raster"),V=n.colorModeForRenderPass(),ee=A instanceof Te?[{},h]:n.stencilConfigForOverlap(h),de=ee[0],_e=ee[1],xe=_e[_e.length-1].overscaledZ,Xe=!n.options.moving,Ge=0,nt=_e;Ge<nt.length;Ge+=1){var ke=nt[Ge],rt=n.depthModeForSublayer(ke.overscaledZ-xe,a.paint.get("raster-opacity")===1?K.ReadWrite:K.ReadOnly,b.LESS),ht=u.getTile(ke),Bt=n.transform.calculatePosMatrix(ke.toUnwrapped(),Xe);ht.registerFadeDuration(a.paint.get("raster-fade-duration"));var or=u.findLoadedParent(ke,0),rr=Du(ht,or,u,a,n.transform),lr=void 0,Lr=void 0,rn=a.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),ht.texture.bind(rn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),or?(or.texture.bind(rn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),lr=Math.pow(2,or.tileID.overscaledZ-ht.tileID.overscaledZ),Lr=[ht.tileID.canonical.x*lr%1,ht.tileID.canonical.y*lr%1]):ht.texture.bind(rn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var Yr=Rc(Bt,Lr||[0,0],lr||1,rr,a);A instanceof Te?L.draw(g,b.TRIANGLES,rt,ie.disabled,V,He.disabled,Yr,a.id,A.boundsBuffer,n.quadTriangleIndexBuffer,A.boundsSegments):L.draw(g,b.TRIANGLES,rt,de[ke.overscaledZ],V,He.disabled,Yr,a.id,n.rasterBoundsBuffer,n.quadTriangleIndexBuffer,n.rasterBoundsSegments)}},background:function(n,u,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var b=n.context,A=b.gl,L=n.transform,V=L.tileSize,ee=a.paint.get("background-pattern");if(!n.isPatternMissing(ee)){var de=!ee&&h.a===1&&g===1&&n.opaquePassEnabledForLayer()?"opaque":"translucent";if(n.renderPass===de){var _e=ie.disabled,xe=n.depthModeForSublayer(0,de==="opaque"?K.ReadWrite:K.ReadOnly),Xe=n.colorModeForRenderPass(),Ge=n.useProgram(ee?"backgroundPattern":"background"),nt=L.coveringTiles({tileSize:V});ee&&(b.activeTexture.set(A.TEXTURE0),n.imageManager.bind(n.context));for(var ke=a.getCrossfadeParameters(),rt=0,ht=nt;rt<ht.length;rt+=1){var Bt=ht[rt],or=n.transform.calculatePosMatrix(Bt.toUnwrapped()),rr=ee?cu(or,g,n,ee,{tileID:Bt,tileSize:V},ke):cl(or,g,h);Ge.draw(b,A.TRIANGLES,xe,_e,Xe,He.disabled,rr,a.id,n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments)}}}}},debug:function(n,u,a){for(var h=0;h<a.length;h++)Bc(n,u,a[h])},custom:function(n,u,a){var h=n.context,g=a.implementation;if(n.renderPass==="offscreen"){var b=g.prerender;b&&(n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),b.call(g,h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState())}else if(n.renderPass==="translucent"){n.setCustomLayerDefaults(),h.setColorMode(n.colorModeForRenderPass()),h.setStencilMode(ie.disabled);var A=g.renderingMode==="3d"?new K(n.context.gl.LEQUAL,K.ReadWrite,n.depthRangeFor3D):n.depthModeForSublayer(0,K.ReadOnly);h.setDepthMode(A),g.render(h.gl,n.transform.customLayerMatrix()),h.setDirty(),n.setBaseState(),h.bindFramebuffer.set(null)}}},Ma=function(n,u){this.context=new ue(n),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=De.maxUnderzooming+De.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new uo,this.gpuTimers={}};Ma.prototype.resize=function(n,u){if(this.width=n*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},Ma.prototype.setup=function(){var n=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(u,zn.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=n.createVertexBuffer(a,zn.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(h,me.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(g,zn.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var b=new p.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(b);var A=new p.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new p.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new ie({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Ma.prototype.clearStencil=function(){var n=this.context,u=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,u.TRIANGLES,K.disabled,this.stencilClearMode,Oe.disabled,He.disabled,Is(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ma.prototype._renderTileClippingMasks=function(n,u){if(this.currentStencilSource!==n.source&&n.isTileClipped()&&u&&u.length){this.currentStencilSource=n.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(Oe.disabled),a.setDepthMode(K.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,A=u;b<A.length;b+=1){var L=A[b],V=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,K.disabled,new ie({func:h.ALWAYS,mask:0},V,255,h.KEEP,h.KEEP,h.REPLACE),Oe.disabled,He.disabled,Is(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ma.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var n=this.nextStencilID++,u=this.context.gl;return new ie({func:u.NOTEQUAL,mask:255},n,255,u.KEEP,u.KEEP,u.REPLACE)},Ma.prototype.stencilModeForClipping=function(n){var u=this.context.gl;return new ie({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,u.KEEP,u.KEEP,u.REPLACE)},Ma.prototype.stencilConfigForOverlap=function(n){var u,a=this.context.gl,h=n.sort(function(V,ee){return ee.overscaledZ-V.overscaledZ}),g=h[h.length-1].overscaledZ,b=h[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var A={},L=0;L<b;L++)A[L+g]=new ie({func:a.GEQUAL,mask:255},L+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[A,h]}return[(u={},u[g]=ie.disabled,u),h]},Ma.prototype.colorModeForRenderPass=function(){var n=this.context.gl;return this._showOverdrawInspector?new Oe([n.CONSTANT_COLOR,n.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oe.unblended:Oe.alphaBlended},Ma.prototype.depthModeForSublayer=function(n,u,a){if(!this.opaquePassEnabledForLayer())return K.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new K(a||this.context.gl.LEQUAL,u,[h,h])},Ma.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ma.prototype.render=function(n,u){var a=this;this.style=n,this.options=u,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var b in g){var A=g[b];A.used&&A.prepare(this.context)}var L,V,ee={},de={},_e={};for(var xe in g){var Xe=g[xe];ee[xe]=Xe.getVisibleCoordinates(),de[xe]=ee[xe].slice().reverse(),_e[xe]=Xe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ge=0;Ge<h.length;Ge++)if(this.style._layers[h[Ge]].is3D()){this.opaquePassCutoff=Ge;break}this.renderPass="offscreen";for(var nt=0,ke=h;nt<ke.length;nt+=1){var rt=this.style._layers[ke[nt]];if(rt.hasOffscreenPass()&&!rt.isHidden(this.transform.zoom)){var ht=de[rt.source];(rt.type==="custom"||ht.length)&&this.renderLayer(this,g[rt.source],rt,ht)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Bt=this.style._layers[h[this.currentLayer]],or=g[Bt.source],rr=ee[Bt.source];this._renderTileClippingMasks(Bt,rr),this.renderLayer(this,or,Bt,rr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var lr=this.style._layers[h[this.currentLayer]],Lr=g[lr.source],rn=(lr.type==="symbol"?_e:de)[lr.source];this._renderTileClippingMasks(lr,ee[lr.source]),this.renderLayer(this,Lr,lr,rn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Yr){Yr.source&&!Yr.isHidden(a.transform.zoom)&&(Yr.source!==(V&&V.id)&&(V=a.style.sourceCaches[Yr.source]),(!L||L.getSource().maxzoom<V.getSource().maxzoom)&&(L=V))}),L&&ku.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Yr){var _n=Yr.transform.padding;Fc(Yr,Yr.transform.height-(_n.top||0),3,kc),Fc(Yr,_n.bottom||0,3,ef),Nc(Yr,_n.left||0,3,tf),Nc(Yr,Yr.transform.width-(_n.right||0),3,Ll);var Bn=Yr.transform.centerPoint;(function(Xn,Hn,ta,xn){hl(Xn,Hn-1,ta-10,2,20,xn),hl(Xn,Hn-10,ta-1,20,2,xn)})(Yr,Bn.x,Yr.transform.height-Bn.y,zc)}(this),this.context.setDefault()},Ma.prototype.renderLayer=function(n,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),ku[a.type](n,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ma.prototype.gpuTimingStart=function(n){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[n.id];a||(a=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},Ma.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}},Ma.prototype.collectGpuTimers=function(){var n=this.gpuTimers;return this.gpuTimers={},n},Ma.prototype.queryGpuTimers=function(n){var u={};for(var a in n){var h=n[a],g=this.context.extTimerQuery,b=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[a]=b}return u},Ma.prototype.translatePosMatrix=function(n,u,a,h,g){if(!a[0]&&!a[1])return n;var b=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var A=Math.sin(b),L=Math.cos(b);a=[a[0]*L-a[1]*A,a[0]*A+a[1]*L]}var V=[g?a[0]:sa(u,a[0],this.transform.zoom),g?a[1]:sa(u,a[1],this.transform.zoom),0],ee=new Float32Array(16);return p.translate(ee,n,V),ee},Ma.prototype.saveTileTexture=function(n){var u=this._tileTextures[n.size[0]];u?u.push(n):this._tileTextures[n.size[0]]=[n]},Ma.prototype.getTileTexture=function(n){var u=this._tileTextures[n];return u&&u.length>0?u.pop():null},Ma.prototype.isPatternMissing=function(n){if(!n)return!1;if(!n.from||!n.to)return!0;var u=this.imageManager.getPattern(n.from.toString()),a=this.imageManager.getPattern(n.to.toString());return!u||!a},Ma.prototype.useProgram=function(n,u){this.cache=this.cache||{};var a=""+n+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new Ic(this.context,n,mf[n],u,Dc[n],this._showOverdrawInspector)),this.cache[a]},Ma.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ma.prototype.setBaseState=function(){var n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)},Ma.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ma.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Kl=function(n,u){this.points=n,this.planes=u};Kl.fromInvProjectionMatrix=function(n,u,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(A){return p.transformMat4([],A,n)}).map(function(A){return p.scale$1([],A,1/A[3]/u*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(A){var L=p.sub([],g[A[0]],g[A[1]]),V=p.sub([],g[A[2]],g[A[1]]),ee=p.normalize([],p.cross([],L,V)),de=-p.dot(ee,g[A[1]]);return ee.concat(de)});return new Kl(g,b)};var Ka=function(n,u){this.min=n,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Ka.prototype.quadrant=function(n){for(var u=[n%2==0,n<2],a=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<u.length;g++)a[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Ka(a,h)},Ka.prototype.distanceX=function(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]},Ka.prototype.distanceY=function(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]},Ka.prototype.intersects=function(n){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<n.planes.length;h++){for(var g=n.planes[h],b=0,A=0;A<u.length;A++)b+=p.dot$1(g,u[A])>=0;if(b===0)return 0;b!==u.length&&(a=!1)}if(a)return 2;for(var L=0;L<3;L++){for(var V=Number.MAX_VALUE,ee=-Number.MAX_VALUE,de=0;de<n.points.length;de++){var _e=n.points[de][L]-this.min[L];V=Math.min(V,_e),ee=Math.max(ee,_e)}if(ee<0||V>this.max[L]-this.min[L])return 0}return 1};var Qu=function(n,u,a,h){if(n===void 0&&(n=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(n)||n<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=u,this.left=a,this.right=h};Qu.prototype.interpolate=function(n,u,a){return u.top!=null&&n.top!=null&&(this.top=p.number(n.top,u.top,a)),u.bottom!=null&&n.bottom!=null&&(this.bottom=p.number(n.bottom,u.bottom,a)),u.left!=null&&n.left!=null&&(this.left=p.number(n.left,u.left,a)),u.right!=null&&n.right!=null&&(this.right=p.number(n.right,u.right,a)),this},Qu.prototype.getCenter=function(n,u){var a=p.clamp((this.left+n-this.right)/2,0,n),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(a,h)},Qu.prototype.equals=function(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right},Qu.prototype.clone=function(){return new Qu(this.top,this.bottom,this.left,this.right)},Qu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Fi=function(n,u,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=n||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ta={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Fi.prototype.clone=function(){var n=new Fi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n},Ta.minZoom.get=function(){return this._minZoom},Ta.minZoom.set=function(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))},Ta.maxZoom.get=function(){return this._maxZoom},Ta.maxZoom.set=function(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))},Ta.minPitch.get=function(){return this._minPitch},Ta.minPitch.set=function(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))},Ta.maxPitch.get=function(){return this._maxPitch},Ta.maxPitch.set=function(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))},Ta.renderWorldCopies.get=function(){return this._renderWorldCopies},Ta.renderWorldCopies.set=function(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n},Ta.worldSize.get=function(){return this.tileSize*this.scale},Ta.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ta.size.get=function(){return new p.Point(this.width,this.height)},Ta.bearing.get=function(){return-this.angle/Math.PI*180},Ta.bearing.set=function(n){var u=-p.wrap(n,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ta.pitch.get=function(){return this._pitch/Math.PI*180},Ta.pitch.set=function(n){var u=p.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ta.fov.get=function(){return this._fov/Math.PI*180},Ta.fov.set=function(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())},Ta.zoom.get=function(){return this._zoom},Ta.zoom.set=function(n){var u=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ta.center.get=function(){return this._center},Ta.center.set=function(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())},Ta.padding.get=function(){return this._edgeInsets.toJSON()},Ta.padding.set=function(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())},Ta.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Fi.prototype.isPaddingEqual=function(n){return this._edgeInsets.equals(n)},Fi.prototype.interpolatePadding=function(n,u,a){this._unmodified=!1,this._edgeInsets.interpolate(n,u,a),this._constrain(),this._calcMatrices()},Fi.prototype.coveringZoomLevel=function(n){var u=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,u)},Fi.prototype.getVisibleUnwrappedCoordinates=function(n){var u=[new p.UnwrappedTileID(0,n)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),b=this.pointCoordinate(new p.Point(0,this.height)),A=Math.floor(Math.min(a.x,h.x,g.x,b.x)),L=Math.floor(Math.max(a.x,h.x,g.x,b.x)),V=A-1;V<=L+1;V++)V!==0&&u.push(new p.UnwrappedTileID(V,n));return u},Fi.prototype.coveringTiles=function(n){var u=this.coveringZoomLevel(n),a=u;if(n.minzoom!==void 0&&u<n.minzoom)return[];n.maxzoom!==void 0&&u>n.maxzoom&&(u=n.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),b=[g*h.x,g*h.y,0],A=Kl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),L=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=u);var V=function(Yr){return{aabb:new Ka([Yr*g,0,0],[(Yr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Yr,fullyVisible:!1}},ee=[],de=[],_e=u,xe=n.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var Xe=1;Xe<=3;Xe++)ee.push(V(-Xe)),ee.push(V(Xe));for(ee.push(V(0));ee.length>0;){var Ge=ee.pop(),nt=Ge.x,ke=Ge.y,rt=Ge.fullyVisible;if(!rt){var ht=Ge.aabb.intersects(A);if(ht===0)continue;rt=ht===2}var Bt=Ge.aabb.distanceX(b),or=Ge.aabb.distanceY(b),rr=Math.max(Math.abs(Bt),Math.abs(or));if(Ge.zoom===_e||rr>3+(1<<_e-Ge.zoom)-2&&Ge.zoom>=L)de.push({tileID:new p.OverscaledTileID(Ge.zoom===_e?xe:Ge.zoom,Ge.wrap,Ge.zoom,nt,ke),distanceSq:p.sqrLen([b[0]-.5-nt,b[1]-.5-ke])});else for(var lr=0;lr<4;lr++){var Lr=(nt<<1)+lr%2,rn=(ke<<1)+(lr>>1);ee.push({aabb:Ge.aabb.quadrant(lr),zoom:Ge.zoom+1,x:Lr,y:rn,wrap:Ge.wrap,fullyVisible:rt})}}return de.sort(function(Yr,_n){return Yr.distanceSq-_n.distanceSq}).map(function(Yr){return Yr.tileID})},Fi.prototype.resize=function(n,u){this.width=n,this.height=u,this.pixelsToGLUnits=[2/n,-2/u],this._constrain(),this._calcMatrices()},Ta.unmodified.get=function(){return this._unmodified},Fi.prototype.zoomScale=function(n){return Math.pow(2,n)},Fi.prototype.scaleZoom=function(n){return Math.log(n)/Math.LN2},Fi.prototype.project=function(n){var u=p.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(n.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},Fi.prototype.unproject=function(n){return new p.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()},Ta.point.get=function(){return this.project(this.center)},Fi.prototype.setLocationAtPoint=function(n,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(n),b=new p.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},Fi.prototype.locationPoint=function(n){return this.coordinatePoint(this.locationCoordinate(n))},Fi.prototype.pointLocation=function(n){return this.coordinateLocation(this.pointCoordinate(n))},Fi.prototype.locationCoordinate=function(n){return p.MercatorCoordinate.fromLngLat(n)},Fi.prototype.coordinateLocation=function(n){return n.toLngLat()},Fi.prototype.pointCoordinate=function(n){var u=[n.x,n.y,0,1],a=[n.x,n.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],g=a[3],b=u[1]/h,A=a[1]/g,L=u[2]/h,V=a[2]/g,ee=L===V?0:(0-L)/(V-L);return new p.MercatorCoordinate(p.number(u[0]/h,a[0]/g,ee)/this.worldSize,p.number(b,A,ee)/this.worldSize)},Fi.prototype.coordinatePoint=function(n){var u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},Fi.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},Fi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Fi.prototype.setMaxBounds=function(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Fi.prototype.calculatePosMatrix=function(n,u){u===void 0&&(u=!1);var a=n.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=n.canonical,b=this.worldSize/this.zoomScale(g.z),A=g.x+Math.pow(2,g.z)*n.wrap,L=p.identity(new Float64Array(16));return p.translate(L,L,[A*b,g.y*b,0]),p.scale(L,L,[b/p.EXTENT,b/p.EXTENT,1]),p.multiply(L,u?this.alignedProjMatrix:this.projMatrix,L),h[a]=new Float32Array(L),h[a]},Fi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Fi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var n,u,a,h,g=-90,b=90,A=-180,L=180,V=this.size,ee=this._unmodified;if(this.latRange){var de=this.latRange;g=p.mercatorYfromLat(de[1])*this.worldSize,n=(b=p.mercatorYfromLat(de[0])*this.worldSize)-g<V.y?V.y/(b-g):0}if(this.lngRange){var _e=this.lngRange;A=p.mercatorXfromLng(_e[0])*this.worldSize,u=(L=p.mercatorXfromLng(_e[1])*this.worldSize)-A<V.x?V.x/(L-A):0}var xe=this.point,Xe=Math.max(u||0,n||0);if(Xe)return this.center=this.unproject(new p.Point(u?(L+A)/2:xe.x,n?(b+g)/2:xe.y)),this.zoom+=this.scaleZoom(Xe),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var Ge=xe.y,nt=V.y/2;Ge-nt<g&&(h=g+nt),Ge+nt>b&&(h=b-nt)}if(this.lngRange){var ke=xe.x,rt=V.x/2;ke-rt<A&&(a=A+rt),ke+rt>L&&(a=L-rt)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:xe.x,h!==void 0?h:xe.y))),this._unmodified=ee,this._constraining=!1}},Fi.prototype._calcMatrices=function(){if(this.height){var n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-a,.01,Math.PI-.01)),g=this.point,b=g.x,A=g.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),V=this.height/50,ee=new Float64Array(16);p.perspective(ee,this._fov,this.width/this.height,V,L),ee[8]=2*-n.x/this.width,ee[9]=2*n.y/this.height,p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),p.rotateX(ee,ee,this._pitch),p.rotateZ(ee,ee,this.angle),p.translate(ee,ee,[-b,-A,0]),this.mercatorMatrix=p.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ee,ee,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=p.invert([],this.projMatrix);var de=this.width%2/2,_e=this.height%2/2,xe=Math.cos(this.angle),Xe=Math.sin(this.angle),Ge=b-Math.round(b)+xe*de+Xe*_e,nt=A-Math.round(A)+xe*_e+Xe*de,ke=new Float64Array(ee);if(p.translate(ke,ke,[Ge>.5?Ge-1:Ge,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=ke,ee=p.create(),p.scale(ee,ee,[this.width/2,-this.height/2,1]),p.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=p.create(),p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[-1,-1,0]),p.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Fi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var n=this.pointCoordinate(new p.Point(0,0)),u=[n.x*this.worldSize,n.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},Fi.prototype.getCameraPoint=function(){var n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,n))},Fi.prototype.getCameraQueryGeometry=function(n){var u=this.getCameraPoint();if(n.length===1)return[n[0],u];for(var a=u.x,h=u.y,g=u.x,b=u.y,A=0,L=n;A<L.length;A+=1){var V=L[A];a=Math.min(a,V.x),h=Math.min(h,V.y),g=Math.max(g,V.x),b=Math.max(b,V.y)}return[new p.Point(a,h),new p.Point(g,h),new p.Point(g,b),new p.Point(a,b),new p.Point(a,h)]},Object.defineProperties(Fi.prototype,Ta);var js=function(n){var u,a,h,g;this._hashName=n&&encodeURIComponent(n),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(u(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};js.prototype.addTo=function(n){return this._map=n,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},js.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},js.prototype.getHashString=function(n){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),b=Math.round(u.lng*g)/g,A=Math.round(u.lat*g)/g,L=this._map.getBearing(),V=this._map.getPitch(),ee="";if(ee+=n?"/"+b+"/"+A+"/"+a:a+"/"+A+"/"+b,(L||V)&&(ee+="/"+Math.round(10*L)/10),V&&(ee+="/"+Math.round(V)),this._hashName){var de=this._hashName,_e=!1,xe=p.window.location.hash.slice(1).split("&").map(function(Xe){var Ge=Xe.split("=")[0];return Ge===de?(_e=!0,Ge+"="+ee):Xe}).filter(function(Xe){return Xe});return _e||xe.push(de+"="+ee),"#"+xe.join("&")}return"#"+ee},js.prototype._getCurrentHash=function(){var n,u=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(n=h)}),(n&&n[1]||"").split("/")):a.split("/")},js.prototype._onHashChange=function(){var n=this._getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},js.prototype._updateHashUnthrottled=function(){var n=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,n)}catch(u){}};var $l={linearity:.3,easing:p.bezier(0,0,.3,1)},Rl=p.extend({deceleration:2500,maxSpeed:1400},$l),Jl=p.extend({deceleration:20,maxSpeed:1400},$l),_f=p.extend({deceleration:1e3,maxSpeed:360},$l),xf=p.extend({deceleration:1e3,maxSpeed:90},$l),Dl=function(n){this._map=n,this.clear()};function zu(n,u){(!n.duration||n.duration<u.duration)&&(n.duration=u.duration,n.easing=u.easing)}function Fu(n,u,a){var h=a.maxSpeed,g=a.linearity,b=a.deceleration,A=p.clamp(n*g/(u/1e3),-h,h),L=Math.abs(A)/(b*g);return{easing:a.easing,duration:1e3*L,amount:A*(L/2)}}Dl.prototype.clear=function(){this._inertiaBuffer=[]},Dl.prototype.record=function(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:n})},Dl.prototype._drainInertiaBuffer=function(){for(var n=this._inertiaBuffer,u=p.browser.now();n.length>0&&u-n[0].time>160;)n.shift()},Dl.prototype._onMoveEnd=function(n){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(u.pan.mag()){var L=Fu(u.pan.mag(),b,p.extend({},Rl,n||{}));A.offset=u.pan.mult(L.amount/u.pan.mag()),A.center=this._map.transform.center,zu(A,L)}if(u.zoom){var V=Fu(u.zoom,b,Jl);A.zoom=this._map.transform.zoom+V.amount,zu(A,V)}if(u.bearing){var ee=Fu(u.bearing,b,_f);A.bearing=this._map.transform.bearing+p.clamp(ee.amount,-179,179),zu(A,ee)}if(u.pitch){var de=Fu(u.pitch,b,xf);A.pitch=this._map.transform.pitch+de.amount,zu(A,de)}if(A.zoom||A.bearing){var _e=u.pinchAround===void 0?u.around:u.pinchAround;A.around=_e?this._map.unproject(_e):this._map.getCenter()}return this.clear(),p.extend(A,{noMoveStart:!0})}};var no=function(n){function u(h,g,b,A){A===void 0&&(A={});var L=z.mousePos(g.getCanvasContainer(),b),V=g.unproject(L);n.call(this,h,p.extend({point:L,lngLat:V,originalEvent:b},A)),this._defaultPrevented=!1,this.target=g}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),ds=function(n){function u(h,g,b){var A=h==="touchend"?b.changedTouches:b.touches,L=z.touchPos(g.getCanvasContainer(),A),V=L.map(function(_e){return g.unproject(_e)}),ee=L.reduce(function(_e,xe,Xe,Ge){return _e.add(xe.div(Ge.length))},new p.Point(0,0)),de=g.unproject(ee);n.call(this,h,{points:L,point:ee,lngLats:V,lngLat:de,originalEvent:b}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),pl=function(n){function u(h,g,b){n.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),fo=function(n,u){this._map=n,this._clickTolerance=u.clickTolerance};fo.prototype.reset=function(){delete this._mousedownPos},fo.prototype.wheel=function(n){return this._firePreventable(new pl(n.type,this._map,n))},fo.prototype.mousedown=function(n,u){return this._mousedownPos=u,this._firePreventable(new no(n.type,this._map,n))},fo.prototype.mouseup=function(n){this._map.fire(new no(n.type,this._map,n))},fo.prototype.click=function(n,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new no(n.type,this._map,n))},fo.prototype.dblclick=function(n){return this._firePreventable(new no(n.type,this._map,n))},fo.prototype.mouseover=function(n){this._map.fire(new no(n.type,this._map,n))},fo.prototype.mouseout=function(n){this._map.fire(new no(n.type,this._map,n))},fo.prototype.touchstart=function(n){return this._firePreventable(new ds(n.type,this._map,n))},fo.prototype.touchmove=function(n){this._map.fire(new ds(n.type,this._map,n))},fo.prototype.touchend=function(n){this._map.fire(new ds(n.type,this._map,n))},fo.prototype.touchcancel=function(n){this._map.fire(new ds(n.type,this._map,n))},fo.prototype._firePreventable=function(n){if(this._map.fire(n),n.defaultPrevented)return{}},fo.prototype.isEnabled=function(){return!0},fo.prototype.isActive=function(){return!1},fo.prototype.enable=function(){},fo.prototype.disable=function(){};var Tn=function(n){this._map=n};Tn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Tn.prototype.mousemove=function(n){this._map.fire(new no(n.type,this._map,n))},Tn.prototype.mousedown=function(){this._delayContextMenu=!0},Tn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new no("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Tn.prototype.contextmenu=function(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new no(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()},Tn.prototype.isEnabled=function(){return!0},Tn.prototype.isActive=function(){return!1},Tn.prototype.enable=function(){},Tn.prototype.disable=function(){};var Zs=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=u.clickTolerance||1};function mc(n,u){for(var a={},h=0;h<n.length;h++)a[n[h].identifier]=u[h];return a}Zs.prototype.isEnabled=function(){return!!this._enabled},Zs.prototype.isActive=function(){return!!this._active},Zs.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Zs.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Zs.prototype.mousedown=function(n,u){this.isEnabled()&&n.shiftKey&&n.button===0&&(z.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},Zs.prototype.mousemoveWindow=function(n,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));var g=Math.min(h.x,a.x),b=Math.max(h.x,a.x),A=Math.min(h.y,a.y),L=Math.max(h.y,a.y);z.setTransform(this._box,"translate("+g+"px,"+A+"px)"),this._box.style.width=b-g+"px",this._box.style.height=L-A+"px"}}},Zs.prototype.mouseupWindow=function(n,u){var a=this;if(this._active&&n.button===0){var h=this._startPos,g=u;if(this.reset(),z.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",n)}},Zs.prototype.keydown=function(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))},Zs.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(z.remove(this._box),this._box=null),z.enableDrag(),delete this._startPos,delete this._lastPos},Zs.prototype._fireEvent=function(n,u){return this._map.fire(new p.Event(n,{originalEvent:u}))};var kl=function(n){this.reset(),this.numTouches=n.numTouches};kl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},kl.prototype.touchstart=function(n,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),b=0,A=h;b<A.length;b+=1)g._add(A[b]);return g.div(h.length)}(u),this.touches=mc(a,u)))},kl.prototype.touchmove=function(n,u,a){if(!this.aborted&&this.centroid){var h=mc(a,u);for(var g in this.touches){var b=h[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}},kl.prototype.touchend=function(n,u,a){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var fu=function(n){this.singleTap=new kl(n),this.numTaps=n.numTaps,this.reset()};fu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},fu.prototype.touchstart=function(n,u,a){this.singleTap.touchstart(n,u,a)},fu.prototype.touchmove=function(n,u,a){this.singleTap.touchmove(n,u,a)},fu.prototype.touchend=function(n,u,a){var h=this.singleTap.touchend(n,u,a);if(h){var g=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(g&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Vs=function(){this._zoomIn=new fu({numTouches:1,numTaps:2}),this._zoomOut=new fu({numTouches:2,numTaps:1}),this.reset()};Vs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vs.prototype.touchstart=function(n,u,a){this._zoomIn.touchstart(n,u,a),this._zoomOut.touchstart(n,u,a)},Vs.prototype.touchmove=function(n,u,a){this._zoomIn.touchmove(n,u,a),this._zoomOut.touchmove(n,u,a)},Vs.prototype.touchend=function(n,u,a){var h=this,g=this._zoomIn.touchend(n,u,a),b=this._zoomOut.touchend(n,u,a);return g?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(g)},{originalEvent:n})}}):b?(this._active=!0,n.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(b)},{originalEvent:n})}}):void 0},Vs.prototype.touchcancel=function(){this.reset()},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active};var dl={0:1,2:2},Jr=function(n){this.reset(),this._clickTolerance=n.clickTolerance||1};Jr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Jr.prototype._correctButton=function(n,u){return!1},Jr.prototype._move=function(n,u){return{}},Jr.prototype.mousedown=function(n,u){if(!this._lastPoint){var a=z.mouseButton(n);this._correctButton(n,a)&&(this._lastPoint=u,this._eventButton=a)}},Jr.prototype.mousemoveWindow=function(n,u){var a=this._lastPoint;if(a){if(n.preventDefault(),function(h,g){var b=dl[g];return h.buttons===void 0||(h.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},Jr.prototype.mouseupWindow=function(n){this._lastPoint&&z.mouseButton(n)===this._eventButton&&(this._moved&&z.suppressClick(),this.reset())},Jr.prototype.enable=function(){this._enabled=!0},Jr.prototype.disable=function(){this._enabled=!1,this.reset()},Jr.prototype.isEnabled=function(){return this._enabled},Jr.prototype.isActive=function(){return this._active};var gc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.mousedown=function(a,h){n.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}(Jr),Ql=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Jr),Nu=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}(Jr),Gs=function(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()};Gs.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},Gs.prototype.touchstart=function(n,u,a){return this._calculateTransform(n,u,a)},Gs.prototype.touchmove=function(n,u,a){if(this._active&&!(a.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,u,a)},Gs.prototype.touchend=function(n,u,a){this._calculateTransform(n,u,a),this._active&&a.length<this._minTouches&&this.reset()},Gs.prototype.touchcancel=function(){this.reset()},Gs.prototype._calculateTransform=function(n,u,a){a.length>0&&(this._active=!0);var h=mc(a,u),g=new p.Point(0,0),b=new p.Point(0,0),A=0;for(var L in h){var V=h[L],ee=this._touches[L];ee&&(g._add(V),b._add(V.sub(ee)),A++,h[L]=V)}if(this._touches=h,!(A<this._minTouches)&&b.mag()){var de=b.div(A);if(this._sum._add(de),!(this._sum.mag()<this._clickTolerance))return{around:g.div(A),panDelta:de}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active};var bs=function(){this.reset()};function vl(n,u,a){for(var h=0;h<n.length;h++)if(n[h].identifier===a)return u[h]}function yc(n,u){return Math.log(n/u)/Math.LN2}bs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},bs.prototype._start=function(n){},bs.prototype._move=function(n,u,a){return{}},bs.prototype.touchstart=function(n,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},bs.prototype.touchmove=function(n,u,a){if(this._firstTwoTouches){n.preventDefault();var h=this._firstTwoTouches,g=h[1],b=vl(a,u,h[0]),A=vl(a,u,g);if(b&&A){var L=this._aroundCenter?null:b.add(A).div(2);return this._move([b,A],L,n)}}},bs.prototype.touchend=function(n,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],b=vl(a,u,h[0]),A=vl(a,u,g);b&&A||(this._active&&z.suppressClick(),this.reset())}},bs.prototype.touchcancel=function(){this.reset()},bs.prototype.enable=function(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"},bs.prototype.disable=function(){this._enabled=!1,this.reset()},bs.prototype.isEnabled=function(){return this._enabled},bs.prototype.isActive=function(){return this._active};var Hs=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(yc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yc(this._distance,g),pinchAround:h}},u}(bs);function qu(n,u){return 180*n.angleWith(u)/Math.PI}var Uc=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qu(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=qu(a,this._startVector);return Math.abs(g)<h},u}(bs);function ql(n){return Math.abs(n.y)>Math.abs(n.x)}var rf=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.reset=function(){n.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,ql(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,g){var b=a[0].sub(this._lastPoints[0]),A=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,A,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+A.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var b=a.mag()>=2,A=h.mag()>=2;if(b||A){if(!b||!A)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var L=a.y>0==h.y>0;return ql(a)&&ql(h)&&L}},u}(bs),jc={panStep:100,bearingStep:15,pitchStep:10},_u=function(){var n=jc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1};function Js(n){return n*(2-n)}_u.prototype.reset=function(){this._active=!1},_u.prototype.keydown=function(n){var u=this;if(!(n.altKey||n.ctrlKey||n.metaKey)){var a=0,h=0,g=0,b=0,A=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?g=1:(n.preventDefault(),A=-1);break;case 40:n.shiftKey?g=-1:(n.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(L){var V=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Js,zoom:a?Math.round(V)+a*(n.shiftKey?2:1):V,bearing:L.getBearing()+h*u._bearingStep,pitch:L.getPitch()+g*u._pitchStep,offset:[-b*u._panStep,-A*u._panStep],center:L.getCenter()},{originalEvent:n})}}}},_u.prototype.enable=function(){this._enabled=!0},_u.prototype.disable=function(){this._enabled=!1,this.reset()},_u.prototype.isEnabled=function(){return this._enabled},_u.prototype.isActive=function(){return this._active},_u.prototype.disableRotation=function(){this._rotationDisabled=!0},_u.prototype.enableRotation=function(){this._rotationDisabled=!1};var Di=function(n,u){this._map=n,this._el=n.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};Di.prototype.setZoomRate=function(n){this._defaultZoomRate=n},Di.prototype.setWheelZoomRate=function(n){this._wheelZoomRate=n},Di.prototype.isEnabled=function(){return!!this._enabled},Di.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Di.prototype.isZooming=function(){return!!this._zooming},Di.prototype.enable=function(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")},Di.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Di.prototype.wheel=function(n){if(this.isEnabled()){var u=n.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),n.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=n,this._delta-=u,this._active||this._start(n)),n.preventDefault()}},Di.prototype._onTimeout=function(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},Di.prototype._start=function(n){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=z.mousePos(this._el,n);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Di.prototype.renderFrame=function(){var n=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,A=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,L=this._startZoom,V=this._easing,ee=!1;if(this._type==="wheel"&&L&&V){var de=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),_e=V(de);b=p.number(L,A,_e),de<1?this._frameId||(this._frameId=!0):ee=!0}else b=A,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){n._zooming=!1,n._handler._triggerRenderFrame(),delete n._targetZoom,delete n._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:b-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Di.prototype._smoothOutEasing=function(n){var u=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),b=.27/Math.sqrt(g*g+1e-4)*.01,A=Math.sqrt(.0729-b*b);u=p.bezier(b,A,.25,1)}return this._prevEase={start:p.browser.now(),duration:n,easing:u},u},Di.prototype.reset=function(){this._active=!1};var Bu=function(n,u){this._clickZoom=n,this._tapZoom=u};Bu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Bu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Bu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Bu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var os=function(){this.reset()};os.prototype.reset=function(){this._active=!1},os.prototype.dblclick=function(n,u){return n.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(n.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:n})}}},os.prototype.enable=function(){this._enabled=!0},os.prototype.disable=function(){this._enabled=!1,this.reset()},os.prototype.isEnabled=function(){return this._enabled},os.prototype.isActive=function(){return this._active};var Io=function(){this._tap=new fu({numTouches:1,numTaps:1}),this.reset()};Io.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Io.prototype.touchstart=function(n,u,a){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(n,u,a))},Io.prototype.touchmove=function(n,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,n.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(n,u,a)},Io.prototype.touchend=function(n,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(n,u,a)&&(this._tapTime=n.timeStamp)},Io.prototype.touchcancel=function(){this.reset()},Io.prototype.enable=function(){this._enabled=!0},Io.prototype.disable=function(){this._enabled=!1,this.reset()},Io.prototype.isEnabled=function(){return this._enabled},Io.prototype.isActive=function(){return this._active};var xu=function(n,u,a){this._el=n,this._mousePan=u,this._touchPan=a};xu.prototype.enable=function(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},xu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},xu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},xu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Qs=function(n,u,a){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};Qs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Qs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Qs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Qs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var qs=function(n,u,a,h){this._el=n,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};qs.prototype.enable=function(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},qs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},qs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},qs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},qs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},qs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ss=function(n){return n.zoom||n.drag||n.pitch||n.rotate},zl=function(n){function u(){n.apply(this,arguments)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u}(p.Event);function Zn(n){return n.panDelta&&n.panDelta.mag()||n.zoomDelta||n.bearingDelta||n.pitchDelta}var Mn=function(n,u){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dl(n),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var b=g[h],A=b[0];z.addEventListener(A,b[1],A===p.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};Mn.prototype.destroy=function(){for(var n=0,u=this._listeners;n<u.length;n+=1){var a=u[n],h=a[0];z.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},Mn.prototype._addDefaultHandlers=function(n){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new fo(u,n));var h=u.boxZoom=new Zs(u,n);this._add("boxZoom",h);var g=new Vs,b=new os;u.doubleClickZoom=new Bu(b,g),this._add("tapZoom",g),this._add("clickZoom",b);var A=new Io;this._add("tapDragZoom",A);var L=u.touchPitch=new rf;this._add("touchPitch",L);var V=new Ql(n),ee=new Nu(n);u.dragRotate=new Qs(n,V,ee),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var de=new gc(n),_e=new Gs(n);u.dragPan=new xu(a,de,_e),this._add("mousePan",de),this._add("touchPan",_e,["touchZoom","touchRotate"]);var xe=new Uc,Xe=new Hs;u.touchZoomRotate=new qs(a,Xe,xe,A),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",Xe,["touchPan","touchRotate"]);var Ge=u.scrollZoom=new Di(u,this);this._add("scrollZoom",Ge,["mousePan"]);var nt=u.keyboard=new _u;this._add("keyboard",nt),this._add("blockableMapEvent",new Tn(u));for(var ke=0,rt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ke<rt.length;ke+=1){var ht=rt[ke];n.interactive&&n[ht]&&u[ht].enable(n[ht])}},Mn.prototype._add=function(n,u,a){this._handlers.push({handlerName:n,handler:u,allowed:a}),this._handlersById[n]=u},Mn.prototype.stop=function(n){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}},Mn.prototype.isActive=function(){for(var n=0,u=this._handlers;n<u.length;n+=1)if(u[n].handler.isActive())return!0;return!1},Mn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Mn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Mn.prototype.isMoving=function(){return Boolean(ss(this._eventsInProgress))||this.isZooming()},Mn.prototype._blockedByActive=function(n,u,a){for(var h in n)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},Mn.prototype.handleWindowEvent=function(n){this.handleEvent(n,n.type+"Window")},Mn.prototype._getMapTouches=function(n){for(var u=[],a=0,h=n;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&u.push(g)}return u},Mn.prototype.handleEvent=function(n,u){if(n.type!=="blur"){this._updatingCamera=!0;for(var a=n.type==="renderFrame"?void 0:n,h={needsRenderFrame:!1},g={},b={},A=n.touches?this._getMapTouches(n.touches):void 0,L=A?z.touchPos(this._el,A):z.mousePos(this._el,n),V=0,ee=this._handlers;V<ee.length;V+=1){var de=ee[V],_e=de.handlerName,xe=de.handler,Xe=de.allowed;if(xe.isEnabled()){var Ge=void 0;this._blockedByActive(b,Xe,_e)?xe.reset():xe[u||n.type]&&(Ge=xe[u||n.type](n,L,A),this.mergeHandlerResult(h,g,Ge,_e,a),Ge&&Ge.needsRenderFrame&&this._triggerRenderFrame()),(Ge||xe.isActive())&&(b[_e]=xe)}}var nt={};for(var ke in this._previousActiveHandlers)b[ke]||(nt[ke]=a);this._previousActiveHandlers=b,(Object.keys(nt).length||Zn(h))&&(this._changes.push([h,g,nt]),this._triggerRenderFrame()),(Object.keys(b).length||Zn(h))&&this._map._stop(!0),this._updatingCamera=!1;var rt=h.cameraAnimation;rt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],rt(this._map))}else this.stop(!0)},Mn.prototype.mergeHandlerResult=function(n,u,a,h,g){if(a){p.extend(n,a);var b={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(u.zoom=b),a.panDelta!==void 0&&(u.drag=b),a.pitchDelta!==void 0&&(u.pitch=b),a.bearingDelta!==void 0&&(u.rotate=b)}},Mn.prototype._applyChanges=function(){for(var n={},u={},a={},h=0,g=this._changes;h<g.length;h+=1){var b=g[h],A=b[0],L=b[1],V=b[2];A.panDelta&&(n.panDelta=(n.panDelta||new p.Point(0,0))._add(A.panDelta)),A.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(n.around=A.around),A.pinchAround!==void 0&&(n.pinchAround=A.pinchAround),A.noInertia&&(n.noInertia=A.noInertia),p.extend(u,L),p.extend(a,V)}this._updateMapTransform(n,u,a),this._changes=[]},Mn.prototype._updateMapTransform=function(n,u,a){var h=this._map,g=h.transform;if(!Zn(n))return this._fireEvents(u,a,!0);var b=n.panDelta,A=n.zoomDelta,L=n.bearingDelta,V=n.pitchDelta,ee=n.around,de=n.pinchAround;de!==void 0&&(ee=de),h._stop(!0),ee=ee||h.transform.centerPoint;var _e=g.pointLocation(b?ee.sub(b):ee);L&&(g.bearing+=L),V&&(g.pitch+=V),A&&(g.zoom+=A),g.setLocationAtPoint(_e,ee),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(u,a,!0)},Mn.prototype._fireEvents=function(n,u,a){var h=this,g=ss(this._eventsInProgress),b=ss(n),A={};for(var L in n)this._eventsInProgress[L]||(A[L+"start"]=n[L].originalEvent),this._eventsInProgress[L]=n[L];for(var V in!g&&b&&this._fireEvent("movestart",b.originalEvent),A)this._fireEvent(V,A[V]);for(var ee in b&&this._fireEvent("move",b.originalEvent),n)this._fireEvent(ee,n[ee].originalEvent);var de,_e={};for(var xe in this._eventsInProgress){var Xe=this._eventsInProgress[xe],Ge=Xe.handlerName,nt=Xe.originalEvent;this._handlersById[Ge].isActive()||(delete this._eventsInProgress[xe],_e[xe+"end"]=de=u[Ge]||nt)}for(var ke in _e)this._fireEvent(ke,_e[ke]);var rt=ss(this._eventsInProgress);if(a&&(g||b)&&!rt){this._updatingCamera=!0;var ht=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Bt=function(or){return or!==0&&-h._bearingSnap<or&&or<h._bearingSnap};ht?(Bt(ht.bearing||this._map.getBearing())&&(ht.bearing=0),this._map.easeTo(ht,{originalEvent:de})):(this._map.fire(new p.Event("moveend",{originalEvent:de})),Bt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Mn.prototype._fireEvent=function(n,u){this._map.fire(new p.Event(n,u?{originalEvent:u}:{}))},Mn.prototype._requestFrame=function(){var n=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete n._frameId,n.handleEvent(new zl("renderFrame",{timeStamp:u})),n._applyChanges()})},Mn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var ec=function(n){function u(a,h){n.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),g)},u.prototype.panTo=function(a,h,g){return this.easeTo(p.extend({center:a},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,g){return this.easeTo(p.extend({zoom:a},h),g)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,g){return this.easeTo(p.extend({bearing:a},h),g)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(a,h,g,b){var A={top:0,bottom:0,right:0,left:0};if(typeof(b=p.extend({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var L=b.padding;b.padding={top:L,bottom:L,right:L,left:L}}b.padding=p.extend(A,b.padding);var V=this.transform,ee=V.padding,de=V.project(p.LngLat.convert(a)),_e=V.project(p.LngLat.convert(h)),xe=de.rotate(-g*Math.PI/180),Xe=_e.rotate(-g*Math.PI/180),Ge=new p.Point(Math.max(xe.x,Xe.x),Math.max(xe.y,Xe.y)),nt=new p.Point(Math.min(xe.x,Xe.x),Math.min(xe.y,Xe.y)),ke=Ge.sub(nt),rt=(V.width-(ee.left+ee.right+b.padding.left+b.padding.right))/ke.x,ht=(V.height-(ee.top+ee.bottom+b.padding.top+b.padding.bottom))/ke.y;if(!(ht<0||rt<0)){var Bt=Math.min(V.scaleZoom(V.scale*Math.min(rt,ht)),b.maxZoom),or=typeof b.offset.x=="number"?new p.Point(b.offset.x,b.offset.y):p.Point.convert(b.offset),rr=new p.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),lr=or.add(rr).mult(V.scale/V.zoomScale(Bt));return{center:V.unproject(de.add(_e).div(2).sub(lr)),zoom:Bt,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},u.prototype.fitScreenCoordinates=function(a,h,g,b,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),g,b),b,A)},u.prototype._fitInternal=function(a,h,g){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,b=!1,A=!1,L=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(b=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(A=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(L=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),b&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),A&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),L&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var b=this.transform,A=this.getZoom(),L=this.getBearing(),V=this.getPitch(),ee=this.getPadding(),de="zoom"in a?+a.zoom:A,_e="bearing"in a?this._normalizeBearing(a.bearing,L):L,xe="pitch"in a?+a.pitch:V,Xe="padding"in a?a.padding:b.padding,Ge=p.Point.convert(a.offset),nt=b.centerPoint.add(Ge),ke=b.pointLocation(nt),rt=p.LngLat.convert(a.center||ke);this._normalizeCenter(rt);var ht,Bt,or=b.project(ke),rr=b.project(rt).sub(or),lr=b.zoomScale(de-A);a.around&&(ht=p.LngLat.convert(a.around),Bt=b.locationPoint(ht));var Lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||de!==A,this._rotating=this._rotating||L!==_e,this._pitching=this._pitching||xe!==V,this._padding=!b.isPaddingEqual(Xe),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Lr),this._ease(function(rn){if(g._zooming&&(b.zoom=p.number(A,de,rn)),g._rotating&&(b.bearing=p.number(L,_e,rn)),g._pitching&&(b.pitch=p.number(V,xe,rn)),g._padding&&(b.interpolatePadding(ee,Xe,rn),nt=b.centerPoint.add(Ge)),ht)b.setLocationAtPoint(ht,Bt);else{var Yr=b.zoomScale(b.zoom-A),_n=de>A?Math.min(2,lr):Math.max(.5,lr),Bn=Math.pow(_n,1-rn),Xn=b.unproject(or.add(rr.mult(rn*Bn)).mult(Yr));b.setLocationAtPoint(b.renderWorldCopies?Xn.wrap():Xn,nt)}g._fireMoveEvents(h)},function(rn){g._afterEase(h,rn)},a),this},u.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,b=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),b&&this.fire(new p.Event("rotateend",a)),A&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&p.browser.prefersReducedMotion){var b=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var A=this.transform,L=this.getZoom(),V=this.getBearing(),ee=this.getPitch(),de=this.getPadding(),_e="zoom"in a?p.clamp(+a.zoom,A.minZoom,A.maxZoom):L,xe="bearing"in a?this._normalizeBearing(a.bearing,V):V,Xe="pitch"in a?+a.pitch:ee,Ge="padding"in a?a.padding:A.padding,nt=A.zoomScale(_e-L),ke=p.Point.convert(a.offset),rt=A.centerPoint.add(ke),ht=A.pointLocation(rt),Bt=p.LngLat.convert(a.center||ht);this._normalizeCenter(Bt);var or=A.project(ht),rr=A.project(Bt).sub(or),lr=a.curve,Lr=Math.max(A.width,A.height),rn=Lr/nt,Yr=rr.mag();if("minZoom"in a){var _n=p.clamp(Math.min(a.minZoom,L,_e),A.minZoom,A.maxZoom),Bn=Lr/A.zoomScale(_n-L);lr=Math.sqrt(Bn/Yr*2)}var Xn=lr*lr;function Hn(ni){var Jn=(rn*rn-Lr*Lr+(ni?-1:1)*Xn*Xn*Yr*Yr)/(2*(ni?rn:Lr)*Xn*Yr);return Math.log(Math.sqrt(Jn*Jn+1)-Jn)}function ta(ni){return(Math.exp(ni)-Math.exp(-ni))/2}function xn(ni){return(Math.exp(ni)+Math.exp(-ni))/2}var ii=Hn(0),Si=function(ni){return xn(ii)/xn(ii+lr*ni)},ri=function(ni){return Lr*((xn(ii)*(ta(Jn=ii+lr*ni)/xn(Jn))-ta(ii))/Xn)/Yr;var Jn},ai=(Hn(1)-ii)/lr;if(Math.abs(Yr)<1e-6||!isFinite(ai)){if(Math.abs(Lr-rn)<1e-6)return this.easeTo(a,h);var wi=rn<Lr?-1:1;ai=Math.abs(Math.log(rn/Lr))/lr,ri=function(){return 0},Si=function(ni){return Math.exp(wi*lr*ni)}}return a.duration="duration"in a?+a.duration:1e3*ai/("screenSpeed"in a?+a.screenSpeed/lr:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=V!==xe,this._pitching=Xe!==ee,this._padding=!A.isPaddingEqual(Ge),this._prepareEase(h,!1),this._ease(function(ni){var Jn=ni*ai,xo=1/Si(Jn);A.zoom=ni===1?_e:L+A.scaleZoom(xo),g._rotating&&(A.bearing=p.number(V,xe,ni)),g._pitching&&(A.pitch=p.number(ee,Xe,ni)),g._padding&&(A.interpolatePadding(de,Ge,ni),rt=A.centerPoint.add(ke));var ja=ni===1?Bt:A.unproject(or.add(rr.mult(ri(Jn))).mult(xo));A.setLocationAtPoint(A.renderWorldCopies?ja.wrap():ja,rt),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var b=this.handlers;b&&b.stop(!1)}return this},u.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},u}(p.Evented),zo=function(n){n===void 0&&(n={}),this.options=n,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};zo.prototype.getDefaultPosition=function(){return"bottom-right"},zo.prototype.onAdd=function(n){var u=this.options&&this.options.compact;return this._map=n,this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},zo.prototype.onRemove=function(){z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},zo.prototype._setElementTitle=function(n,u){var a=this._map._getUIString("AttributionControl."+u);n.title=a,n.setAttribute("aria-label",a)},zo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},zo.prototype._updateEditLink=function(){var n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(n){var a=u.reduce(function(h,g,b){return g.value&&(h+=g.key+"="+g.value+(b<u.length-1?"&":"")),h},"?");n.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}},zo.prototype._updateData=function(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},zo.prototype._updateAttributions=function(){if(this._map.style){var n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var b=g.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort(function(L,V){return L.length-V.length});var A=(n=n.filter(function(L,V){for(var ee=V+1;ee<n.length;ee++)if(n[ee].indexOf(L)>=0)return!1;return!0})).join(" | ");A!==this._attribHTML&&(this._attribHTML=A,n.length?(this._innerContainer.innerHTML=A,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},zo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var To=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};To.prototype.onAdd=function(n){this._map=n,this._container=z.create("div","mapboxgl-ctrl");var u=z.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},To.prototype.onRemove=function(){z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},To.prototype.getDefaultPosition=function(){return"bottom-left"},To.prototype._updateLogo=function(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},To.prototype._logoRequired=function(){if(this._map.style){var n=this._map.style.sourceCaches;for(var u in n)if(n[u].getSource().mapbox_logo)return!0;return!1}},To.prototype._updateCompact=function(){var n=this._container.children;if(n.length){var u=n[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Fo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Fo.prototype.add=function(n){var u=++this._id;return this._queue.push({callback:n,id:u,cancelled:!1}),u},Fo.prototype.remove=function(n){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===n)return void(g.cancelled=!0)}},Fo.prototype.run=function(n){n===void 0&&(n=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(n),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Fo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var bu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Su=p.window.HTMLImageElement,tc=p.window.HTMLElement,ea=p.window.ImageBitmap,_o={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Zc=function(n){function u(h){var g=this;if((h=p.extend({},_o,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new Fi(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(n.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Fo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},bu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof tc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Mn(this,h),this._hash=h.hash&&new js(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new zo({customAttribution:h.customAttribution})),this.addControl(new To,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(A){g._update(A.dataType==="style"),g.fire(new p.Event(A.dataType+"data",A))}),this.on("dataloading",function(A){g.fire(new p.Event(A.dataType+"dataloading",A))})}n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var A=this._controlPositions[g];return g.indexOf("bottom")!==-1?A.insertBefore(b,A.firstChild):A.appendChild(b),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),b=g[0],A=g[1];this._resizeCanvas(b,A),this.transform.resize(b,A),this.painter.resize(b,A);var L=!this._moving;return L&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),L&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,b){var A,L=this;if(h==="mouseenter"||h==="mouseover"){var V=!1;return{layer:g,listener:b,delegates:{mousemove:function(de){var _e=L.getLayer(g)?L.queryRenderedFeatures(de.point,{layers:[g]}):[];_e.length?V||(V=!0,b.call(L,new no(h,L,de.originalEvent,{features:_e}))):V=!1},mouseout:function(){V=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ee=!1;return{layer:g,listener:b,delegates:{mousemove:function(de){(L.getLayer(g)?L.queryRenderedFeatures(de.point,{layers:[g]}):[]).length?ee=!0:ee&&(ee=!1,b.call(L,new no(h,L,de.originalEvent)))},mouseout:function(de){ee&&(ee=!1,b.call(L,new no(h,L,de.originalEvent)))}}}}return{layer:g,listener:b,delegates:(A={},A[h]=function(de){var _e=L.getLayer(g)?L.queryRenderedFeatures(de.point,{layers:[g]}):[];_e.length&&(de.features=_e,b.call(L,de),delete de.features)},A)}},u.prototype.on=function(h,g,b){if(b===void 0)return n.prototype.on.call(this,h,g);var A=this._createDelegatedListener(h,g,b);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(A),A.delegates)this.on(L,A.delegates[L]);return this},u.prototype.once=function(h,g,b){if(b===void 0)return n.prototype.once.call(this,h,g);var A=this._createDelegatedListener(h,g,b);for(var L in A.delegates)this.once(L,A.delegates[L]);return this},u.prototype.off=function(h,g,b){var A=this;return b===void 0?n.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(L){for(var V=L[h],ee=0;ee<V.length;ee++){var de=V[ee];if(de.layer===g&&de.listener===b){for(var _e in de.delegates)A.off(_e,de.delegates[_e]);return V.splice(ee,1),A}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var b;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")b=[p.Point.convert(h)];else{var A=p.Point.convert(h[0]),L=p.Point.convert(h[1]);b=[A,new p.Point(L.x,A.y),L,new p.Point(A.x,L.y),A]}return this.style.queryRenderedFeatures(b,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Ra(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ra(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var b=this;if(typeof h=="string"){var A=this._requestManager.normalizeStyleURL(h),L=this._requestManager.transformRequest(A,p.ResourceType.Style);p.getJSON(L,function(V,ee){V?b.fire(new p.ErrorEvent(V)):ee&&b._updateDiff(ee,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(b){p.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var b=h[g]._tiles;for(var A in b){var L=b[A];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,b)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,b){b===void 0&&(b={});var A=b.pixelRatio;A===void 0&&(A=1);var L=b.sdf;L===void 0&&(L=!1);var V=b.stretchX,ee=b.stretchY,de=b.content;if(this._lazyInitEmptyStyle(),g instanceof Su||ea&&g instanceof ea){var _e=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:_e.width,height:_e.height},_e.data),pixelRatio:A,stretchX:V,stretchY:ee,content:de,sdf:L,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var xe=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:A,stretchX:V,stretchY:ee,content:de,sdf:L,version:0,userImage:xe}),xe.onAdd&&xe.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var b=this.style.getImage(h);if(!b)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var A=g instanceof Su||ea&&g instanceof ea?p.browser.getImageData(g):g,L=A.width,V=A.height,ee=A.data;return L===void 0||V===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==b.data.width||V!==b.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(ee,!(g instanceof Su||ea&&g instanceof ea)),void this.style.updateImage(h,b))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,b){return this.style.setLayerZoomRange(h,g,b),this._update(!0)},u.prototype.setFilter=function(h,g,b){return b===void 0&&(b={}),this.style.setFilter(h,g,b),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,b,A){return A===void 0&&(A={}),this.style.setPaintProperty(h,g,b,A),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,b,A){return A===void 0&&(A={}),this.style.setLayoutProperty(h,g,b,A),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=z.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=z.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=z.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var A=this._controlContainer=z.create("div","mapboxgl-control-container",h),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(V){L[V]=z.create("div","mapboxgl-ctrl-"+V,A)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var b=p.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=p.extend({},w.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Ma(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,b=this,A=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,g),A=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,de=p.browser.now();this.style.zoomHistory.update(ee,de);var _e=new p.EvaluationParameters(ee,{now:de,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),xe=_e.crossFadingFactor();xe===1&&xe===this._crossFadingFactor||(V=!0,this._crossFadingFactor=xe),this.style.update(_e)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Xe=p.browser.now()-A;L.endQueryEXT(L.TIME_ELAPSED_EXT,g),setTimeout(function(){var ke=L.getQueryObjectEXT(g,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(g),b.fire(new p.Event("gpu-timing-frame",{cpuTime:Xe,gpuTime:ke}))},50)}if(this.listens("gpu-timing-layer")){var Ge=this.painter.collectGpuTimers();setTimeout(function(){var ke=b.painter.queryGpuTimers(Ge);b.fire(new p.Event("gpu-timing-layer",{layerTimes:ke}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),Uu(this._canvasContainer),Uu(this._controlContainer),Uu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},a.version.get=function(){return p.version},Object.defineProperties(u.prototype,a),u}(ec);function Uu(n){n.parentNode&&n.parentNode.removeChild(n)}var _c={showCompass:!0,showZoom:!0,visualizePitch:!1},Eu=function(n){var u=this;this.options=p.extend({},_c,n),this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Eu.prototype._updateZoomButtons=function(){var n=this._map.getZoom(),u=n===this._map.getMaxZoom(),a=n===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},Eu.prototype._rotateCompassArrow=function(){var n=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=n},Eu.prototype.onAdd=function(n){return this._map=n,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Os(this._map,this._compass,this.options.visualizePitch)),this._container},Eu.prototype.onRemove=function(){z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Eu.prototype._createButton=function(n,u){var a=z.create("button",n,this._container);return a.type="button",a.addEventListener("click",u),a},Eu.prototype._setButtonTitle=function(n,u){var a=this._map._getUIString("NavigationControl."+u);n.title=a,n.setAttribute("aria-label",a)};var Os=function(n,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new Ql({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,a&&(this.mousePitch=new Nu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),z.addEventListener(u,"mousedown",this.mousedown),z.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),z.addEventListener(u,"touchmove",this.touchmove),z.addEventListener(u,"touchend",this.touchend),z.addEventListener(u,"touchcancel",this.reset)};function Fl(n,u,a){if(n=new p.LngLat(n.lng,n.lat),u){var h=new p.LngLat(n.lng-360,n.lat),g=new p.LngLat(n.lng+360,n.lat),b=a.locationPoint(n).distSqr(u);a.locationPoint(h).distSqr(u)<b?n=h:a.locationPoint(g).distSqr(u)<b&&(n=g)}for(;Math.abs(n.lng-a.center.lng)>180;){var A=a.locationPoint(n);if(A.x>=0&&A.y>=0&&A.x<=a.width&&A.y<=a.height)break;n.lng>a.center.lng?n.lng-=360:n.lng+=360}return n}Os.prototype.down=function(n,u){this.mouseRotate.mousedown(n,u),this.mousePitch&&this.mousePitch.mousedown(n,u),z.disableDrag()},Os.prototype.move=function(n,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(n,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(n,u);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},Os.prototype.off=function(){var n=this.element;z.removeEventListener(n,"mousedown",this.mousedown),z.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),z.removeEventListener(n,"touchmove",this.touchmove),z.removeEventListener(n,"touchend",this.touchend),z.removeEventListener(n,"touchcancel",this.reset),this.offTemp()},Os.prototype.offTemp=function(){z.enableDrag(),z.removeEventListener(p.window,"mousemove",this.mousemove),z.removeEventListener(p.window,"mouseup",this.mouseup)},Os.prototype.mousedown=function(n){this.down(p.extend({},n,{ctrlKey:!0,preventDefault:function(){return n.preventDefault()}}),z.mousePos(this.element,n)),z.addEventListener(p.window,"mousemove",this.mousemove),z.addEventListener(p.window,"mouseup",this.mouseup)},Os.prototype.mousemove=function(n){this.move(n,z.mousePos(this.element,n))},Os.prototype.mouseup=function(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()},Os.prototype.touchstart=function(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=z.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return n.preventDefault()}},this._startPos))},Os.prototype.touchmove=function(n){n.targetTouches.length!==1?this.reset():(this._lastPos=z.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:function(){return n.preventDefault()}},this._lastPos))},Os.prototype.touchend=function(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vc(n,u,a){var h=n.classList;for(var g in wu)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+u)}var Nl,rc=function(n){function u(a,h){if(n.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=z.create("div"),this._element.setAttribute("aria-label","Map marker");var g=z.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var b=z.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var A=z.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");var L=z.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var V=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];V<ee.length;V+=1){var de=ee[V],_e=z.createNS("http://www.w3.org/2000/svg","ellipse");_e.setAttributeNS(null,"opacity","0.04"),_e.setAttributeNS(null,"cx","10.5"),_e.setAttributeNS(null,"cy","5.80029008"),_e.setAttributeNS(null,"rx",de.rx),_e.setAttributeNS(null,"ry",de.ry),L.appendChild(_e)}var xe=z.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"fill",this._color);var Xe=z.createNS("http://www.w3.org/2000/svg","path");Xe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),xe.appendChild(Xe);var Ge=z.createNS("http://www.w3.org/2000/svg","g");Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"fill","#000000");var nt=z.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ge.appendChild(nt);var ke=z.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ke.setAttributeNS(null,"fill","#FFFFFF");var rt=z.createNS("http://www.w3.org/2000/svg","g");rt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var ht=z.createNS("http://www.w3.org/2000/svg","circle");ht.setAttributeNS(null,"fill","#000000"),ht.setAttributeNS(null,"opacity","0.25"),ht.setAttributeNS(null,"cx","5.5"),ht.setAttributeNS(null,"cy","5.5"),ht.setAttributeNS(null,"r","5.4999962");var Bt=z.createNS("http://www.w3.org/2000/svg","circle");Bt.setAttributeNS(null,"fill","#FFFFFF"),Bt.setAttributeNS(null,"cx","5.5"),Bt.setAttributeNS(null,"cy","5.5"),Bt.setAttributeNS(null,"r","5.4999962"),rt.appendChild(ht),rt.appendChild(Bt),A.appendChild(L),A.appendChild(xe),A.appendChild(Ge),A.appendChild(ke),A.appendChild(rt),g.appendChild(A),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(or){or.preventDefault()}),this._element.addEventListener("mousedown",function(or){or.preventDefault()}),Vc(this._element,this._anchor,"marker"),this._popup=null}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),z.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Fl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),z.setTransform(this._element,wu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),Gc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},el=0,eu=!1,xc=function(n){function u(a){n.call(this),this.options=p.extend({},Gc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Nl!==void 0?h(Nl):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(Nl=g.state!=="denied")}):h(Nl=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,el=0,eu=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,b=this._map.getBearing(),A=p.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),A,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),b=h.distanceTo(g),A=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=A+"px",this._circleElement.style.height=A+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&eu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(A){return A.preventDefault()}),this._geolocateButton=z.create("button","mapboxgl-ctrl-geolocate",this._container),z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new rc(this._dotElement),this._circleElement=z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(A){A.geolocateSource||h._watchState!=="ACTIVE_LOCK"||A.originalEvent&&A.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":el--,eu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++el>1?(a={maximumAge:6e5,timeout:0},eu=!0):(a=this.options.positionOptions,eu=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),tl={maxWidth:100,unit:"metric"},ju=function(n){this.options=p.extend({},tl,n),p.bindAll(["_onMove","setUnit"],this)};function nc(n,u,a){var h=a&&a.maxWidth||100,g=n._container.clientHeight/2,b=n.unproject([0,g]),A=n.unproject([h,g]),L=b.distanceTo(A);if(a&&a.unit==="imperial"){var V=3.2808*L;V>5280?Tu(u,h,V/5280,n._getUIString("ScaleControl.Miles")):Tu(u,h,V,n._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Tu(u,h,L/1852,n._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Tu(u,h,L/1e3,n._getUIString("ScaleControl.Kilometers")):Tu(u,h,L,n._getUIString("ScaleControl.Meters"))}function Tu(n,u,a,h){var g,b,A,L=(g=a,(b=Math.pow(10,(""+Math.floor(g)).length-1))*(A=(A=g/b)>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(V){var ee=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*ee)/ee}(A)));n.style.width=u*(L/a)+"px",n.innerHTML=L+"&nbsp;"+h}ju.prototype.getDefaultPosition=function(){return"bottom-left"},ju.prototype._onMove=function(){nc(this._map,this._container,this.options)},ju.prototype.onAdd=function(n){return this._map=n,this._container=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",n.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},ju.prototype.onRemove=function(){z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},ju.prototype.setUnit=function(n){this.options.unit=n,nc(this._map,this._container,this.options)};var hu=function(n){this._fullscreen=!1,n&&n.container&&(n.container instanceof p.window.HTMLElement?this._container=n.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};hu.prototype.onAdd=function(n){return this._map=n,this._container||(this._container=this._map.getContainer()),this._controlContainer=z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},hu.prototype.onRemove=function(){z.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},hu.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},hu.prototype._setupUI=function(){var n=this._fullscreenButton=z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);z.create("span","mapboxgl-ctrl-icon",n).setAttribute("aria-hidden",!0),n.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},hu.prototype._updateTitle=function(){var n=this._getTitle();this._fullscreenButton.setAttribute("aria-label",n),this._fullscreenButton.title=n},hu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},hu.prototype._isFullscreen=function(){return this._fullscreen},hu.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},hu.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Au={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ic=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),bc=function(n){function u(a){n.call(this),this.options=p.extend(Object.create(Au),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return n&&(u.__proto__=n),(u.prototype=Object.create(n&&n.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&z.remove(this._content),this._container&&(z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,g=p.window.document.createDocumentFragment(),b=p.window.document.createElement("body");for(b.innerHTML=a;h=b.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(_e){return h._container.classList.add(_e)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),b=this.options.anchor,A=function _e(xe){if(xe){if(typeof xe=="number"){var Xe=Math.round(Math.sqrt(.5*Math.pow(xe,2)));return{center:new p.Point(0,0),top:new p.Point(0,xe),"top-left":new p.Point(Xe,Xe),"top-right":new p.Point(-Xe,Xe),bottom:new p.Point(0,-xe),"bottom-left":new p.Point(Xe,-Xe),"bottom-right":new p.Point(-Xe,-Xe),left:new p.Point(xe,0),right:new p.Point(-xe,0)}}if(xe instanceof p.Point||Array.isArray(xe)){var Ge=p.Point.convert(xe);return{center:Ge,top:Ge,"top-left":Ge,"top-right":Ge,bottom:Ge,"bottom-left":Ge,"bottom-right":Ge,left:Ge,right:Ge}}return{center:p.Point.convert(xe.center||[0,0]),top:p.Point.convert(xe.top||[0,0]),"top-left":p.Point.convert(xe["top-left"]||[0,0]),"top-right":p.Point.convert(xe["top-right"]||[0,0]),bottom:p.Point.convert(xe.bottom||[0,0]),"bottom-left":p.Point.convert(xe["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(xe["bottom-right"]||[0,0]),left:p.Point.convert(xe.left||[0,0]),right:p.Point.convert(xe.right||[0,0])}}return _e(new p.Point(0,0))}(this.options.offset);if(!b){var L,V=this._container.offsetWidth,ee=this._container.offsetHeight;L=g.y+A.bottom.y<ee?["top"]:g.y>this._map.transform.height-ee?["bottom"]:[],g.x<V/2?L.push("left"):g.x>this._map.transform.width-V/2&&L.push("right"),b=L.length===0?"bottom":L.join("-")}var de=g.add(A[b]).round();z.setTransform(this._container,wu[b]+" translate("+de.x+"px,"+de.y+"px)"),Vc(this._container,b,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(ic);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),ac={version:p.version,supported:w,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Zc,NavigationControl:Eu,GeolocateControl:xc,AttributionControl:zo,ScaleControl:ju,FullscreenControl:hu,Popup:bc,Marker:rc,Style:Ra,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){vr().acquire(jt)},clearPrewarmedResources:function(){var n=Wr;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(jt),Wr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(n){p.config.ACCESS_TOKEN=n},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(n){p.config.API_URL=n},get workerCount(){return dr.workerCount},set workerCount(n){dr.workerCount=n},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(n){p.config.MAX_PARALLEL_IMAGE_REQUESTS=n},clearStorage:function(n){p.clearTileCache(n)},workerUrl:""};return ac}),J})},86387:function(pr,O,x){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.default=function(Xt){return(0,E.default)((0,ce.default)(Xt)&&Xt.length>=1,"Must merge at least 1 JSON schema."),w.default.apply(void 0,[{}].concat(Zt(Xt),[function(zt,Lt,yt){if(!(0,q.default)(zt)){if(yt==="required")return(0,be.default)(zt.concat(Lt));if((0,Me.default)(zt)){if(!(0,Me.default)(Lt))throw new Error('Failed to merge schemas because "'+yt+'" has different values.');return}E.default.deepEqual(zt,Lt,'Failed to merge schemas because "'+yt+'" has different values: '+JSON.stringify(zt)+" and "+JSON.stringify(Lt)+".")}}]))};var J=x(48583),E=Kt(J),p=x(38554),w=Kt(p),z=x(59722),q=Kt(z),Y=x(53778),ce=Kt(Y),ne=x(97644),be=Kt(ne),we=x(8146),Me=Kt(we);function Kt(Xt){return Xt&&Xt.__esModule?Xt:{default:Xt}}function Zt(Xt){if(Array.isArray(Xt)){for(var zt=0,Lt=Array(Xt.length);zt<Xt.length;zt++)Lt[zt]=Xt[zt];return Lt}else return Array.from(Xt)}pr.exports=O.default},28660:function(pr,O,x){var J=x(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var E;(function(p){(function(w){var z=typeof x.g=="object"?x.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),q=Y(p);typeof z.Reflect=="undefined"?z.Reflect=p:q=Y(z.Reflect,q),w(q);function Y(ce,ne){return function(be,we){typeof ce[be]!="function"&&Object.defineProperty(ce,be,{configurable:!0,writable:!0,value:we}),ne&&ne(be,we)}}})(function(w){var z=Object.prototype.hasOwnProperty,q=typeof Symbol=="function",Y=q&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ce=q&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",be={__proto__:[]}instanceof Array,we=!ne&&!be,Me={create:ne?function(){return Mr(Object.create(null))}:be?function(){return Mr({__proto__:null})}:function(){return Mr({})},has:we?function(Ke,gt){return z.call(Ke,gt)}:function(Ke,gt){return gt in Ke},get:we?function(Ke,gt){return z.call(Ke,gt)?Ke[gt]:void 0}:function(Ke,gt){return Ke[gt]}},Kt=Object.getPrototypeOf(Function),Zt=typeof J=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Xt=!Zt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:yr(),zt=!Zt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Er(),Lt=!Zt&&typeof WeakMap=="function"?WeakMap:Ar(),yt=new Lt;function pt(Ke,gt,ct,sr){if(zr(ct)){if(!S(Ke))throw new TypeError;if(!he(gt))throw new TypeError;return xt(Ke,gt)}else{if(!S(Ke))throw new TypeError;if(!oe(gt))throw new TypeError;if(!oe(sr)&&!zr(sr)&&!ln(sr))throw new TypeError;return ln(sr)&&(sr=void 0),ct=kt(ct),nr(Ke,gt,ct,sr)}}w("decorate",pt);function Pr(Ke,gt){function ct(sr,Qr){if(!oe(sr))throw new TypeError;if(!zr(Qr)&&!Be(Qr))throw new TypeError;Je(Ke,gt,sr,Qr)}return ct}w("metadata",Pr);function Ht(Ke,gt,ct,sr){if(!oe(ct))throw new TypeError;return zr(sr)||(sr=kt(sr)),Je(Ke,gt,ct,sr)}w("defineMetadata",Ht);function ar(Ke,gt,ct){if(!oe(gt))throw new TypeError;return zr(ct)||(ct=kt(ct)),Ee(Ke,gt,ct)}w("hasMetadata",ar);function mt(Ke,gt,ct){if(!oe(gt))throw new TypeError;return zr(ct)||(ct=kt(ct)),ae(Ke,gt,ct)}w("hasOwnMetadata",mt);function Ye(Ke,gt,ct){if(!oe(gt))throw new TypeError;return zr(ct)||(ct=kt(ct)),me(Ke,gt,ct)}w("getMetadata",Ye);function bt(Ke,gt,ct){if(!oe(gt))throw new TypeError;return zr(ct)||(ct=kt(ct)),Te(Ke,gt,ct)}w("getOwnMetadata",bt);function Fe(Ke,gt){if(!oe(Ke))throw new TypeError;return zr(gt)||(gt=kt(gt)),dt(Ke,gt)}w("getMetadataKeys",Fe);function Ae(Ke,gt){if(!oe(Ke))throw new TypeError;return zr(gt)||(gt=kt(gt)),$t(Ke,gt)}w("getOwnMetadataKeys",Ae);function Ne(Ke,gt,ct){if(!oe(gt))throw new TypeError;zr(ct)||(ct=kt(ct));var sr=re(gt,ct,!1);if(zr(sr)||!sr.delete(Ke))return!1;if(sr.size>0)return!0;var Qr=yt.get(gt);return Qr.delete(ct),Qr.size>0||yt.delete(gt),!0}w("deleteMetadata",Ne);function xt(Ke,gt){for(var ct=Ke.length-1;ct>=0;--ct){var sr=Ke[ct],Qr=sr(gt);if(!zr(Qr)&&!ln(Qr)){if(!he(Qr))throw new TypeError;gt=Qr}}return gt}function nr(Ke,gt,ct,sr){for(var Qr=Ke.length-1;Qr>=0;--Qr){var st=Ke[Qr],Mt=st(gt,ct,sr);if(!zr(Mt)&&!ln(Mt)){if(!oe(Mt))throw new TypeError;sr=Mt}}return sr}function re(Ke,gt,ct){var sr=yt.get(Ke);if(zr(sr)){if(!ct)return;sr=new Xt,yt.set(Ke,sr)}var Qr=sr.get(gt);if(zr(Qr)){if(!ct)return;Qr=new Xt,sr.set(gt,Qr)}return Qr}function Ee(Ke,gt,ct){var sr=ae(Ke,gt,ct);if(sr)return!0;var Qr=Vt(gt);return ln(Qr)?!1:Ee(Ke,Qr,ct)}function ae(Ke,gt,ct){var sr=re(gt,ct,!1);return zr(sr)?!1:qe(sr.has(Ke))}function me(Ke,gt,ct){var sr=ae(Ke,gt,ct);if(sr)return Te(Ke,gt,ct);var Qr=Vt(gt);if(!ln(Qr))return me(Ke,Qr,ct)}function Te(Ke,gt,ct){var sr=re(gt,ct,!1);if(!zr(sr))return sr.get(Ke)}function Je(Ke,gt,ct,sr){var Qr=re(ct,sr,!0);Qr.set(Ke,gt)}function dt(Ke,gt){var ct=$t(Ke,gt),sr=Vt(Ke);if(sr===null)return ct;var Qr=dt(sr,gt);if(Qr.length<=0)return ct;if(ct.length<=0)return Qr;for(var st=new zt,Mt=[],Jt=0,mr=ct;Jt<mr.length;Jt++){var gn=mr[Jt],Cn=st.has(gn);Cn||(st.add(gn),Mt.push(gn))}for(var yi=0,Ei=Qr;yi<Ei.length;yi++){var gn=Ei[yi],Cn=st.has(gn);Cn||(st.add(gn),Mt.push(gn))}return Mt}function $t(Ke,gt){var ct=[],sr=re(Ke,gt,!1);if(zr(sr))return ct;for(var Qr=sr.keys(),st=vt(Qr),Mt=0;;){var Jt=H(st);if(!Jt)return ct.length=Mt,ct;var mr=wt(Jt);try{ct[Mt]=mr}catch(gn){try{Wt(st)}finally{throw gn}}Mt++}}function Fr(Ke){if(Ke===null)return 1;switch(typeof Ke){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ke===null?1:6;default:return 6}}function zr(Ke){return Ke===void 0}function ln(Ke){return Ke===null}function tr(Ke){return typeof Ke=="symbol"}function oe(Ke){return typeof Ke=="object"?Ke!==null:typeof Ke=="function"}function ge(Ke,gt){switch(Fr(Ke)){case 0:return Ke;case 1:return Ke;case 2:return Ke;case 3:return Ke;case 4:return Ke;case 5:return Ke}var ct=gt===3?"string":gt===5?"number":"default",sr=$e(Ke,Y);if(sr!==void 0){var Qr=sr.call(Ke,ct);if(oe(Qr))throw new TypeError;return Qr}return Re(Ke,ct==="default"?"number":ct)}function Re(Ke,gt){if(gt==="string"){var ct=Ke.toString;if(F(ct)){var sr=ct.call(Ke);if(!oe(sr))return sr}var Qr=Ke.valueOf;if(F(Qr)){var sr=Qr.call(Ke);if(!oe(sr))return sr}}else{var Qr=Ke.valueOf;if(F(Qr)){var sr=Qr.call(Ke);if(!oe(sr))return sr}var st=Ke.toString;if(F(st)){var sr=st.call(Ke);if(!oe(sr))return sr}}throw new TypeError}function qe(Ke){return!!Ke}function Ct(Ke){return""+Ke}function kt(Ke){var gt=ge(Ke,3);return tr(gt)?gt:Ct(gt)}function S(Ke){return Array.isArray?Array.isArray(Ke):Ke instanceof Object?Ke instanceof Array:Object.prototype.toString.call(Ke)==="[object Array]"}function F(Ke){return typeof Ke=="function"}function he(Ke){return typeof Ke=="function"}function Be(Ke){switch(Fr(Ke)){case 3:return!0;case 4:return!0;default:return!1}}function $e(Ke,gt){var ct=Ke[gt];if(ct!=null){if(!F(ct))throw new TypeError;return ct}}function vt(Ke){var gt=$e(Ke,ce);if(!F(gt))throw new TypeError;var ct=gt.call(Ke);if(!oe(ct))throw new TypeError;return ct}function wt(Ke){return Ke.value}function H(Ke){var gt=Ke.next();return gt.done?!1:gt}function Wt(Ke){var gt=Ke.return;gt&&gt.call(Ke)}function Vt(Ke){var gt=Object.getPrototypeOf(Ke);if(typeof Ke!="function"||Ke===Kt||gt!==Kt)return gt;var ct=Ke.prototype,sr=ct&&Object.getPrototypeOf(ct);if(sr==null||sr===Object.prototype)return gt;var Qr=sr.constructor;return typeof Qr!="function"||Qr===Ke?gt:Qr}function yr(){var Ke={},gt=[],ct=function(){function Mt(Jt,mr,gn){this._index=0,this._keys=Jt,this._values=mr,this._selector=gn}return Mt.prototype["@@iterator"]=function(){return this},Mt.prototype[ce]=function(){return this},Mt.prototype.next=function(){var Jt=this._index;if(Jt>=0&&Jt<this._keys.length){var mr=this._selector(this._keys[Jt],this._values[Jt]);return Jt+1>=this._keys.length?(this._index=-1,this._keys=gt,this._values=gt):this._index++,{value:mr,done:!1}}return{value:void 0,done:!0}},Mt.prototype.throw=function(Jt){throw this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),Jt},Mt.prototype.return=function(Jt){return this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),{value:Jt,done:!0}},Mt}();return function(){function Mt(){this._keys=[],this._values=[],this._cacheKey=Ke,this._cacheIndex=-2}return Object.defineProperty(Mt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Mt.prototype.has=function(Jt){return this._find(Jt,!1)>=0},Mt.prototype.get=function(Jt){var mr=this._find(Jt,!1);return mr>=0?this._values[mr]:void 0},Mt.prototype.set=function(Jt,mr){var gn=this._find(Jt,!0);return this._values[gn]=mr,this},Mt.prototype.delete=function(Jt){var mr=this._find(Jt,!1);if(mr>=0){for(var gn=this._keys.length,Cn=mr+1;Cn<gn;Cn++)this._keys[Cn-1]=this._keys[Cn],this._values[Cn-1]=this._values[Cn];return this._keys.length--,this._values.length--,Jt===this._cacheKey&&(this._cacheKey=Ke,this._cacheIndex=-2),!0}return!1},Mt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ke,this._cacheIndex=-2},Mt.prototype.keys=function(){return new ct(this._keys,this._values,sr)},Mt.prototype.values=function(){return new ct(this._keys,this._values,Qr)},Mt.prototype.entries=function(){return new ct(this._keys,this._values,st)},Mt.prototype["@@iterator"]=function(){return this.entries()},Mt.prototype[ce]=function(){return this.entries()},Mt.prototype._find=function(Jt,mr){return this._cacheKey!==Jt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jt)),this._cacheIndex<0&&mr&&(this._cacheIndex=this._keys.length,this._keys.push(Jt),this._values.push(void 0)),this._cacheIndex},Mt}();function sr(Mt,Jt){return Mt}function Qr(Mt,Jt){return Jt}function st(Mt,Jt){return[Mt,Jt]}}function Er(){return function(){function Ke(){this._map=new Xt}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ke.prototype.has=function(gt){return this._map.has(gt)},Ke.prototype.add=function(gt){return this._map.set(gt,gt),this},Ke.prototype.delete=function(gt){return this._map.delete(gt)},Ke.prototype.clear=function(){this._map.clear()},Ke.prototype.keys=function(){return this._map.keys()},Ke.prototype.values=function(){return this._map.values()},Ke.prototype.entries=function(){return this._map.entries()},Ke.prototype["@@iterator"]=function(){return this.keys()},Ke.prototype[ce]=function(){return this.keys()},Ke}()}function Ar(){var Ke=16,gt=Me.create(),ct=sr();return function(){function mr(){this._key=sr()}return mr.prototype.has=function(gn){var Cn=Qr(gn,!1);return Cn!==void 0?Me.has(Cn,this._key):!1},mr.prototype.get=function(gn){var Cn=Qr(gn,!1);return Cn!==void 0?Me.get(Cn,this._key):void 0},mr.prototype.set=function(gn,Cn){var yi=Qr(gn,!0);return yi[this._key]=Cn,this},mr.prototype.delete=function(gn){var Cn=Qr(gn,!1);return Cn!==void 0?delete Cn[this._key]:!1},mr.prototype.clear=function(){this._key=sr()},mr}();function sr(){var mr;do mr="@@WeakMap@@"+Jt();while(Me.has(gt,mr));return gt[mr]=!0,mr}function Qr(mr,gn){if(!z.call(mr,ct)){if(!gn)return;Object.defineProperty(mr,ct,{value:Me.create()})}return mr[ct]}function st(mr,gn){for(var Cn=0;Cn<gn;++Cn)mr[Cn]=Math.random()*255|0;return mr}function Mt(mr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(mr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(mr)):st(new Uint8Array(mr),mr):st(new Array(mr),mr)}function Jt(){var mr=Mt(Ke);mr[6]=mr[6]&79|64,mr[8]=mr[8]&191|128;for(var gn="",Cn=0;Cn<Ke;++Cn){var yi=mr[Cn];(Cn===4||Cn===6||Cn===8)&&(gn+="-"),yi<16&&(gn+="0"),gn+=yi.toString(16).toLowerCase()}return gn}}function Mr(Ke){return Ke.__=void 0,delete Ke.__,Ke}})})(E||(E={}))},81550:function(pr){(function(O,x){pr.exports=x()})(this,function(){"use strict";var O=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},x=function(U,Se){for(var ze=Object.keys(Se),Qt=0;Qt<ze.length;++Qt)U[ze[Qt]]=Se[ze[Qt]];return U},J=`
`;function E(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function p(U){var Se=new Error("(regl) "+U);throw console.error(Se),Se}function w(U,Se){U||p(Se)}function z(U){return U?": "+U:""}function q(U,Se,ze){U in Se||p("unknown parameter ("+U+")"+z(ze)+". possible values: "+Object.keys(Se).join())}function Y(U,Se){O(U)||p("invalid parameter type"+z(Se)+". must be a typed array")}function ce(U,Se){switch(Se){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function ne(U,Se,ze){ce(U,Se)||p("invalid parameter type"+z(ze)+". expected "+Se+", got "+typeof U)}function be(U,Se){U>=0&&(U|0)===U||p("invalid parameter type, ("+U+")"+z(Se)+". must be a nonnegative integer")}function we(U,Se,ze){Se.indexOf(U)<0&&p("invalid value"+z(ze)+". must be one of: "+Se)}var Me=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Kt(U){Object.keys(U).forEach(function(Se){Me.indexOf(Se)<0&&p('invalid regl constructor argument "'+Se+'". must be one of '+Me)})}function Zt(U,Se){for(U=U+"";U.length<Se;)U=" "+U;return U}function Xt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function zt(U,Se){this.number=U,this.line=Se,this.errors=[]}function Lt(U,Se,ze){this.file=U,this.line=Se,this.message=ze}function yt(){var U=new Error,Se=(U.stack||U).toString(),ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Se);if(ze)return ze[1];var Qt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Se);return Qt?Qt[1]:"unknown"}function pt(){var U=new Error,Se=(U.stack||U).toString(),ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Se);if(ze)return ze[1];var Qt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Se);return Qt?Qt[1]:"unknown"}function Pr(U,Se){var ze=U.split(`
`),Qt=1,wr=0,Yt={unknown:new Xt,0:new Xt};Yt.unknown.name=Yt[0].name=Se||yt(),Yt.unknown.lines.push(new zt(0,""));for(var fr=0;fr<ze.length;++fr){var Zr=ze[fr],Xr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Zr);if(Xr)switch(Xr[1]){case"line":var qr=/(\d+)(\s+\d+)?/.exec(Xr[2]);qr&&(Qt=qr[1]|0,qr[2]&&(wr=qr[2]|0,wr in Yt||(Yt[wr]=new Xt)));break;case"define":var Kr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Xr[2]);Kr&&(Yt[wr].name=Kr[1]?E(Kr[2]):Kr[2]);break}Yt[wr].lines.push(new zt(Qt++,Zr))}return Object.keys(Yt).forEach(function(nn){var fn=Yt[nn];fn.lines.forEach(function(Vr){fn.index[Vr.number]=Vr})}),Yt}function Ht(U){var Se=[];return U.split(`
`).forEach(function(ze){if(!(ze.length<5)){var Qt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ze);Qt?Se.push(new Lt(Qt[1]|0,Qt[2]|0,Qt[3].trim())):ze.length>0&&Se.push(new Lt("unknown",0,ze))}}),Se}function ar(U,Se){Se.forEach(function(ze){var Qt=U[ze.file];if(Qt){var wr=Qt.index[ze.line];if(wr){wr.errors.push(ze),Qt.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push(ze)})}function mt(U,Se,ze,Qt,wr){if(!U.getShaderParameter(Se,U.COMPILE_STATUS)){var Yt=U.getShaderInfoLog(Se),fr=Qt===U.FRAGMENT_SHADER?"fragment":"vertex";nr(ze,"string",fr+" shader source must be a string",wr);var Zr=Pr(ze,wr),Xr=Ht(Yt);ar(Zr,Xr),Object.keys(Zr).forEach(function(qr){var Kr=Zr[qr];if(!Kr.hasErrors)return;var nn=[""],fn=[""];function Vr(an,Ft){nn.push(an),fn.push(Ft||"")}Vr("file number "+qr+": "+Kr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Kr.lines.forEach(function(an){if(an.errors.length>0){Vr(Zt(an.number,4)+"|  ","background-color:yellow; font-weight:bold"),Vr(an.line+J,"color:red; background-color:yellow; font-weight:bold");var Ft=0;an.errors.forEach(function(cr){var Hr=cr.message,mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Hr);if(mn){var Dr=mn[1];switch(Hr=mn[2],Dr){case"assign":Dr="=";break}Ft=Math.max(an.line.indexOf(Dr,Ft),0)}else Ft=0;Vr(Zt("| ",6)),Vr(Zt("^^^",Ft+3)+J,"font-weight:bold"),Vr(Zt("| ",6)),Vr(Hr+J,"font-weight:bold")}),Vr(Zt("| ",6)+J)}else Vr(Zt(an.number,4)+"|  "),Vr(an.line+J,"color:red")}),typeof document!="undefined"&&!window.chrome?(fn[0]=nn.join("%c"),console.log.apply(console,fn)):console.log(nn.join(""))}),w.raise("Error compiling "+fr+" shader, "+Zr[0].name)}}function Ye(U,Se,ze,Qt,wr){if(!U.getProgramParameter(Se,U.LINK_STATUS)){var Yt=U.getProgramInfoLog(Se),fr=Pr(ze,wr),Zr=Pr(Qt,wr),Xr='Error linking program with vertex shader, "'+Zr[0].name+'", and fragment shader "'+fr[0].name+'"';typeof document!="undefined"?console.log("%c"+Xr+J+"%c"+Yt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Xr+J+Yt),w.raise(Xr)}}function bt(U){U._commandRef=yt()}function Fe(U,Se,ze,Qt){bt(U);function wr(Xr){return Xr?Qt.id(Xr):0}U._fragId=wr(U.static.frag),U._vertId=wr(U.static.vert);function Yt(Xr,qr){Object.keys(qr).forEach(function(Kr){Xr[Qt.id(Kr)]=!0})}var fr=U._uniformSet={};Yt(fr,Se.static),Yt(fr,Se.dynamic);var Zr=U._attributeSet={};Yt(Zr,ze.static),Yt(Zr,ze.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function Ae(U,Se){var ze=pt();p(U+" in command "+(Se||yt())+(ze==="unknown"?"":" called from "+ze))}function Ne(U,Se,ze){U||Ae(Se,ze||yt())}function xt(U,Se,ze,Qt){U in Se||Ae("unknown parameter ("+U+")"+z(ze)+". possible values: "+Object.keys(Se).join(),Qt||yt())}function nr(U,Se,ze,Qt){ce(U,Se)||Ae("invalid parameter type"+z(ze)+". expected "+Se+", got "+typeof U,Qt||yt())}function re(U){U()}function Ee(U,Se,ze){U.texture?we(U.texture._texture.internalformat,Se,"unsupported texture format for attachment"):we(U.renderbuffer._renderbuffer.format,ze,"unsupported renderbuffer format for attachment")}var ae=33071,me=9728,Te=9984,Je=9985,dt=9986,$t=9987,Fr=5120,zr=5121,ln=5122,tr=5123,oe=5124,ge=5125,Re=5126,qe=32819,Ct=32820,kt=33635,S=34042,F=36193,he={};he[Fr]=he[zr]=1,he[ln]=he[tr]=he[F]=he[kt]=he[qe]=he[Ct]=2,he[oe]=he[ge]=he[Re]=he[S]=4;function Be(U,Se){return U===Ct||U===qe||U===kt?2:U===S?4:he[U]*Se}function $e(U){return!(U&U-1)&&!!U}function vt(U,Se,ze){var Qt,wr=Se.width,Yt=Se.height,fr=Se.channels;w(wr>0&&wr<=ze.maxTextureSize&&Yt>0&&Yt<=ze.maxTextureSize,"invalid texture shape"),(U.wrapS!==ae||U.wrapT!==ae)&&w($e(wr)&&$e(Yt),"incompatible wrap mode for texture, both width and height must be power of 2"),Se.mipmask===1?wr!==1&&Yt!==1&&w(U.minFilter!==Te&&U.minFilter!==dt&&U.minFilter!==Je&&U.minFilter!==$t,"min filter requires mipmap"):(w($e(wr)&&$e(Yt),"texture must be a square power of 2 to support mipmapping"),w(Se.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),Se.type===Re&&(ze.extensions.indexOf("oes_texture_float_linear")<0&&w(U.minFilter===me&&U.magFilter===me,"filter not supported, must enable oes_texture_float_linear"),w(!U.genMipmaps,"mipmap generation not supported with float textures"));var Zr=Se.images;for(Qt=0;Qt<16;++Qt)if(Zr[Qt]){var Xr=wr>>Qt,qr=Yt>>Qt;w(Se.mipmask&1<<Qt,"missing mipmap data");var Kr=Zr[Qt];if(w(Kr.width===Xr&&Kr.height===qr,"invalid shape for mip images"),w(Kr.format===Se.format&&Kr.internalformat===Se.internalformat&&Kr.type===Se.type,"incompatible type for mip image"),!Kr.compressed)if(Kr.data){var nn=Math.ceil(Be(Kr.type,fr)*Xr/Kr.unpackAlignment)*Kr.unpackAlignment;w(Kr.data.byteLength===nn*qr,"invalid data for image, buffer size is inconsistent with image format")}else Kr.element||Kr.copy}else U.genMipmaps||w((Se.mipmask&1<<Qt)==0,"extra mipmap data");Se.compressed&&w(!U.genMipmaps,"mipmap generation for compressed images not supported")}function wt(U,Se,ze,Qt){var wr=U.width,Yt=U.height,fr=U.channels;w(wr>0&&wr<=Qt.maxTextureSize&&Yt>0&&Yt<=Qt.maxTextureSize,"invalid texture shape"),w(wr===Yt,"cube map must be square"),w(Se.wrapS===ae&&Se.wrapT===ae,"wrap mode not supported by cube map");for(var Zr=0;Zr<ze.length;++Zr){var Xr=ze[Zr];w(Xr.width===wr&&Xr.height===Yt,"inconsistent cube map face shape"),Se.genMipmaps&&(w(!Xr.compressed,"can not generate mipmap for compressed textures"),w(Xr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var qr=Xr.images,Kr=0;Kr<16;++Kr){var nn=qr[Kr];if(nn){var fn=wr>>Kr,Vr=Yt>>Kr;w(Xr.mipmask&1<<Kr,"missing mipmap data"),w(nn.width===fn&&nn.height===Vr,"invalid shape for mip images"),w(nn.format===U.format&&nn.internalformat===U.internalformat&&nn.type===U.type,"incompatible type for mip image"),nn.compressed||(nn.data?w(nn.data.byteLength===fn*Vr*Math.max(Be(nn.type,fr),nn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):nn.element||nn.copy)}}}}var H=x(w,{optional:re,raise:p,commandRaise:Ae,command:Ne,parameter:q,commandParameter:xt,constructor:Kt,type:ne,commandType:nr,isTypedArray:Y,nni:be,oneOf:we,shaderError:mt,linkError:Ye,callSite:pt,saveCommandRef:bt,saveDrawInfo:Fe,framebufferFormat:Ee,guessCommand:yt,texture2D:vt,textureCube:wt}),Wt=0,Vt=0,yr=5,Er=6;function Ar(U,Se){this.id=Wt++,this.type=U,this.data=Se}function Mr(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Ke(U){if(U.length===0)return[];var Se=U.charAt(0),ze=U.charAt(U.length-1);if(U.length>1&&Se===ze&&(Se==='"'||Se==="'"))return['"'+Mr(U.substr(1,U.length-2))+'"'];var Qt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(Qt)return Ke(U.substr(0,Qt.index)).concat(Ke(Qt[1])).concat(Ke(U.substr(Qt.index+Qt[0].length)));var wr=U.split(".");if(wr.length===1)return['"'+Mr(U)+'"'];for(var Yt=[],fr=0;fr<wr.length;++fr)Yt=Yt.concat(Ke(wr[fr]));return Yt}function gt(U){return"["+Ke(U).join("][")+"]"}function ct(U,Se){return new Ar(U,gt(Se+""))}function sr(U){return typeof U=="function"&&!U._reglType||U instanceof Ar}function Qr(U,Se){if(typeof U=="function")return new Ar(Vt,U);if(typeof U=="number"||typeof U=="boolean")return new Ar(yr,U);if(Array.isArray(U))return new Ar(Er,U.map((ze,Qt)=>Qr(ze,Se+"["+Qt+"]")));if(U instanceof Ar)return U;H(!1,"invalid option type in uniform "+Se)}var st={DynamicVariable:Ar,define:ct,isDynamic:sr,unbox:Qr,accessor:gt},Mt={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},Jt=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function mr(){var U={"":0},Se=[""];return{id:function(ze){var Qt=U[ze];return Qt||(Qt=U[ze]=Se.length,Se.push(ze),Qt)},str:function(ze){return Se[ze]}}}function gn(U,Se,ze){var Qt=document.createElement("canvas");x(Qt.style,{border:0,margin:0,padding:0,top:0,left:0}),U.appendChild(Qt),U===document.body&&(Qt.style.position="absolute",x(U.style,{margin:0,padding:0}));function wr(){var Zr=window.innerWidth,Xr=window.innerHeight;if(U!==document.body){var qr=U.getBoundingClientRect();Zr=qr.right-qr.left,Xr=qr.bottom-qr.top}Qt.width=ze*Zr,Qt.height=ze*Xr,x(Qt.style,{width:Zr+"px",height:Xr+"px"})}var Yt;U!==document.body&&typeof ResizeObserver=="function"?(Yt=new ResizeObserver(function(){setTimeout(wr)}),Yt.observe(U)):window.addEventListener("resize",wr,!1);function fr(){Yt?Yt.disconnect():window.removeEventListener("resize",wr),U.removeChild(Qt)}return wr(),{canvas:Qt,onDestroy:fr}}function Cn(U,Se){function ze(Qt){try{return U.getContext(Qt,Se)}catch(wr){return null}}return ze("webgl")||ze("experimental-webgl")||ze("webgl-experimental")}function yi(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function Ei(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function Ii(U){return typeof U=="string"?U.split():(H(Array.isArray(U),"invalid extension array"),U)}function Ji(U){return typeof U=="string"?(H(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function li(U){var Se=U||{},ze,Qt,wr,Yt,fr={},Zr=[],Xr=[],qr=typeof window=="undefined"?1:window.devicePixelRatio,Kr=!1,nn=function(an){an&&H.raise(an)},fn=function(){};if(typeof Se=="string"?(H(typeof document!="undefined","selector queries only supported in DOM enviroments"),ze=document.querySelector(Se),H(ze,"invalid query string for element")):typeof Se=="object"?yi(Se)?ze=Se:Ei(Se)?(Yt=Se,wr=Yt.canvas):(H.constructor(Se),"gl"in Se?Yt=Se.gl:"canvas"in Se?wr=Ji(Se.canvas):"container"in Se&&(Qt=Ji(Se.container)),"attributes"in Se&&(fr=Se.attributes,H.type(fr,"object","invalid context attributes")),"extensions"in Se&&(Zr=Ii(Se.extensions)),"optionalExtensions"in Se&&(Xr=Ii(Se.optionalExtensions)),"onDone"in Se&&(H.type(Se.onDone,"function","invalid or missing onDone callback"),nn=Se.onDone),"profile"in Se&&(Kr=!!Se.profile),"pixelRatio"in Se&&(qr=+Se.pixelRatio,H(qr>0,"invalid pixel ratio"))):H.raise("invalid arguments to regl"),ze&&(ze.nodeName.toLowerCase()==="canvas"?wr=ze:Qt=ze),!Yt){if(!wr){H(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Vr=gn(Qt||document.body,nn,qr);if(!Vr)return null;wr=Vr.canvas,fn=Vr.onDestroy}fr.premultipliedAlpha===void 0&&(fr.premultipliedAlpha=!0),Yt=Cn(wr,fr)}return Yt?{gl:Yt,canvas:wr,container:Qt,extensions:Zr,optionalExtensions:Xr,pixelRatio:qr,profile:Kr,onDone:nn,onDestroy:fn}:(fn(),nn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function G(U,Se){var ze={};function Qt(fr){H.type(fr,"string","extension name must be string");var Zr=fr.toLowerCase(),Xr;try{Xr=ze[Zr]=U.getExtension(Zr)}catch(qr){}return!!Xr}for(var wr=0;wr<Se.extensions.length;++wr){var Yt=Se.extensions[wr];if(!Qt(Yt))return Se.onDestroy(),Se.onDone('"'+Yt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Se.optionalExtensions.forEach(Qt),{extensions:ze,restore:function(){Object.keys(ze).forEach(function(fr){if(ze[fr]&&!Qt(fr))throw new Error("(regl): error restoring extension "+fr)})}}}function I(U,Se){for(var ze=Array(U),Qt=0;Qt<U;++Qt)ze[Qt]=Se(Qt);return ze}var j=5120,K=5121,ie=5122,Oe=5123,He=5124,ue=5125,De=5126;function St(U){for(var Se=16;Se<=1<<28;Se*=16)if(U<=Se)return Se;return 0}function Ir(U){var Se,ze;return Se=(U>65535)<<4,U>>>=Se,ze=(U>255)<<3,U>>>=ze,Se|=ze,ze=(U>15)<<2,U>>>=ze,Se|=ze,ze=(U>3)<<1,U>>>=ze,Se|=ze,Se|U>>1}function Br(){var U=I(8,function(){return[]});function Se(Yt){var fr=St(Yt),Zr=U[Ir(fr)>>2];return Zr.length>0?Zr.pop():new ArrayBuffer(fr)}function ze(Yt){U[Ir(Yt.byteLength)>>2].push(Yt)}function Qt(Yt,fr){var Zr=null;switch(Yt){case j:Zr=new Int8Array(Se(fr),0,fr);break;case K:Zr=new Uint8Array(Se(fr),0,fr);break;case ie:Zr=new Int16Array(Se(2*fr),0,fr);break;case Oe:Zr=new Uint16Array(Se(2*fr),0,fr);break;case He:Zr=new Int32Array(Se(4*fr),0,fr);break;case ue:Zr=new Uint32Array(Se(4*fr),0,fr);break;case De:Zr=new Float32Array(Se(4*fr),0,fr);break;default:return null}return Zr.length!==fr?Zr.subarray(0,fr):Zr}function wr(Yt){ze(Yt.buffer)}return{alloc:Se,free:ze,allocType:Qt,freeType:wr}}var jt=Br();jt.zero=Br();var dr=3408,Wr=3410,yn=3411,vr=3412,vn=3413,$r=3414,cn=3415,di=33901,hn=33902,bi=3379,Qi=3386,_i=34921,Oi=36347,Ci=36348,yo=35661,Zi=35660,Rn=34930,Dn=36349,hi=34076,jn=34024,Oa=7936,hs=7937,Li=7938,La=35724,gu=34047,su=36063,ga=34852,so=3553,Ga=34067,Ha=34069,Ho=33984,sa=6408,Wa=5126,Ea=5121,ya=36160,ia=36053,ol=36064,ns=16384,to=function(U,Se){var ze=1;Se.ext_texture_filter_anisotropic&&(ze=U.getParameter(gu));var Qt=1,wr=1;Se.webgl_draw_buffers&&(Qt=U.getParameter(ga),wr=U.getParameter(su));var Yt=!!Se.oes_texture_float;if(Yt){var fr=U.createTexture();U.bindTexture(so,fr),U.texImage2D(so,0,sa,1,1,0,sa,Wa,null);var Zr=U.createFramebuffer();if(U.bindFramebuffer(ya,Zr),U.framebufferTexture2D(ya,ol,so,fr,0),U.bindTexture(so,null),U.checkFramebufferStatus(ya)!==ia)Yt=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(ns);var Xr=jt.allocType(Wa,4);U.readPixels(0,0,1,1,sa,Wa,Xr),U.getError()?Yt=!1:(U.deleteFramebuffer(Zr),U.deleteTexture(fr),Yt=Xr[0]===1),jt.freeType(Xr)}}var qr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Kr=!0;if(!qr){var nn=U.createTexture(),fn=jt.allocType(Ea,36);U.activeTexture(Ho),U.bindTexture(Ga,nn),U.texImage2D(Ha,0,sa,3,3,0,sa,Ea,fn),jt.freeType(fn),U.bindTexture(Ga,null),U.deleteTexture(nn),Kr=!U.getError()}return{colorBits:[U.getParameter(Wr),U.getParameter(yn),U.getParameter(vr),U.getParameter(vn)],depthBits:U.getParameter($r),stencilBits:U.getParameter(cn),subpixelBits:U.getParameter(dr),extensions:Object.keys(Se).filter(function(Vr){return!!Se[Vr]}),maxAnisotropic:ze,maxDrawbuffers:Qt,maxColorAttachments:wr,pointSizeDims:U.getParameter(di),lineWidthDims:U.getParameter(hn),maxViewportDims:U.getParameter(Qi),maxCombinedTextureUnits:U.getParameter(yo),maxCubeMapSize:U.getParameter(hi),maxRenderbufferSize:U.getParameter(jn),maxTextureUnits:U.getParameter(Rn),maxTextureSize:U.getParameter(bi),maxAttributes:U.getParameter(_i),maxVertexUniforms:U.getParameter(Oi),maxVertexTextureUnits:U.getParameter(Zi),maxVaryingVectors:U.getParameter(Ci),maxFragmentUniforms:U.getParameter(Dn),glsl:U.getParameter(La),renderer:U.getParameter(hs),vendor:U.getParameter(Oa),version:U.getParameter(Li),readFloat:Yt,npotTextureCube:Kr}};function Aa(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||O(U.data))}var fa=function(U){return Object.keys(U).map(function(Se){return U[Se]})},fe={shape:Vi,flatten:kn};function Pe(U,Se,ze){for(var Qt=0;Qt<Se;++Qt)ze[Qt]=U[Qt]}function ft(U,Se,ze,Qt){for(var wr=0,Yt=0;Yt<Se;++Yt)for(var fr=U[Yt],Zr=0;Zr<ze;++Zr)Qt[wr++]=fr[Zr]}function ur(U,Se,ze,Qt,wr,Yt){for(var fr=Yt,Zr=0;Zr<Se;++Zr)for(var Xr=U[Zr],qr=0;qr<ze;++qr)for(var Kr=Xr[qr],nn=0;nn<Qt;++nn)wr[fr++]=Kr[nn]}function en(U,Se,ze,Qt,wr){for(var Yt=1,fr=ze+1;fr<Se.length;++fr)Yt*=Se[fr];var Zr=Se[ze];if(Se.length-ze==4){var Xr=Se[ze+1],qr=Se[ze+2],Kr=Se[ze+3];for(fr=0;fr<Zr;++fr)ur(U[fr],Xr,qr,Kr,Qt,wr),wr+=Yt}else for(fr=0;fr<Zr;++fr)en(U[fr],Se,ze+1,Qt,wr),wr+=Yt}function kn(U,Se,ze,Qt){var wr=1;if(Se.length)for(var Yt=0;Yt<Se.length;++Yt)wr*=Se[Yt];else wr=0;var fr=Qt||jt.allocType(ze,wr);switch(Se.length){case 0:break;case 1:Pe(U,Se[0],fr);break;case 2:ft(U,Se[0],Se[1],fr);break;case 3:ur(U,Se[0],Se[1],Se[2],fr,0);break;default:en(U,Se,0,fr,0)}return fr}function Vi(U){for(var Se=[],ze=U;ze.length;ze=ze[0])Se.push(ze.length);return Se}var qi={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xa=5120,Ya=5122,Wo=5124,xs=5121,jl=5123,Ku=5125,Do=5126,Cs=5126,uo={int8:Xa,int16:Ya,int32:Wo,uint8:xs,uint16:jl,uint32:Ku,float:Do,float32:Cs},Ps=35048,Ca=35040,pi={dynamic:Ps,stream:Ca,static:35044},sl=fe.flatten,Ra=fe.shape,zn=35044,Ks=35040,Zl=5121,lo=5126,je=[];je[5120]=1,je[5122]=2,je[5124]=4,je[5121]=1,je[5123]=2,je[5125]=4,je[5126]=4;function Tt(U){return qi[Object.prototype.toString.call(U)]|0}function gr(U,Se){for(var ze=0;ze<Se.length;++ze)U[ze]=Se[ze]}function In(U,Se,ze,Qt,wr,Yt,fr){for(var Zr=0,Xr=0;Xr<ze;++Xr)for(var qr=0;qr<Qt;++qr)U[Zr++]=Se[wr*Xr+Yt*qr+fr]}function Yi(U,Se,ze,Qt){var wr=0,Yt={};function fr(Ft){this.id=wr++,this.buffer=U.createBuffer(),this.type=Ft,this.usage=zn,this.byteLength=0,this.dimension=1,this.dtype=Zl,this.persistentData=null,ze.profile&&(this.stats={size:0})}fr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},fr.prototype.destroy=function(){fn(this)};var Zr=[];function Xr(Ft,cr){var Hr=Zr.pop();return Hr||(Hr=new fr(Ft)),Hr.bind(),nn(Hr,cr,Ks,0,1,!1),Hr}function qr(Ft){Zr.push(Ft)}function Kr(Ft,cr,Hr){Ft.byteLength=cr.byteLength,U.bufferData(Ft.type,cr,Hr)}function nn(Ft,cr,Hr,mn,Dr,wn){var Nr;if(Ft.usage=Hr,Array.isArray(cr)){if(Ft.dtype=mn||lo,cr.length>0){var sn;if(Array.isArray(cr[0])){Nr=Ra(cr);for(var Rr=1,on=1;on<Nr.length;++on)Rr*=Nr[on];Ft.dimension=Rr,sn=sl(cr,Nr,Ft.dtype),Kr(Ft,sn,Hr),wn?Ft.persistentData=sn:jt.freeType(sn)}else if(typeof cr[0]=="number"){Ft.dimension=Dr;var Yn=jt.allocType(Ft.dtype,cr.length);gr(Yn,cr),Kr(Ft,Yn,Hr),wn?Ft.persistentData=Yn:jt.freeType(Yn)}else O(cr[0])?(Ft.dimension=cr[0].length,Ft.dtype=mn||Tt(cr[0])||lo,sn=sl(cr,[cr.length,cr[0].length],Ft.dtype),Kr(Ft,sn,Hr),wn?Ft.persistentData=sn:jt.freeType(sn)):H.raise("invalid buffer data")}}else if(O(cr))Ft.dtype=mn||Tt(cr),Ft.dimension=Dr,Kr(Ft,cr,Hr),wn&&(Ft.persistentData=new Uint8Array(new Uint8Array(cr.buffer)));else if(Aa(cr)){Nr=cr.shape;var $n=cr.stride,un=cr.offset,kr=0,Or=0,fi=0,Qn=0;Nr.length===1?(kr=Nr[0],Or=1,fi=$n[0],Qn=0):Nr.length===2?(kr=Nr[0],Or=Nr[1],fi=$n[0],Qn=$n[1]):H.raise("invalid shape"),Ft.dtype=mn||Tt(cr.data)||lo,Ft.dimension=Or;var On=jt.allocType(Ft.dtype,kr*Or);In(On,cr.data,kr,Or,fi,Qn,un),Kr(Ft,On,Hr),wn?Ft.persistentData=On:jt.freeType(On)}else cr instanceof ArrayBuffer?(Ft.dtype=Zl,Ft.dimension=Dr,Kr(Ft,cr,Hr),wn&&(Ft.persistentData=new Uint8Array(new Uint8Array(cr)))):H.raise("invalid buffer data")}function fn(Ft){Se.bufferCount--,Qt(Ft);var cr=Ft.buffer;H(cr,"buffer must not be deleted already"),U.deleteBuffer(cr),Ft.buffer=null,delete Yt[Ft.id]}function Vr(Ft,cr,Hr,mn){Se.bufferCount++;var Dr=new fr(cr);Yt[Dr.id]=Dr;function wn(Rr){var on=zn,Yn=null,$n=0,un=0,kr=1;return Array.isArray(Rr)||O(Rr)||Aa(Rr)||Rr instanceof ArrayBuffer?Yn=Rr:typeof Rr=="number"?$n=Rr|0:Rr&&(H.type(Rr,"object","buffer arguments must be an object, a number or an array"),"data"in Rr&&(H(Yn===null||Array.isArray(Yn)||O(Yn)||Aa(Yn),"invalid data for buffer"),Yn=Rr.data),"usage"in Rr&&(H.parameter(Rr.usage,pi,"invalid buffer usage"),on=pi[Rr.usage]),"type"in Rr&&(H.parameter(Rr.type,uo,"invalid buffer type"),un=uo[Rr.type]),"dimension"in Rr&&(H.type(Rr.dimension,"number","invalid dimension"),kr=Rr.dimension|0),"length"in Rr&&(H.nni($n,"buffer length must be a nonnegative integer"),$n=Rr.length|0)),Dr.bind(),Yn?nn(Dr,Yn,on,un,kr,mn):($n&&U.bufferData(Dr.type,$n,on),Dr.dtype=un||Zl,Dr.usage=on,Dr.dimension=kr,Dr.byteLength=$n),ze.profile&&(Dr.stats.size=Dr.byteLength*je[Dr.dtype]),wn}function Nr(Rr,on){H(on+Rr.byteLength<=Dr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Rr.byteLength+" starting from offset "+on+" to a buffer of size "+Dr.byteLength),U.bufferSubData(Dr.type,on,Rr)}function sn(Rr,on){var Yn=(on||0)|0,$n;if(Dr.bind(),O(Rr)||Rr instanceof ArrayBuffer)Nr(Rr,Yn);else if(Array.isArray(Rr)){if(Rr.length>0)if(typeof Rr[0]=="number"){var un=jt.allocType(Dr.dtype,Rr.length);gr(un,Rr),Nr(un,Yn),jt.freeType(un)}else if(Array.isArray(Rr[0])||O(Rr[0])){$n=Ra(Rr);var kr=sl(Rr,$n,Dr.dtype);Nr(kr,Yn),jt.freeType(kr)}else H.raise("invalid buffer data")}else if(Aa(Rr)){$n=Rr.shape;var Or=Rr.stride,fi=0,Qn=0,On=0,Ni=0;$n.length===1?(fi=$n[0],Qn=1,On=Or[0],Ni=0):$n.length===2?(fi=$n[0],Qn=$n[1],On=Or[0],Ni=Or[1]):H.raise("invalid shape");var Ti=Array.isArray(Rr.data)?Dr.dtype:Tt(Rr.data),Bi=jt.allocType(Ti,fi*Qn);In(Bi,Rr.data,fi,Qn,On,Ni,Rr.offset),Nr(Bi,Yn),jt.freeType(Bi)}else H.raise("invalid data for buffer subdata");return wn}return Hr||wn(Ft),wn._reglType="buffer",wn._buffer=Dr,wn.subdata=sn,ze.profile&&(wn.stats=Dr.stats),wn.destroy=function(){fn(Dr)},wn}function an(){fa(Yt).forEach(function(Ft){Ft.buffer=U.createBuffer(),U.bindBuffer(Ft.type,Ft.buffer),U.bufferData(Ft.type,Ft.persistentData||Ft.byteLength,Ft.usage)})}return ze.profile&&(Se.getTotalBufferSize=function(){var Ft=0;return Object.keys(Yt).forEach(function(cr){Ft+=Yt[cr].stats.size}),Ft}),{create:Vr,createStream:Xr,destroyStream:qr,clear:function(){fa(Yt).forEach(fn),Zr.forEach(fn)},getBuffer:function(Ft){return Ft&&Ft._buffer instanceof fr?Ft._buffer:null},restore:an,_initBuffer:nn}}var _a=0,Ba=0,aa=1,Pa=1,ko=4,Mo=4,Ri={points:_a,point:Ba,lines:aa,line:Pa,triangles:ko,triangle:Mo,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},wl=0,Us=1,ps=4,Vl=5120,co=5121,is=5122,as=5123,uu=5124,Ms=5125,pc=34963,vf=35040,xa=35044;function mf(U,Se,ze,Qt){var wr={},Yt=0,fr={uint8:co,uint16:as};Se.oes_element_index_uint&&(fr.uint32=Ms);function Zr(an){this.id=Yt++,wr[this.id]=this,this.buffer=an,this.primType=ps,this.vertCount=0,this.type=0}Zr.prototype.bind=function(){this.buffer.bind()};var Xr=[];function qr(an){var Ft=Xr.pop();return Ft||(Ft=new Zr(ze.create(null,pc,!0,!1)._buffer)),nn(Ft,an,vf,-1,-1,0,0),Ft}function Kr(an){Xr.push(an)}function nn(an,Ft,cr,Hr,mn,Dr,wn){an.buffer.bind();var Nr;if(Ft){var sn=wn;!wn&&(!O(Ft)||Aa(Ft)&&!O(Ft.data))&&(sn=Se.oes_element_index_uint?Ms:as),ze._initBuffer(an.buffer,Ft,cr,sn,3)}else U.bufferData(pc,Dr,cr),an.buffer.dtype=Nr||co,an.buffer.usage=cr,an.buffer.dimension=3,an.buffer.byteLength=Dr;if(Nr=wn,!wn){switch(an.buffer.dtype){case co:case Vl:Nr=co;break;case as:case is:Nr=as;break;case Ms:case uu:Nr=Ms;break;default:H.raise("unsupported type for element array")}an.buffer.dtype=Nr}an.type=Nr,H(Nr!==Ms||!!Se.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Rr=mn;Rr<0&&(Rr=an.buffer.byteLength,Nr===as?Rr>>=1:Nr===Ms&&(Rr>>=2)),an.vertCount=Rr;var on=Hr;if(Hr<0){on=ps;var Yn=an.buffer.dimension;Yn===1&&(on=wl),Yn===2&&(on=Us),Yn===3&&(on=ps)}an.primType=on}function fn(an){Qt.elementsCount--,H(an.buffer!==null,"must not double destroy elements"),delete wr[an.id],an.buffer.destroy(),an.buffer=null}function Vr(an,Ft){var cr=ze.create(null,pc,!0),Hr=new Zr(cr._buffer);Qt.elementsCount++;function mn(Dr){if(!Dr)cr(),Hr.primType=ps,Hr.vertCount=0,Hr.type=co;else if(typeof Dr=="number")cr(Dr),Hr.primType=ps,Hr.vertCount=Dr|0,Hr.type=co;else{var wn=null,Nr=xa,sn=-1,Rr=-1,on=0,Yn=0;Array.isArray(Dr)||O(Dr)||Aa(Dr)?wn=Dr:(H.type(Dr,"object","invalid arguments for elements"),"data"in Dr&&(wn=Dr.data,H(Array.isArray(wn)||O(wn)||Aa(wn),"invalid data for element buffer")),"usage"in Dr&&(H.parameter(Dr.usage,pi,"invalid element buffer usage"),Nr=pi[Dr.usage]),"primitive"in Dr&&(H.parameter(Dr.primitive,Ri,"invalid element buffer primitive"),sn=Ri[Dr.primitive]),"count"in Dr&&(H(typeof Dr.count=="number"&&Dr.count>=0,"invalid vertex count for elements"),Rr=Dr.count|0),"type"in Dr&&(H.parameter(Dr.type,fr,"invalid buffer type"),Yn=fr[Dr.type]),"length"in Dr?on=Dr.length|0:(on=Rr,Yn===as||Yn===is?on*=2:(Yn===Ms||Yn===uu)&&(on*=4))),nn(Hr,wn,Nr,sn,Rr,on,Yn)}return mn}return mn(an),mn._reglType="elements",mn._elements=Hr,mn.subdata=function(Dr,wn){return cr.subdata(Dr,wn),mn},mn.destroy=function(){fn(Hr)},mn}return{create:Vr,createStream:qr,destroyStream:Kr,getElements:function(an){return typeof an=="function"&&an._elements instanceof Zr?an._elements:null},clear:function(){fa(wr).forEach(fn)}}}var lu=new Float32Array(1),Gl=new Uint32Array(lu.buffer),Ic=5123;function Oc(U){for(var Se=jt.allocType(Ic,U.length),ze=0;ze<U.length;++ze)if(isNaN(U[ze]))Se[ze]=65535;else if(U[ze]===Infinity)Se[ze]=31744;else if(U[ze]===-Infinity)Se[ze]=64512;else{lu[0]=U[ze];var Qt=Gl[0],wr=Qt>>>31<<15,Yt=(Qt<<1>>>24)-127,fr=Qt>>13&(1<<10)-1;if(Yt<-24)Se[ze]=wr;else if(Yt<-14){var Zr=-14-Yt;Se[ze]=wr+(fr+(1<<10)>>Zr)}else Yt>15?Se[ze]=wr+31744:Se[ze]=wr+(Yt+15<<10)+fr}return Se}function ro(U){return Array.isArray(U)||O(U)}var yu=function(U){return!(U&U-1)&&!!U},$u=34467,Ua=3553,Lc=34067,Tl=34069,Ou=6408,ul=6406,Hl=6407,Ju=6409,Is=6410,Al=32854,Cl=32855,Ui=36194,dc=32819,gf=32820,Wl=33635,Jc=34042,Rc=6402,Xl=34041,Yl=35904,ll=35906,Lu=36193,Pl=33776,cl=33777,cu=33778,Dc=33779,Ml=35986,$s=35987,Qc=34798,yf=35840,qc=35841,ba=35842,Il=35843,Ol=36196,Ru=5121,fl=5123,vc=5125,Du=5126,kc=10242,ef=10243,tf=10497,Ll=33071,zc=33648,Fc=10240,Nc=10241,hl=9728,Bc=9729,ku=9984,Ma=9985,Kl=9986,Ka=9987,Qu=33170,Fi=4352,Ta=4353,js=4354,$l=34046,Rl=3317,Jl=37440,_f=37441,xf=37443,Dl=37444,zu=33984,Fu=[ku,Kl,Ma,Ka],no=[0,Ju,Is,Hl,Ou],ds={};ds[Ju]=ds[ul]=ds[Rc]=1,ds[Xl]=ds[Is]=2,ds[Hl]=ds[Yl]=3,ds[Ou]=ds[ll]=4;function pl(U){return"[object "+U+"]"}var fo=pl("HTMLCanvasElement"),Tn=pl("OffscreenCanvas"),Zs=pl("CanvasRenderingContext2D"),mc=pl("ImageBitmap"),kl=pl("HTMLImageElement"),fu=pl("HTMLVideoElement"),Vs=Object.keys(qi).concat([fo,Tn,Zs,mc,kl,fu]),dl=[];dl[Ru]=1,dl[Du]=4,dl[Lu]=2,dl[fl]=2,dl[vc]=4;var Jr=[];Jr[Al]=2,Jr[Cl]=2,Jr[Ui]=2,Jr[Xl]=4,Jr[Pl]=.5,Jr[cl]=.5,Jr[cu]=1,Jr[Dc]=1,Jr[Ml]=.5,Jr[$s]=1,Jr[Qc]=1,Jr[yf]=.5,Jr[qc]=.25,Jr[ba]=.5,Jr[Il]=.25,Jr[Ol]=.5;function gc(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function Ql(U){if(!Array.isArray(U))return!1;var Se=U.length;return!(Se===0||!ro(U[0]))}function Nu(U){return Object.prototype.toString.call(U)}function Gs(U){return Nu(U)===fo}function bs(U){return Nu(U)===Tn}function vl(U){return Nu(U)===Zs}function yc(U){return Nu(U)===mc}function Hs(U){return Nu(U)===kl}function qu(U){return Nu(U)===fu}function Uc(U){if(!U)return!1;var Se=Nu(U);return Vs.indexOf(Se)>=0?!0:gc(U)||Ql(U)||Aa(U)}function ql(U){return qi[Object.prototype.toString.call(U)]|0}function rf(U,Se){var ze=Se.length;switch(U.type){case Ru:case fl:case vc:case Du:var Qt=jt.allocType(U.type,ze);Qt.set(Se),U.data=Qt;break;case Lu:U.data=Oc(Se);break;default:H.raise("unsupported texture type, must specify a typed array")}}function jc(U,Se){return jt.allocType(U.type===Lu?Du:U.type,Se)}function _u(U,Se){U.type===Lu?(U.data=Oc(Se),jt.freeType(Se)):U.data=Se}function Js(U,Se,ze,Qt,wr,Yt){for(var fr=U.width,Zr=U.height,Xr=U.channels,qr=fr*Zr*Xr,Kr=jc(U,qr),nn=0,fn=0;fn<Zr;++fn)for(var Vr=0;Vr<fr;++Vr)for(var an=0;an<Xr;++an)Kr[nn++]=Se[ze*Vr+Qt*fn+wr*an+Yt];_u(U,Kr)}function Di(U,Se,ze,Qt,wr,Yt){var fr;if(typeof Jr[U]!="undefined"?fr=Jr[U]:fr=ds[U]*dl[Se],Yt&&(fr*=6),wr){for(var Zr=0,Xr=ze;Xr>=1;)Zr+=fr*Xr*Xr,Xr/=2;return Zr}else return fr*ze*Qt}function Bu(U,Se,ze,Qt,wr,Yt,fr){var Zr={"don't care":Fi,"dont care":Fi,nice:js,fast:Ta},Xr={repeat:tf,clamp:Ll,mirror:zc},qr={nearest:hl,linear:Bc},Kr=x({mipmap:Ka,"nearest mipmap nearest":ku,"linear mipmap nearest":Ma,"nearest mipmap linear":Kl,"linear mipmap linear":Ka},qr),nn={none:0,browser:Dl},fn={uint8:Ru,rgba4:dc,rgb565:Wl,"rgb5 a1":gf},Vr={alpha:ul,luminance:Ju,"luminance alpha":Is,rgb:Hl,rgba:Ou,rgba4:Al,"rgb5 a1":Cl,rgb565:Ui},an={};Se.ext_srgb&&(Vr.srgb=Yl,Vr.srgba=ll),Se.oes_texture_float&&(fn.float32=fn.float=Du),Se.oes_texture_half_float&&(fn.float16=fn["half float"]=Lu),Se.webgl_depth_texture&&(x(Vr,{depth:Rc,"depth stencil":Xl}),x(fn,{uint16:fl,uint32:vc,"depth stencil":Jc})),Se.webgl_compressed_texture_s3tc&&x(an,{"rgb s3tc dxt1":Pl,"rgba s3tc dxt1":cl,"rgba s3tc dxt3":cu,"rgba s3tc dxt5":Dc}),Se.webgl_compressed_texture_atc&&x(an,{"rgb atc":Ml,"rgba atc explicit alpha":$s,"rgba atc interpolated alpha":Qc}),Se.webgl_compressed_texture_pvrtc&&x(an,{"rgb pvrtc 4bppv1":yf,"rgb pvrtc 2bppv1":qc,"rgba pvrtc 4bppv1":ba,"rgba pvrtc 2bppv1":Il}),Se.webgl_compressed_texture_etc1&&(an["rgb etc1"]=Ol);var Ft=Array.prototype.slice.call(U.getParameter($u));Object.keys(an).forEach(function(Ve){var qt=an[Ve];Ft.indexOf(qt)>=0&&(Vr[Ve]=qt)});var cr=Object.keys(Vr);ze.textureFormats=cr;var Hr=[];Object.keys(Vr).forEach(function(Ve){var qt=Vr[Ve];Hr[qt]=Ve});var mn=[];Object.keys(fn).forEach(function(Ve){var qt=fn[Ve];mn[qt]=Ve});var Dr=[];Object.keys(qr).forEach(function(Ve){var qt=qr[Ve];Dr[qt]=Ve});var wn=[];Object.keys(Kr).forEach(function(Ve){var qt=Kr[Ve];wn[qt]=Ve});var Nr=[];Object.keys(Xr).forEach(function(Ve){var qt=Xr[Ve];Nr[qt]=Ve});var sn=cr.reduce(function(Ve,qt){var Ut=Vr[qt];return Ut===Ju||Ut===ul||Ut===Ju||Ut===Is||Ut===Rc||Ut===Xl||Se.ext_srgb&&(Ut===Yl||Ut===ll)?Ve[Ut]=Ut:Ut===Cl||qt.indexOf("rgba")>=0?Ve[Ut]=Ou:Ve[Ut]=Hl,Ve},{});function Rr(){this.internalformat=Ou,this.format=Ou,this.type=Ru,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Dl,this.width=0,this.height=0,this.channels=0}function on(Ve,qt){Ve.internalformat=qt.internalformat,Ve.format=qt.format,Ve.type=qt.type,Ve.compressed=qt.compressed,Ve.premultiplyAlpha=qt.premultiplyAlpha,Ve.flipY=qt.flipY,Ve.unpackAlignment=qt.unpackAlignment,Ve.colorSpace=qt.colorSpace,Ve.width=qt.width,Ve.height=qt.height,Ve.channels=qt.channels}function Yn(Ve,qt){if(!(typeof qt!="object"||!qt)){if("premultiplyAlpha"in qt&&(H.type(qt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ve.premultiplyAlpha=qt.premultiplyAlpha),"flipY"in qt&&(H.type(qt.flipY,"boolean","invalid texture flip"),Ve.flipY=qt.flipY),"alignment"in qt&&(H.oneOf(qt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ve.unpackAlignment=qt.alignment),"colorSpace"in qt&&(H.parameter(qt.colorSpace,nn,"invalid colorSpace"),Ve.colorSpace=nn[qt.colorSpace]),"type"in qt){var Ut=qt.type;H(Se.oes_texture_float||!(Ut==="float"||Ut==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),H(Se.oes_texture_half_float||!(Ut==="half float"||Ut==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),H(Se.webgl_depth_texture||!(Ut==="uint16"||Ut==="uint32"||Ut==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(Ut,fn,"invalid texture type"),Ve.type=fn[Ut]}var An=Ve.width,Xi=Ve.height,Ie=Ve.channels,ye=!1;"shape"in qt?(H(Array.isArray(qt.shape)&&qt.shape.length>=2,"shape must be an array"),An=qt.shape[0],Xi=qt.shape[1],qt.shape.length===3&&(Ie=qt.shape[2],H(Ie>0&&Ie<=4,"invalid number of channels"),ye=!0),H(An>=0&&An<=ze.maxTextureSize,"invalid width"),H(Xi>=0&&Xi<=ze.maxTextureSize,"invalid height")):("radius"in qt&&(An=Xi=qt.radius,H(An>=0&&An<=ze.maxTextureSize,"invalid radius")),"width"in qt&&(An=qt.width,H(An>=0&&An<=ze.maxTextureSize,"invalid width")),"height"in qt&&(Xi=qt.height,H(Xi>=0&&Xi<=ze.maxTextureSize,"invalid height")),"channels"in qt&&(Ie=qt.channels,H(Ie>0&&Ie<=4,"invalid number of channels"),ye=!0)),Ve.width=An|0,Ve.height=Xi|0,Ve.channels=Ie|0;var it=!1;if("format"in qt){var It=qt.format;H(Se.webgl_depth_texture||!(It==="depth"||It==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),H.parameter(It,Vr,"invalid texture format");var Dt=Ve.internalformat=Vr[It];Ve.format=sn[Dt],It in fn&&("type"in qt||(Ve.type=fn[It])),It in an&&(Ve.compressed=!0),it=!0}!ye&&it?Ve.channels=ds[Ve.format]:ye&&!it?Ve.channels!==no[Ve.format]&&(Ve.format=Ve.internalformat=no[Ve.channels]):it&&ye&&H(Ve.channels===ds[Ve.format],"number of channels inconsistent with specified format")}}function $n(Ve){U.pixelStorei(Jl,Ve.flipY),U.pixelStorei(_f,Ve.premultiplyAlpha),U.pixelStorei(xf,Ve.colorSpace),U.pixelStorei(Rl,Ve.unpackAlignment)}function un(){Rr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function kr(Ve,qt){var Ut=null;if(Uc(qt)?Ut=qt:qt&&(H.type(qt,"object","invalid pixel data type"),Yn(Ve,qt),"x"in qt&&(Ve.xOffset=qt.x|0),"y"in qt&&(Ve.yOffset=qt.y|0),Uc(qt.data)&&(Ut=qt.data)),H(!Ve.compressed||Ut instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),qt.copy){H(!Ut,"can not specify copy and data field for the same texture");var An=wr.viewportWidth,Xi=wr.viewportHeight;Ve.width=Ve.width||An-Ve.xOffset,Ve.height=Ve.height||Xi-Ve.yOffset,Ve.needsCopy=!0,H(Ve.xOffset>=0&&Ve.xOffset<An&&Ve.yOffset>=0&&Ve.yOffset<Xi&&Ve.width>0&&Ve.width<=An&&Ve.height>0&&Ve.height<=Xi,"copy texture read out of bounds")}else if(!Ut)Ve.width=Ve.width||1,Ve.height=Ve.height||1,Ve.channels=Ve.channels||4;else if(O(Ut))Ve.channels=Ve.channels||4,Ve.data=Ut,!("type"in qt)&&Ve.type===Ru&&(Ve.type=ql(Ut));else if(gc(Ut))Ve.channels=Ve.channels||4,rf(Ve,Ut),Ve.alignment=1,Ve.needsFree=!0;else if(Aa(Ut)){var Ie=Ut.data;!Array.isArray(Ie)&&Ve.type===Ru&&(Ve.type=ql(Ie));var ye=Ut.shape,it=Ut.stride,It,Dt,lt,at,_t,Le;ye.length===3?(lt=ye[2],Le=it[2]):(H(ye.length===2,"invalid ndarray pixel data, must be 2 or 3D"),lt=1,Le=1),It=ye[0],Dt=ye[1],at=it[0],_t=it[1],Ve.alignment=1,Ve.width=It,Ve.height=Dt,Ve.channels=lt,Ve.format=Ve.internalformat=no[lt],Ve.needsFree=!0,Js(Ve,Ie,at,_t,Le,Ut.offset)}else if(Gs(Ut)||bs(Ut)||vl(Ut))Gs(Ut)||bs(Ut)?Ve.element=Ut:Ve.element=Ut.canvas,Ve.width=Ve.element.width,Ve.height=Ve.element.height,Ve.channels=4;else if(yc(Ut))Ve.element=Ut,Ve.width=Ut.width,Ve.height=Ut.height,Ve.channels=4;else if(Hs(Ut))Ve.element=Ut,Ve.width=Ut.naturalWidth,Ve.height=Ut.naturalHeight,Ve.channels=4;else if(qu(Ut))Ve.element=Ut,Ve.width=Ut.videoWidth,Ve.height=Ut.videoHeight,Ve.channels=4;else if(Ql(Ut)){var et=Ve.width||Ut[0].length,Ce=Ve.height||Ut.length,Et=Ve.channels;ro(Ut[0][0])?Et=Et||Ut[0][0].length:Et=Et||1;for(var Rt=fe.shape(Ut),_r=1,er=0;er<Rt.length;++er)_r*=Rt[er];var br=jc(Ve,_r);fe.flatten(Ut,Rt,"",br),_u(Ve,br),Ve.alignment=1,Ve.width=et,Ve.height=Ce,Ve.channels=Et,Ve.format=Ve.internalformat=no[Et],Ve.needsFree=!0}Ve.type===Du?H(ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ve.type===Lu&&H(ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Or(Ve,qt,Ut){var An=Ve.element,Xi=Ve.data,Ie=Ve.internalformat,ye=Ve.format,it=Ve.type,It=Ve.width,Dt=Ve.height;$n(Ve),An?U.texImage2D(qt,Ut,ye,ye,it,An):Ve.compressed?U.compressedTexImage2D(qt,Ut,Ie,It,Dt,0,Xi):Ve.needsCopy?(Qt(),U.copyTexImage2D(qt,Ut,ye,Ve.xOffset,Ve.yOffset,It,Dt,0)):U.texImage2D(qt,Ut,ye,It,Dt,0,ye,it,Xi||null)}function fi(Ve,qt,Ut,An,Xi){var Ie=Ve.element,ye=Ve.data,it=Ve.internalformat,It=Ve.format,Dt=Ve.type,lt=Ve.width,at=Ve.height;$n(Ve),Ie?U.texSubImage2D(qt,Xi,Ut,An,It,Dt,Ie):Ve.compressed?U.compressedTexSubImage2D(qt,Xi,Ut,An,it,lt,at,ye):Ve.needsCopy?(Qt(),U.copyTexSubImage2D(qt,Xi,Ut,An,Ve.xOffset,Ve.yOffset,lt,at)):U.texSubImage2D(qt,Xi,Ut,An,lt,at,It,Dt,ye)}var Qn=[];function On(){return Qn.pop()||new un}function Ni(Ve){Ve.needsFree&&jt.freeType(Ve.data),un.call(Ve),Qn.push(Ve)}function Ti(){Rr.call(this),this.genMipmaps=!1,this.mipmapHint=Fi,this.mipmask=0,this.images=Array(16)}function Bi(Ve,qt,Ut){var An=Ve.images[0]=On();Ve.mipmask=1,An.width=Ve.width=qt,An.height=Ve.height=Ut,An.channels=Ve.channels=4}function ca(Ve,qt){var Ut=null;if(Uc(qt))Ut=Ve.images[0]=On(),on(Ut,Ve),kr(Ut,qt),Ve.mipmask=1;else if(Yn(Ve,qt),Array.isArray(qt.mipmap))for(var An=qt.mipmap,Xi=0;Xi<An.length;++Xi)Ut=Ve.images[Xi]=On(),on(Ut,Ve),Ut.width>>=Xi,Ut.height>>=Xi,kr(Ut,An[Xi]),Ve.mipmask|=1<<Xi;else Ut=Ve.images[0]=On(),on(Ut,Ve),kr(Ut,qt),Ve.mipmask=1;on(Ve,Ve.images[0]),Ve.compressed&&(Ve.internalformat===Pl||Ve.internalformat===cl||Ve.internalformat===cu||Ve.internalformat===Dc)&&H(Ve.width%4==0&&Ve.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Jo(Ve,qt){for(var Ut=Ve.images,An=0;An<Ut.length;++An){if(!Ut[An])return;Or(Ut[An],qt,An)}}var ks=[];function Hi(){var Ve=ks.pop()||new Ti;Rr.call(Ve),Ve.mipmask=0;for(var qt=0;qt<16;++qt)Ve.images[qt]=null;return Ve}function So(Ve){for(var qt=Ve.images,Ut=0;Ut<qt.length;++Ut)qt[Ut]&&Ni(qt[Ut]),qt[Ut]=null;ks.push(Ve)}function Ja(){this.minFilter=hl,this.magFilter=hl,this.wrapS=Ll,this.wrapT=Ll,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Fi}function jo(Ve,qt){if("min"in qt){var Ut=qt.min;H.parameter(Ut,Kr),Ve.minFilter=Kr[Ut],Fu.indexOf(Ve.minFilter)>=0&&!("faces"in qt)&&(Ve.genMipmaps=!0)}if("mag"in qt){var An=qt.mag;H.parameter(An,qr),Ve.magFilter=qr[An]}var Xi=Ve.wrapS,Ie=Ve.wrapT;if("wrap"in qt){var ye=qt.wrap;typeof ye=="string"?(H.parameter(ye,Xr),Xi=Ie=Xr[ye]):Array.isArray(ye)&&(H.parameter(ye[0],Xr),H.parameter(ye[1],Xr),Xi=Xr[ye[0]],Ie=Xr[ye[1]])}else{if("wrapS"in qt){var it=qt.wrapS;H.parameter(it,Xr),Xi=Xr[it]}if("wrapT"in qt){var It=qt.wrapT;H.parameter(It,Xr),Ie=Xr[It]}}if(Ve.wrapS=Xi,Ve.wrapT=Ie,"anisotropic"in qt){var Dt=qt.anisotropic;H(typeof Dt=="number"&&Dt>=1&&Dt<=ze.maxAnisotropic,"aniso samples must be between 1 and "),Ve.anisotropic=qt.anisotropic}if("mipmap"in qt){var lt=!1;switch(typeof qt.mipmap){case"string":H.parameter(qt.mipmap,Zr,"invalid mipmap hint"),Ve.mipmapHint=Zr[qt.mipmap],Ve.genMipmaps=!0,lt=!0;break;case"boolean":lt=Ve.genMipmaps=qt.mipmap;break;case"object":H(Array.isArray(qt.mipmap),"invalid mipmap type"),Ve.genMipmaps=!1,lt=!0;break;default:H.raise("invalid mipmap type")}lt&&!("min"in qt)&&(Ve.minFilter=ku)}}function ls(Ve,qt){U.texParameteri(qt,Nc,Ve.minFilter),U.texParameteri(qt,Fc,Ve.magFilter),U.texParameteri(qt,kc,Ve.wrapS),U.texParameteri(qt,ef,Ve.wrapT),Se.ext_texture_filter_anisotropic&&U.texParameteri(qt,$l,Ve.anisotropic),Ve.genMipmaps&&(U.hint(Qu,Ve.mipmapHint),U.generateMipmap(qt))}var ws=0,Qo={},Ts=ze.maxTextureUnits,qo=Array(Ts).map(function(){return null});function zi(Ve){Rr.call(this),this.mipmask=0,this.internalformat=Ou,this.id=ws++,this.refCount=1,this.target=Ve,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ja,fr.profile&&(this.stats={size:0})}function As(Ve){U.activeTexture(zu),U.bindTexture(Ve.target,Ve.texture)}function ha(){var Ve=qo[0];Ve?U.bindTexture(Ve.target,Ve.texture):U.bindTexture(Ua,null)}function qn(Ve){var qt=Ve.texture;H(qt,"must not double destroy texture");var Ut=Ve.unit,An=Ve.target;Ut>=0&&(U.activeTexture(zu+Ut),U.bindTexture(An,null),qo[Ut]=null),U.deleteTexture(qt),Ve.texture=null,Ve.params=null,Ve.pixels=null,Ve.refCount=0,delete Qo[Ve.id],Yt.textureCount--}x(zi.prototype,{bind:function(){var Ve=this;Ve.bindCount+=1;var qt=Ve.unit;if(qt<0){for(var Ut=0;Ut<Ts;++Ut){var An=qo[Ut];if(An){if(An.bindCount>0)continue;An.unit=-1}qo[Ut]=Ve,qt=Ut;break}qt>=Ts&&H.raise("insufficient number of texture units"),fr.profile&&Yt.maxTextureUnits<qt+1&&(Yt.maxTextureUnits=qt+1),Ve.unit=qt,U.activeTexture(zu+qt),U.bindTexture(Ve.target,Ve.texture)}return qt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&qn(this)}});function Wi(Ve,qt){var Ut=new zi(Ua);Qo[Ut.id]=Ut,Yt.textureCount++;function An(ye,it){var It=Ut.texInfo;Ja.call(It);var Dt=Hi();return typeof ye=="number"?typeof it=="number"?Bi(Dt,ye|0,it|0):Bi(Dt,ye|0,ye|0):ye?(H.type(ye,"object","invalid arguments to regl.texture"),jo(It,ye),ca(Dt,ye)):Bi(Dt,1,1),It.genMipmaps&&(Dt.mipmask=(Dt.width<<1)-1),Ut.mipmask=Dt.mipmask,on(Ut,Dt),H.texture2D(It,Dt,ze),Ut.internalformat=Dt.internalformat,An.width=Dt.width,An.height=Dt.height,As(Ut),Jo(Dt,Ua),ls(It,Ua),ha(),So(Dt),fr.profile&&(Ut.stats.size=Di(Ut.internalformat,Ut.type,Dt.width,Dt.height,It.genMipmaps,!1)),An.format=Hr[Ut.internalformat],An.type=mn[Ut.type],An.mag=Dr[It.magFilter],An.min=wn[It.minFilter],An.wrapS=Nr[It.wrapS],An.wrapT=Nr[It.wrapT],An}function Xi(ye,it,It,Dt){H(!!ye,"must specify image data");var lt=it|0,at=It|0,_t=Dt|0,Le=On();return on(Le,Ut),Le.width=0,Le.height=0,kr(Le,ye),Le.width=Le.width||(Ut.width>>_t)-lt,Le.height=Le.height||(Ut.height>>_t)-at,H(Ut.type===Le.type&&Ut.format===Le.format&&Ut.internalformat===Le.internalformat,"incompatible format for texture.subimage"),H(lt>=0&&at>=0&&lt+Le.width<=Ut.width&&at+Le.height<=Ut.height,"texture.subimage write out of bounds"),H(Ut.mipmask&1<<_t,"missing mipmap data"),H(Le.data||Le.element||Le.needsCopy,"missing image data"),As(Ut),fi(Le,Ua,lt,at,_t),ha(),Ni(Le),An}function Ie(ye,it){var It=ye|0,Dt=it|0||It;if(It===Ut.width&&Dt===Ut.height)return An;An.width=Ut.width=It,An.height=Ut.height=Dt,As(Ut);for(var lt=0;Ut.mipmask>>lt;++lt){var at=It>>lt,_t=Dt>>lt;if(!at||!_t)break;U.texImage2D(Ua,lt,Ut.format,at,_t,0,Ut.format,Ut.type,null)}return ha(),fr.profile&&(Ut.stats.size=Di(Ut.internalformat,Ut.type,It,Dt,!1,!1)),An}return An(Ve,qt),An.subimage=Xi,An.resize=Ie,An._reglType="texture2d",An._texture=Ut,fr.profile&&(An.stats=Ut.stats),An.destroy=function(){Ut.decRef()},An}function $i(Ve,qt,Ut,An,Xi,Ie){var ye=new zi(Lc);Qo[ye.id]=ye,Yt.cubeCount++;var it=new Array(6);function It(at,_t,Le,et,Ce,Et){var Rt,_r=ye.texInfo;for(Ja.call(_r),Rt=0;Rt<6;++Rt)it[Rt]=Hi();if(typeof at=="number"||!at){var er=at|0||1;for(Rt=0;Rt<6;++Rt)Bi(it[Rt],er,er)}else if(typeof at=="object")if(_t)ca(it[0],at),ca(it[1],_t),ca(it[2],Le),ca(it[3],et),ca(it[4],Ce),ca(it[5],Et);else if(jo(_r,at),Yn(ye,at),"faces"in at){var br=at.faces;for(H(Array.isArray(br)&&br.length===6,"cube faces must be a length 6 array"),Rt=0;Rt<6;++Rt)H(typeof br[Rt]=="object"&&!!br[Rt],"invalid input for cube map face"),on(it[Rt],ye),ca(it[Rt],br[Rt])}else for(Rt=0;Rt<6;++Rt)ca(it[Rt],at);else H.raise("invalid arguments to cube map");for(on(ye,it[0]),ze.npotTextureCube||H(yu(ye.width)&&yu(ye.height),"your browser does not support non power or two texture dimensions"),_r.genMipmaps?ye.mipmask=(it[0].width<<1)-1:ye.mipmask=it[0].mipmask,H.textureCube(ye,_r,it,ze),ye.internalformat=it[0].internalformat,It.width=it[0].width,It.height=it[0].height,As(ye),Rt=0;Rt<6;++Rt)Jo(it[Rt],Tl+Rt);for(ls(_r,Lc),ha(),fr.profile&&(ye.stats.size=Di(ye.internalformat,ye.type,It.width,It.height,_r.genMipmaps,!0)),It.format=Hr[ye.internalformat],It.type=mn[ye.type],It.mag=Dr[_r.magFilter],It.min=wn[_r.minFilter],It.wrapS=Nr[_r.wrapS],It.wrapT=Nr[_r.wrapT],Rt=0;Rt<6;++Rt)So(it[Rt]);return It}function Dt(at,_t,Le,et,Ce){H(!!_t,"must specify image data"),H(typeof at=="number"&&at===(at|0)&&at>=0&&at<6,"invalid face");var Et=Le|0,Rt=et|0,_r=Ce|0,er=On();return on(er,ye),er.width=0,er.height=0,kr(er,_t),er.width=er.width||(ye.width>>_r)-Et,er.height=er.height||(ye.height>>_r)-Rt,H(ye.type===er.type&&ye.format===er.format&&ye.internalformat===er.internalformat,"incompatible format for texture.subimage"),H(Et>=0&&Rt>=0&&Et+er.width<=ye.width&&Rt+er.height<=ye.height,"texture.subimage write out of bounds"),H(ye.mipmask&1<<_r,"missing mipmap data"),H(er.data||er.element||er.needsCopy,"missing image data"),As(ye),fi(er,Tl+at,Et,Rt,_r),ha(),Ni(er),It}function lt(at){var _t=at|0;if(_t!==ye.width){It.width=ye.width=_t,It.height=ye.height=_t,As(ye);for(var Le=0;Le<6;++Le)for(var et=0;ye.mipmask>>et;++et)U.texImage2D(Tl+Le,et,ye.format,_t>>et,_t>>et,0,ye.format,ye.type,null);return ha(),fr.profile&&(ye.stats.size=Di(ye.internalformat,ye.type,It.width,It.height,!1,!0)),It}}return It(Ve,qt,Ut,An,Xi,Ie),It.subimage=Dt,It.resize=lt,It._reglType="textureCube",It._texture=ye,fr.profile&&(It.stats=ye.stats),It.destroy=function(){ye.decRef()},It}function Co(){for(var Ve=0;Ve<Ts;++Ve)U.activeTexture(zu+Ve),U.bindTexture(Ua,null),qo[Ve]=null;fa(Qo).forEach(qn),Yt.cubeCount=0,Yt.textureCount=0}fr.profile&&(Yt.getTotalTextureSize=function(){var Ve=0;return Object.keys(Qo).forEach(function(qt){Ve+=Qo[qt].stats.size}),Ve});function bl(){for(var Ve=0;Ve<Ts;++Ve){var qt=qo[Ve];qt&&(qt.bindCount=0,qt.unit=-1,qo[Ve]=null)}fa(Qo).forEach(function(Ut){Ut.texture=U.createTexture(),U.bindTexture(Ut.target,Ut.texture);for(var An=0;An<32;++An)if((Ut.mipmask&1<<An)!=0)if(Ut.target===Ua)U.texImage2D(Ua,An,Ut.internalformat,Ut.width>>An,Ut.height>>An,0,Ut.internalformat,Ut.type,null);else for(var Xi=0;Xi<6;++Xi)U.texImage2D(Tl+Xi,An,Ut.internalformat,Ut.width>>An,Ut.height>>An,0,Ut.internalformat,Ut.type,null);ls(Ut.texInfo,Ut.target)})}function Ec(){for(var Ve=0;Ve<Ts;++Ve){var qt=qo[Ve];qt&&(qt.bindCount=0,qt.unit=-1,qo[Ve]=null),U.activeTexture(zu+Ve),U.bindTexture(Ua,null),U.bindTexture(Lc,null)}}return{create2D:Wi,createCube:$i,clear:Co,getTexture:function(Ve){return null},restore:bl,refresh:Ec}}var os=36161,Io=32854,xu=32855,Qs=36194,qs=33189,ss=36168,zl=34041,Zn=35907,Mn=34836,ec=34842,zo=34843,To=[];To[Io]=2,To[xu]=2,To[Qs]=2,To[qs]=2,To[ss]=1,To[zl]=4,To[Zn]=4,To[Mn]=16,To[ec]=8,To[zo]=6;function Fo(U,Se,ze){return To[U]*Se*ze}var bu=function(U,Se,ze,Qt,wr){var Yt={rgba4:Io,rgb565:Qs,"rgb5 a1":xu,depth:qs,stencil:ss,"depth stencil":zl};Se.ext_srgb&&(Yt.srgba=Zn),Se.ext_color_buffer_half_float&&(Yt.rgba16f=ec,Yt.rgb16f=zo),Se.webgl_color_buffer_float&&(Yt.rgba32f=Mn);var fr=[];Object.keys(Yt).forEach(function(Vr){var an=Yt[Vr];fr[an]=Vr});var Zr=0,Xr={};function qr(Vr){this.id=Zr++,this.refCount=1,this.renderbuffer=Vr,this.format=Io,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}qr.prototype.decRef=function(){--this.refCount<=0&&Kr(this)};function Kr(Vr){var an=Vr.renderbuffer;H(an,"must not double destroy renderbuffer"),U.bindRenderbuffer(os,null),U.deleteRenderbuffer(an),Vr.renderbuffer=null,Vr.refCount=0,delete Xr[Vr.id],Qt.renderbufferCount--}function nn(Vr,an){var Ft=new qr(U.createRenderbuffer());Xr[Ft.id]=Ft,Qt.renderbufferCount++;function cr(mn,Dr){var wn=0,Nr=0,sn=Io;if(typeof mn=="object"&&mn){var Rr=mn;if("shape"in Rr){var on=Rr.shape;H(Array.isArray(on)&&on.length>=2,"invalid renderbuffer shape"),wn=on[0]|0,Nr=on[1]|0}else"radius"in Rr&&(wn=Nr=Rr.radius|0),"width"in Rr&&(wn=Rr.width|0),"height"in Rr&&(Nr=Rr.height|0);"format"in Rr&&(H.parameter(Rr.format,Yt,"invalid renderbuffer format"),sn=Yt[Rr.format])}else typeof mn=="number"?(wn=mn|0,typeof Dr=="number"?Nr=Dr|0:Nr=wn):mn?H.raise("invalid arguments to renderbuffer constructor"):wn=Nr=1;if(H(wn>0&&Nr>0&&wn<=ze.maxRenderbufferSize&&Nr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),!(wn===Ft.width&&Nr===Ft.height&&sn===Ft.format))return cr.width=Ft.width=wn,cr.height=Ft.height=Nr,Ft.format=sn,U.bindRenderbuffer(os,Ft.renderbuffer),U.renderbufferStorage(os,sn,wn,Nr),H(U.getError()===0,"invalid render buffer format"),wr.profile&&(Ft.stats.size=Fo(Ft.format,Ft.width,Ft.height)),cr.format=fr[Ft.format],cr}function Hr(mn,Dr){var wn=mn|0,Nr=Dr|0||wn;return wn===Ft.width&&Nr===Ft.height||(H(wn>0&&Nr>0&&wn<=ze.maxRenderbufferSize&&Nr<=ze.maxRenderbufferSize,"invalid renderbuffer size"),cr.width=Ft.width=wn,cr.height=Ft.height=Nr,U.bindRenderbuffer(os,Ft.renderbuffer),U.renderbufferStorage(os,Ft.format,wn,Nr),H(U.getError()===0,"invalid render buffer format"),wr.profile&&(Ft.stats.size=Fo(Ft.format,Ft.width,Ft.height))),cr}return cr(Vr,an),cr.resize=Hr,cr._reglType="renderbuffer",cr._renderbuffer=Ft,wr.profile&&(cr.stats=Ft.stats),cr.destroy=function(){Ft.decRef()},cr}wr.profile&&(Qt.getTotalRenderbufferSize=function(){var Vr=0;return Object.keys(Xr).forEach(function(an){Vr+=Xr[an].stats.size}),Vr});function fn(){fa(Xr).forEach(function(Vr){Vr.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer(os,Vr.renderbuffer),U.renderbufferStorage(os,Vr.format,Vr.width,Vr.height)}),U.bindRenderbuffer(os,null)}return{create:nn,clear:function(){fa(Xr).forEach(Kr)},restore:fn}},Su=36160,tc=36161,ea=3553,_o=34069,Zc=36064,Uu=36096,_c=36128,Eu=33306,Os=36053,Fl=36054,wu=36055,Vc=36057,Nl=36061,rc=36193,Gc=5121,el=5126,eu=6407,xc=6408,tl=6402,ju=[eu,xc],nc=[];nc[xc]=4,nc[eu]=3;var Tu=[];Tu[Gc]=1,Tu[el]=4,Tu[rc]=2;var hu=32854,Au=32855,ic=36194,bc=33189,ac=36168,n=34041,u=35907,a=34836,h=34842,g=34843,b=[hu,Au,ic,u,h,g,a],A={};A[Os]="complete",A[Fl]="incomplete attachment",A[Vc]="incomplete dimensions",A[wu]="incomplete, missing attachment",A[Nl]="unsupported";function L(U,Se,ze,Qt,wr,Yt){var fr={cur:null,next:null,dirty:!1,setFBO:null},Zr=["rgba"],Xr=["rgba4","rgb565","rgb5 a1"];Se.ext_srgb&&Xr.push("srgba"),Se.ext_color_buffer_half_float&&Xr.push("rgba16f","rgb16f"),Se.webgl_color_buffer_float&&Xr.push("rgba32f");var qr=["uint8"];Se.oes_texture_half_float&&qr.push("half float","float16"),Se.oes_texture_float&&qr.push("float","float32");function Kr(un,kr,Or){this.target=un,this.texture=kr,this.renderbuffer=Or;var fi=0,Qn=0;kr?(fi=kr.width,Qn=kr.height):Or&&(fi=Or.width,Qn=Or.height),this.width=fi,this.height=Qn}function nn(un){un&&(un.texture&&un.texture._texture.decRef(),un.renderbuffer&&un.renderbuffer._renderbuffer.decRef())}function fn(un,kr,Or){if(!!un)if(un.texture){var fi=un.texture._texture,Qn=Math.max(1,fi.width),On=Math.max(1,fi.height);H(Qn===kr&&On===Or,"inconsistent width/height for supplied texture"),fi.refCount+=1}else{var Ni=un.renderbuffer._renderbuffer;H(Ni.width===kr&&Ni.height===Or,"inconsistent width/height for renderbuffer"),Ni.refCount+=1}}function Vr(un,kr){kr&&(kr.texture?U.framebufferTexture2D(Su,un,kr.target,kr.texture._texture.texture,0):U.framebufferRenderbuffer(Su,un,tc,kr.renderbuffer._renderbuffer.renderbuffer))}function an(un){var kr=ea,Or=null,fi=null,Qn=un;typeof un=="object"&&(Qn=un.data,"target"in un&&(kr=un.target|0)),H.type(Qn,"function","invalid attachment data");var On=Qn._reglType;return On==="texture2d"?(Or=Qn,H(kr===ea)):On==="textureCube"?(Or=Qn,H(kr>=_o&&kr<_o+6,"invalid cube map target")):On==="renderbuffer"?(fi=Qn,kr=tc):H.raise("invalid regl object for attachment"),new Kr(kr,Or,fi)}function Ft(un,kr,Or,fi,Qn){if(Or){var On=Qt.create2D({width:un,height:kr,format:fi,type:Qn});return On._texture.refCount=0,new Kr(ea,On,null)}else{var Ni=wr.create({width:un,height:kr,format:fi});return Ni._renderbuffer.refCount=0,new Kr(tc,null,Ni)}}function cr(un){return un&&(un.texture||un.renderbuffer)}function Hr(un,kr,Or){un&&(un.texture?un.texture.resize(kr,Or):un.renderbuffer&&un.renderbuffer.resize(kr,Or),un.width=kr,un.height=Or)}var mn=0,Dr={};function wn(){this.id=mn++,Dr[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Nr(un){un.colorAttachments.forEach(nn),nn(un.depthAttachment),nn(un.stencilAttachment),nn(un.depthStencilAttachment)}function sn(un){var kr=un.framebuffer;H(kr,"must not double destroy framebuffer"),U.deleteFramebuffer(kr),un.framebuffer=null,Yt.framebufferCount--,delete Dr[un.id]}function Rr(un){var kr;U.bindFramebuffer(Su,un.framebuffer);var Or=un.colorAttachments;for(kr=0;kr<Or.length;++kr)Vr(Zc+kr,Or[kr]);for(kr=Or.length;kr<ze.maxColorAttachments;++kr)U.framebufferTexture2D(Su,Zc+kr,ea,null,0);U.framebufferTexture2D(Su,Eu,ea,null,0),U.framebufferTexture2D(Su,Uu,ea,null,0),U.framebufferTexture2D(Su,_c,ea,null,0),Vr(Uu,un.depthAttachment),Vr(_c,un.stencilAttachment),Vr(Eu,un.depthStencilAttachment);var fi=U.checkFramebufferStatus(Su);!U.isContextLost()&&fi!==Os&&H.raise("framebuffer configuration not supported, status = "+A[fi]),U.bindFramebuffer(Su,fr.next?fr.next.framebuffer:null),fr.cur=fr.next,U.getError()}function on(un,kr){var Or=new wn;Yt.framebufferCount++;function fi(On,Ni){var Ti;H(fr.next!==Or,"can not update framebuffer which is currently in use");var Bi=0,ca=0,Jo=!0,ks=!0,Hi=null,So=!0,Ja="rgba",jo="uint8",ls=1,ws=null,Qo=null,Ts=null,qo=!1;if(typeof On=="number")Bi=On|0,ca=Ni|0||Bi;else if(!On)Bi=ca=1;else{H.type(On,"object","invalid arguments for framebuffer");var zi=On;if("shape"in zi){var As=zi.shape;H(Array.isArray(As)&&As.length>=2,"invalid shape for framebuffer"),Bi=As[0],ca=As[1]}else"radius"in zi&&(Bi=ca=zi.radius),"width"in zi&&(Bi=zi.width),"height"in zi&&(ca=zi.height);("color"in zi||"colors"in zi)&&(Hi=zi.color||zi.colors,Array.isArray(Hi)&&H(Hi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Hi||("colorCount"in zi&&(ls=zi.colorCount|0,H(ls>0,"invalid color buffer count")),"colorTexture"in zi&&(So=!!zi.colorTexture,Ja="rgba4"),"colorType"in zi&&(jo=zi.colorType,So?(H(Se.oes_texture_float||!(jo==="float"||jo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),H(Se.oes_texture_half_float||!(jo==="half float"||jo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):jo==="half float"||jo==="float16"?(H(Se.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ja="rgba16f"):(jo==="float"||jo==="float32")&&(H(Se.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ja="rgba32f"),H.oneOf(jo,qr,"invalid color type")),"colorFormat"in zi&&(Ja=zi.colorFormat,Zr.indexOf(Ja)>=0?So=!0:Xr.indexOf(Ja)>=0?So=!1:So?H.oneOf(zi.colorFormat,Zr,"invalid color format for texture"):H.oneOf(zi.colorFormat,Xr,"invalid color format for renderbuffer"))),("depthTexture"in zi||"depthStencilTexture"in zi)&&(qo=!!(zi.depthTexture||zi.depthStencilTexture),H(!qo||Se.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in zi&&(typeof zi.depth=="boolean"?Jo=zi.depth:(ws=zi.depth,ks=!1)),"stencil"in zi&&(typeof zi.stencil=="boolean"?ks=zi.stencil:(Qo=zi.stencil,Jo=!1)),"depthStencil"in zi&&(typeof zi.depthStencil=="boolean"?Jo=ks=zi.depthStencil:(Ts=zi.depthStencil,Jo=!1,ks=!1))}var ha=null,qn=null,Wi=null,$i=null;if(Array.isArray(Hi))ha=Hi.map(an);else if(Hi)ha=[an(Hi)];else for(ha=new Array(ls),Ti=0;Ti<ls;++Ti)ha[Ti]=Ft(Bi,ca,So,Ja,jo);H(Se.webgl_draw_buffers||ha.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),H(ha.length<=ze.maxColorAttachments,"too many color attachments, not supported"),Bi=Bi||ha[0].width,ca=ca||ha[0].height,ws?qn=an(ws):Jo&&!ks&&(qn=Ft(Bi,ca,qo,"depth","uint32")),Qo?Wi=an(Qo):ks&&!Jo&&(Wi=Ft(Bi,ca,!1,"stencil","uint8")),Ts?$i=an(Ts):!ws&&!Qo&&ks&&Jo&&($i=Ft(Bi,ca,qo,"depth stencil","depth stencil")),H(!!ws+!!Qo+!!Ts<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Co=null;for(Ti=0;Ti<ha.length;++Ti)if(fn(ha[Ti],Bi,ca),H(!ha[Ti]||ha[Ti].texture&&ju.indexOf(ha[Ti].texture._texture.format)>=0||ha[Ti].renderbuffer&&b.indexOf(ha[Ti].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ti+" is invalid"),ha[Ti]&&ha[Ti].texture){var bl=nc[ha[Ti].texture._texture.format]*Tu[ha[Ti].texture._texture.type];Co===null?Co=bl:H(Co===bl,"all color attachments much have the same number of bits per pixel.")}return fn(qn,Bi,ca),H(!qn||qn.texture&&qn.texture._texture.format===tl||qn.renderbuffer&&qn.renderbuffer._renderbuffer.format===bc,"invalid depth attachment for framebuffer object"),fn(Wi,Bi,ca),H(!Wi||Wi.renderbuffer&&Wi.renderbuffer._renderbuffer.format===ac,"invalid stencil attachment for framebuffer object"),fn($i,Bi,ca),H(!$i||$i.texture&&$i.texture._texture.format===n||$i.renderbuffer&&$i.renderbuffer._renderbuffer.format===n,"invalid depth-stencil attachment for framebuffer object"),Nr(Or),Or.width=Bi,Or.height=ca,Or.colorAttachments=ha,Or.depthAttachment=qn,Or.stencilAttachment=Wi,Or.depthStencilAttachment=$i,fi.color=ha.map(cr),fi.depth=cr(qn),fi.stencil=cr(Wi),fi.depthStencil=cr($i),fi.width=Or.width,fi.height=Or.height,Rr(Or),fi}function Qn(On,Ni){H(fr.next!==Or,"can not resize a framebuffer which is currently in use");var Ti=Math.max(On|0,1),Bi=Math.max(Ni|0||Ti,1);if(Ti===Or.width&&Bi===Or.height)return fi;for(var ca=Or.colorAttachments,Jo=0;Jo<ca.length;++Jo)Hr(ca[Jo],Ti,Bi);return Hr(Or.depthAttachment,Ti,Bi),Hr(Or.stencilAttachment,Ti,Bi),Hr(Or.depthStencilAttachment,Ti,Bi),Or.width=fi.width=Ti,Or.height=fi.height=Bi,Rr(Or),fi}return fi(un,kr),x(fi,{resize:Qn,_reglType:"framebuffer",_framebuffer:Or,destroy:function(){sn(Or),Nr(Or)},use:function(On){fr.setFBO({framebuffer:fi},On)}})}function Yn(un){var kr=Array(6);function Or(Qn){var On;H(kr.indexOf(fr.next)<0,"can not update framebuffer which is currently in use");var Ni={color:null},Ti=0,Bi=null,ca="rgba",Jo="uint8",ks=1;if(typeof Qn=="number")Ti=Qn|0;else if(!Qn)Ti=1;else{H.type(Qn,"object","invalid arguments for framebuffer");var Hi=Qn;if("shape"in Hi){var So=Hi.shape;H(Array.isArray(So)&&So.length>=2,"invalid shape for framebuffer"),H(So[0]===So[1],"cube framebuffer must be square"),Ti=So[0]}else"radius"in Hi&&(Ti=Hi.radius|0),"width"in Hi?(Ti=Hi.width|0,"height"in Hi&&H(Hi.height===Ti,"must be square")):"height"in Hi&&(Ti=Hi.height|0);("color"in Hi||"colors"in Hi)&&(Bi=Hi.color||Hi.colors,Array.isArray(Bi)&&H(Bi.length===1||Se.webgl_draw_buffers,"multiple render targets not supported")),Bi||("colorCount"in Hi&&(ks=Hi.colorCount|0,H(ks>0,"invalid color buffer count")),"colorType"in Hi&&(H.oneOf(Hi.colorType,qr,"invalid color type"),Jo=Hi.colorType),"colorFormat"in Hi&&(ca=Hi.colorFormat,H.oneOf(Hi.colorFormat,Zr,"invalid color format for texture"))),"depth"in Hi&&(Ni.depth=Hi.depth),"stencil"in Hi&&(Ni.stencil=Hi.stencil),"depthStencil"in Hi&&(Ni.depthStencil=Hi.depthStencil)}var Ja;if(Bi)if(Array.isArray(Bi))for(Ja=[],On=0;On<Bi.length;++On)Ja[On]=Bi[On];else Ja=[Bi];else{Ja=Array(ks);var jo={radius:Ti,format:ca,type:Jo};for(On=0;On<ks;++On)Ja[On]=Qt.createCube(jo)}for(Ni.color=Array(Ja.length),On=0;On<Ja.length;++On){var ls=Ja[On];H(typeof ls=="function"&&ls._reglType==="textureCube","invalid cube map"),Ti=Ti||ls.width,H(ls.width===Ti&&ls.height===Ti,"invalid cube map shape"),Ni.color[On]={target:_o,data:Ja[On]}}for(On=0;On<6;++On){for(var ws=0;ws<Ja.length;++ws)Ni.color[ws].target=_o+On;On>0&&(Ni.depth=kr[0].depth,Ni.stencil=kr[0].stencil,Ni.depthStencil=kr[0].depthStencil),kr[On]?kr[On](Ni):kr[On]=on(Ni)}return x(Or,{width:Ti,height:Ti,color:Ja})}function fi(Qn){var On,Ni=Qn|0;if(H(Ni>0&&Ni<=ze.maxCubeMapSize,"invalid radius for cube fbo"),Ni===Or.width)return Or;var Ti=Or.color;for(On=0;On<Ti.length;++On)Ti[On].resize(Ni);for(On=0;On<6;++On)kr[On].resize(Ni);return Or.width=Or.height=Ni,Or}return Or(un),x(Or,{faces:kr,resize:fi,_reglType:"framebufferCube",destroy:function(){kr.forEach(function(Qn){Qn.destroy()})}})}function $n(){fr.cur=null,fr.next=null,fr.dirty=!0,fa(Dr).forEach(function(un){un.framebuffer=U.createFramebuffer(),Rr(un)})}return x(fr,{getFramebuffer:function(un){if(typeof un=="function"&&un._reglType==="framebuffer"){var kr=un._framebuffer;if(kr instanceof wn)return kr}return null},create:on,createCube:Yn,clear:function(){fa(Dr).forEach(sn)},restore:$n})}var V=5126,ee=34962;function de(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=V,this.offset=0,this.stride=0,this.divisor=0}function _e(U,Se,ze,Qt,wr){for(var Yt=ze.maxAttributes,fr=new Array(Yt),Zr=0;Zr<Yt;++Zr)fr[Zr]=new de;var Xr=0,qr={},Kr={Record:de,scope:{},state:fr,currentVAO:null,targetVAO:null,restore:fn()?Dr:function(){},createVAO:wn,getVAO:an,destroyBuffer:nn,setVAO:fn()?Ft:cr,clear:fn()?Hr:function(){}};function nn(Nr){for(var sn=0;sn<fr.length;++sn){var Rr=fr[sn];Rr.buffer===Nr&&(U.disableVertexAttribArray(sn),Rr.buffer=null)}}function fn(){return Se.oes_vertex_array_object}function Vr(){return Se.angle_instanced_arrays}function an(Nr){return typeof Nr=="function"&&Nr._vao?Nr._vao:null}function Ft(Nr){if(Nr!==Kr.currentVAO){var sn=fn();Nr?sn.bindVertexArrayOES(Nr.vao):sn.bindVertexArrayOES(null),Kr.currentVAO=Nr}}function cr(Nr){if(Nr!==Kr.currentVAO){if(Nr)Nr.bindAttrs();else for(var sn=Vr(),Rr=0;Rr<fr.length;++Rr){var on=fr[Rr];on.buffer?(U.enableVertexAttribArray(Rr),U.vertexAttribPointer(Rr,on.size,on.type,on.normalized,on.stride,on.offfset),sn&&on.divisor&&sn.vertexAttribDivisorANGLE(Rr,on.divisor)):(U.disableVertexAttribArray(Rr),U.vertexAttrib4f(Rr,on.x,on.y,on.z,on.w))}Kr.currentVAO=Nr}}function Hr(){fa(qr).forEach(function(Nr){Nr.destroy()})}function mn(){this.id=++Xr,this.attributes=[];var Nr=fn();Nr?this.vao=Nr.createVertexArrayOES():this.vao=null,qr[this.id]=this,this.buffers=[]}mn.prototype.bindAttrs=function(){for(var Nr=Vr(),sn=this.attributes,Rr=0;Rr<sn.length;++Rr){var on=sn[Rr];on.buffer?(U.enableVertexAttribArray(Rr),U.bindBuffer(ee,on.buffer.buffer),U.vertexAttribPointer(Rr,on.size,on.type,on.normalized,on.stride,on.offset),Nr&&on.divisor&&Nr.vertexAttribDivisorANGLE(Rr,on.divisor)):(U.disableVertexAttribArray(Rr),U.vertexAttrib4f(Rr,on.x,on.y,on.z,on.w))}for(var Yn=sn.length;Yn<Yt;++Yn)U.disableVertexAttribArray(Yn)},mn.prototype.refresh=function(){var Nr=fn();Nr&&(Nr.bindVertexArrayOES(this.vao),this.bindAttrs(),Kr.currentVAO=this)},mn.prototype.destroy=function(){if(this.vao){var Nr=fn();this===Kr.currentVAO&&(Kr.currentVAO=null,Nr.bindVertexArrayOES(null)),Nr.deleteVertexArrayOES(this.vao),this.vao=null}qr[this.id]&&(delete qr[this.id],Qt.vaoCount-=1)};function Dr(){var Nr=fn();Nr&&fa(qr).forEach(function(sn){sn.refresh()})}function wn(Nr){var sn=new mn;Qt.vaoCount+=1;function Rr(on){H(Array.isArray(on),"arguments to vertex array constructor must be an array"),H(on.length<Yt,"too many attributes"),H(on.length>0,"must specify at least one attribute");var Yn={},$n=sn.attributes;$n.length=on.length;for(var un=0;un<on.length;++un){var kr=on[un],Or=$n[un]=new de,fi=kr.data||kr;if(Array.isArray(fi)||O(fi)||Aa(fi)){var Qn;sn.buffers[un]&&(Qn=sn.buffers[un],O(fi)&&Qn._buffer.byteLength>=fi.byteLength?Qn.subdata(fi):(Qn.destroy(),sn.buffers[un]=null)),sn.buffers[un]||(Qn=sn.buffers[un]=wr.create(kr,ee,!1,!0)),Or.buffer=wr.getBuffer(Qn),Or.size=Or.buffer.dimension|0,Or.normalized=!1,Or.type=Or.buffer.dtype,Or.offset=0,Or.stride=0,Or.divisor=0,Or.state=1,Yn[un]=1}else wr.getBuffer(kr)?(Or.buffer=wr.getBuffer(kr),Or.size=Or.buffer.dimension|0,Or.normalized=!1,Or.type=Or.buffer.dtype,Or.offset=0,Or.stride=0,Or.divisor=0,Or.state=1):wr.getBuffer(kr.buffer)?(Or.buffer=wr.getBuffer(kr.buffer),Or.size=(+kr.size||Or.buffer.dimension)|0,Or.normalized=!!kr.normalized||!1,"type"in kr?(H.parameter(kr.type,uo,"invalid buffer type"),Or.type=uo[kr.type]):Or.type=Or.buffer.dtype,Or.offset=(kr.offset||0)|0,Or.stride=(kr.stride||0)|0,Or.divisor=(kr.divisor||0)|0,Or.state=1,H(Or.size>=1&&Or.size<=4,"size must be between 1 and 4"),H(Or.offset>=0,"invalid offset"),H(Or.stride>=0&&Or.stride<=255,"stride must be between 0 and 255"),H(Or.divisor>=0,"divisor must be positive"),H(!Or.divisor||!!Se.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in kr?(H(un>0,"first attribute must not be a constant"),Or.x=+kr.x||0,Or.y=+kr.y||0,Or.z=+kr.z||0,Or.w=+kr.w||0,Or.state=2):H(!1,"invalid attribute spec for location "+un)}for(var On=0;On<sn.buffers.length;++On)!Yn[On]&&sn.buffers[On]&&(sn.buffers[On].destroy(),sn.buffers[On]=null);return sn.refresh(),Rr}return Rr.destroy=function(){for(var on=0;on<sn.buffers.length;++on)sn.buffers[on]&&sn.buffers[on].destroy();sn.buffers.length=0,sn.destroy()},Rr._vao=sn,Rr._reglType="vao",Rr(Nr)}return Kr}var xe=35632,Xe=35633,Ge=35718,nt=35721;function ke(U,Se,ze,Qt){var wr={},Yt={};function fr(Ft,cr,Hr,mn){this.name=Ft,this.id=cr,this.location=Hr,this.info=mn}function Zr(Ft,cr){for(var Hr=0;Hr<Ft.length;++Hr)if(Ft[Hr].id===cr.id){Ft[Hr].location=cr.location;return}Ft.push(cr)}function Xr(Ft,cr,Hr){var mn=Ft===xe?wr:Yt,Dr=mn[cr];if(!Dr){var wn=Se.str(cr);Dr=U.createShader(Ft),U.shaderSource(Dr,wn),U.compileShader(Dr),H.shaderError(U,Dr,wn,Ft,Hr),mn[cr]=Dr}return Dr}var qr={},Kr=[],nn=0;function fn(Ft,cr){this.id=nn++,this.fragId=Ft,this.vertId=cr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Qt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Vr(Ft,cr,Hr){var mn,Dr,wn=Xr(xe,Ft.fragId),Nr=Xr(Xe,Ft.vertId),sn=Ft.program=U.createProgram();if(U.attachShader(sn,wn),U.attachShader(sn,Nr),Hr)for(mn=0;mn<Hr.length;++mn){var Rr=Hr[mn];U.bindAttribLocation(sn,Rr[0],Rr[1])}U.linkProgram(sn),H.linkError(U,sn,Se.str(Ft.fragId),Se.str(Ft.vertId),cr);var on=U.getProgramParameter(sn,Ge);Qt.profile&&(Ft.stats.uniformsCount=on);var Yn=Ft.uniforms;for(mn=0;mn<on;++mn)if(Dr=U.getActiveUniform(sn,mn),Dr)if(Dr.size>1)for(var $n=0;$n<Dr.size;++$n){var un=Dr.name.replace("[0]","["+$n+"]");Zr(Yn,new fr(un,Se.id(un),U.getUniformLocation(sn,un),Dr))}else Zr(Yn,new fr(Dr.name,Se.id(Dr.name),U.getUniformLocation(sn,Dr.name),Dr));var kr=U.getProgramParameter(sn,nt);Qt.profile&&(Ft.stats.attributesCount=kr);var Or=Ft.attributes;for(mn=0;mn<kr;++mn)Dr=U.getActiveAttrib(sn,mn),Dr&&Zr(Or,new fr(Dr.name,Se.id(Dr.name),U.getAttribLocation(sn,Dr.name),Dr))}Qt.profile&&(ze.getMaxUniformsCount=function(){var Ft=0;return Kr.forEach(function(cr){cr.stats.uniformsCount>Ft&&(Ft=cr.stats.uniformsCount)}),Ft},ze.getMaxAttributesCount=function(){var Ft=0;return Kr.forEach(function(cr){cr.stats.attributesCount>Ft&&(Ft=cr.stats.attributesCount)}),Ft});function an(){wr={},Yt={};for(var Ft=0;Ft<Kr.length;++Ft)Vr(Kr[Ft],null,Kr[Ft].attributes.map(function(cr){return[cr.location,cr.name]}))}return{clear:function(){var Ft=U.deleteShader.bind(U);fa(wr).forEach(Ft),wr={},fa(Yt).forEach(Ft),Yt={},Kr.forEach(function(cr){U.deleteProgram(cr.program)}),Kr.length=0,qr={},ze.shaderCount=0},program:function(Ft,cr,Hr,mn){H.command(Ft>=0,"missing vertex shader",Hr),H.command(cr>=0,"missing fragment shader",Hr);var Dr=qr[cr];Dr||(Dr=qr[cr]={});var wn=Dr[Ft];if(wn&&(wn.refCount++,!mn))return wn;var Nr=new fn(cr,Ft);return ze.shaderCount++,Vr(Nr,Hr,mn),wn||(Dr[Ft]=Nr),Kr.push(Nr),x(Nr,{destroy:function(){if(Nr.refCount--,Nr.refCount<=0){U.deleteProgram(Nr.program);var sn=Kr.indexOf(Nr);Kr.splice(sn,1),ze.shaderCount--}Dr[Nr.vertId].refCount<=0&&(U.deleteShader(Yt[Nr.vertId]),delete Yt[Nr.vertId],delete qr[Nr.fragId][Nr.vertId]),Object.keys(qr[Nr.fragId]).length||(U.deleteShader(wr[Nr.fragId]),delete wr[Nr.fragId],delete qr[Nr.fragId])}})},restore:an,shader:Xr,frag:-1,vert:-1}}var rt=6408,ht=5121,Bt=3333,or=5126;function rr(U,Se,ze,Qt,wr,Yt,fr){function Zr(Kr){var nn;Se.next===null?(H(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),nn=ht):(H(Se.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),nn=Se.next.colorAttachments[0].texture._texture.type,Yt.oes_texture_float?(H(nn===ht||nn===or,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),nn===or&&H(fr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):H(nn===ht,"Reading from a framebuffer is only allowed for the type 'uint8'"));var fn=0,Vr=0,an=Qt.framebufferWidth,Ft=Qt.framebufferHeight,cr=null;O(Kr)?cr=Kr:Kr&&(H.type(Kr,"object","invalid arguments to regl.read()"),fn=Kr.x|0,Vr=Kr.y|0,H(fn>=0&&fn<Qt.framebufferWidth,"invalid x offset for regl.read"),H(Vr>=0&&Vr<Qt.framebufferHeight,"invalid y offset for regl.read"),an=(Kr.width||Qt.framebufferWidth-fn)|0,Ft=(Kr.height||Qt.framebufferHeight-Vr)|0,cr=Kr.data||null),cr&&(nn===ht?H(cr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):nn===or&&H(cr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),H(an>0&&an+fn<=Qt.framebufferWidth,"invalid width for read pixels"),H(Ft>0&&Ft+Vr<=Qt.framebufferHeight,"invalid height for read pixels"),ze();var Hr=an*Ft*4;return cr||(nn===ht?cr=new Uint8Array(Hr):nn===or&&(cr=cr||new Float32Array(Hr))),H.isTypedArray(cr,"data buffer for regl.read() must be a typedarray"),H(cr.byteLength>=Hr,"data buffer for regl.read() too small"),U.pixelStorei(Bt,4),U.readPixels(fn,Vr,an,Ft,rt,nn,cr),cr}function Xr(Kr){var nn;return Se.setFBO({framebuffer:Kr.framebuffer},function(){nn=Zr(Kr)}),nn}function qr(Kr){return!Kr||!("framebuffer"in Kr)?Zr(Kr):Xr(Kr)}return qr}function lr(U){return Array.prototype.slice.call(U)}function Lr(U){return lr(U).join("")}function rn(){var U=0,Se=[],ze=[];function Qt(nn){for(var fn=0;fn<ze.length;++fn)if(ze[fn]===nn)return Se[fn];var Vr="g"+U++;return Se.push(Vr),ze.push(nn),Vr}function wr(){var nn=[];function fn(){nn.push.apply(nn,lr(arguments))}var Vr=[];function an(){var Ft="v"+U++;return Vr.push(Ft),arguments.length>0&&(nn.push(Ft,"="),nn.push.apply(nn,lr(arguments)),nn.push(";")),Ft}return x(fn,{def:an,toString:function(){return Lr([Vr.length>0?"var "+Vr.join(",")+";":"",Lr(nn)])}})}function Yt(){var nn=wr(),fn=wr(),Vr=nn.toString,an=fn.toString;function Ft(cr,Hr){fn(cr,Hr,"=",nn.def(cr,Hr),";")}return x(function(){nn.apply(nn,lr(arguments))},{def:nn.def,entry:nn,exit:fn,save:Ft,set:function(cr,Hr,mn){Ft(cr,Hr),nn(cr,Hr,"=",mn,";")},toString:function(){return Vr()+an()}})}function fr(){var nn=Lr(arguments),fn=Yt(),Vr=Yt(),an=fn.toString,Ft=Vr.toString;return x(fn,{then:function(){return fn.apply(fn,lr(arguments)),this},else:function(){return Vr.apply(Vr,lr(arguments)),this},toString:function(){var cr=Ft();return cr&&(cr="else{"+cr+"}"),Lr(["if(",nn,"){",an(),"}",cr])}})}var Zr=wr(),Xr={};function qr(nn,fn){var Vr=[];function an(){var Dr="a"+Vr.length;return Vr.push(Dr),Dr}fn=fn||0;for(var Ft=0;Ft<fn;++Ft)an();var cr=Yt(),Hr=cr.toString,mn=Xr[nn]=x(cr,{arg:an,toString:function(){return Lr(["function(",Vr.join(),"){",Hr(),"}"])}});return mn}function Kr(){var nn=['"use strict";',Zr,"return {"];Object.keys(Xr).forEach(function(an){nn.push('"',an,'":',Xr[an].toString(),",")}),nn.push("}");var fn=Lr(nn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Vr=Function.apply(null,Se.concat(fn));return Vr.apply(null,ze)}return{global:Zr,link:Qt,block:wr,proc:qr,scope:Yt,cond:fr,compile:Kr}}var Yr="xyzw".split(""),_n=5121,Bn=1,Xn=2,Hn=0,ta=1,xn=2,ii=3,Si=4,ri=5,ai=6,wi="dither",ni="blend.enable",Jn="blend.color",xo="blend.equation",ja="blend.func",Xo="depth.enable",Oo="depth.func",Za="depth.range",ho="depth.mask",Ss="colorMask",Yo="cull.enable",Zu="cull.face",us="frontFace",Ls="lineWidth",Rs="polygonOffset.enable",ml="polygonOffset.offset",gl="sample.alpha",Ws="sample.enable",rl="sample.coverage",Bl="stencil.enable",tu="stencil.mask",nl="stencil.func",ru="stencil.opFront",io="stencil.opBack",Vu="scissor.enable",Cu="scissor.box",Es="viewport",Ki="profile",Lo="framebuffer",po="vert",pu="frag",vs="elements",du="primitive",Gu="count",Hu="offset",Wu="instances",nu="vao",Ul="Width",nf="Height",Pu=Lo+Ul,va=Lo+nf,Qf=Es+Ul,If=Es+nf,Of="drawingBuffer",il=Of+Ul,Lf=Of+nf,vh=[ja,xo,nl,ru,io,rl,Es,Cu,ml],oc=34962,mh=34963,bf=35632,gh=35633,sc=3553,af=34067,Rf=2884,qf=3042,Df=3024,eh=2960,yh=2929,uc=3089,_h=32823,kf=32926,Uh=32928,Sc=5126,zf=35664,bo=35665,Hc=35666,Z=5124,N=35667,M=35668,R=35669,te=35670,ve=35671,ut=35672,Nt=35673,Pt=35674,Sr=35675,Ur=35676,Fn=35678,Gn=35680,vi=4,mi=1028,ci=1029,ji=2304,Gi=2305,Ao=32775,No=32776,Ko=519,$a=7680,Da=0,ma=1,ao=32774,ms=513,Bo=36160,$o=36064,vo={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xs=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],yl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ds={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},_l={frag:bf,vert:gh},Ys={cw:ji,ccw:Gi};function Ff(U){return Array.isArray(U)||O(U)||Aa(U)}function jh(U){return U.sort(function(Se,ze){return Se===Es?-1:ze===Es?1:Se<ze?-1:1})}function Mu(U,Se,ze,Qt){this.thisDep=U,this.contextDep=Se,this.propDep=ze,this.append=Qt}function xl(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function Uo(U){return new Mu(!1,!1,!1,U)}function Iu(U,Se){var ze=U.type;if(ze===Hn){var Qt=U.data.length;return new Mu(!0,Qt>=1,Qt>=2,Se)}else if(ze===Si){var wr=U.data;return new Mu(wr.thisDep,wr.contextDep,wr.propDep,Se)}else{if(ze===ri)return new Mu(!1,!1,!1,Se);if(ze===ai){for(var Yt=!1,fr=!1,Zr=!1,Xr=0;Xr<U.data.length;++Xr){var qr=U.data[Xr];if(qr.type===ta)Zr=!0;else if(qr.type===xn)fr=!0;else if(qr.type===ii)Yt=!0;else if(qr.type===Hn){Yt=!0;var Kr=qr.data;Kr>=1&&(fr=!0),Kr>=2&&(Zr=!0)}else qr.type===Si&&(Yt=Yt||qr.data.thisDep,fr=fr||qr.data.contextDep,Zr=Zr||qr.data.propDep)}return new Mu(Yt,fr,Zr,Se)}else return new Mu(ze===ii,ze===xn,ze===ta,Se)}}var Zh=new Mu(!1,!1,!1,function(){});function hp(U,Se,ze,Qt,wr,Yt,fr,Zr,Xr,qr,Kr,nn,fn,Vr,an){var Ft=qr.Record,cr={add:32774,subtract:32778,"reverse subtract":32779};ze.ext_blend_minmax&&(cr.min=Ao,cr.max=No);var Hr=ze.angle_instanced_arrays,mn=ze.webgl_draw_buffers,Dr={dirty:!0,profile:an.profile},wn={},Nr=[],sn={},Rr={};function on(Ie){return Ie.replace(".","_")}function Yn(Ie,ye,it){var It=on(Ie);Nr.push(Ie),wn[It]=Dr[It]=!!it,sn[It]=ye}function $n(Ie,ye,it){var It=on(Ie);Nr.push(Ie),Array.isArray(it)?(Dr[It]=it.slice(),wn[It]=it.slice()):Dr[It]=wn[It]=it,Rr[It]=ye}Yn(wi,Df),Yn(ni,qf),$n(Jn,"blendColor",[0,0,0,0]),$n(xo,"blendEquationSeparate",[ao,ao]),$n(ja,"blendFuncSeparate",[ma,Da,ma,Da]),Yn(Xo,yh,!0),$n(Oo,"depthFunc",ms),$n(Za,"depthRange",[0,1]),$n(ho,"depthMask",!0),$n(Ss,Ss,[!0,!0,!0,!0]),Yn(Yo,Rf),$n(Zu,"cullFace",ci),$n(us,us,Gi),$n(Ls,Ls,1),Yn(Rs,_h),$n(ml,"polygonOffset",[0,0]),Yn(gl,kf),Yn(Ws,Uh),$n(rl,"sampleCoverage",[1,!1]),Yn(Bl,eh),$n(tu,"stencilMask",-1),$n(nl,"stencilFunc",[Ko,0,-1]),$n(ru,"stencilOpSeparate",[mi,$a,$a,$a]),$n(io,"stencilOpSeparate",[ci,$a,$a,$a]),Yn(Vu,uc),$n(Cu,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),$n(Es,Es,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var un={gl:U,context:fn,strings:Se,next:wn,current:Dr,draw:nn,elements:Yt,buffer:wr,shader:Kr,attributes:qr.state,vao:qr,uniforms:Xr,framebuffer:Zr,extensions:ze,timer:Vr,isBufferArgs:Ff},kr={primTypes:Ri,compareFuncs:yl,blendFuncs:vo,blendEquations:cr,stencilOps:Ds,glTypes:uo,orientationType:Ys};H.optional(function(){un.isArrayLike=ro}),mn&&(kr.backBuffer=[ci],kr.drawBuffer=I(Qt.maxDrawbuffers,function(Ie){return Ie===0?[0]:I(Ie,function(ye){return $o+ye})}));var Or=0;function fi(){var Ie=rn(),ye=Ie.link,it=Ie.global;Ie.id=Or++,Ie.batchId="0";var It=ye(un),Dt=Ie.shared={props:"a0"};Object.keys(un).forEach(function(et){Dt[et]=it.def(It,".",et)}),H.optional(function(){Ie.CHECK=ye(H),Ie.commandStr=H.guessCommand(),Ie.command=ye(Ie.commandStr),Ie.assert=function(et,Ce,Et){et("if(!(",Ce,"))",this.CHECK,".commandRaise(",ye(Et),",",this.command,");")},kr.invalidBlendCombinations=Xs});var lt=Ie.next={},at=Ie.current={};Object.keys(Rr).forEach(function(et){Array.isArray(Dr[et])&&(lt[et]=it.def(Dt.next,".",et),at[et]=it.def(Dt.current,".",et))});var _t=Ie.constants={};Object.keys(kr).forEach(function(et){_t[et]=it.def(JSON.stringify(kr[et]))}),Ie.invoke=function(et,Ce){switch(Ce.type){case Hn:var Et=["this",Dt.context,Dt.props,Ie.batchId];return et.def(ye(Ce.data),".call(",Et.slice(0,Math.max(Ce.data.length+1,4)),")");case ta:return et.def(Dt.props,Ce.data);case xn:return et.def(Dt.context,Ce.data);case ii:return et.def("this",Ce.data);case Si:return Ce.data.append(Ie,et),Ce.data.ref;case ri:return Ce.data.toString();case ai:return Ce.data.map(function(Rt){return Ie.invoke(et,Rt)})}},Ie.attribCache={};var Le={};return Ie.scopeAttrib=function(et){var Ce=Se.id(et);if(Ce in Le)return Le[Ce];var Et=qr.scope[Ce];Et||(Et=qr.scope[Ce]=new Ft);var Rt=Le[Ce]=ye(Et);return Rt},Ie}function Qn(Ie){var ye=Ie.static,it=Ie.dynamic,It;if(Ki in ye){var Dt=!!ye[Ki];It=Uo(function(at,_t){return Dt}),It.enable=Dt}else if(Ki in it){var lt=it[Ki];It=Iu(lt,function(at,_t){return at.invoke(_t,lt)})}return It}function On(Ie,ye){var it=Ie.static,It=Ie.dynamic;if(Lo in it){var Dt=it[Lo];return Dt?(Dt=Zr.getFramebuffer(Dt),H.command(Dt,"invalid framebuffer object"),Uo(function(at,_t){var Le=at.link(Dt),et=at.shared;_t.set(et.framebuffer,".next",Le);var Ce=et.context;return _t.set(Ce,"."+Pu,Le+".width"),_t.set(Ce,"."+va,Le+".height"),Le})):Uo(function(at,_t){var Le=at.shared;_t.set(Le.framebuffer,".next","null");var et=Le.context;return _t.set(et,"."+Pu,et+"."+il),_t.set(et,"."+va,et+"."+Lf),"null"})}else if(Lo in It){var lt=It[Lo];return Iu(lt,function(at,_t){var Le=at.invoke(_t,lt),et=at.shared,Ce=et.framebuffer,Et=_t.def(Ce,".getFramebuffer(",Le,")");H.optional(function(){at.assert(_t,"!"+Le+"||"+Et,"invalid framebuffer object")}),_t.set(Ce,".next",Et);var Rt=et.context;return _t.set(Rt,"."+Pu,Et+"?"+Et+".width:"+Rt+"."+il),_t.set(Rt,"."+va,Et+"?"+Et+".height:"+Rt+"."+Lf),Et})}else return null}function Ni(Ie,ye,it){var It=Ie.static,Dt=Ie.dynamic;function lt(Le){if(Le in It){var et=It[Le];H.commandType(et,"object","invalid "+Le,it.commandStr);var Ce=!0,Et=et.x|0,Rt=et.y|0,_r,er;return"width"in et?(_r=et.width|0,H.command(_r>=0,"invalid "+Le,it.commandStr)):Ce=!1,"height"in et?(er=et.height|0,H.command(er>=0,"invalid "+Le,it.commandStr)):Ce=!1,new Mu(!Ce&&ye&&ye.thisDep,!Ce&&ye&&ye.contextDep,!Ce&&ye&&ye.propDep,function(Un,ki){var Nn=Un.shared.context,oi=_r;"width"in et||(oi=ki.def(Nn,".",Pu,"-",Et));var Ai=er;return"height"in et||(Ai=ki.def(Nn,".",va,"-",Rt)),[Et,Rt,oi,Ai]})}else if(Le in Dt){var br=Dt[Le],Gr=Iu(br,function(Un,ki){var Nn=Un.invoke(ki,br);H.optional(function(){Un.assert(ki,Nn+"&&typeof "+Nn+'==="object"',"invalid "+Le)});var oi=Un.shared.context,Ai=ki.def(Nn,".x|0"),pa=ki.def(Nn,".y|0"),Zo=ki.def('"width" in ',Nn,"?",Nn,".width|0:","(",oi,".",Pu,"-",Ai,")"),au=ki.def('"height" in ',Nn,"?",Nn,".height|0:","(",oi,".",va,"-",pa,")");return H.optional(function(){Un.assert(ki,Zo+">=0&&"+au+">=0","invalid "+Le)}),[Ai,pa,Zo,au]});return ye&&(Gr.thisDep=Gr.thisDep||ye.thisDep,Gr.contextDep=Gr.contextDep||ye.contextDep,Gr.propDep=Gr.propDep||ye.propDep),Gr}else return ye?new Mu(ye.thisDep,ye.contextDep,ye.propDep,function(Un,ki){var Nn=Un.shared.context;return[0,0,ki.def(Nn,".",Pu),ki.def(Nn,".",va)]}):null}var at=lt(Es);if(at){var _t=at;at=new Mu(at.thisDep,at.contextDep,at.propDep,function(Le,et){var Ce=_t.append(Le,et),Et=Le.shared.context;return et.set(Et,"."+Qf,Ce[2]),et.set(Et,"."+If,Ce[3]),Ce})}return{viewport:at,scissor_box:lt(Cu)}}function Ti(Ie,ye){var it=Ie.static,It=typeof it[pu]=="string"&&typeof it[po]=="string";if(It){if(Object.keys(ye.dynamic).length>0)return null;var Dt=ye.static,lt=Object.keys(Dt);if(lt.length>0&&typeof Dt[lt[0]]=="number"){for(var at=[],_t=0;_t<lt.length;++_t)H(typeof Dt[lt[_t]]=="number","must specify all vertex attribute locations when using vaos"),at.push([Dt[lt[_t]]|0,lt[_t]]);return at}}return null}function Bi(Ie,ye,it){var It=Ie.static,Dt=Ie.dynamic;function lt(Ce){if(Ce in It){var Et=Se.id(It[Ce]);H.optional(function(){Kr.shader(_l[Ce],Et,H.guessCommand())});var Rt=Uo(function(){return Et});return Rt.id=Et,Rt}else if(Ce in Dt){var _r=Dt[Ce];return Iu(_r,function(er,br){var Gr=er.invoke(br,_r),Un=br.def(er.shared.strings,".id(",Gr,")");return H.optional(function(){br(er.shared.shader,".shader(",_l[Ce],",",Un,",",er.command,");")}),Un})}return null}var at=lt(pu),_t=lt(po),Le=null,et;return xl(at)&&xl(_t)?(Le=Kr.program(_t.id,at.id,null,it),et=Uo(function(Ce,Et){return Ce.link(Le)})):et=new Mu(at&&at.thisDep||_t&&_t.thisDep,at&&at.contextDep||_t&&_t.contextDep,at&&at.propDep||_t&&_t.propDep,function(Ce,Et){var Rt=Ce.shared.shader,_r;at?_r=at.append(Ce,Et):_r=Et.def(Rt,".",pu);var er;_t?er=_t.append(Ce,Et):er=Et.def(Rt,".",po);var br=Rt+".program("+er+","+_r;return H.optional(function(){br+=","+Ce.command}),Et.def(br+")")}),{frag:at,vert:_t,progVar:et,program:Le}}function ca(Ie,ye){var it=Ie.static,It=Ie.dynamic;function Dt(){if(vs in it){var Ce=it[vs];Ff(Ce)?Ce=Yt.getElements(Yt.create(Ce,!0)):Ce&&(Ce=Yt.getElements(Ce),H.command(Ce,"invalid elements",ye.commandStr));var Et=Uo(function(_r,er){if(Ce){var br=_r.link(Ce);return _r.ELEMENTS=br,br}return _r.ELEMENTS=null,null});return Et.value=Ce,Et}else if(vs in It){var Rt=It[vs];return Iu(Rt,function(_r,er){var br=_r.shared,Gr=br.isBufferArgs,Un=br.elements,ki=_r.invoke(er,Rt),Nn=er.def("null"),oi=er.def(Gr,"(",ki,")"),Ai=_r.cond(oi).then(Nn,"=",Un,".createStream(",ki,");").else(Nn,"=",Un,".getElements(",ki,");");return H.optional(function(){_r.assert(Ai.else,"!"+ki+"||"+Nn,"invalid elements")}),er.entry(Ai),er.exit(_r.cond(oi).then(Un,".destroyStream(",Nn,");")),_r.ELEMENTS=Nn,Nn})}return null}var lt=Dt();function at(){if(du in it){var Ce=it[du];return H.commandParameter(Ce,Ri,"invalid primitve",ye.commandStr),Uo(function(Rt,_r){return Ri[Ce]})}else if(du in It){var Et=It[du];return Iu(Et,function(Rt,_r){var er=Rt.constants.primTypes,br=Rt.invoke(_r,Et);return H.optional(function(){Rt.assert(_r,br+" in "+er,"invalid primitive, must be one of "+Object.keys(Ri))}),_r.def(er,"[",br,"]")})}else if(lt)return xl(lt)?lt.value?Uo(function(Rt,_r){return _r.def(Rt.ELEMENTS,".primType")}):Uo(function(){return vi}):new Mu(lt.thisDep,lt.contextDep,lt.propDep,function(Rt,_r){var er=Rt.ELEMENTS;return _r.def(er,"?",er,".primType:",vi)});return null}function _t(Ce,Et){if(Ce in it){var Rt=it[Ce]|0;return H.command(!Et||Rt>=0,"invalid "+Ce,ye.commandStr),Uo(function(er,br){return Et&&(er.OFFSET=Rt),Rt})}else if(Ce in It){var _r=It[Ce];return Iu(_r,function(er,br){var Gr=er.invoke(br,_r);return Et&&(er.OFFSET=Gr,H.optional(function(){er.assert(br,Gr+">=0","invalid "+Ce)})),Gr})}else if(Et&&lt)return Uo(function(er,br){return er.OFFSET="0",0});return null}var Le=_t(Hu,!0);function et(){if(Gu in it){var Ce=it[Gu]|0;return H.command(typeof Ce=="number"&&Ce>=0,"invalid vertex count",ye.commandStr),Uo(function(){return Ce})}else if(Gu in It){var Et=It[Gu];return Iu(Et,function(er,br){var Gr=er.invoke(br,Et);return H.optional(function(){er.assert(br,"typeof "+Gr+'==="number"&&'+Gr+">=0&&"+Gr+"===("+Gr+"|0)","invalid vertex count")}),Gr})}else if(lt)if(xl(lt)){if(lt)return Le?new Mu(Le.thisDep,Le.contextDep,Le.propDep,function(er,br){var Gr=br.def(er.ELEMENTS,".vertCount-",er.OFFSET);return H.optional(function(){er.assert(br,Gr+">=0","invalid vertex offset/element buffer too small")}),Gr}):Uo(function(er,br){return br.def(er.ELEMENTS,".vertCount")});var Rt=Uo(function(){return-1});return H.optional(function(){Rt.MISSING=!0}),Rt}else{var _r=new Mu(lt.thisDep||Le.thisDep,lt.contextDep||Le.contextDep,lt.propDep||Le.propDep,function(er,br){var Gr=er.ELEMENTS;return er.OFFSET?br.def(Gr,"?",Gr,".vertCount-",er.OFFSET,":-1"):br.def(Gr,"?",Gr,".vertCount:-1")});return H.optional(function(){_r.DYNAMIC=!0}),_r}return null}return{elements:lt,primitive:at(),count:et(),instances:_t(Wu,!1),offset:Le}}function Jo(Ie,ye){var it=Ie.static,It=Ie.dynamic,Dt={};return Nr.forEach(function(lt){var at=on(lt);function _t(Le,et){if(lt in it){var Ce=Le(it[lt]);Dt[at]=Uo(function(){return Ce})}else if(lt in It){var Et=It[lt];Dt[at]=Iu(Et,function(Rt,_r){return et(Rt,_r,Rt.invoke(_r,Et))})}}switch(lt){case Yo:case ni:case wi:case Bl:case Xo:case Vu:case Rs:case gl:case Ws:case ho:return _t(function(Le){return H.commandType(Le,"boolean",lt,ye.commandStr),Le},function(Le,et,Ce){return H.optional(function(){Le.assert(et,"typeof "+Ce+'==="boolean"',"invalid flag "+lt,Le.commandStr)}),Ce});case Oo:return _t(function(Le){return H.commandParameter(Le,yl,"invalid "+lt,ye.commandStr),yl[Le]},function(Le,et,Ce){var Et=Le.constants.compareFuncs;return H.optional(function(){Le.assert(et,Ce+" in "+Et,"invalid "+lt+", must be one of "+Object.keys(yl))}),et.def(Et,"[",Ce,"]")});case Za:return _t(function(Le){return H.command(ro(Le)&&Le.length===2&&typeof Le[0]=="number"&&typeof Le[1]=="number"&&Le[0]<=Le[1],"depth range is 2d array",ye.commandStr),Le},function(Le,et,Ce){H.optional(function(){Le.assert(et,Le.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===2&&typeof "+Ce+'[0]==="number"&&typeof '+Ce+'[1]==="number"&&'+Ce+"[0]<="+Ce+"[1]","depth range must be a 2d array")});var Et=et.def("+",Ce,"[0]"),Rt=et.def("+",Ce,"[1]");return[Et,Rt]});case ja:return _t(function(Le){H.commandType(Le,"object","blend.func",ye.commandStr);var et="srcRGB"in Le?Le.srcRGB:Le.src,Ce="srcAlpha"in Le?Le.srcAlpha:Le.src,Et="dstRGB"in Le?Le.dstRGB:Le.dst,Rt="dstAlpha"in Le?Le.dstAlpha:Le.dst;return H.commandParameter(et,vo,at+".srcRGB",ye.commandStr),H.commandParameter(Ce,vo,at+".srcAlpha",ye.commandStr),H.commandParameter(Et,vo,at+".dstRGB",ye.commandStr),H.commandParameter(Rt,vo,at+".dstAlpha",ye.commandStr),H.command(Xs.indexOf(et+", "+Et)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+et+", "+Et+")",ye.commandStr),[vo[et],vo[Et],vo[Ce],vo[Rt]]},function(Le,et,Ce){var Et=Le.constants.blendFuncs;H.optional(function(){Le.assert(et,Ce+"&&typeof "+Ce+'==="object"',"invalid blend func, must be an object")});function Rt(Nn,oi){var Ai=et.def('"',Nn,oi,'" in ',Ce,"?",Ce,".",Nn,oi,":",Ce,".",Nn);return H.optional(function(){Le.assert(et,Ai+" in "+Et,"invalid "+lt+"."+Nn+oi+", must be one of "+Object.keys(vo))}),Ai}var _r=Rt("src","RGB"),er=Rt("dst","RGB");H.optional(function(){var Nn=Le.constants.invalidBlendCombinations;Le.assert(et,Nn+".indexOf("+_r+'+", "+'+er+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var br=et.def(Et,"[",_r,"]"),Gr=et.def(Et,"[",Rt("src","Alpha"),"]"),Un=et.def(Et,"[",er,"]"),ki=et.def(Et,"[",Rt("dst","Alpha"),"]");return[br,Un,Gr,ki]});case xo:return _t(function(Le){if(typeof Le=="string")return H.commandParameter(Le,cr,"invalid "+lt,ye.commandStr),[cr[Le],cr[Le]];if(typeof Le=="object")return H.commandParameter(Le.rgb,cr,lt+".rgb",ye.commandStr),H.commandParameter(Le.alpha,cr,lt+".alpha",ye.commandStr),[cr[Le.rgb],cr[Le.alpha]];H.commandRaise("invalid blend.equation",ye.commandStr)},function(Le,et,Ce){var Et=Le.constants.blendEquations,Rt=et.def(),_r=et.def(),er=Le.cond("typeof ",Ce,'==="string"');return H.optional(function(){function br(Gr,Un,ki){Le.assert(Gr,ki+" in "+Et,"invalid "+Un+", must be one of "+Object.keys(cr))}br(er.then,lt,Ce),Le.assert(er.else,Ce+"&&typeof "+Ce+'==="object"',"invalid "+lt),br(er.else,lt+".rgb",Ce+".rgb"),br(er.else,lt+".alpha",Ce+".alpha")}),er.then(Rt,"=",_r,"=",Et,"[",Ce,"];"),er.else(Rt,"=",Et,"[",Ce,".rgb];",_r,"=",Et,"[",Ce,".alpha];"),et(er),[Rt,_r]});case Jn:return _t(function(Le){return H.command(ro(Le)&&Le.length===4,"blend.color must be a 4d array",ye.commandStr),I(4,function(et){return+Le[et]})},function(Le,et,Ce){return H.optional(function(){Le.assert(et,Le.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","blend.color must be a 4d array")}),I(4,function(Et){return et.def("+",Ce,"[",Et,"]")})});case tu:return _t(function(Le){return H.commandType(Le,"number",at,ye.commandStr),Le|0},function(Le,et,Ce){return H.optional(function(){Le.assert(et,"typeof "+Ce+'==="number"',"invalid stencil.mask")}),et.def(Ce,"|0")});case nl:return _t(function(Le){H.commandType(Le,"object",at,ye.commandStr);var et=Le.cmp||"keep",Ce=Le.ref||0,Et="mask"in Le?Le.mask:-1;return H.commandParameter(et,yl,lt+".cmp",ye.commandStr),H.commandType(Ce,"number",lt+".ref",ye.commandStr),H.commandType(Et,"number",lt+".mask",ye.commandStr),[yl[et],Ce,Et]},function(Le,et,Ce){var Et=Le.constants.compareFuncs;H.optional(function(){function br(){Le.assert(et,Array.prototype.join.call(arguments,""),"invalid stencil.func")}br(Ce+"&&typeof ",Ce,'==="object"'),br('!("cmp" in ',Ce,")||(",Ce,".cmp in ",Et,")")});var Rt=et.def('"cmp" in ',Ce,"?",Et,"[",Ce,".cmp]",":",$a),_r=et.def(Ce,".ref|0"),er=et.def('"mask" in ',Ce,"?",Ce,".mask|0:-1");return[Rt,_r,er]});case ru:case io:return _t(function(Le){H.commandType(Le,"object",at,ye.commandStr);var et=Le.fail||"keep",Ce=Le.zfail||"keep",Et=Le.zpass||"keep";return H.commandParameter(et,Ds,lt+".fail",ye.commandStr),H.commandParameter(Ce,Ds,lt+".zfail",ye.commandStr),H.commandParameter(Et,Ds,lt+".zpass",ye.commandStr),[lt===io?ci:mi,Ds[et],Ds[Ce],Ds[Et]]},function(Le,et,Ce){var Et=Le.constants.stencilOps;H.optional(function(){Le.assert(et,Ce+"&&typeof "+Ce+'==="object"',"invalid "+lt)});function Rt(_r){return H.optional(function(){Le.assert(et,'!("'+_r+'" in '+Ce+")||("+Ce+"."+_r+" in "+Et+")","invalid "+lt+"."+_r+", must be one of "+Object.keys(Ds))}),et.def('"',_r,'" in ',Ce,"?",Et,"[",Ce,".",_r,"]:",$a)}return[lt===io?ci:mi,Rt("fail"),Rt("zfail"),Rt("zpass")]});case ml:return _t(function(Le){H.commandType(Le,"object",at,ye.commandStr);var et=Le.factor|0,Ce=Le.units|0;return H.commandType(et,"number",at+".factor",ye.commandStr),H.commandType(Ce,"number",at+".units",ye.commandStr),[et,Ce]},function(Le,et,Ce){H.optional(function(){Le.assert(et,Ce+"&&typeof "+Ce+'==="object"',"invalid "+lt)});var Et=et.def(Ce,".factor|0"),Rt=et.def(Ce,".units|0");return[Et,Rt]});case Zu:return _t(function(Le){var et=0;return Le==="front"?et=mi:Le==="back"&&(et=ci),H.command(!!et,at,ye.commandStr),et},function(Le,et,Ce){return H.optional(function(){Le.assert(et,Ce+'==="front"||'+Ce+'==="back"',"invalid cull.face")}),et.def(Ce,'==="front"?',mi,":",ci)});case Ls:return _t(function(Le){return H.command(typeof Le=="number"&&Le>=Qt.lineWidthDims[0]&&Le<=Qt.lineWidthDims[1],"invalid line width, must be a positive number between "+Qt.lineWidthDims[0]+" and "+Qt.lineWidthDims[1],ye.commandStr),Le},function(Le,et,Ce){return H.optional(function(){Le.assert(et,"typeof "+Ce+'==="number"&&'+Ce+">="+Qt.lineWidthDims[0]+"&&"+Ce+"<="+Qt.lineWidthDims[1],"invalid line width")}),Ce});case us:return _t(function(Le){return H.commandParameter(Le,Ys,at,ye.commandStr),Ys[Le]},function(Le,et,Ce){return H.optional(function(){Le.assert(et,Ce+'==="cw"||'+Ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),et.def(Ce+'==="cw"?'+ji+":"+Gi)});case Ss:return _t(function(Le){return H.command(ro(Le)&&Le.length===4,"color.mask must be length 4 array",ye.commandStr),Le.map(function(et){return!!et})},function(Le,et,Ce){return H.optional(function(){Le.assert(et,Le.shared.isArrayLike+"("+Ce+")&&"+Ce+".length===4","invalid color.mask")}),I(4,function(Et){return"!!"+Ce+"["+Et+"]"})});case rl:return _t(function(Le){H.command(typeof Le=="object"&&Le,at,ye.commandStr);var et="value"in Le?Le.value:1,Ce=!!Le.invert;return H.command(typeof et=="number"&&et>=0&&et<=1,"sample.coverage.value must be a number between 0 and 1",ye.commandStr),[et,Ce]},function(Le,et,Ce){H.optional(function(){Le.assert(et,Ce+"&&typeof "+Ce+'==="object"',"invalid sample.coverage")});var Et=et.def('"value" in ',Ce,"?+",Ce,".value:1"),Rt=et.def("!!",Ce,".invert");return[Et,Rt]})}}),Dt}function ks(Ie,ye){var it=Ie.static,It=Ie.dynamic,Dt={};return Object.keys(it).forEach(function(lt){var at=it[lt],_t;if(typeof at=="number"||typeof at=="boolean")_t=Uo(function(){return at});else if(typeof at=="function"){var Le=at._reglType;Le==="texture2d"||Le==="textureCube"?_t=Uo(function(et){return et.link(at)}):Le==="framebuffer"||Le==="framebufferCube"?(H.command(at.color.length>0,'missing color attachment for framebuffer sent to uniform "'+lt+'"',ye.commandStr),_t=Uo(function(et){return et.link(at.color[0])})):H.commandRaise('invalid data for uniform "'+lt+'"',ye.commandStr)}else ro(at)?_t=Uo(function(et){var Ce=et.global.def("[",I(at.length,function(Et){return H.command(typeof at[Et]=="number"||typeof at[Et]=="boolean","invalid uniform "+lt,et.commandStr),at[Et]}),"]");return Ce}):H.commandRaise('invalid or missing data for uniform "'+lt+'"',ye.commandStr);_t.value=at,Dt[lt]=_t}),Object.keys(It).forEach(function(lt){var at=It[lt];Dt[lt]=Iu(at,function(_t,Le){return _t.invoke(Le,at)})}),Dt}function Hi(Ie,ye){var it=Ie.static,It=Ie.dynamic,Dt={};return Object.keys(it).forEach(function(lt){var at=it[lt],_t=Se.id(lt),Le=new Ft;if(Ff(at))Le.state=Bn,Le.buffer=wr.getBuffer(wr.create(at,oc,!1,!0)),Le.type=0;else{var et=wr.getBuffer(at);if(et)Le.state=Bn,Le.buffer=et,Le.type=0;else if(H.command(typeof at=="object"&&at,"invalid data for attribute "+lt,ye.commandStr),"constant"in at){var Ce=at.constant;Le.buffer="null",Le.state=Xn,typeof Ce=="number"?Le.x=Ce:(H.command(ro(Ce)&&Ce.length>0&&Ce.length<=4,"invalid constant for attribute "+lt,ye.commandStr),Yr.forEach(function(Un,ki){ki<Ce.length&&(Le[Un]=Ce[ki])}))}else{Ff(at.buffer)?et=wr.getBuffer(wr.create(at.buffer,oc,!1,!0)):et=wr.getBuffer(at.buffer),H.command(!!et,'missing buffer for attribute "'+lt+'"',ye.commandStr);var Et=at.offset|0;H.command(Et>=0,'invalid offset for attribute "'+lt+'"',ye.commandStr);var Rt=at.stride|0;H.command(Rt>=0&&Rt<256,'invalid stride for attribute "'+lt+'", must be integer betweeen [0, 255]',ye.commandStr);var _r=at.size|0;H.command(!("size"in at)||_r>0&&_r<=4,'invalid size for attribute "'+lt+'", must be 1,2,3,4',ye.commandStr);var er=!!at.normalized,br=0;"type"in at&&(H.commandParameter(at.type,uo,"invalid type for attribute "+lt,ye.commandStr),br=uo[at.type]);var Gr=at.divisor|0;"divisor"in at&&(H.command(Gr===0||Hr,'cannot specify divisor for attribute "'+lt+'", instancing not supported',ye.commandStr),H.command(Gr>=0,'invalid divisor for attribute "'+lt+'"',ye.commandStr)),H.optional(function(){var Un=ye.commandStr,ki=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(at).forEach(function(Nn){H.command(ki.indexOf(Nn)>=0,'unknown parameter "'+Nn+'" for attribute pointer "'+lt+'" (valid parameters are '+ki+")",Un)})}),Le.buffer=et,Le.state=Bn,Le.size=_r,Le.normalized=er,Le.type=br||et.dtype,Le.offset=Et,Le.stride=Rt,Le.divisor=Gr}}Dt[lt]=Uo(function(Un,ki){var Nn=Un.attribCache;if(_t in Nn)return Nn[_t];var oi={isStream:!1};return Object.keys(Le).forEach(function(Ai){oi[Ai]=Le[Ai]}),Le.buffer&&(oi.buffer=Un.link(Le.buffer),oi.type=oi.type||oi.buffer+".dtype"),Nn[_t]=oi,oi})}),Object.keys(It).forEach(function(lt){var at=It[lt];function _t(Le,et){var Ce=Le.invoke(et,at),Et=Le.shared,Rt=Le.constants,_r=Et.isBufferArgs,er=Et.buffer;H.optional(function(){Le.assert(et,Ce+"&&(typeof "+Ce+'==="object"||typeof '+Ce+'==="function")&&('+_r+"("+Ce+")||"+er+".getBuffer("+Ce+")||"+er+".getBuffer("+Ce+".buffer)||"+_r+"("+Ce+'.buffer)||("constant" in '+Ce+"&&(typeof "+Ce+'.constant==="number"||'+Et.isArrayLike+"("+Ce+".constant))))",'invalid dynamic attribute "'+lt+'"')});var br={isStream:et.def(!1)},Gr=new Ft;Gr.state=Bn,Object.keys(Gr).forEach(function(oi){br[oi]=et.def(""+Gr[oi])});var Un=br.buffer,ki=br.type;et("if(",_r,"(",Ce,")){",br.isStream,"=true;",Un,"=",er,".createStream(",oc,",",Ce,");",ki,"=",Un,".dtype;","}else{",Un,"=",er,".getBuffer(",Ce,");","if(",Un,"){",ki,"=",Un,".dtype;",'}else if("constant" in ',Ce,"){",br.state,"=",Xn,";","if(typeof "+Ce+'.constant === "number"){',br[Yr[0]],"=",Ce,".constant;",Yr.slice(1).map(function(oi){return br[oi]}).join("="),"=0;","}else{",Yr.map(function(oi,Ai){return br[oi]+"="+Ce+".constant.length>"+Ai+"?"+Ce+".constant["+Ai+"]:0;"}).join(""),"}}else{","if(",_r,"(",Ce,".buffer)){",Un,"=",er,".createStream(",oc,",",Ce,".buffer);","}else{",Un,"=",er,".getBuffer(",Ce,".buffer);","}",ki,'="type" in ',Ce,"?",Rt.glTypes,"[",Ce,".type]:",Un,".dtype;",br.normalized,"=!!",Ce,".normalized;");function Nn(oi){et(br[oi],"=",Ce,".",oi,"|0;")}return Nn("size"),Nn("offset"),Nn("stride"),Nn("divisor"),et("}}"),et.exit("if(",br.isStream,"){",er,".destroyStream(",Un,");","}"),br}Dt[lt]=Iu(at,_t)}),Dt}function So(Ie,ye){var it=Ie.static,It=Ie.dynamic;if(nu in it){var Dt=it[nu];return Dt!==null&&qr.getVAO(Dt)===null&&(Dt=qr.createVAO(Dt)),Uo(function(at){return at.link(qr.getVAO(Dt))})}else if(nu in It){var lt=It[nu];return Iu(lt,function(at,_t){var Le=at.invoke(_t,lt);return _t.def(at.shared.vao+".getVAO("+Le+")")})}return null}function Ja(Ie){var ye=Ie.static,it=Ie.dynamic,It={};return Object.keys(ye).forEach(function(Dt){var lt=ye[Dt];It[Dt]=Uo(function(at,_t){return typeof lt=="number"||typeof lt=="boolean"?""+lt:at.link(lt)})}),Object.keys(it).forEach(function(Dt){var lt=it[Dt];It[Dt]=Iu(lt,function(at,_t){return at.invoke(_t,lt)})}),It}function jo(Ie,ye,it,It,Dt){var lt=Ie.static,at=Ie.dynamic;H.optional(function(){var Nn=[Lo,po,pu,vs,du,Hu,Gu,Wu,Ki,nu].concat(Nr);function oi(Ai){Object.keys(Ai).forEach(function(pa){H.command(Nn.indexOf(pa)>=0,'unknown parameter "'+pa+'"',Dt.commandStr)})}oi(lt),oi(at)});var _t=Ti(Ie,ye),Le=On(Ie,Dt),et=Ni(Ie,Le,Dt),Ce=ca(Ie,Dt),Et=Jo(Ie,Dt),Rt=Bi(Ie,Dt,_t);function _r(Nn){var oi=et[Nn];oi&&(Et[Nn]=oi)}_r(Es),_r(on(Cu));var er=Object.keys(Et).length>0,br={framebuffer:Le,draw:Ce,shader:Rt,state:Et,dirty:er,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(br.profile=Qn(Ie,Dt),br.uniforms=ks(it,Dt),br.drawVAO=br.scopeVAO=So(Ie,Dt),!br.drawVAO&&Rt.program&&!_t&&ze.angle_instanced_arrays){var Gr=!0,Un=Rt.program.attributes.map(function(Nn){var oi=ye.static[Nn];return Gr=Gr&&!!oi,oi});if(Gr&&Un.length>0){var ki=qr.getVAO(qr.createVAO(Un));br.drawVAO=new Mu(null,null,null,function(Nn,oi){return Nn.link(ki)}),br.useVAO=!0}}return _t?br.useVAO=!0:br.attributes=Hi(ye,Dt),br.context=Ja(It,Dt),br}function ls(Ie,ye,it){var It=Ie.shared,Dt=It.context,lt=Ie.scope();Object.keys(it).forEach(function(at){ye.save(Dt,"."+at);var _t=it[at],Le=_t.append(Ie,ye);Array.isArray(Le)?lt(Dt,".",at,"=[",Le.join(),"];"):lt(Dt,".",at,"=",Le,";")}),ye(lt)}function ws(Ie,ye,it,It){var Dt=Ie.shared,lt=Dt.gl,at=Dt.framebuffer,_t;mn&&(_t=ye.def(Dt.extensions,".webgl_draw_buffers"));var Le=Ie.constants,et=Le.drawBuffer,Ce=Le.backBuffer,Et;it?Et=it.append(Ie,ye):Et=ye.def(at,".next"),It||ye("if(",Et,"!==",at,".cur){"),ye("if(",Et,"){",lt,".bindFramebuffer(",Bo,",",Et,".framebuffer);"),mn&&ye(_t,".drawBuffersWEBGL(",et,"[",Et,".colorAttachments.length]);"),ye("}else{",lt,".bindFramebuffer(",Bo,",null);"),mn&&ye(_t,".drawBuffersWEBGL(",Ce,");"),ye("}",at,".cur=",Et,";"),It||ye("}")}function Qo(Ie,ye,it){var It=Ie.shared,Dt=It.gl,lt=Ie.current,at=Ie.next,_t=It.current,Le=It.next,et=Ie.cond(_t,".dirty");Nr.forEach(function(Ce){var Et=on(Ce);if(!(Et in it.state)){var Rt,_r;if(Et in at){Rt=at[Et],_r=lt[Et];var er=I(Dr[Et].length,function(Gr){return et.def(Rt,"[",Gr,"]")});et(Ie.cond(er.map(function(Gr,Un){return Gr+"!=="+_r+"["+Un+"]"}).join("||")).then(Dt,".",Rr[Et],"(",er,");",er.map(function(Gr,Un){return _r+"["+Un+"]="+Gr}).join(";"),";"))}else{Rt=et.def(Le,".",Et);var br=Ie.cond(Rt,"!==",_t,".",Et);et(br),Et in sn?br(Ie.cond(Rt).then(Dt,".enable(",sn[Et],");").else(Dt,".disable(",sn[Et],");"),_t,".",Et,"=",Rt,";"):br(Dt,".",Rr[Et],"(",Rt,");",_t,".",Et,"=",Rt,";")}}}),Object.keys(it.state).length===0&&et(_t,".dirty=false;"),ye(et)}function Ts(Ie,ye,it,It){var Dt=Ie.shared,lt=Ie.current,at=Dt.current,_t=Dt.gl;jh(Object.keys(it)).forEach(function(Le){var et=it[Le];if(!(It&&!It(et))){var Ce=et.append(Ie,ye);if(sn[Le]){var Et=sn[Le];xl(et)?Ce?ye(_t,".enable(",Et,");"):ye(_t,".disable(",Et,");"):ye(Ie.cond(Ce).then(_t,".enable(",Et,");").else(_t,".disable(",Et,");")),ye(at,".",Le,"=",Ce,";")}else if(ro(Ce)){var Rt=lt[Le];ye(_t,".",Rr[Le],"(",Ce,");",Ce.map(function(_r,er){return Rt+"["+er+"]="+_r}).join(";"),";")}else ye(_t,".",Rr[Le],"(",Ce,");",at,".",Le,"=",Ce,";")}})}function qo(Ie,ye){Hr&&(Ie.instancing=ye.def(Ie.shared.extensions,".angle_instanced_arrays"))}function zi(Ie,ye,it,It,Dt){var lt=Ie.shared,at=Ie.stats,_t=lt.current,Le=lt.timer,et=it.profile;function Ce(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Et,Rt;function _r(Nn){Et=ye.def(),Nn(Et,"=",Ce(),";"),typeof Dt=="string"?Nn(at,".count+=",Dt,";"):Nn(at,".count++;"),Vr&&(It?(Rt=ye.def(),Nn(Rt,"=",Le,".getNumPendingQueries();")):Nn(Le,".beginQuery(",at,");"))}function er(Nn){Nn(at,".cpuTime+=",Ce(),"-",Et,";"),Vr&&(It?Nn(Le,".pushScopeStats(",Rt,",",Le,".getNumPendingQueries(),",at,");"):Nn(Le,".endQuery();"))}function br(Nn){var oi=ye.def(_t,".profile");ye(_t,".profile=",Nn,";"),ye.exit(_t,".profile=",oi,";")}var Gr;if(et){if(xl(et)){et.enable?(_r(ye),er(ye.exit),br("true")):br("false");return}Gr=et.append(Ie,ye),br(Gr)}else Gr=ye.def(_t,".profile");var Un=Ie.block();_r(Un),ye("if(",Gr,"){",Un,"}");var ki=Ie.block();er(ki),ye.exit("if(",Gr,"){",ki,"}")}function As(Ie,ye,it,It,Dt){var lt=Ie.shared;function at(Le){switch(Le){case zf:case N:case ve:return 2;case bo:case M:case ut:return 3;case Hc:case R:case Nt:return 4;default:return 1}}function _t(Le,et,Ce){var Et=lt.gl,Rt=ye.def(Le,".location"),_r=ye.def(lt.attributes,"[",Rt,"]"),er=Ce.state,br=Ce.buffer,Gr=[Ce.x,Ce.y,Ce.z,Ce.w],Un=["buffer","normalized","offset","stride"];function ki(){ye("if(!",_r,".buffer){",Et,".enableVertexAttribArray(",Rt,");}");var oi=Ce.type,Ai;if(Ce.size?Ai=ye.def(Ce.size,"||",et):Ai=et,ye("if(",_r,".type!==",oi,"||",_r,".size!==",Ai,"||",Un.map(function(Zo){return _r+"."+Zo+"!=="+Ce[Zo]}).join("||"),"){",Et,".bindBuffer(",oc,",",br,".buffer);",Et,".vertexAttribPointer(",[Rt,Ai,oi,Ce.normalized,Ce.stride,Ce.offset],");",_r,".type=",oi,";",_r,".size=",Ai,";",Un.map(function(Zo){return _r+"."+Zo+"="+Ce[Zo]+";"}).join(""),"}"),Hr){var pa=Ce.divisor;ye("if(",_r,".divisor!==",pa,"){",Ie.instancing,".vertexAttribDivisorANGLE(",[Rt,pa],");",_r,".divisor=",pa,";}")}}function Nn(){ye("if(",_r,".buffer){",Et,".disableVertexAttribArray(",Rt,");",_r,".buffer=null;","}if(",Yr.map(function(oi,Ai){return _r+"."+oi+"!=="+Gr[Ai]}).join("||"),"){",Et,".vertexAttrib4f(",Rt,",",Gr,");",Yr.map(function(oi,Ai){return _r+"."+oi+"="+Gr[Ai]+";"}).join(""),"}")}er===Bn?ki():er===Xn?Nn():(ye("if(",er,"===",Bn,"){"),ki(),ye("}else{"),Nn(),ye("}"))}It.forEach(function(Le){var et=Le.name,Ce=it.attributes[et],Et;if(Ce){if(!Dt(Ce))return;Et=Ce.append(Ie,ye)}else{if(!Dt(Zh))return;var Rt=Ie.scopeAttrib(et);H.optional(function(){Ie.assert(ye,Rt+".state","missing attribute "+et)}),Et={},Object.keys(new Ft).forEach(function(_r){Et[_r]=ye.def(Rt,".",_r)})}_t(Ie.link(Le),at(Le.info.type),Et)})}function ha(Ie,ye,it,It,Dt){for(var lt=Ie.shared,at=lt.gl,_t,Le=0;Le<It.length;++Le){var et=It[Le],Ce=et.name,Et=et.info.type,Rt=it.uniforms[Ce],_r=Ie.link(et),er=_r+".location",br;if(Rt){if(!Dt(Rt))continue;if(xl(Rt)){var Gr=Rt.value;if(H.command(Gr!==null&&typeof Gr!="undefined",'missing uniform "'+Ce+'"',Ie.commandStr),Et===Fn||Et===Gn){H.command(typeof Gr=="function"&&(Et===Fn&&(Gr._reglType==="texture2d"||Gr._reglType==="framebuffer")||Et===Gn&&(Gr._reglType==="textureCube"||Gr._reglType==="framebufferCube")),"invalid texture for uniform "+Ce,Ie.commandStr);var Un=Ie.link(Gr._texture||Gr.color[0]._texture);ye(at,".uniform1i(",er,",",Un+".bind());"),ye.exit(Un,".unbind();")}else if(Et===Pt||Et===Sr||Et===Ur){H.optional(function(){H.command(ro(Gr),"invalid matrix for uniform "+Ce,Ie.commandStr),H.command(Et===Pt&&Gr.length===4||Et===Sr&&Gr.length===9||Et===Ur&&Gr.length===16,"invalid length for matrix uniform "+Ce,Ie.commandStr)});var ki=Ie.global.def("new Float32Array(["+Array.prototype.slice.call(Gr)+"])"),Nn=2;Et===Sr?Nn=3:Et===Ur&&(Nn=4),ye(at,".uniformMatrix",Nn,"fv(",er,",false,",ki,");")}else{switch(Et){case Sc:H.commandType(Gr,"number","uniform "+Ce,Ie.commandStr),_t="1f";break;case zf:H.command(ro(Gr)&&Gr.length===2,"uniform "+Ce,Ie.commandStr),_t="2f";break;case bo:H.command(ro(Gr)&&Gr.length===3,"uniform "+Ce,Ie.commandStr),_t="3f";break;case Hc:H.command(ro(Gr)&&Gr.length===4,"uniform "+Ce,Ie.commandStr),_t="4f";break;case te:H.commandType(Gr,"boolean","uniform "+Ce,Ie.commandStr),_t="1i";break;case Z:H.commandType(Gr,"number","uniform "+Ce,Ie.commandStr),_t="1i";break;case ve:H.command(ro(Gr)&&Gr.length===2,"uniform "+Ce,Ie.commandStr),_t="2i";break;case N:H.command(ro(Gr)&&Gr.length===2,"uniform "+Ce,Ie.commandStr),_t="2i";break;case ut:H.command(ro(Gr)&&Gr.length===3,"uniform "+Ce,Ie.commandStr),_t="3i";break;case M:H.command(ro(Gr)&&Gr.length===3,"uniform "+Ce,Ie.commandStr),_t="3i";break;case Nt:H.command(ro(Gr)&&Gr.length===4,"uniform "+Ce,Ie.commandStr),_t="4i";break;case R:H.command(ro(Gr)&&Gr.length===4,"uniform "+Ce,Ie.commandStr),_t="4i";break}ye(at,".uniform",_t,"(",er,",",ro(Gr)?Array.prototype.slice.call(Gr):Gr,");")}continue}else br=Rt.append(Ie,ye)}else{if(!Dt(Zh))continue;br=ye.def(lt.uniforms,"[",Se.id(Ce),"]")}Et===Fn?(H(!Array.isArray(br),"must specify a scalar prop for textures"),ye("if(",br,"&&",br,'._reglType==="framebuffer"){',br,"=",br,".color[0];","}")):Et===Gn&&(H(!Array.isArray(br),"must specify a scalar prop for cube maps"),ye("if(",br,"&&",br,'._reglType==="framebufferCube"){',br,"=",br,".color[0];","}")),H.optional(function(){function au(al,Uf){Ie.assert(ye,al,'bad data or missing for uniform "'+Ce+'".  '+Uf)}function Nf(al){H(!Array.isArray(br),"must not specify an array type for uniform"),au("typeof "+br+'==="'+al+'"',"invalid type, expected "+al)}function Vo(al,Uf){Array.isArray(br)?H(br.length===al,"must have length "+al):au(lt.isArrayLike+"("+br+")&&"+br+".length==="+al,"invalid vector, should have length "+al,Ie.commandStr)}function Bf(al){H(!Array.isArray(br),"must not specify a value type"),au("typeof "+br+'==="function"&&'+br+'._reglType==="texture'+(al===sc?"2d":"Cube")+'"',"invalid texture type",Ie.commandStr)}switch(Et){case Z:Nf("number");break;case N:Vo(2,"number");break;case M:Vo(3,"number");break;case R:Vo(4,"number");break;case Sc:Nf("number");break;case zf:Vo(2,"number");break;case bo:Vo(3,"number");break;case Hc:Vo(4,"number");break;case te:Nf("boolean");break;case ve:Vo(2,"boolean");break;case ut:Vo(3,"boolean");break;case Nt:Vo(4,"boolean");break;case Pt:Vo(4,"number");break;case Sr:Vo(9,"number");break;case Ur:Vo(16,"number");break;case Fn:Bf(sc);break;case Gn:Bf(af);break}});var oi=1;switch(Et){case Fn:case Gn:var Ai=ye.def(br,"._texture");ye(at,".uniform1i(",er,",",Ai,".bind());"),ye.exit(Ai,".unbind();");continue;case Z:case te:_t="1i";break;case N:case ve:_t="2i",oi=2;break;case M:case ut:_t="3i",oi=3;break;case R:case Nt:_t="4i",oi=4;break;case Sc:_t="1f";break;case zf:_t="2f",oi=2;break;case bo:_t="3f",oi=3;break;case Hc:_t="4f",oi=4;break;case Pt:_t="Matrix2fv";break;case Sr:_t="Matrix3fv";break;case Ur:_t="Matrix4fv";break}if(ye(at,".uniform",_t,"(",er,","),_t.charAt(0)==="M"){var pa=Math.pow(Et-Pt+2,2),Zo=Ie.global.def("new Float32Array(",pa,")");Array.isArray(br)?ye("false,(",I(pa,function(au){return Zo+"["+au+"]="+br[au]}),",",Zo,")"):ye("false,(Array.isArray(",br,")||",br," instanceof Float32Array)?",br,":(",I(pa,function(au){return Zo+"["+au+"]="+br+"["+au+"]"}),",",Zo,")")}else oi>1?ye(I(oi,function(au){return Array.isArray(br)?br[au]:br+"["+au+"]"})):(H(!Array.isArray(br),"uniform value must not be an array"),ye(br));ye(");")}}function qn(Ie,ye,it,It){var Dt=Ie.shared,lt=Dt.gl,at=Dt.draw,_t=It.draw;function Le(){var Ai=_t.elements,pa,Zo=ye;return Ai?((Ai.contextDep&&It.contextDynamic||Ai.propDep)&&(Zo=it),pa=Ai.append(Ie,Zo)):pa=Zo.def(at,".",vs),pa&&Zo("if("+pa+")"+lt+".bindBuffer("+mh+","+pa+".buffer.buffer);"),pa}function et(){var Ai=_t.count,pa,Zo=ye;return Ai?((Ai.contextDep&&It.contextDynamic||Ai.propDep)&&(Zo=it),pa=Ai.append(Ie,Zo),H.optional(function(){Ai.MISSING&&Ie.assert(ye,"false","missing vertex count"),Ai.DYNAMIC&&Ie.assert(Zo,pa+">=0","missing vertex count")})):(pa=Zo.def(at,".",Gu),H.optional(function(){Ie.assert(Zo,pa+">=0","missing vertex count")})),pa}var Ce=Le();function Et(Ai){var pa=_t[Ai];return pa?pa.contextDep&&It.contextDynamic||pa.propDep?pa.append(Ie,it):pa.append(Ie,ye):ye.def(at,".",Ai)}var Rt=Et(du),_r=Et(Hu),er=et();if(typeof er=="number"){if(er===0)return}else it("if(",er,"){"),it.exit("}");var br,Gr;Hr&&(br=Et(Wu),Gr=Ie.instancing);var Un=Ce+".type",ki=_t.elements&&xl(_t.elements);function Nn(){function Ai(){it(Gr,".drawElementsInstancedANGLE(",[Rt,er,Un,_r+"<<(("+Un+"-"+_n+")>>1)",br],");")}function pa(){it(Gr,".drawArraysInstancedANGLE(",[Rt,_r,er,br],");")}Ce?ki?Ai():(it("if(",Ce,"){"),Ai(),it("}else{"),pa(),it("}")):pa()}function oi(){function Ai(){it(lt+".drawElements("+[Rt,er,Un,_r+"<<(("+Un+"-"+_n+")>>1)"]+");")}function pa(){it(lt+".drawArrays("+[Rt,_r,er]+");")}Ce?ki?Ai():(it("if(",Ce,"){"),Ai(),it("}else{"),pa(),it("}")):pa()}Hr&&(typeof br!="number"||br>=0)?typeof br=="string"?(it("if(",br,">0){"),Nn(),it("}else if(",br,"<0){"),oi(),it("}")):Nn():oi()}function Wi(Ie,ye,it,It,Dt){var lt=fi(),at=lt.proc("body",Dt);return H.optional(function(){lt.commandStr=ye.commandStr,lt.command=lt.link(ye.commandStr)}),Hr&&(lt.instancing=at.def(lt.shared.extensions,".angle_instanced_arrays")),Ie(lt,at,it,It),lt.compile().body}function $i(Ie,ye,it,It){qo(Ie,ye),it.useVAO?it.drawVAO?ye(Ie.shared.vao,".setVAO(",it.drawVAO.append(Ie,ye),");"):ye(Ie.shared.vao,".setVAO(",Ie.shared.vao,".targetVAO);"):(ye(Ie.shared.vao,".setVAO(null);"),As(Ie,ye,it,It.attributes,function(){return!0})),ha(Ie,ye,it,It.uniforms,function(){return!0}),qn(Ie,ye,ye,it)}function Co(Ie,ye){var it=Ie.proc("draw",1);qo(Ie,it),ls(Ie,it,ye.context),ws(Ie,it,ye.framebuffer),Qo(Ie,it,ye),Ts(Ie,it,ye.state),zi(Ie,it,ye,!1,!0);var It=ye.shader.progVar.append(Ie,it);if(it(Ie.shared.gl,".useProgram(",It,".program);"),ye.shader.program)$i(Ie,it,ye,ye.shader.program);else{it(Ie.shared.vao,".setVAO(null);");var Dt=Ie.global.def("{}"),lt=it.def(It,".id"),at=it.def(Dt,"[",lt,"]");it(Ie.cond(at).then(at,".call(this,a0);").else(at,"=",Dt,"[",lt,"]=",Ie.link(function(_t){return Wi($i,Ie,ye,_t,1)}),"(",It,");",at,".call(this,a0);"))}Object.keys(ye.state).length>0&&it(Ie.shared.current,".dirty=true;")}function bl(Ie,ye,it,It){Ie.batchId="a1",qo(Ie,ye);function Dt(){return!0}As(Ie,ye,it,It.attributes,Dt),ha(Ie,ye,it,It.uniforms,Dt),qn(Ie,ye,ye,it)}function Ec(Ie,ye,it,It){qo(Ie,ye);var Dt=it.contextDep,lt=ye.def(),at="a0",_t="a1",Le=ye.def();Ie.shared.props=Le,Ie.batchId=lt;var et=Ie.scope(),Ce=Ie.scope();ye(et.entry,"for(",lt,"=0;",lt,"<",_t,";++",lt,"){",Le,"=",at,"[",lt,"];",Ce,"}",et.exit);function Et(Un){return Un.contextDep&&Dt||Un.propDep}function Rt(Un){return!Et(Un)}if(it.needsContext&&ls(Ie,Ce,it.context),it.needsFramebuffer&&ws(Ie,Ce,it.framebuffer),Ts(Ie,Ce,it.state,Et),it.profile&&Et(it.profile)&&zi(Ie,Ce,it,!1,!0),It)it.useVAO?it.drawVAO?Et(it.drawVAO)?Ce(Ie.shared.vao,".setVAO(",it.drawVAO.append(Ie,Ce),");"):et(Ie.shared.vao,".setVAO(",it.drawVAO.append(Ie,et),");"):et(Ie.shared.vao,".setVAO(",Ie.shared.vao,".targetVAO);"):(et(Ie.shared.vao,".setVAO(null);"),As(Ie,et,it,It.attributes,Rt),As(Ie,Ce,it,It.attributes,Et)),ha(Ie,et,it,It.uniforms,Rt),ha(Ie,Ce,it,It.uniforms,Et),qn(Ie,et,Ce,it);else{var _r=Ie.global.def("{}"),er=it.shader.progVar.append(Ie,Ce),br=Ce.def(er,".id"),Gr=Ce.def(_r,"[",br,"]");Ce(Ie.shared.gl,".useProgram(",er,".program);","if(!",Gr,"){",Gr,"=",_r,"[",br,"]=",Ie.link(function(Un){return Wi(bl,Ie,it,Un,2)}),"(",er,");}",Gr,".call(this,a0[",lt,"],",lt,");")}}function Ve(Ie,ye){var it=Ie.proc("batch",2);Ie.batchId="0",qo(Ie,it);var It=!1,Dt=!0;Object.keys(ye.context).forEach(function(_r){It=It||ye.context[_r].propDep}),It||(ls(Ie,it,ye.context),Dt=!1);var lt=ye.framebuffer,at=!1;lt?(lt.propDep?It=at=!0:lt.contextDep&&It&&(at=!0),at||ws(Ie,it,lt)):ws(Ie,it,null),ye.state.viewport&&ye.state.viewport.propDep&&(It=!0);function _t(_r){return _r.contextDep&&It||_r.propDep}Qo(Ie,it,ye),Ts(Ie,it,ye.state,function(_r){return!_t(_r)}),(!ye.profile||!_t(ye.profile))&&zi(Ie,it,ye,!1,"a1"),ye.contextDep=It,ye.needsContext=Dt,ye.needsFramebuffer=at;var Le=ye.shader.progVar;if(Le.contextDep&&It||Le.propDep)Ec(Ie,it,ye,null);else{var et=Le.append(Ie,it);if(it(Ie.shared.gl,".useProgram(",et,".program);"),ye.shader.program)Ec(Ie,it,ye,ye.shader.program);else{it(Ie.shared.vao,".setVAO(null);");var Ce=Ie.global.def("{}"),Et=it.def(et,".id"),Rt=it.def(Ce,"[",Et,"]");it(Ie.cond(Rt).then(Rt,".call(this,a0,a1);").else(Rt,"=",Ce,"[",Et,"]=",Ie.link(function(_r){return Wi(Ec,Ie,ye,_r,2)}),"(",et,");",Rt,".call(this,a0,a1);"))}}Object.keys(ye.state).length>0&&it(Ie.shared.current,".dirty=true;")}function qt(Ie,ye){var it=Ie.proc("scope",3);Ie.batchId="a2";var It=Ie.shared,Dt=It.current;ls(Ie,it,ye.context),ye.framebuffer&&ye.framebuffer.append(Ie,it),jh(Object.keys(ye.state)).forEach(function(at){var _t=ye.state[at],Le=_t.append(Ie,it);ro(Le)?Le.forEach(function(et,Ce){it.set(Ie.next[at],"["+Ce+"]",et)}):it.set(It.next,"."+at,Le)}),zi(Ie,it,ye,!0,!0),[vs,Hu,Gu,Wu,du].forEach(function(at){var _t=ye.draw[at];!_t||it.set(It.draw,"."+at,""+_t.append(Ie,it))}),Object.keys(ye.uniforms).forEach(function(at){var _t=ye.uniforms[at].append(Ie,it);Array.isArray(_t)&&(_t="["+_t.join()+"]"),it.set(It.uniforms,"["+Se.id(at)+"]",_t)}),Object.keys(ye.attributes).forEach(function(at){var _t=ye.attributes[at].append(Ie,it),Le=Ie.scopeAttrib(at);Object.keys(new Ft).forEach(function(et){it.set(Le,"."+et,_t[et])})}),ye.scopeVAO&&it.set(It.vao,".targetVAO",ye.scopeVAO.append(Ie,it));function lt(at){var _t=ye.shader[at];_t&&it.set(It.shader,"."+at,_t.append(Ie,it))}lt(po),lt(pu),Object.keys(ye.state).length>0&&(it(Dt,".dirty=true;"),it.exit(Dt,".dirty=true;")),it("a1(",Ie.shared.context,",a0,",Ie.batchId,");")}function Ut(Ie){if(!(typeof Ie!="object"||ro(Ie))){for(var ye=Object.keys(Ie),it=0;it<ye.length;++it)if(st.isDynamic(Ie[ye[it]]))return!0;return!1}}function An(Ie,ye,it){var It=ye.static[it];if(!It||!Ut(It))return;var Dt=Ie.global,lt=Object.keys(It),at=!1,_t=!1,Le=!1,et=Ie.global.def("{}");lt.forEach(function(Et){var Rt=It[Et];if(st.isDynamic(Rt)){typeof Rt=="function"&&(Rt=It[Et]=st.unbox(Rt));var _r=Iu(Rt,null);at=at||_r.thisDep,Le=Le||_r.propDep,_t=_t||_r.contextDep}else{switch(Dt(et,".",Et,"="),typeof Rt){case"number":Dt(Rt);break;case"string":Dt('"',Rt,'"');break;case"object":Array.isArray(Rt)&&Dt("[",Rt.join(),"]");break;default:Dt(Ie.link(Rt));break}Dt(";")}});function Ce(Et,Rt){lt.forEach(function(_r){var er=It[_r];if(!!st.isDynamic(er)){var br=Et.invoke(Rt,er);Rt(et,".",_r,"=",br,";")}})}ye.dynamic[it]=new st.DynamicVariable(Si,{thisDep:at,contextDep:_t,propDep:Le,ref:et,append:Ce}),delete ye.static[it]}function Xi(Ie,ye,it,It,Dt){var lt=fi();lt.stats=lt.link(Dt),Object.keys(ye.static).forEach(function(_t){An(lt,ye,_t)}),vh.forEach(function(_t){An(lt,Ie,_t)});var at=jo(Ie,ye,it,It,lt);return Co(lt,at),qt(lt,at),Ve(lt,at),x(lt.compile(),{destroy:function(){at.shader.program.destroy()}})}return{next:wn,current:Dr,procs:function(){var Ie=fi(),ye=Ie.proc("poll"),it=Ie.proc("refresh"),It=Ie.block();ye(It),it(It);var Dt=Ie.shared,lt=Dt.gl,at=Dt.next,_t=Dt.current;It(_t,".dirty=false;"),ws(Ie,ye),ws(Ie,it,null,!0);var Le;Hr&&(Le=Ie.link(Hr)),ze.oes_vertex_array_object&&it(Ie.link(ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var et=0;et<Qt.maxAttributes;++et){var Ce=it.def(Dt.attributes,"[",et,"]"),Et=Ie.cond(Ce,".buffer");Et.then(lt,".enableVertexAttribArray(",et,");",lt,".bindBuffer(",oc,",",Ce,".buffer.buffer);",lt,".vertexAttribPointer(",et,",",Ce,".size,",Ce,".type,",Ce,".normalized,",Ce,".stride,",Ce,".offset);").else(lt,".disableVertexAttribArray(",et,");",lt,".vertexAttrib4f(",et,",",Ce,".x,",Ce,".y,",Ce,".z,",Ce,".w);",Ce,".buffer=null;"),it(Et),Hr&&it(Le,".vertexAttribDivisorANGLE(",et,",",Ce,".divisor);")}return it(Ie.shared.vao,".currentVAO=null;",Ie.shared.vao,".setVAO(",Ie.shared.vao,".targetVAO);"),Object.keys(sn).forEach(function(Rt){var _r=sn[Rt],er=It.def(at,".",Rt),br=Ie.block();br("if(",er,"){",lt,".enable(",_r,")}else{",lt,".disable(",_r,")}",_t,".",Rt,"=",er,";"),it(br),ye("if(",er,"!==",_t,".",Rt,"){",br,"}")}),Object.keys(Rr).forEach(function(Rt){var _r=Rr[Rt],er=Dr[Rt],br,Gr,Un=Ie.block();if(Un(lt,".",_r,"("),ro(er)){var ki=er.length;br=Ie.global.def(at,".",Rt),Gr=Ie.global.def(_t,".",Rt),Un(I(ki,function(Nn){return br+"["+Nn+"]"}),");",I(ki,function(Nn){return Gr+"["+Nn+"]="+br+"["+Nn+"];"}).join("")),ye("if(",I(ki,function(Nn){return br+"["+Nn+"]!=="+Gr+"["+Nn+"]"}).join("||"),"){",Un,"}")}else br=It.def(at,".",Rt),Gr=It.def(_t,".",Rt),Un(br,");",_t,".",Rt,"=",br,";"),ye("if(",br,"!==",Gr,"){",Un,"}");it(Un)}),Ie.compile()}(),compile:Xi}}function pp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Vh=34918,iu=34919,xh=35007,Gh=function(U,Se){if(!Se.ext_disjoint_timer_query)return null;var ze=[];function Qt(){return ze.pop()||Se.ext_disjoint_timer_query.createQueryEXT()}function wr(Hr){ze.push(Hr)}var Yt=[];function fr(Hr){var mn=Qt();Se.ext_disjoint_timer_query.beginQueryEXT(xh,mn),Yt.push(mn),Vr(Yt.length-1,Yt.length,Hr)}function Zr(){Se.ext_disjoint_timer_query.endQueryEXT(xh)}function Xr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var qr=[];function Kr(){return qr.pop()||new Xr}function nn(Hr){qr.push(Hr)}var fn=[];function Vr(Hr,mn,Dr){var wn=Kr();wn.startQueryIndex=Hr,wn.endQueryIndex=mn,wn.sum=0,wn.stats=Dr,fn.push(wn)}var an=[],Ft=[];function cr(){var Hr,mn,Dr=Yt.length;if(Dr!==0){Ft.length=Math.max(Ft.length,Dr+1),an.length=Math.max(an.length,Dr+1),an[0]=0,Ft[0]=0;var wn=0;for(Hr=0,mn=0;mn<Yt.length;++mn){var Nr=Yt[mn];Se.ext_disjoint_timer_query.getQueryObjectEXT(Nr,iu)?(wn+=Se.ext_disjoint_timer_query.getQueryObjectEXT(Nr,Vh),wr(Nr)):Yt[Hr++]=Nr,an[mn+1]=wn,Ft[mn+1]=Hr}for(Yt.length=Hr,Hr=0,mn=0;mn<fn.length;++mn){var sn=fn[mn],Rr=sn.startQueryIndex,on=sn.endQueryIndex;sn.sum+=an[on]-an[Rr];var Yn=Ft[Rr],$n=Ft[on];$n===Yn?(sn.stats.gpuTime+=sn.sum/1e6,nn(sn)):(sn.startQueryIndex=Yn,sn.endQueryIndex=$n,fn[Hr++]=sn)}fn.length=Hr}}return{beginQuery:fr,endQuery:Zr,pushScopeStats:Vr,update:cr,getNumPendingQueries:function(){return Yt.length},clear:function(){ze.push.apply(ze,Yt);for(var Hr=0;Hr<ze.length;Hr++)Se.ext_disjoint_timer_query.deleteQueryEXT(ze[Hr]);Yt.length=0,ze.length=0},restore:function(){Yt.length=0,ze.length=0}}},bh=16384,Sh=256,Hh=1024,dp=34962,Wh="webglcontextlost",Xh="webglcontextrestored",Eh=1,vp=2,Sf=3;function Ef(U,Se){for(var ze=0;ze<U.length;++ze)if(U[ze]===Se)return ze;return-1}function Yh(U){var Se=li(U);if(!Se)return null;var ze=Se.gl,Qt=ze.getContextAttributes(),wr=ze.isContextLost(),Yt=G(ze,Se);if(!Yt)return null;var fr=mr(),Zr=pp(),Xr=Yt.extensions,qr=Gh(ze,Xr),Kr=Jt(),nn=ze.drawingBufferWidth,fn=ze.drawingBufferHeight,Vr={tick:0,time:0,viewportWidth:nn,viewportHeight:fn,framebufferWidth:nn,framebufferHeight:fn,drawingBufferWidth:nn,drawingBufferHeight:fn,pixelRatio:Se.pixelRatio},an={},Ft={elements:null,primitive:4,count:-1,offset:0,instances:-1},cr=to(ze,Xr),Hr=Yi(ze,Zr,Se,Dr),mn=_e(ze,Xr,cr,Zr,Hr);function Dr(qn){return mn.destroyBuffer(qn)}var wn=mf(ze,Xr,Hr,Zr),Nr=ke(ze,fr,Zr,Se),sn=Bu(ze,Xr,cr,function(){Yn.procs.poll()},Vr,Zr,Se),Rr=bu(ze,Xr,cr,Zr,Se),on=L(ze,Xr,cr,sn,Rr,Zr),Yn=hp(ze,fr,Xr,cr,Hr,wn,sn,on,an,mn,Nr,Ft,Vr,qr,Se),$n=rr(ze,on,Yn.procs.poll,Vr,Qt,Xr,cr),un=Yn.next,kr=ze.canvas,Or=[],fi=[],Qn=[],On=[Se.onDestroy],Ni=null;function Ti(){if(Or.length===0){qr&&qr.update(),Ni=null;return}Ni=Mt.next(Ti),Ts();for(var qn=Or.length-1;qn>=0;--qn){var Wi=Or[qn];Wi&&Wi(Vr,null,0)}ze.flush(),qr&&qr.update()}function Bi(){!Ni&&Or.length>0&&(Ni=Mt.next(Ti))}function ca(){Ni&&(Mt.cancel(Ti),Ni=null)}function Jo(qn){qn.preventDefault(),wr=!0,ca(),fi.forEach(function(Wi){Wi()})}function ks(qn){ze.getError(),wr=!1,Yt.restore(),Nr.restore(),Hr.restore(),sn.restore(),Rr.restore(),on.restore(),mn.restore(),qr&&qr.restore(),Yn.procs.refresh(),Bi(),Qn.forEach(function(Wi){Wi()})}kr&&(kr.addEventListener(Wh,Jo,!1),kr.addEventListener(Xh,ks,!1));function Hi(){Or.length=0,ca(),kr&&(kr.removeEventListener(Wh,Jo),kr.removeEventListener(Xh,ks)),Nr.clear(),on.clear(),Rr.clear(),sn.clear(),wn.clear(),Hr.clear(),mn.clear(),qr&&qr.clear(),On.forEach(function(qn){qn()})}function So(qn){H(!!qn,"invalid args to regl({...})"),H.type(qn,"object","invalid args to regl({...})");function Wi(Dt){var lt=x({},Dt);delete lt.uniforms,delete lt.attributes,delete lt.context,delete lt.vao,"stencil"in lt&&lt.stencil.op&&(lt.stencil.opBack=lt.stencil.opFront=lt.stencil.op,delete lt.stencil.op);function at(_t){if(_t in lt){var Le=lt[_t];delete lt[_t],Object.keys(Le).forEach(function(et){lt[_t+"."+et]=Le[et]})}}return at("blend"),at("depth"),at("cull"),at("stencil"),at("polygonOffset"),at("scissor"),at("sample"),"vao"in Dt&&(lt.vao=Dt.vao),lt}function $i(Dt,lt){var at={},_t={};return Object.keys(Dt).forEach(function(Le){var et=Dt[Le];if(st.isDynamic(et)){_t[Le]=st.unbox(et,Le);return}else if(lt&&Array.isArray(et)){for(var Ce=0;Ce<et.length;++Ce)if(st.isDynamic(et[Ce])){_t[Le]=st.unbox(et,Le);return}}at[Le]=et}),{dynamic:_t,static:at}}var Co=$i(qn.context||{},!0),bl=$i(qn.uniforms||{},!0),Ec=$i(qn.attributes||{},!1),Ve=$i(Wi(qn),!1),qt={gpuTime:0,cpuTime:0,count:0},Ut=Yn.compile(Ve,Ec,bl,Co,qt),An=Ut.draw,Xi=Ut.batch,Ie=Ut.scope,ye=[];function it(Dt){for(;ye.length<Dt;)ye.push(null);return ye}function It(Dt,lt){var at;if(wr&&H.raise("context lost"),typeof Dt=="function")return Ie.call(this,null,Dt,0);if(typeof lt=="function")if(typeof Dt=="number")for(at=0;at<Dt;++at)Ie.call(this,null,lt,at);else if(Array.isArray(Dt))for(at=0;at<Dt.length;++at)Ie.call(this,Dt[at],lt,at);else return Ie.call(this,Dt,lt,0);else if(typeof Dt=="number"){if(Dt>0)return Xi.call(this,it(Dt|0),Dt|0)}else if(Array.isArray(Dt)){if(Dt.length)return Xi.call(this,Dt,Dt.length)}else return An.call(this,Dt)}return x(It,{stats:qt,destroy:function(){Ut.destroy()}})}var Ja=on.setFBO=So({framebuffer:st.define.call(null,Eh,"framebuffer")});function jo(qn,Wi){var $i=0;Yn.procs.poll();var Co=Wi.color;Co&&(ze.clearColor(+Co[0]||0,+Co[1]||0,+Co[2]||0,+Co[3]||0),$i|=bh),"depth"in Wi&&(ze.clearDepth(+Wi.depth),$i|=Sh),"stencil"in Wi&&(ze.clearStencil(Wi.stencil|0),$i|=Hh),H(!!$i,"called regl.clear with no buffer specified"),ze.clear($i)}function ls(qn){if(H(typeof qn=="object"&&qn,"regl.clear() takes an object as input"),"framebuffer"in qn)if(qn.framebuffer&&qn.framebuffer_reglType==="framebufferCube")for(var Wi=0;Wi<6;++Wi)Ja(x({framebuffer:qn.framebuffer.faces[Wi]},qn),jo);else Ja(qn,jo);else jo(null,qn)}function ws(qn){H.type(qn,"function","regl.frame() callback must be a function"),Or.push(qn);function Wi(){var $i=Ef(Or,qn);H($i>=0,"cannot cancel a frame twice");function Co(){var bl=Ef(Or,Co);Or[bl]=Or[Or.length-1],Or.length-=1,Or.length<=0&&ca()}Or[$i]=Co}return Bi(),{cancel:Wi}}function Qo(){var qn=un.viewport,Wi=un.scissor_box;qn[0]=qn[1]=Wi[0]=Wi[1]=0,Vr.viewportWidth=Vr.framebufferWidth=Vr.drawingBufferWidth=qn[2]=Wi[2]=ze.drawingBufferWidth,Vr.viewportHeight=Vr.framebufferHeight=Vr.drawingBufferHeight=qn[3]=Wi[3]=ze.drawingBufferHeight}function Ts(){Vr.tick+=1,Vr.time=zi(),Qo(),Yn.procs.poll()}function qo(){sn.refresh(),Qo(),Yn.procs.refresh(),qr&&qr.update()}function zi(){return(Jt()-Kr)/1e3}qo();function As(qn,Wi){H.type(Wi,"function","listener callback must be a function");var $i;switch(qn){case"frame":return ws(Wi);case"lost":$i=fi;break;case"restore":$i=Qn;break;case"destroy":$i=On;break;default:H.raise("invalid event, must be one of frame,lost,restore,destroy")}return $i.push(Wi),{cancel:function(){for(var Co=0;Co<$i.length;++Co)if($i[Co]===Wi){$i[Co]=$i[$i.length-1],$i.pop();return}}}}var ha=x(So,{clear:ls,prop:st.define.bind(null,Eh),context:st.define.bind(null,vp),this:st.define.bind(null,Sf),draw:So({}),buffer:function(qn){return Hr.create(qn,dp,!1,!1)},elements:function(qn){return wn.create(qn,!1)},texture:sn.create2D,cube:sn.createCube,renderbuffer:Rr.create,framebuffer:on.create,framebufferCube:on.createCube,vao:mn.createVAO,attributes:Qt,frame:ws,on:As,limits:cr,hasExtension:function(qn){return cr.extensions.indexOf(qn.toLowerCase())>=0},read:$n,destroy:Hi,_gl:ze,_refresh:qo,poll:function(){Ts(),qr&&qr.update()},now:zi,stats:Zr});return Se.onDone(null,ha),ha}return Yh})},69848:function(pr){(function(O,x){pr.exports=x()})(this,function(){"use strict";function O(mt,Ye,bt,Fe,Ae,Ne){if(!(Ae-Fe<=bt)){var xt=Fe+Ae>>1;x(mt,Ye,xt,Fe,Ae,Ne%2),O(mt,Ye,bt,Fe,xt-1,Ne+1),O(mt,Ye,bt,xt+1,Ae,Ne+1)}}function x(mt,Ye,bt,Fe,Ae,Ne){for(;Ae>Fe;){if(Ae-Fe>600){var xt=Ae-Fe+1,nr=bt-Fe+1,re=Math.log(xt),Ee=.5*Math.exp(2*re/3),ae=.5*Math.sqrt(re*Ee*(xt-Ee)/xt)*(nr-xt/2<0?-1:1),me=Math.max(Fe,Math.floor(bt-nr*Ee/xt+ae)),Te=Math.min(Ae,Math.floor(bt+(xt-nr)*Ee/xt+ae));x(mt,Ye,bt,me,Te,Ne)}var Je=Ye[2*bt+Ne],dt=Fe,$t=Ae;for(J(mt,Ye,Fe,bt),Ye[2*Ae+Ne]>Je&&J(mt,Ye,Fe,Ae);dt<$t;){for(J(mt,Ye,dt,$t),dt++,$t--;Ye[2*dt+Ne]<Je;)dt++;for(;Ye[2*$t+Ne]>Je;)$t--}Ye[2*Fe+Ne]===Je?J(mt,Ye,Fe,$t):($t++,J(mt,Ye,$t,Ae)),$t<=bt&&(Fe=$t+1),bt<=$t&&(Ae=$t-1)}}function J(mt,Ye,bt,Fe){E(mt,bt,Fe),E(Ye,2*bt,2*Fe),E(Ye,2*bt+1,2*Fe+1)}function E(mt,Ye,bt){var Fe=mt[Ye];mt[Ye]=mt[bt],mt[bt]=Fe}function p(mt,Ye,bt,Fe,Ae,Ne,xt){for(var nr=[0,mt.length-1,0],re=[],Ee,ae;nr.length;){var me=nr.pop(),Te=nr.pop(),Je=nr.pop();if(Te-Je<=xt){for(var dt=Je;dt<=Te;dt++)Ee=Ye[2*dt],ae=Ye[2*dt+1],Ee>=bt&&Ee<=Ae&&ae>=Fe&&ae<=Ne&&re.push(mt[dt]);continue}var $t=Math.floor((Je+Te)/2);Ee=Ye[2*$t],ae=Ye[2*$t+1],Ee>=bt&&Ee<=Ae&&ae>=Fe&&ae<=Ne&&re.push(mt[$t]);var Fr=(me+1)%2;(me===0?bt<=Ee:Fe<=ae)&&(nr.push(Je),nr.push($t-1),nr.push(Fr)),(me===0?Ae>=Ee:Ne>=ae)&&(nr.push($t+1),nr.push(Te),nr.push(Fr))}return re}function w(mt,Ye,bt,Fe,Ae,Ne){for(var xt=[0,mt.length-1,0],nr=[],re=Ae*Ae;xt.length;){var Ee=xt.pop(),ae=xt.pop(),me=xt.pop();if(ae-me<=Ne){for(var Te=me;Te<=ae;Te++)z(Ye[2*Te],Ye[2*Te+1],bt,Fe)<=re&&nr.push(mt[Te]);continue}var Je=Math.floor((me+ae)/2),dt=Ye[2*Je],$t=Ye[2*Je+1];z(dt,$t,bt,Fe)<=re&&nr.push(mt[Je]);var Fr=(Ee+1)%2;(Ee===0?bt-Ae<=dt:Fe-Ae<=$t)&&(xt.push(me),xt.push(Je-1),xt.push(Fr)),(Ee===0?bt+Ae>=dt:Fe+Ae>=$t)&&(xt.push(Je+1),xt.push(ae),xt.push(Fr))}return nr}function z(mt,Ye,bt,Fe){var Ae=mt-bt,Ne=Ye-Fe;return Ae*Ae+Ne*Ne}var q=function(mt){return mt[0]},Y=function(mt){return mt[1]},ce=function(Ye,bt,Fe,Ae,Ne){bt===void 0&&(bt=q),Fe===void 0&&(Fe=Y),Ae===void 0&&(Ae=64),Ne===void 0&&(Ne=Float64Array),this.nodeSize=Ae,this.points=Ye;for(var xt=Ye.length<65536?Uint16Array:Uint32Array,nr=this.ids=new xt(Ye.length),re=this.coords=new Ne(Ye.length*2),Ee=0;Ee<Ye.length;Ee++)nr[Ee]=Ee,re[2*Ee]=bt(Ye[Ee]),re[2*Ee+1]=Fe(Ye[Ee]);O(nr,re,Ae,0,nr.length-1,0)};ce.prototype.range=function(Ye,bt,Fe,Ae){return p(this.ids,this.coords,Ye,bt,Fe,Ae,this.nodeSize)},ce.prototype.within=function(Ye,bt,Fe){return w(this.ids,this.coords,Ye,bt,Fe,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(mt){return mt}},be=Math.fround||function(mt){return function(Ye){return mt[0]=+Ye,mt[0]}}(new Float32Array(1)),we=function(Ye){this.options=Pr(Object.create(ne),Ye),this.trees=new Array(this.options.maxZoom+1)};we.prototype.load=function(Ye){var bt=this.options,Fe=bt.log,Ae=bt.minZoom,Ne=bt.maxZoom,xt=bt.nodeSize;Fe&&console.time("total time");var nr="prepare "+Ye.length+" points";Fe&&console.time(nr),this.points=Ye;for(var re=[],Ee=0;Ee<Ye.length;Ee++)!Ye[Ee].geometry||re.push(Kt(Ye[Ee],Ee));this.trees[Ne+1]=new ce(re,Ht,ar,xt,Float32Array),Fe&&console.timeEnd(nr);for(var ae=Ne;ae>=Ae;ae--){var me=+Date.now();re=this._cluster(re,ae),this.trees[ae]=new ce(re,Ht,ar,xt,Float32Array),Fe&&console.log("z%d: %d clusters in %dms",ae,re.length,+Date.now()-me)}return Fe&&console.timeEnd("total time"),this},we.prototype.getClusters=function(Ye,bt){var Fe=((Ye[0]+180)%360+360)%360-180,Ae=Math.max(-90,Math.min(90,Ye[1])),Ne=Ye[2]===180?180:((Ye[2]+180)%360+360)%360-180,xt=Math.max(-90,Math.min(90,Ye[3]));if(Ye[2]-Ye[0]>=360)Fe=-180,Ne=180;else if(Fe>Ne){var nr=this.getClusters([Fe,Ae,180,xt],bt),re=this.getClusters([-180,Ae,Ne,xt],bt);return nr.concat(re)}for(var Ee=this.trees[this._limitZoom(bt)],ae=Ee.range(zt(Fe),Lt(xt),zt(Ne),Lt(Ae)),me=[],Te=0,Je=ae;Te<Je.length;Te+=1){var dt=Je[Te],$t=Ee.points[dt];me.push($t.numPoints?Zt($t):this.points[$t.index])}return me},we.prototype.getChildren=function(Ye){var bt=this._getOriginId(Ye),Fe=this._getOriginZoom(Ye),Ae="No cluster with the specified id.",Ne=this.trees[Fe];if(!Ne)throw new Error(Ae);var xt=Ne.points[bt];if(!xt)throw new Error(Ae);for(var nr=this.options.radius/(this.options.extent*Math.pow(2,Fe-1)),re=Ne.within(xt.x,xt.y,nr),Ee=[],ae=0,me=re;ae<me.length;ae+=1){var Te=me[ae],Je=Ne.points[Te];Je.parentId===Ye&&Ee.push(Je.numPoints?Zt(Je):this.points[Je.index])}if(Ee.length===0)throw new Error(Ae);return Ee},we.prototype.getLeaves=function(Ye,bt,Fe){bt=bt||10,Fe=Fe||0;var Ae=[];return this._appendLeaves(Ae,Ye,bt,Fe,0),Ae},we.prototype.getTile=function(Ye,bt,Fe){var Ae=this.trees[this._limitZoom(Ye)],Ne=Math.pow(2,Ye),xt=this.options,nr=xt.extent,re=xt.radius,Ee=re/nr,ae=(Fe-Ee)/Ne,me=(Fe+1+Ee)/Ne,Te={features:[]};return this._addTileFeatures(Ae.range((bt-Ee)/Ne,ae,(bt+1+Ee)/Ne,me),Ae.points,bt,Fe,Ne,Te),bt===0&&this._addTileFeatures(Ae.range(1-Ee/Ne,ae,1,me),Ae.points,Ne,Fe,Ne,Te),bt===Ne-1&&this._addTileFeatures(Ae.range(0,ae,Ee/Ne,me),Ae.points,-1,Fe,Ne,Te),Te.features.length?Te:null},we.prototype.getClusterExpansionZoom=function(Ye){for(var bt=this._getOriginZoom(Ye)-1;bt<=this.options.maxZoom;){var Fe=this.getChildren(Ye);if(bt++,Fe.length!==1)break;Ye=Fe[0].properties.cluster_id}return bt},we.prototype._appendLeaves=function(Ye,bt,Fe,Ae,Ne){for(var xt=this.getChildren(bt),nr=0,re=xt;nr<re.length;nr+=1){var Ee=re[nr],ae=Ee.properties;if(ae&&ae.cluster?Ne+ae.point_count<=Ae?Ne+=ae.point_count:Ne=this._appendLeaves(Ye,ae.cluster_id,Fe,Ae,Ne):Ne<Ae?Ne++:Ye.push(Ee),Ye.length===Fe)break}return Ne},we.prototype._addTileFeatures=function(Ye,bt,Fe,Ae,Ne,xt){for(var nr=0,re=Ye;nr<re.length;nr+=1){var Ee=re[nr],ae=bt[Ee],me=ae.numPoints,Te=void 0,Je=void 0,dt=void 0;if(me)Te=Xt(ae),Je=ae.x,dt=ae.y;else{var $t=this.points[ae.index];Te=$t.properties,Je=zt($t.geometry.coordinates[0]),dt=Lt($t.geometry.coordinates[1])}var Fr={type:1,geometry:[[Math.round(this.options.extent*(Je*Ne-Fe)),Math.round(this.options.extent*(dt*Ne-Ae))]],tags:Te},zr=void 0;me?zr=ae.id:this.options.generateId?zr=ae.index:this.points[ae.index].id&&(zr=this.points[ae.index].id),zr!==void 0&&(Fr.id=zr),xt.features.push(Fr)}},we.prototype._limitZoom=function(Ye){return Math.max(this.options.minZoom,Math.min(+Ye,this.options.maxZoom+1))},we.prototype._cluster=function(Ye,bt){for(var Fe=[],Ae=this.options,Ne=Ae.radius,xt=Ae.extent,nr=Ae.reduce,re=Ae.minPoints,Ee=Ne/(xt*Math.pow(2,bt)),ae=0;ae<Ye.length;ae++){var me=Ye[ae];if(!(me.zoom<=bt)){me.zoom=bt;for(var Te=this.trees[bt+1],Je=Te.within(me.x,me.y,Ee),dt=me.numPoints||1,$t=dt,Fr=0,zr=Je;Fr<zr.length;Fr+=1){var ln=zr[Fr],tr=Te.points[ln];tr.zoom>bt&&($t+=tr.numPoints||1)}if($t>=re){for(var oe=me.x*dt,ge=me.y*dt,Re=nr&&dt>1?this._map(me,!0):null,qe=(ae<<5)+(bt+1)+this.points.length,Ct=0,kt=Je;Ct<kt.length;Ct+=1){var S=kt[Ct],F=Te.points[S];if(!(F.zoom<=bt)){F.zoom=bt;var he=F.numPoints||1;oe+=F.x*he,ge+=F.y*he,F.parentId=qe,nr&&(Re||(Re=this._map(me,!0)),nr(Re,this._map(F)))}}me.parentId=qe,Fe.push(Me(oe/$t,ge/$t,qe,$t,Re))}else if(Fe.push(me),$t>1)for(var Be=0,$e=Je;Be<$e.length;Be+=1){var vt=$e[Be],wt=Te.points[vt];wt.zoom<=bt||(wt.zoom=bt,Fe.push(wt))}}}return Fe},we.prototype._getOriginId=function(Ye){return Ye-this.points.length>>5},we.prototype._getOriginZoom=function(Ye){return(Ye-this.points.length)%32},we.prototype._map=function(Ye,bt){if(Ye.numPoints)return bt?Pr({},Ye.properties):Ye.properties;var Fe=this.points[Ye.index].properties,Ae=this.options.map(Fe);return bt&&Ae===Fe?Pr({},Ae):Ae};function Me(mt,Ye,bt,Fe,Ae){return{x:be(mt),y:be(Ye),zoom:Infinity,id:bt,parentId:-1,numPoints:Fe,properties:Ae}}function Kt(mt,Ye){var bt=mt.geometry.coordinates,Fe=bt[0],Ae=bt[1];return{x:be(zt(Fe)),y:be(Lt(Ae)),zoom:Infinity,index:Ye,parentId:-1}}function Zt(mt){return{type:"Feature",id:mt.id,properties:Xt(mt),geometry:{type:"Point",coordinates:[yt(mt.x),pt(mt.y)]}}}function Xt(mt){var Ye=mt.numPoints,bt=Ye>=1e4?Math.round(Ye/1e3)+"k":Ye>=1e3?Math.round(Ye/100)/10+"k":Ye;return Pr(Pr({},mt.properties),{cluster:!0,cluster_id:mt.id,point_count:Ye,point_count_abbreviated:bt})}function zt(mt){return mt/360+.5}function Lt(mt){var Ye=Math.sin(mt*Math.PI/180),bt=.5-.25*Math.log((1+Ye)/(1-Ye))/Math.PI;return bt<0?0:bt>1?1:bt}function yt(mt){return(mt-.5)*360}function pt(mt){var Ye=(180-mt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ye))/Math.PI-90}function Pr(mt,Ye){for(var bt in Ye)mt[bt]=Ye[bt];return mt}function Ht(mt){return mt.x}function ar(mt){return mt.y}return we})},75752:function(pr){pr.exports.RADIUS=6378137,pr.exports.FLATTENING=1/298.257223563,pr.exports.POLAR_RADIUS=63567523142e-4}}]);
